<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>SNS Content Engine â€” AI ê¸°ë°˜ ì½˜í…ì¸  í”Œë«í¼</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>
<style>
:root{--bg1:#0a0b0f;--bg2:#111219;--bg3:#181922;--bg4:#1f2029;--bg5:#282936;--border:rgba(255,255,255,.06);--border2:rgba(255,255,255,.1);--t1:#f0f1f5;--t2:#a8aab5;--t3:#5a5b6a;--ac:#f97316;--ac2:#ff8a2b;--acs:rgba(249,115,22,.1);--b:#60a5fa;--g:#34d399;--r:#f87171;--p:#a78bfa;--glass:rgba(255,255,255,.03);--ff:'Pretendard',-apple-system,sans-serif;--fb:'Pretendard',sans-serif;--fm:'SF Mono','Fira Code',monospace;--r1:8px;--r2:12px;--r3:16px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:var(--ff);background:var(--bg1);color:var(--t1);font-size:15px;line-height:1.55;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-thumb{background:var(--bg5);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--t3)}
.wrap{display:flex;min-height:100vh}
/* SIDEBAR */
.side{width:230px;background:var(--bg2);border-right:1px solid var(--border);padding:16px 12px;display:flex;flex-direction:column;position:fixed;height:100vh;overflow-y:auto;z-index:10}
.logo{font-size:1.15em;font-weight:700;padding:8px 8px 4px;margin-bottom:8px;display:flex;align-items:center;gap:10px;letter-spacing:-.3px}.logo .dot{width:10px;height:10px;border-radius:50%;background:var(--ac);box-shadow:0 0 12px rgba(249,115,22,.5)}
.nav-section-label{font-size:.65em;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:1.5px;padding:12px 10px 6px}
.nav-i{display:flex;align-items:center;gap:10px;width:100%;padding:9px 12px;border:none;background:none;color:var(--t2);font-size:.88em;font-weight:500;border-radius:10px;cursor:pointer;text-align:left;transition:all .2s;font-family:var(--fb);position:relative;margin:1px 0}
.nav-i:hover{background:rgba(255,255,255,.04);color:var(--t1)}
.nav-i.a{background:linear-gradient(135deg,rgba(249,115,22,.12),rgba(249,115,22,.05));color:var(--ac);font-weight:600}
.nav-i.a::before{content:'';position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--ac);border-radius:0 3px 3px 0}
.ni{font-size:1.1em;width:22px;text-align:center;flex-shrink:0}
.nav-sep{height:1px;background:var(--border);margin:6px 4px}
/* MAIN */
.main{margin-left:230px;flex:1;padding:0}
/* TOP BAR */
.top{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;padding:14px 32px;background:rgba(10,11,15,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);flex-wrap:wrap;gap:8px}
.top-l{display:flex;align-items:center;gap:10px}.top-l .hamburger{display:none;background:none;border:none;color:var(--t1);font-size:1.4em;cursor:pointer}
.mbadge{background:linear-gradient(135deg,var(--acs),rgba(249,115,22,.05));color:var(--ac);padding:4px 12px;border-radius:20px;font-size:.75em;font-weight:600;border:1px solid rgba(249,115,22,.15)}
.btn-s{background:var(--glass);color:var(--t2);border:1px solid var(--border);padding:5px 12px;border-radius:var(--r1);cursor:pointer;font-size:.82em;transition:.2s;font-family:var(--fb)}.btn-s:hover{border-color:var(--ac);color:var(--ac)}
.mnav{display:none;overflow-x:auto;gap:4px;padding:4px 0;margin-bottom:10px}
.mnav button{flex-shrink:0;padding:6px 12px;background:var(--bg3);border:1px solid var(--border);border-radius:20px;color:var(--t2);font-size:.8em;cursor:pointer;white-space:nowrap;font-family:var(--fb)}
.mnav button.a{background:var(--acs);color:var(--ac);border-color:rgba(249,115,22,.2)}
/* TABS */
.tab-c{display:none;padding:28px 32px}.tab-c.a{display:block}
.ph{margin-bottom:20px}.pt{font-size:1.3em;font-weight:700;display:flex;align-items:center;gap:10px;letter-spacing:-.3px}.ps{color:var(--t2);font-size:.88em;margin-top:4px}
/* CARDS */
.sc{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);overflow:hidden;margin-bottom:16px;transition:all .3s}
.sc:hover{border-color:var(--border2)}
.sch{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.sct{font-weight:600;font-size:.92em}.scb{padding:18px}
/* INPUTS */
.mi{width:100%;padding:10px 14px;background:var(--bg4);border:1px solid var(--border);border-radius:10px;color:var(--t1);font-size:.9em;font-family:var(--fb);outline:none;transition:all .2s;margin-bottom:8px}
.mi:focus{border-color:var(--ac);box-shadow:0 0 0 3px rgba(249,115,22,.08)}.mi::placeholder{color:var(--t3)}
select.mi{cursor:pointer;appearance:none}
textarea.mi{resize:vertical;min-height:80px}
.mlbl{font-size:.82em;color:var(--t2);margin-bottom:4px;font-weight:600}
/* BUTTONS */
.btn-p{padding:10px 22px;background:linear-gradient(135deg,var(--ac),var(--ac2));color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:.88em;transition:all .2s;font-family:var(--fb);box-shadow:0 2px 8px rgba(249,115,22,.25)}.btn-p:hover{filter:brightness(1.1);transform:translateY(-1px);box-shadow:0 4px 16px rgba(249,115,22,.35)}.btn-p:disabled{opacity:.5;cursor:not-allowed;transform:none}.btn-p.full{width:100%}
.btn-o{padding:7px 16px;background:var(--glass);color:var(--t2);border:1px solid var(--border);border-radius:10px;cursor:pointer;font-size:.84em;transition:all .2s;font-family:var(--fb)}.btn-o:hover{border-color:var(--ac);color:var(--ac);background:var(--acs)}
.bg{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
/* STEPS */
.steps{display:flex;gap:0;margin-bottom:16px;background:var(--bg3);border-radius:var(--r2);overflow:hidden;border:1px solid var(--border)}
.step{flex:1;padding:10px 6px;text-align:center;font-size:.8em;color:var(--t3);cursor:pointer;transition:.2s;position:relative}
.step.a{color:var(--ac);background:var(--acs)}.step.done{color:var(--g)}
.step-n{display:block;font-weight:700;font-size:1em;font-family:var(--fm)}
/* RESULTS */
.sc-body{display:none}.sc-body.a{display:block}
.ra{display:none;margin-top:12px}.ra.show{display:block}
.rc{font-size:.88em;color:var(--t2);line-height:1.7;white-space:pre-wrap;max-height:350px;overflow-y:auto;padding:12px;background:var(--bg4);border-radius:var(--r2)}
/* IMAGES */
.ig{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.isl{width:68px;height:68px;border:1px dashed var(--border);border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;transition:.2s;flex-shrink:0;position:relative}
.isl:hover{border-color:var(--ac);background:var(--acs)}.isl.filled{border-style:solid}.isl img{width:100%;height:100%;object-fit:cover}
/* MISC */
.ebtn{padding:5px 12px;background:var(--glass);border:1px solid var(--border);border-radius:20px;color:var(--t2);font-size:.8em;cursor:pointer;transition:.2s;font-family:var(--fb)}.ebtn:hover{border-color:var(--ac);color:var(--ac)}
.fpi{margin-bottom:6px}.fpt{display:flex;align-items:center;gap:4px;width:100%;padding:8px 12px;background:var(--bg4);border:1px solid var(--border);border-radius:10px;color:var(--t2);font-size:.85em;cursor:pointer;font-family:var(--fb);transition:.2s}.fpt.a{color:var(--g);border-color:rgba(52,211,153,.2);background:rgba(52,211,153,.05)}
.fpc{display:none;padding:6px 0}.fpc.show{display:block}.fta{width:100%;padding:8px 10px;background:var(--bg1);border:1px solid var(--border);border-radius:10px;color:var(--t1);font-size:.85em;font-family:var(--fb);min-height:50px;resize:vertical}
.ad-plats{display:flex;flex-wrap:wrap;gap:6px;margin:8px 0}
.ad-plat{padding:5px 12px;background:var(--glass);border:1px solid var(--border);border-radius:20px;color:var(--t2);font-size:.8em;cursor:pointer;transition:.2s;font-family:var(--fb)}.ad-plat.a{background:var(--acs);color:var(--ac);border-color:rgba(249,115,22,.2)}
.cmp-vs{display:grid;grid-template-columns:1fr 50px 1fr;gap:12px;align-items:start}.cmp-mid{text-align:center;font-weight:700;color:var(--ac);padding-top:30px}
/* TABLES */
.dt{width:100%;border-collapse:collapse;font-size:.82em}.dt th{background:var(--bg4);padding:10px 8px;text-align:left;font-weight:600;color:var(--t2);border-bottom:1px solid var(--border)}.dt td{padding:8px;border-bottom:1px solid var(--border);color:var(--t2)}.ts{overflow-x:auto}
/* BADGES */
.badge{padding:3px 8px;border-radius:8px;font-size:.75em;font-weight:600}
.badge.green,.badge.good{background:rgba(52,211,153,.15);color:var(--g)}
.badge.yellow{background:rgba(250,204,21,.12);color:#facc15}
.badge.blue,.badge.neutral{background:rgba(96,165,250,.12);color:var(--b)}
.badge.red,.badge.bad{background:rgba(248,113,113,.12);color:var(--r)}
/* STATS */
.stat-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
.stat-card{background:var(--bg4);border:1px solid var(--border);border-radius:var(--r2);padding:14px;text-align:center;transition:all .3s}
.stat-card:hover{border-color:var(--border2);transform:translateY(-2px)}
.stat-v{font-size:1.4em;font-weight:700;color:var(--ac);font-family:var(--fm)}.stat-l{font-size:.78em;color:var(--t2);margin-top:3px}
.tip-box{padding:14px 16px;background:linear-gradient(135deg,var(--acs),rgba(96,165,250,.05));border:1px solid rgba(249,115,22,.12);border-radius:var(--r2);font-size:.88em;color:var(--t2);line-height:1.6;margin-top:10px}.tip-box b{color:var(--ac)}
/* MODALS */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:99;backdrop-filter:blur(8px)}.modal.show{display:flex}
.modal-c{background:var(--bg3);border:1px solid var(--border);border-radius:20px;padding:24px;width:90%;max-width:420px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.modal-t{font-weight:700;font-size:1.1em;margin-bottom:14px}
.md{font-size:.8em;color:var(--t3);margin-top:6px}
/* ANIMATIONS */
.spinner{display:inline-block;width:14px;height:14px;border:2px solid transparent;border-top-color:currentColor;border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle;margin-right:4px}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--bg3);color:var(--t1);padding:12px 24px;border-radius:var(--r2);font-size:.88em;border:1px solid var(--border);transition:.3s;opacity:0;z-index:100;box-shadow:0 8px 32px rgba(0,0,0,.3)}.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
@keyframes sp{to{transform:rotate(360deg)}}@keyframes fu{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
/* LOGOS */
.p-logo{width:24px;height:24px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px;flex-shrink:0}
.p-logo.naver{background:#03C75A}.p-logo.naver::after{content:'N';color:#fff;font-weight:800;font-size:13px}
.p-logo.ig{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888)}.p-logo.ig::after{content:'';width:11px;height:11px;border:2px solid #fff;border-radius:3px}
.p-logo.fbk{background:#1877F2}.p-logo.fbk::after{content:'f';color:#fff;font-weight:800;font-size:14px}
/* A/B */
.ab-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:10px}
.ab-col{background:var(--bg4);border:1px solid var(--border);border-radius:var(--r2);padding:16px;position:relative}
.ab-lbl{position:absolute;top:-8px;left:12px;padding:0 8px;font-size:.78em;font-weight:700;background:var(--bg4);border-radius:4px}
.ab-lbl.a-lbl{color:var(--ac)}.ab-lbl.b-lbl{color:var(--b)}
/* CREDIT */
.credit-bar{display:flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;background:linear-gradient(135deg,rgba(249,115,22,.08),rgba(249,115,22,.03));border:1px solid rgba(249,115,22,.15);font-size:.8em;color:var(--t2)}
.credit-bar .credit-val,.credit-bar .cv{color:var(--ac);font-weight:600;font-family:var(--fm)}
/* PILLS */
.sub-pills{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}.sub-pill{padding:7px 16px;background:var(--glass);border:1px solid var(--border);border-radius:20px;font-size:.88em;cursor:pointer;transition:all .2s;color:var(--t2);font-family:var(--fb)}.sub-pill.a{background:var(--acs);color:var(--ac);border-color:rgba(249,115,22,.2)}
/* OOH */
.ooh-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.ooh-card{background:var(--bg4);border:1px solid var(--border);border-radius:var(--r3);padding:18px;transition:all .3s;cursor:pointer}.ooh-card:hover{border-color:var(--ac);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.3)}
.ooh-icon{font-size:1.8em;margin-bottom:6px}.ooh-name{font-weight:600;font-size:.98em;margin-bottom:4px}.ooh-price{font-size:.88em;color:var(--ac);margin-bottom:6px;font-weight:600}.ooh-info{font-size:.82em;color:var(--t2);line-height:1.5}
.ooh-detail-box{background:var(--bg4);border:1px solid var(--border);border-radius:var(--r3);padding:18px;margin-top:12px;display:none}.ooh-detail-box.show{display:block}
.tag-list{display:flex;flex-wrap:wrap;gap:5px;margin-top:8px}.tag{padding:3px 10px;background:var(--glass);border:1px solid var(--border);border-radius:14px;font-size:.78em;color:var(--t2)}
/* DASHBOARD */
.dash-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:18px}
.dash-grid.full{grid-column:1/-1}
.hero-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}
.hero-card{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);padding:22px 24px;transition:all .3s;position:relative;overflow:hidden;animation:fadeUp .4s ease forwards;opacity:0}
.hero-card:nth-child(1){animation-delay:0s}.hero-card:nth-child(2){animation-delay:.08s}.hero-card:nth-child(3){animation-delay:.16s}.hero-card:nth-child(4){animation-delay:.24s}
.hero-card:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.2)}
.hero-card::after{content:'';position:absolute;top:0;right:0;width:80px;height:80px;border-radius:0 0 0 80px;opacity:.05}
.hero-card:nth-child(1)::after{background:var(--ac)}.hero-card:nth-child(2)::after{background:var(--r)}.hero-card:nth-child(3)::after{background:var(--b)}.hero-card:nth-child(4)::after{background:var(--p)}
.hero-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.hero-label{font-size:.85em;color:var(--t2);font-weight:500}
.hero-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1em}
.hero-icon.views{background:rgba(249,115,22,.12);color:var(--ac)}
.hero-icon.exposure{background:rgba(248,113,113,.12);color:var(--r)}
.hero-icon.posts{background:rgba(96,165,250,.12);color:var(--b)}
.hero-icon.engage{background:rgba(167,139,250,.12);color:var(--p)}
.hero-val{font-size:2.1em;font-weight:800;font-family:var(--fm);color:var(--t1);line-height:1.1;margin-bottom:6px;letter-spacing:-.5px}
.hero-change{font-size:.82em;font-weight:600}.hero-change.up{color:var(--g)}.hero-change.down{color:var(--r)}.hero-change .arrow{margin-right:2px}
.hero-sub{font-size:.78em;color:var(--t3);margin-top:2px}
/* TREND */
.trend-card{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);padding:22px;margin-bottom:18px}
.trend-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.trend-title{font-size:1em;font-weight:600;display:flex;align-items:center;gap:8px}
.trend-tabs{display:flex;gap:0;background:var(--bg4);border-radius:8px;padding:2px;border:1px solid var(--border)}
.trend-tab{padding:6px 16px;border-radius:6px;font-size:.82em;cursor:pointer;color:var(--t3);font-family:var(--fb);border:none;background:none;transition:.2s;font-weight:500}
.trend-tab.a{background:var(--bg1);color:var(--t1);font-weight:600;box-shadow:0 1px 3px rgba(0,0,0,.3)}
.trend-tab:hover:not(.a){color:var(--t2)}
.trend-chart{display:flex;align-items:flex-end;gap:8px;height:180px;padding-top:10px}
.trend-bar-group{flex:1;display:flex;gap:3px;align-items:flex-end;height:100%}
.trend-bar{border-radius:4px 4px 0 0;transition:all .4s cubic-bezier(.4,0,.2,1);min-width:8px;flex:1;cursor:pointer;position:relative}
.trend-bar:hover{filter:brightness(1.3)}
.trend-bar.naver{background:linear-gradient(180deg,#3B82F6,rgba(59,130,246,.4))}.trend-bar.insta{background:linear-gradient(180deg,var(--ac),rgba(249,115,22,.4))}
.trend-day-label{text-align:center;font-size:.72em;color:var(--t3);margin-top:6px;font-weight:500}
.trend-legend{display:flex;gap:16px;margin-top:14px;padding-top:12px;border-top:1px solid var(--border)}
.trend-legend-item{display:flex;align-items:center;gap:6px;font-size:.78em;color:var(--t2)}
.trend-legend-dot{width:8px;height:8px;border-radius:3px}
/* VISUAL */
.visual-card{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);padding:22px;height:100%;transition:all .3s}
.visual-card:hover{border-color:var(--border2)}
.card-header{font-size:1em;font-weight:600;margin-bottom:18px;display:flex;align-items:center;gap:10px;color:var(--t1)}
.card-icon{font-size:1.4em}
.progress-row{margin-bottom:14px}
.progress-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:.85em}
.progress-bar{background:var(--bg1);height:12px;border-radius:20px;overflow:hidden;position:relative}
.progress-fill{height:100%;border-radius:20px;transition:all .8s cubic-bezier(.4,0,.2,1);position:relative;background:linear-gradient(90deg,var(--ac),var(--b))}
.progress-fill::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:shimmer 2s infinite}
@keyframes shimmer{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.mini-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.mini-card{background:var(--bg4);border:1px solid var(--border);border-radius:var(--r2);padding:16px;text-align:center;transition:all .3s}
.mini-card:hover{border-color:var(--ac);transform:translateY(-2px)}
.mini-num{font-size:1.6em;font-weight:700;font-family:var(--fm);color:var(--ac);margin-bottom:4px}
.mini-label{font-size:.82em;color:var(--t3)}
/* KEYWORDS */
.kw-grid{display:flex;flex-wrap:wrap;gap:8px}
.kw-pill{padding:8px 16px;background:var(--glass);border:1px solid var(--border);border-radius:20px;font-size:.9em;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:8px}
.kw-pill:hover{background:var(--acs);border-color:var(--ac);color:var(--ac);transform:scale(1.05)}
.kw-score{background:linear-gradient(135deg,var(--ac),var(--b));color:#fff;padding:3px 10px;border-radius:14px;font-size:.78em;font-weight:600}
.strength-grid{display:grid;gap:12px}
.strength-item{padding:14px;background:var(--bg4);border-left:3px solid var(--g);border-radius:var(--r2);font-size:.9em;color:var(--t2);line-height:1.6;transition:.2s}
.strength-item:hover{background:var(--bg5)}.strength-item.weak{border-left-color:var(--r)}
.insight-box{background:linear-gradient(135deg,rgba(249,115,22,.06),rgba(96,165,250,.06));border:1px solid rgba(249,115,22,.15);border-radius:var(--r3);padding:20px;margin-bottom:18px}
.insight-title{font-size:1em;font-weight:600;color:var(--ac);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.insight-text{font-size:.9em;color:var(--t2);line-height:1.7}
/* COMPARE */
.compare-row{display:flex;justify-content:space-between;align-items:center;padding:14px;background:var(--bg4);border-radius:var(--r2);margin-bottom:8px;font-size:.9em;transition:.2s;border:1px solid transparent}
.compare-row:hover{background:var(--bg5);border-color:var(--border)}
.compare-label{color:var(--t2)}.compare-values{display:flex;align-items:center;gap:12px}.compare-ours{color:var(--ac);font-weight:600}.compare-theirs{color:var(--t3);font-size:.9em}
/* PLATFORM CARDS */
.platform-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin-bottom:18px}
.platform-card{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);padding:16px;transition:all .3s;cursor:pointer;position:relative;overflow:hidden}
.platform-card::before{content:'';position:absolute;top:0;left:0;width:3px;height:100%;transition:.3s}
.platform-card:hover{transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.25);border-color:rgba(255,255,255,.1)}
.platform-card.naver::before{background:#03C75A}.platform-card.insta::before{background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888)}.platform-card.facebook::before{background:#1877F2}.platform-card.homepage::before{background:var(--ac)}
.pc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.pc-title{display:flex;align-items:center;gap:8px;font-size:.85em;font-weight:600}
.pc-logo{width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:6px}
.pc-row{display:flex;justify-content:space-between;align-items:center;padding:4px 0;font-size:.8em}
.pc-row-label{color:var(--t3)}.pc-row-val{font-weight:600;font-family:var(--fm);color:var(--t1)}.pc-row-val.accent{color:var(--ac)}
.pc-eff-bar{margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.pc-eff-row{display:flex;align-items:center;gap:6px}
.pc-grade{font-size:.85em;font-weight:700;padding:3px 10px;border-radius:8px;font-family:var(--fm)}
.pc-grade.s{background:rgba(52,211,153,.2);color:var(--g)}.pc-grade.a{background:rgba(249,115,22,.15);color:var(--ac)}.pc-grade.b{background:rgba(96,165,250,.15);color:var(--b)}.pc-grade.c{background:rgba(248,113,113,.15);color:var(--r)}
.pc-cost{font-size:.72em;color:var(--t2)}
/* RANK TABLE */
.kw-rank-table{width:100%;font-size:.8em;border-collapse:collapse}
.kw-rank-table th{text-align:left;padding:8px 10px;color:var(--t3);font-weight:600;border-bottom:1px solid var(--border);font-size:.9em}
.kw-rank-table td{padding:8px 10px;border-bottom:1px solid rgba(42,42,58,.5);color:var(--t2)}
.kw-rank-table tr:hover{background:var(--bg4)}
.rank-num{font-family:var(--fm);font-weight:700;font-size:1em}.rank-num.top{color:var(--g)}.rank-num.mid{color:var(--ac)}.rank-num.low{color:var(--r)}
.rank-change{font-size:.8em;font-weight:600}.rank-change.up{color:var(--g)}.rank-change.down{color:var(--r)}.rank-change.same{color:var(--t3)}
/* BLOG EDITOR */
#blog-editor:empty:before{content:attr(data-placeholder);color:var(--t3);pointer-events:none}
#blog-editor img{max-width:100%;border-radius:8px;margin:12px 0;display:block;cursor:pointer}
#blog-editor img:hover{outline:2px solid var(--ac);outline-offset:2px}
#blog-editor img.selected{outline:2px solid var(--r);outline-offset:2px}
#blog-editor p{margin-bottom:8px}
/* BLOG PREVIEW */
.blog-preview{background:#fff;border-radius:16px;max-width:720px;overflow:hidden;color:#333;font-family:'Noto Sans KR','Malgun Gothic',sans-serif;box-shadow:0 4px 24px rgba(0,0,0,.1)}
.bp-header{background:#fff;padding:18px 22px;border-bottom:1px solid #eee}
.bp-profile{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.bp-avatar{width:38px;height:38px;border-radius:50%;background:#03C75A;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:.85em}
.bp-author{font-size:.88em;font-weight:600;color:#333}.bp-date{font-size:.78em;color:#999}
.bp-title{font-size:1.3em;font-weight:700;color:#222;line-height:1.4;padding:22px 22px 12px}
.bp-body{padding:0 22px 22px;font-size:.92em;line-height:1.9;color:#333;word-break:keep-all}
.bp-body p{margin-bottom:14px}.bp-body img{width:100%;border-radius:8px;margin:14px 0}
.bp-body .bp-img-placeholder{background:#f5f5f5;border:1px dashed #ddd;border-radius:8px;padding:32px;text-align:center;color:#aaa;margin:14px 0;font-size:.85em}
.bp-tags{padding:12px 22px 18px;display:flex;flex-wrap:wrap;gap:5px}.bp-tag{font-size:.82em;color:#03C75A;cursor:default}
.bp-footer{padding:14px 22px;border-top:1px solid #eee;display:flex;gap:16px;font-size:.82em;color:#888}
.bp-footer span{display:flex;align-items:center;gap:4px;cursor:default}
/* ACCOUNTS */
.accounts-bar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.account-chip{display:flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;font-size:.78em;font-weight:500;border:1px solid var(--border);background:var(--glass);transition:all .2s}
.account-chip.connected{border-color:rgba(52,211,153,.25);background:rgba(52,211,153,.06);color:var(--g)}
.account-chip.disconnected{color:var(--t3);cursor:pointer}
.account-chip.disconnected:hover{border-color:var(--ac);color:var(--ac);background:var(--acs)}
/* USER MENU */
.user-menu{position:absolute;right:12px;top:50px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r2);padding:8px;min-width:200px;z-index:100;display:none;box-shadow:0 12px 40px rgba(0,0,0,.4)}
.user-menu.show{display:block}
.user-menu-item{display:flex;align-items:center;gap:8px;padding:9px 12px;border-radius:8px;color:var(--t2);font-size:.85em;cursor:pointer;border:none;background:none;width:100%;text-align:left;font-family:var(--ff);transition:.2s}
.user-menu-item:hover{background:var(--bg4);color:var(--t1)}
/* LANDING PAGE */
.login-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg1);z-index:9999;overflow-y:auto}
.login-overlay.hidden{display:none}
/* Nav */
.lp-nav{display:flex;align-items:center;justify-content:space-between;padding:16px 40px;border-bottom:1px solid var(--border);position:sticky;top:0;background:rgba(10,11,15,.88);backdrop-filter:blur(20px);z-index:10}
.lp-nav-logo{display:flex;align-items:center;gap:10px;font-weight:800;font-size:1.1em;letter-spacing:-.3px}.lp-nav-logo .dot{width:10px;height:10px;border-radius:50%;background:var(--ac);box-shadow:0 0 12px rgba(249,115,22,.5)}
.lp-nav-links{display:flex;gap:28px}.lp-nav-links a{color:var(--t3);text-decoration:none;font-size:.85em;font-weight:500;transition:color .2s}.lp-nav-links a:hover{color:var(--t1)}
.lp-nav-cta{padding:8px 20px;border-radius:8px;border:none;background:linear-gradient(135deg,var(--ac),var(--ac2));color:#fff;font-weight:600;font-size:.85em;cursor:pointer;font-family:var(--ff);box-shadow:0 4px 16px rgba(249,115,22,.25);transition:all .2s}.lp-nav-cta:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(249,115,22,.35)}
/* Hero */
.lp-hero{display:flex;align-items:center;justify-content:center;min-height:85vh;padding:60px 40px;gap:60px;position:relative;overflow:hidden}
.lp-hero::before{content:'';position:absolute;top:-20%;left:30%;width:700px;height:700px;background:radial-gradient(circle,rgba(249,115,22,.08) 0%,transparent 65%);pointer-events:none}
.lp-hero::after{content:'';position:absolute;bottom:-10%;right:20%;width:500px;height:500px;background:radial-gradient(circle,rgba(96,165,250,.06) 0%,transparent 60%);pointer-events:none}
.lp-hero-left{flex:1;max-width:520px;position:relative;z-index:1}
.lp-hero-right{flex:1;max-width:540px;position:relative;z-index:1}
.lp-tag{padding:6px 16px;border-radius:20px;background:rgba(249,115,22,.06);border:1px solid rgba(249,115,22,.15);font-size:.72em;color:var(--ac);display:inline-flex;align-items:center;gap:6px;margin-bottom:22px;font-weight:600;animation:lpFadeUp .7s ease both}
.lp-tag .pulse{width:6px;height:6px;border-radius:50%;background:var(--ac);animation:lpBlink 2s ease infinite}
@keyframes lpBlink{0%,100%{opacity:1}50%{opacity:.3}}
.lp-h1{font-size:clamp(2.2em,3.8vw,3.2em);font-weight:800;line-height:1.15;margin-bottom:18px;letter-spacing:-.5px;animation:lpFadeUp .7s ease .08s both}
.lp-h1 em{font-style:normal;background:linear-gradient(135deg,var(--ac),var(--ac2),#fbbf24);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.lp-p{color:var(--t2);font-size:1em;line-height:1.8;margin-bottom:30px;font-weight:400;animation:lpFadeUp .7s ease .16s both}
.lp-btns{display:flex;gap:12px;flex-wrap:wrap;animation:lpFadeUp .7s ease .24s both}
.lp-btn-naver{display:flex;align-items:center;justify-content:center;gap:10px;padding:14px 28px;border-radius:12px;border:none;background:linear-gradient(135deg,#03cf5d,#02a84a);color:#fff;font-size:.92em;font-weight:700;cursor:pointer;font-family:var(--ff);box-shadow:0 6px 24px rgba(3,207,93,.2);transition:all .3s}
.lp-btn-naver:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(3,207,93,.3)}
.lp-btn-meta{display:flex;align-items:center;justify-content:center;gap:10px;padding:14px 28px;border-radius:12px;border:none;background:linear-gradient(135deg,#1877f2,#0d65d9);color:#fff;font-size:.92em;font-weight:700;cursor:pointer;font-family:var(--ff);box-shadow:0 6px 24px rgba(24,119,242,.2);transition:all .3s}
.lp-btn-meta:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(24,119,242,.3)}
.lp-btn-skip{padding:14px 24px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);color:var(--t2);font-size:.92em;font-weight:600;cursor:pointer;font-family:var(--ff);transition:all .3s;backdrop-filter:blur(10px)}
.lp-btn-skip:hover{border-color:rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:var(--t1)}
.lp-social-hint{margin-top:16px;font-size:.75em;color:var(--t3);display:flex;align-items:center;gap:10px;animation:lpFadeUp .7s ease .32s both}
.lp-social-hint .plat-dots{display:flex;gap:4px}
.lp-social-hint .plat-dots span{width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.6em;font-weight:800;color:#fff}
/* Mock card */
.lp-mock{background:var(--bg2);border:1px solid var(--border);border-radius:20px;padding:24px;position:relative;overflow:hidden;animation:lpFadeUp .8s ease .2s both}
.lp-mock::before{content:'';position:absolute;top:-40%;right:-30%;width:160%;height:160%;background:radial-gradient(circle at 30% 30%,rgba(249,115,22,.03),transparent 50%);pointer-events:none}
.lp-mock-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.lp-mock-head span{font-size:.8em;font-weight:600;color:var(--t2)}.lp-mock-head .live{font-size:.7em;color:var(--ac);display:flex;align-items:center;gap:5px}
.lp-mock-head .live::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--ac);animation:lpBlink 1.5s ease infinite}
.lp-mock-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:18px}
.lp-mock-stat{background:rgba(255,255,255,.03);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,.04)}
.lp-mock-stat .mv{font-size:1.5em;font-weight:700;margin-bottom:2px;font-family:var(--fm)}.lp-mock-stat .mv.green{color:var(--g)}.lp-mock-stat .mv.orange{color:var(--ac)}.lp-mock-stat .mv.blue{color:var(--b)}
.lp-mock-stat .ml{font-size:.68em;color:var(--t3)}
.lp-mock-bars{display:flex;align-items:end;gap:5px;height:90px;padding-top:8px}
.lp-mock-bar{flex:1;border-radius:4px 4px 0 0;transition:height 1s ease}
/* Features */
.lp-features{padding:80px 40px 60px;text-align:center;position:relative}
.lp-features::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent)}
.lp-features h2{font-size:1.8em;font-weight:800;margin-bottom:10px;letter-spacing:-.3px}
.lp-features>p{color:var(--t3);margin-bottom:48px;font-size:.95em}
.lp-feat-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;max-width:960px;margin:0 auto}
.lp-feat-card{background:var(--bg2);border:1px solid rgba(255,255,255,.04);border-radius:16px;padding:28px 22px;text-align:left;transition:all .35s;cursor:default}
.lp-feat-card:hover{border-color:rgba(249,115,22,.12);transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,.3)}
.lp-feat-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3em;margin-bottom:14px}
.lp-feat-card h3{font-size:.95em;font-weight:700;margin-bottom:6px;color:var(--t1)}
.lp-feat-card p{font-size:.78em;color:var(--t3);line-height:1.7}
/* CTA footer */
.lp-cta-section{text-align:center;padding:60px 40px 80px;position:relative}
.lp-cta-section::before{content:'';position:absolute;top:0;left:10%;right:10%;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent)}
.lp-cta-section h3{font-size:1.4em;font-weight:700;margin-bottom:8px}
.lp-cta-section p{color:var(--t3);margin-bottom:28px;font-size:.9em}
@keyframes lpFadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
/* Keyword Ranking Bars */
.kwr-bar-row{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.kwr-bar-label{font-size:.78em;color:var(--t1);font-weight:600;width:90px;flex-shrink:0;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.kwr-bar-track{flex:1;height:26px;background:var(--bg4);border-radius:8px;overflow:hidden;position:relative}
.kwr-bar-fill{height:100%;border-radius:8px;display:flex;align-items:center;padding-left:10px;font-size:.7em;font-weight:700;color:#fff;transition:width .8s ease;min-width:30px}
.kwr-bar-val{font-size:.75em;color:var(--t2);font-weight:600;width:60px;flex-shrink:0;text-align:right;font-family:var(--fm)}
/* Period pills */
.kwr-period-pills{display:flex;gap:4px}
.kwr-period-pill{padding:4px 12px;border-radius:16px;border:1px solid var(--border);background:transparent;color:var(--t3);font-size:.72em;font-weight:600;cursor:pointer;font-family:var(--ff);transition:all .2s;white-space:nowrap}
.kwr-period-pill:hover{border-color:rgba(249,115,22,.3);color:var(--t1)}
.kwr-period-pill.active{background:var(--acs);border-color:rgba(249,115,22,.3);color:var(--ac)}
/* Venn diagram */
.venn-wrap{position:relative;width:100%;height:280px;display:flex;align-items:center;justify-content:center}
.venn-circle{position:absolute;border-radius:50%;opacity:.25;transition:all .4s}
.venn-circle:hover{opacity:.4}
.venn-label{position:absolute;font-size:.72em;font-weight:700;text-align:center;pointer-events:none;line-height:1.4}
.venn-center-label{position:absolute;font-size:.68em;font-weight:800;color:var(--ac);text-align:center;pointer-events:none}
.venn-legend{display:flex;gap:16px;justify-content:center;margin-top:8px;flex-wrap:wrap}
.venn-legend-item{display:flex;align-items:center;gap:6px;font-size:.75em;color:var(--t2)}
.venn-legend-dot{width:10px;height:10px;border-radius:50%}
/* AI Strategy Cards */
.ai-strat-card{background:var(--bg4);border-radius:var(--r2);padding:14px 16px;border-left:3px solid var(--ac);transition:all .3s}
.ai-strat-card:hover{border-left-color:var(--ac2);background:rgba(255,255,255,.03)}
.ai-strat-icon{font-size:1.4em;margin-bottom:6px}
.ai-strat-title{font-size:.78em;font-weight:700;color:var(--ac);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.ai-strat-text{font-size:.82em;color:var(--t2);line-height:1.65}
/* Exposure level badge */
.expo-badge{display:inline-flex;align-items:center;gap:3px;padding:2px 8px;border-radius:6px;font-size:.6em;font-weight:700;letter-spacing:.3px}
.expo-badge.high{background:rgba(249,115,22,.12);color:var(--ac)}
.expo-badge.mid{background:rgba(96,165,250,.12);color:var(--b)}
.expo-badge.low{background:rgba(90,91,106,.15);color:var(--t3)}
/* RESPONSIVE */
@media(max-width:768px){.side{display:none;position:fixed;width:260px}.side.open{display:flex}.main{margin-left:0;padding:0}.tab-c{padding:16px}.mnav{display:flex}.top-l .hamburger{display:block}.ab-grid{grid-template-columns:1fr}.cmp-vs{grid-template-columns:1fr}.ooh-cards{grid-template-columns:1fr}.dash-grid{grid-template-columns:1fr}.hero-grid{grid-template-columns:1fr 1fr}.mini-grid{grid-template-columns:repeat(2,1fr)}.platform-cards{grid-template-columns:repeat(2,1fr)}.kw-rank-table{font-size:.7em}.trend-chart{height:120px}.top{padding:12px 16px}.blog-preview{border-radius:0}.lp-hero{flex-direction:column;padding:40px 20px;min-height:auto;gap:36px}.lp-nav{padding:12px 16px}.lp-nav-links{display:none}.lp-feat-grid{grid-template-columns:1fr}.lp-features{padding:40px 20px}.lp-btns{flex-direction:column}.lp-cta-section{padding:40px 20px}}
</style></head><body>

<!-- LANDING PAGE -->
<div class="login-overlay" id="login-overlay">

<!-- Navigation -->
<nav class="lp-nav">
<div class="lp-nav-logo"><span class="dot"></span>SNS Engine</div>
<div class="lp-nav-links">
<a href="#lp-features">ê¸°ëŠ¥</a>
<a href="#" onclick="event.preventDefault();skipLogin()">ë°ëª¨</a>
</div>
<button class="lp-nav-cta" onclick="loginNaver()">ë¬´ë£Œ ì‹œì‘ â†’</button>
</nav>

<!-- Hero Section -->
<div class="lp-hero">
<div class="lp-hero-left">
<div class="lp-tag"><span class="pulse"></span>AI Content Engine v5</div>
<h1 class="lp-h1">SNS ì½˜í…ì¸ ,<br><em>AIê°€ ëŒ€ì‹ </em><br>ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤</h1>
<p class="lp-p">ë„¤ì´ë²„ ë¸”ë¡œê·¸, ì¸ìŠ¤íƒ€ê·¸ë¨, í˜ì´ìŠ¤ë¶ ì½˜í…ì¸ ë¥¼ AIê°€ A/B ë‘ ê°€ì§€ ì•ˆìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤. í‚¤ì›Œë“œ ë¶„ì„ë¶€í„° ì„±ê³¼ ì¶”ì ê¹Œì§€ í•œ ê³³ì—ì„œ.</p>
<div class="lp-btns">
<button class="lp-btn-naver" onclick="loginNaver()">
<svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M16.273 12.845L7.376 0H0v24h7.727V11.155L16.624 24H24V0h-7.727z"/></svg>
ë„¤ì´ë²„ë¡œ ì‹œì‘
</button>
<button class="lp-btn-meta" onclick="loginMeta()">
<svg width="18" height="18" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
Facebook ì‹œì‘
</button>
<button class="lp-btn-skip" onclick="skipLogin()">ë‘˜ëŸ¬ë³´ê¸° â†’</button>
</div>
<div class="lp-social-hint">
<div class="plat-dots">
<span style="background:#03C75A">N</span>
<span style="background:linear-gradient(135deg,#E4405F,#fd1d1d)">I</span>
<span style="background:#1877F2">f</span>
</div>
3ê°œ í”Œë«í¼ ë™ì‹œ ì—°ë™ Â· ë¬´ë£Œ ì²´í—˜
</div>
</div>

<!-- Mock Dashboard -->
<div class="lp-hero-right">
<div class="lp-mock">
<div class="lp-mock-head"><span>ğŸ“Š ëŒ€ì‹œë³´ë“œ</span><span class="live">ì‹¤ì‹œê°„</span></div>
<div class="lp-mock-stats">
<div class="lp-mock-stat"><div class="mv green">12,847</div><div class="ml">ì´ ì¡°íšŒìˆ˜</div></div>
<div class="lp-mock-stat"><div class="mv orange">3,240</div><div class="ml">íŒ”ë¡œì›Œ</div></div>
<div class="lp-mock-stat"><div class="mv blue">8.7%</div><div class="ml">ì°¸ì—¬ìœ¨</div></div>
</div>
<div class="lp-mock-bars" id="lp-mock-bars"></div>
<div style="display:flex;justify-content:space-between;margin-top:12px">
<span style="font-size:.65em;color:var(--t3)">ì›”</span>
<span style="font-size:.65em;color:var(--t3)">í™”</span>
<span style="font-size:.65em;color:var(--t3)">ìˆ˜</span>
<span style="font-size:.65em;color:var(--t3)">ëª©</span>
<span style="font-size:.65em;color:var(--t3)">ê¸ˆ</span>
<span style="font-size:.65em;color:var(--t3)">í† </span>
<span style="font-size:.65em;color:var(--t3)">ì¼</span>
</div>
</div>
</div>
</div>

<!-- Features Section -->
<div class="lp-features" id="lp-features">
<h2>ì™œ SNS Engineì¸ê°€ìš”?</h2>
<p>ì½˜í…ì¸  ë§ˆì¼€íŒ…ì˜ ëª¨ë“  ê²ƒì„ í•˜ë‚˜ì˜ í”Œë«í¼ì—ì„œ</p>
<div class="lp-feat-grid">
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(249,115,22,.08)">ğŸ“</div>
<h3>A/B ì½˜í…ì¸  ìƒì„±</h3>
<p>ì „ë¬¸í˜•ê³¼ ì¹œê·¼í˜•, ë‘ ê°€ì§€ ì•ˆì„ ë™ì‹œì— ìƒì„±í•˜ê³  AIê°€ ë¹„êµ ë¶„ì„ê¹Œì§€ í•´ë“œë¦½ë‹ˆë‹¤</p>
</div>
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(34,197,94,.08)">ğŸ”</div>
<h3>í‚¤ì›Œë“œ ë¶„ì„</h3>
<p>ê²€ìƒ‰ëŸ‰, ê²½ìŸë„, 12ê°œì›” íŠ¸ë Œë“œë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ê³  ìµœì  í‚¤ì›Œë“œë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤</p>
</div>
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(96,165,250,.08)">ğŸ“Š</div>
<h3>ì„±ê³¼ ëŒ€ì‹œë³´ë“œ</h3>
<p>ë„¤ì´ë²„ Â· ì¸ìŠ¤íƒ€ Â· í˜ì´ìŠ¤ë¶ ë°ì´í„°ë¥¼ ì—°ë™í•˜ì—¬ í•œëˆˆì— ì„±ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
</div>
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(236,72,153,.08)">âš–ï¸</div>
<h3>ê²½ìŸì‚¬ ë¶„ì„</h3>
<p>ë‚´ ì½˜í…ì¸ ì™€ ê²½ìŸì‚¬ë¥¼ AIê°€ í•­ëª©ë³„ë¡œ ë¹„êµí•˜ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì „ëµì„ ì œì•ˆí•©ë‹ˆë‹¤</p>
</div>
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(59,130,246,.08)">ğŸ“¢</div>
<h3>ê´‘ê³  ì‹œë®¬ë ˆì´í„°</h3>
<p>ì˜ˆì‚° Â· íƒ€ê²Ÿ Â· ì§€ì—­ë³„ ROIë¥¼ ì˜ˆì¸¡í•˜ê³  ìµœì  ê´‘ê³  ì „ëµì„ ì¶”ì²œí•©ë‹ˆë‹¤</p>
</div>
<div class="lp-feat-card">
<div class="lp-feat-icon" style="background:rgba(168,85,247,.08)">ğŸ¨</div>
<h3>ë¬¸ì²´ í•™ìŠµ</h3>
<p>ê¸°ì¡´ ê¸€ì˜ ë¬¸ì²´ë¥¼ AIê°€ í•™ìŠµí•˜ì—¬ ì¼ê´€ëœ í†¤ìœ¼ë¡œ ì½˜í…ì¸ ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</p>
</div>
</div>
</div>

<!-- CTA Bottom -->
<div class="lp-cta-section">
<h3>ì§€ê¸ˆ ë°”ë¡œ ì‹œì‘í•˜ì„¸ìš”</h3>
<p>ë¡œê·¸ì¸ë§Œ í•˜ë©´ ì‹¤ì œ ë°ì´í„°ê°€ ìë™ ì—°ë™ë©ë‹ˆë‹¤</p>
<div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
<button class="lp-btn-naver" onclick="loginNaver()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M16.273 12.845L7.376 0H0v24h7.727V11.155L16.624 24H24V0h-7.727z"/></svg>
ë„¤ì´ë²„ë¡œ ì‹œì‘í•˜ê¸°
</button>
<button class="lp-btn-meta" onclick="loginMeta()">
<svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
Facebookìœ¼ë¡œ ì‹œì‘í•˜ê¸°
</button>
</div>
</div>

</div>

<div class="wrap">
<div class="side" id="sidebar">
<div class="logo"><span class="dot"></span>SNS Engine</div>

<div class="nav-section-label" style="margin-top:4px">ì½˜í…ì¸ </div>
<button class="nav-i a" onclick="go('blog')" data-t="blog"><span class="ni"><span class="p-logo naver"></span></span>ë¸”ë¡œê·¸</button>
<button class="nav-i" onclick="go('insta')" data-t="insta"><span class="ni"><span class="p-logo ig"></span></span>ì¸ìŠ¤íƒ€ê·¸ë¨</button>
<button class="nav-i" onclick="go('fb')" data-t="fb"><span class="ni"><span class="p-logo fbk"></span></span>í˜ì´ìŠ¤ë¶</button>

<div class="nav-section-label">ë§ˆì¼€íŒ…</div>
<button class="nav-i" onclick="go('sp')" data-t="sp"><span class="ni">ğŸ“</span>ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤</button>
<button class="nav-i" onclick="go('ooh')" data-t="ooh"><span class="ni">ğŸ“‹</span>ì˜¥ì™¸ê´‘ê³ </button>

<div class="nav-section-label">ë¶„ì„</div>
<button class="nav-i" onclick="go('dash')" data-t="dash"><span class="ni">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ</button>
<button class="nav-i" onclick="go('kwresearch')" data-t="kwresearch"><span class="ni">ğŸ”</span>í‚¤ì›Œë“œ ë¶„ì„</button>
<button class="nav-i" onclick="go('compare')" data-t="compare"><span class="ni">âš–ï¸</span>ë¹„êµ ë¶„ì„</button>
<button class="nav-i" onclick="go('adsim')" data-t="adsim"><span class="ni">ğŸ“¢</span>ê´‘ê³  ì‹œë®¬ë ˆì´í„°</button>

<div class="nav-section-label">ë„êµ¬</div>
<button class="nav-i" onclick="go('style')" data-t="style"><span class="ni">ğŸ¨</span>ë¬¸ì²´ í•™ìŠµ</button>
<button class="nav-i" onclick="go('download')" data-t="download"><span class="ni">ğŸ“¥</span>ë‹¤ìš´ë¡œë“œ</button>

<div style="flex:1"></div>
<!-- ì‚¬ì´ë“œë°” í•˜ë‹¨ ìœ ì € ì¹´ë“œ -->
<div class="sidebar-user" id="sidebar-user-card" onclick="toggleUserMenu()" style="display:flex;align-items:center;gap:10px;padding:12px;border-radius:12px;background:var(--glass);border:1px solid var(--border);cursor:pointer;margin-top:8px;transition:all .2s">
<div style="width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--ac),var(--ac2));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85em;color:#fff;flex-shrink:0" id="sidebar-avatar">?</div>
<div style="flex:1;min-width:0">
<div style="font-size:.82em;font-weight:600;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis" id="sidebar-user-name">ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”</div>
<div style="font-size:.68em;color:var(--t3)" id="sidebar-user-plan">Free</div>
</div>
</div>
</div>

<div class="main">
<!-- STICKY TOP BAR -->
<div class="top">
<div class="top-l">
<button class="hamburger" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button>
<span class="mbadge">AI Engine v5</span>
<div class="accounts-bar" id="accounts-bar">
<span class="account-chip disconnected" id="chip-naver" onclick="loginNaver()" title="ë„¤ì´ë²„ ì—°ê²°">ğŸŸ¢ ë„¤ì´ë²„ ì—°ê²°</span>
<span class="account-chip disconnected" id="chip-meta" onclick="loginMeta()" title="Facebook ì—°ê²°">ğŸ”µ Meta ì—°ê²°</span>
</div>
</div>
<div class="top-r" style="display:flex;align-items:center;gap:10px">
<div class="credit-bar" id="credit-bar">ğŸ”‘ í¬ë ˆë”§: <span class="credit-val" id="credit-display">$0.00</span></div>
<div style="position:relative">
<button class="btn-o" id="user-avatar" onclick="toggleUserMenu()" style="display:flex;align-items:center;gap:5px;padding:6px 14px;font-size:.85em;border-radius:20px">â˜° ë©”ë‰´</button>
<div class="user-menu" id="user-menu">
<div id="user-menu-name" style="padding:10px 12px;font-weight:600;font-size:.88em;color:var(--t1);border-bottom:1px solid var(--border);margin-bottom:4px">ë©”ë‰´</div>
<button class="user-menu-item" onclick="showM('m-myinfo')">ğŸ‘¤ ë‚´ ì •ë³´</button>
<button class="user-menu-item" id="btn-connect-naver" onclick="loginNaver()">ğŸŸ¢ ë„¤ì´ë²„ ì—°ê²°</button>
<button class="user-menu-item" id="btn-connect-meta" onclick="loginMeta()">ğŸ”µ Facebook ì—°ê²°</button>
<button class="user-menu-item" onclick="showCreditHistory()">ğŸ’° í¬ë ˆë”§ ë‚´ì—­</button>
<button class="user-menu-item" onclick="goToLogin()">ğŸ” ë¡œê·¸ì¸ í™”ë©´</button>
<button class="user-menu-item" onclick="logoutAll()" style="color:var(--r)">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
</div>
</div>
</div>
</div>
<div class="mnav" id="mnav"></div>

<!-- ==================== BLOG TAB ==================== -->
<div class="tab-c a" id="blog-tab">
<div class="ph"><div class="pt"><span class="p-logo naver"></span> ë„¤ì´ë²„ ë¸”ë¡œê·¸</div><div class="ps">AIê°€ A/B ë‘ ê°€ì§€ ì•ˆì„ ìƒì„±í•˜ê³  ë¹„êµ ë¶„ì„í•©ë‹ˆë‹¤</div></div>

<!-- ìŠ¤í… ì¸ë””ì¼€ì´í„° -->
<div class="steps" id="blog-steps">
<div class="step a" onclick="bst(0)"><span class="step-n">01</span>ì •ë³´ ì…ë ¥</div>
<div class="step" onclick="bst(1)"><span class="step-n">02</span>A/B ìƒì„±</div>
<div class="step" onclick="bst(2)"><span class="step-n">03</span>ìˆ˜ì •Â·ê²€ìˆ˜</div>
<div class="step" onclick="bst(3)"><span class="step-n">04</span>ì´ë¯¸ì§€Â·ì™„ì„±</div>
<div class="step" onclick="bst(4)"><span class="step-n">05</span>ë¯¸ë¦¬ë³´ê¸°</div>
</div>

<!-- STEP 0: ì •ë³´ ì…ë ¥ -->
<div class="sc-body a" id="bs0">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“ ê¸°ë³¸ ì •ë³´</div></div><div class="scb">
<div class="mlbl">ëª©ì </div><select class="mi" id="b-purpose"><option>ì‹œê³µì‚¬ë¡€ í™ë³´</option><option>ì¥ë¹„ ì†Œê°œ</option><option>í–‰ì‚¬ í›„ê¸°</option><option>ê¸°ìˆ  ì •ë³´</option><option>ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜</option></select>
<div class="mlbl">í–‰ì‚¬/í˜„ì¥ëª…</div><input class="mi" id="b-event" placeholder="ì˜ˆ: 2024 ì½”ì—‘ìŠ¤ ì „ì‹œíšŒ">
<div class="mlbl">ê°•ì¡° í¬ì¸íŠ¸</div><input class="mi" id="b-highlight" placeholder="ì˜ˆ: ì´ˆëŒ€í˜• LED, ì‹¤ì‹œê°„ ì¤‘ê³„">
</div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“‹ ìƒì„¸ ë‚´ìš©</div></div><div class="scb">
<div class="mlbl">ì£¼ìš” ë‚´ìš©, íŠ¹ì´ì‚¬í•­ ë“±</div><textarea class="mi" id="b-detail" placeholder="ìì„¸íˆ ì ì„ìˆ˜ë¡ AIê°€ ë” ì •í™•í•œ ê¸€ì„ ìƒì„±í•©ë‹ˆë‹¤..." style="min-height:160px"></textarea>
</div></div>
</div>
<div style="margin-top:16px"><button class="btn-p full" onclick="bst(1)" style="padding:14px;font-size:.95em">ë‹¤ìŒ â†’ A/B ìƒì„±</button></div>
</div>

<!-- STEP 1: A/B ìƒì„± -->
<div class="sc-body" id="bs1">
<button class="btn-p full" onclick="genBlog()" id="blog-gen-btn" style="padding:14px;font-size:.95em">ğŸ¤– A/B ë‘ ê°€ì§€ ì•ˆ ìƒì„±í•˜ê¸°</button>
<div class="ra" id="blog-ra">
<div class="ab-grid"><div class="ab-col"><span class="ab-lbl a-lbl">Aì•ˆ (ì „ë¬¸í˜•)</span><div class="rc" id="blog-rc-a"></div></div><div class="ab-col"><span class="ab-lbl b-lbl">Bì•ˆ (ì¹œê·¼í˜•)</span><div class="rc" id="blog-rc-b"></div></div></div>
<div class="sc" style="margin-top:14px"><div class="sch"><div class="sct">âš–ï¸ A/B ë¹„êµ ë¶„ì„</div></div><div class="scb"><div class="rc" id="blog-ab-diff"></div></div></div>
<div style="display:flex;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap">
<button class="btn-p" onclick="pickAB('blog','a')">âœ… Aì•ˆ ì„ íƒ</button>
<button class="btn-p" onclick="pickAB('blog','b')" style="background:linear-gradient(135deg,var(--b),#818cf8)">âœ… Bì•ˆ ì„ íƒ</button>
<button class="btn-o" onclick="genBlog()">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
<div style="margin-left:auto;font-size:.82em;color:var(--t3);display:flex;align-items:center;gap:8px">í¬ë ˆë”§: <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="blog-credit">$0.00</span> | ëˆ„ì : <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="blog-credit-total">$0.00</span></div>
</div>
</div></div>

<!-- STEP 2: ìˆ˜ì •Â·ê²€ìˆ˜ (2ë‹¨ ë ˆì´ì•„ì›ƒ) -->
<div class="sc-body" id="bs2">
<div class="sc"><div class="sch"><div class="sct">âœï¸ ìˆ˜ì •Â·ê²€ìˆ˜</div><div style="display:flex;gap:4px"><button class="btn-o" onclick="bst(1)" style="font-size:.8em">â† ì´ì „</button><button class="btn-p" onclick="bst(3)" style="font-size:.8em">ë‹¤ìŒ â†’</button></div></div><div class="scb">
<!-- ì—ë””í„° íˆ´ë°” -->
<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px;padding:8px 10px;background:var(--bg1);border:1px solid var(--border);border-radius:10px">
<button class="ebtn" onclick="aiCheck('blog-edit-ta','spell')">ğŸ” ì˜¤íƒˆì</button>
<button class="ebtn" onclick="aiCheck('blog-edit-ta','sensitive')">âš ï¸ ì˜ˆë¯¼í‘œí˜„</button>
<button class="ebtn" onclick="aiCheck('blog-edit-ta','improve')">âœ¨ ë‹¤ë“¬ê¸°</button>
<button class="ebtn" onclick="editorInsertTag()">ğŸ·ï¸ íƒœê·¸</button>
<span style="width:1px;background:var(--border);margin:0 4px"></span>
<button class="ebtn" style="background:var(--acs);border-color:rgba(249,115,22,.2);color:var(--ac)" onclick="editorInsertImage()">ğŸ“· ì´ë¯¸ì§€ ì‚½ì…</button>
<input type="file" id="blog-inline-file" accept="image/*" style="display:none" onchange="handleEditorImg(this)">
</div>
<!-- ë¦¬ì¹˜ ì—ë””í„° -->
<div id="blog-editor" contenteditable="true" style="width:100%;min-height:320px;padding:16px;background:var(--bg4);border:1px solid var(--border);border-radius:12px;color:var(--t1);font-size:.9em;font-family:var(--fb);line-height:1.8;outline:none;overflow-y:auto;max-height:500px;word-break:keep-all" data-placeholder="ì„ íƒí•œ ì•ˆì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. ê¸€ ì‚¬ì´ì— ì´ë¯¸ì§€ë¥¼ ììœ ë¡­ê²Œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."></div>
<textarea class="mi" id="blog-edit-ta" style="display:none"></textarea>
</div></div>
</div>

<!-- STEP 3: ì´ë¯¸ì§€Â·ì™„ì„± -->
<div class="sc-body" id="bs3">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ–¼ï¸ ëŒ€í‘œ ì´ë¯¸ì§€ (ì¸ë„¤ì¼)</div></div><div class="scb">
<div class="mlbl">ë¸”ë¡œê·¸ ìƒë‹¨ì— í‘œì‹œë  ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
<div class="ig" id="blog-imgs"><div class="isl" onclick="this.querySelector('input').click()"><span style="color:var(--t3);font-size:1.4em">+</span><input type="file" accept="image/*" style="display:none" onchange="addI(this,'blog-imgs')"></div></div>
</div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“‹ ìµœì¢… ê²°ê³¼</div></div><div class="scb"><div class="rc" id="blog-final" style="max-height:400px"></div>
<div style="display:flex;gap:6px;margin-top:10px"><button class="btn-p" onclick="copyF('blog')">ğŸ“‹ ì „ì²´ ë³µì‚¬</button><button class="btn-p" onclick="bst(4)" style="background:linear-gradient(135deg,var(--b),#818cf8)">ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°</button><button class="btn-o" onclick="bst(2)">â† ìˆ˜ì •</button></div>
</div></div>
</div>
</div>

<!-- STEP 4: ë¯¸ë¦¬ë³´ê¸° -->
<div class="sc-body" id="bs4">
<div class="sc"><div class="sch"><div class="sct">ğŸ‘€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë¯¸ë¦¬ë³´ê¸°</div><div style="display:flex;gap:6px"><button class="btn-o" onclick="bst(2)">âœï¸ ìˆ˜ì •í•˜ê¸°</button><button class="btn-p" onclick="copyF('blog')">ğŸ“‹ ë³µì‚¬</button></div></div><div class="scb" style="background:var(--bg1);padding:24px;display:flex;justify-content:center">
<div class="blog-preview" id="blog-preview-card"></div>
</div></div>
</div></div>

<!-- ==================== INSTA TAB ==================== -->
<div class="tab-c" id="insta-tab">
<div class="ph"><div class="pt"><span class="p-logo ig"></span> ì¸ìŠ¤íƒ€ê·¸ë¨</div><div class="ps">A/B ìº¡ì…˜ì„ ë¹„êµ ìƒì„±í•©ë‹ˆë‹¤</div></div>
<div class="steps" id="insta-steps"><div class="step a" onclick="ist(0)"><span class="step-n">01</span>ì‚¬ì§„Â·ì •ë³´</div><div class="step" onclick="ist(1)"><span class="step-n">02</span>A/B ìº¡ì…˜</div><div class="step" onclick="ist(2)"><span class="step-n">03</span>ê²€ìˆ˜Â·ì™„ì„±</div></div>

<!-- STEP 0 -->
<div class="sc-body a" id="is0">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“¸ ì´ë¯¸ì§€ & ë¬¸êµ¬</div></div><div class="scb">
<div class="ig" id="insta-imgs"><div class="isl" onclick="this.querySelector('input').click()"><span style="color:var(--t3);font-size:1.4em">+</span><input type="file" accept="image/*" style="display:none" onchange="addI(this,'insta-imgs')"></div></div>
<button class="btn-o" onclick="addIS('insta-imgs')" style="margin-bottom:10px">+ ì‚¬ì§„ ì¶”ê°€</button>
<div class="fpi"><button class="fpt a" onclick="togFP(this)">âœ… ë„ì… ë¬¸êµ¬</button><div class="fpc show"><textarea class="fta" id="i-intro">ì•ˆë…•í•˜ì„¸ìš”, ë°©ì†¡ì¤‘ê³„ ì „ë¬¸ ê¸°ì—…ì…ë‹ˆë‹¤! ğŸ¬ğŸ“¡</textarea></div></div>
<div class="fpi"><button class="fpt a" onclick="togFP(this)">âœ… ë§ˆë¬´ë¦¬ ë¬¸êµ¬</button><div class="fpc show"><textarea class="fta" id="i-outro">ğŸ“ ë¬¸ì˜ëŠ” DM ë˜ëŠ” ì „í™”ë¡œ!\nğŸ”— í”„ë¡œí•„ ë§í¬ì—ì„œ ìì„¸í•œ ì •ë³´ í™•ì¸</textarea></div></div>
</div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">âœï¸ ìº¡ì…˜ ë‚´ìš©</div></div><div class="scb">
<div class="mlbl">ìº¡ì…˜ì— í¬í•¨í•  ë‚´ìš©</div><textarea class="mi" id="i-content" placeholder="ìº¡ì…˜ì— í¬í•¨í•  ë‚´ìš©..." style="min-height:100px"></textarea>
<div class="mlbl">í•´ì‹œíƒœê·¸ ì¹´í…Œê³ ë¦¬</div>
<div class="ad-plats" id="i-htag">
<button class="ad-plat a" data-tags="#ë°©ì†¡ì¤‘ê³„ #LEDì „ê´‘íŒ #ì´ë²¤íŠ¸ì˜ìƒ #í–‰ì‚¬ì´¬ì˜" onclick="this.classList.toggle('a')">ë°©ì†¡ì¤‘ê³„</button>
<button class="ad-plat" data-tags="#LEDìŠ¤í¬ë¦° #ì „ê´‘íŒë Œíƒˆ #ì´ë²¤íŠ¸ #ë¬´ëŒ€ì—°ì¶œ" onclick="this.classList.toggle('a')">LEDì¥ë¹„</button>
<button class="ad-plat" data-tags="#ê¸°ì—…í–‰ì‚¬ #ì»¨í¼ëŸ°ìŠ¤ #ì„¸ë¯¸ë‚˜ #ì „ì‹œíšŒ" onclick="this.classList.toggle('a')">í–‰ì‚¬</button>
</div>
</div></div>
</div>
<div style="margin-top:16px"><button class="btn-p full" onclick="ist(1)" style="padding:14px;font-size:.95em">ë‹¤ìŒ â†’ A/B ìº¡ì…˜ ìƒì„±</button></div>
</div>

<!-- STEP 1 -->
<div class="sc-body" id="is1">
<button class="btn-p full" onclick="genInsta()" id="insta-gen-btn" style="padding:14px;font-size:.95em">ğŸ¤– A/B ìº¡ì…˜ ìƒì„±</button>
<div class="ra" id="insta-ra">
<div class="ab-grid"><div class="ab-col"><span class="ab-lbl a-lbl">Aì•ˆ (ì •ë³´í˜•)</span><div class="rc" id="insta-rc-a"></div></div><div class="ab-col"><span class="ab-lbl b-lbl">Bì•ˆ (ê°ì„±í˜•)</span><div class="rc" id="insta-rc-b"></div></div></div>
<div class="sc" style="margin-top:14px"><div class="sch"><div class="sct">âš–ï¸ ë¹„êµ</div></div><div class="scb"><div class="rc" id="insta-ab-diff"></div></div></div>
<div style="display:flex;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap">
<button class="btn-p" onclick="pickAB('insta','a')">âœ… Aì•ˆ</button>
<button class="btn-p" onclick="pickAB('insta','b')" style="background:linear-gradient(135deg,var(--b),#818cf8)">âœ… Bì•ˆ</button>
<button class="btn-o" onclick="genInsta()">ğŸ”„ ë‹¤ì‹œ</button>
<div style="margin-left:auto;font-size:.82em;color:var(--t3)">í¬ë ˆë”§: <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="insta-credit">$0.00</span> | ëˆ„ì : <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="insta-credit-total">$0.00</span></div>
</div>
</div></div>

<!-- STEP 2 -->
<div class="sc-body" id="is2">
<div class="sc"><div class="sch"><div class="sct">âœï¸ ê²€ìˆ˜Â·ì™„ì„±</div><div style="display:flex;gap:4px"><button class="btn-o" onclick="ist(1)" style="font-size:.8em">â† ì´ì „</button></div></div><div class="scb">
<textarea class="mi" id="insta-edit-ta" style="min-height:150px"></textarea>
<div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px">
<button class="ebtn" onclick="aiCheck('insta-edit-ta','spell')">ğŸ” ì˜¤íƒˆì</button>
<button class="ebtn" onclick="aiCheck('insta-edit-ta','improve')">âœ¨ ë‹¤ë“¬ê¸°</button>
<div style="flex:1"></div>
<button class="btn-p" onclick="copyF('insta')">ğŸ“‹ ë³µì‚¬</button>
</div>
</div></div></div></div>

<!-- ==================== FB TAB ==================== -->
<div class="tab-c" id="fb-tab">
<div class="ph"><div class="pt"><span class="p-logo fbk"></span> í˜ì´ìŠ¤ë¶</div><div class="ps">A/B ê²Œì‹œë¬¼ ë¹„êµ ìƒì„±</div></div>
<div class="steps" id="fb-steps"><div class="step a" onclick="fst(0)"><span class="step-n">01</span>ì •ë³´</div><div class="step" onclick="fst(1)"><span class="step-n">02</span>A/B ìƒì„±</div><div class="step" onclick="fst(2)"><span class="step-n">03</span>ì™„ì„±</div></div>

<div class="sc-body a" id="fs0">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“˜ ì´ë¯¸ì§€ & ë¬¸êµ¬</div></div><div class="scb">
<div class="ig" id="fb-imgs"><div class="isl" onclick="this.querySelector('input').click()"><span style="color:var(--t3);font-size:1.4em">+</span><input type="file" accept="image/*" style="display:none" onchange="addI(this,'fb-imgs')"></div></div>
<div class="fpi"><button class="fpt a" onclick="togFP(this)">âœ… ë„ì… ë¬¸êµ¬</button><div class="fpc show"><textarea class="fta" id="f-intro">ë°©ì†¡ì¤‘ê³„Â·LEDì‹œìŠ¤í…œ ì „ë¬¸ ê¸°ì—…ì´ ì „í•˜ëŠ” í˜„ì¥ ì´ì•¼ê¸° ğŸ“º</textarea></div></div>
<div class="fpi"><button class="fpt a" onclick="togFP(this)">âœ… ë§ˆë¬´ë¦¬ ë¬¸êµ¬</button><div class="fpc show"><textarea class="fta" id="f-outro">ìì„¸í•œ ë¬¸ì˜ëŠ” í™ˆí˜ì´ì§€ ë˜ëŠ” ì „í™”ë¡œ ì—°ë½ì£¼ì„¸ìš”! ğŸ“</textarea></div></div>
</div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">âœï¸ ê²Œì‹œë¬¼ ë‚´ìš©</div></div><div class="scb">
<textarea class="mi" id="f-content" placeholder="ê²Œì‹œë¬¼ì— í¬í•¨í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." style="min-height:180px"></textarea>
</div></div>
</div>
<div style="margin-top:16px"><button class="btn-p full" onclick="fst(1)" style="padding:14px;font-size:.95em">A/B ìƒì„± â†’</button></div>
</div>

<div class="sc-body" id="fs1">
<button class="btn-p full" onclick="genFB()" id="fb-gen-btn" style="padding:14px;font-size:.95em">ğŸ¤– A/B ê²Œì‹œë¬¼ ìƒì„±</button>
<div class="ra" id="fb-ra">
<div class="ab-grid"><div class="ab-col"><span class="ab-lbl a-lbl">Aì•ˆ (ì •ë³´í˜•)</span><div class="rc" id="fb-rc-a"></div></div><div class="ab-col"><span class="ab-lbl b-lbl">Bì•ˆ (ê³µê°í˜•)</span><div class="rc" id="fb-rc-b"></div></div></div>
<div class="sc" style="margin-top:14px"><div class="sch"><div class="sct">âš–ï¸ ë¹„êµ</div></div><div class="scb"><div class="rc" id="fb-ab-diff"></div></div></div>
<div style="display:flex;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap">
<button class="btn-p" onclick="pickAB('fb','a')">âœ… Aì•ˆ</button>
<button class="btn-p" onclick="pickAB('fb','b')" style="background:linear-gradient(135deg,var(--b),#818cf8)">âœ… Bì•ˆ</button>
<button class="btn-o" onclick="genFB()">ğŸ”„ ë‹¤ì‹œ</button>
<div style="margin-left:auto;font-size:.82em;color:var(--t3)">í¬ë ˆë”§: <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="fb-credit">$0.00</span> | ëˆ„ì : <span style="color:var(--ac);font-weight:600;font-family:var(--fm)" id="fb-credit-total">$0.00</span></div>
</div>
</div></div>

<div class="sc-body" id="fs2">
<div class="sc"><div class="sch"><div class="sct">âœï¸ ì™„ì„±</div><div style="display:flex;gap:4px"><button class="btn-o" onclick="fst(1)" style="font-size:.8em">â† ì´ì „</button></div></div><div class="scb">
<textarea class="mi" id="fb-edit-ta" style="min-height:150px"></textarea>
<div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:8px">
<button class="ebtn" onclick="aiCheck('fb-edit-ta','spell')">ğŸ” ì˜¤íƒˆì</button>
<button class="ebtn" onclick="aiCheck('fb-edit-ta','improve')">âœ¨ ë‹¤ë“¬ê¸°</button>
<div style="flex:1"></div>
<button class="btn-p" onclick="copyF('fb')">ğŸ“‹ ë³µì‚¬</button>
</div>
</div></div></div></div>

<!-- ==================== SMART PLACE TAB ==================== -->
<div class="tab-c" id="sp-tab">
<div class="ph"><div class="pt">ğŸ“ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤</div><div class="ps">ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ì„±ê³¼ ë¶„ì„ & í‚¤ì›Œë“œ ìµœì í™”</div></div>

<div class="sub-pills" id="sp-pills">
<button class="sub-pill a" onclick="setSpMode('myplace')">ğŸª ë‚´ í”Œë ˆì´ìŠ¤</button>
<button class="sub-pill" onclick="setSpMode('dashboard')">ğŸ“Š ì„±ê³¼ ëŒ€ì‹œë³´ë“œ</button>
<button class="sub-pill" onclick="setSpMode('keyword')">ğŸ”‘ í‚¤ì›Œë“œ ìµœì í™”</button>
<button class="sub-pill" onclick="setSpMode('ranking')">ğŸ† ì§€ì—­ ìˆœìœ„</button>
</div>

<!-- ===== ì„±ê³¼ ëŒ€ì‹œë³´ë“œ ===== -->
<div id="sp-dashboard" style="display:none">

<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
<div style="font-size:.95em;font-weight:600;color:var(--t2)">ğŸ“Š í”Œë ˆì´ìŠ¤ ì„±ê³¼ í˜„í™©</div>
<button class="btn-o" onclick="refreshSpDash()" id="sp-refresh-btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
</div>

<!-- í•µì‹¬ ì§€í‘œ -->
<div class="hero-grid">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">í”Œë ˆì´ìŠ¤ ì¡°íšŒìˆ˜</span><span class="hero-icon views">ğŸ‘</span></div>
<div class="hero-val" id="sp-views">0</div>
<div class="hero-change"><span style="font-size:.78em;color:var(--t3)">ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ë™</span></div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ì „í™” ì—°ê²°</span><span class="hero-icon engage">ğŸ“</span></div>
<div class="hero-val" id="sp-calls">0</div>
<div class="hero-change"><span style="font-size:.78em;color:var(--t3)">ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ë™</span></div>
</div>
</div>

<!-- ì¶”ê°€ ì§€í‘œ -->
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px">
<div class="stat-card"><div class="stat-v">-</div><div class="stat-l">â­ í‰ì </div></div>
<div class="stat-card"><div class="stat-v">-</div><div class="stat-l">ğŸ“ ë¦¬ë·°ìˆ˜</div></div>
<div class="stat-card"><div class="stat-v">-</div><div class="stat-l">ğŸ” ê²€ìƒ‰ ìœ ì…</div></div>
<div class="stat-card"><div class="stat-v">-</div><div class="stat-l">ğŸ“² ì§ì ‘ ìœ ì…</div></div>
</div>

<!-- ìœ ì… ê²€ìƒ‰ì–´ -->
<div class="visual-card" style="margin-bottom:16px;height:auto">
<div class="card-header">
<span class="card-icon">ğŸ”</span>ìœ ì… ê²€ìƒ‰ì–´ TOP 10
<button class="btn-o" onclick="refreshSpKeywords()" style="margin-left:auto">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
</div>
<div class="mlbl" style="margin-bottom:8px">ë°©ë¬¸ìë“¤ì´ ì–´ë–¤ ê²€ìƒ‰ì–´ë¡œ ë‚´ í”Œë ˆì´ìŠ¤ì— ë“¤ì–´ì™”ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</div>
<div style="overflow-x:auto">
<table class="kw-rank-table">
<thead><tr><th>#</th><th>ê²€ìƒ‰ì–´</th><th>ìœ ì…ìˆ˜</th><th>ë¹„ìœ¨</th><th>ì „í™˜ìœ¨</th><th>ì¶”ì´</th></tr></thead>
<tbody id="sp-search-tbody"></tbody>
</table>
</div>
</div>

<!-- í–‰ë™ ë¶„ì„ (ì£¼ê°„ íŠ¸ë Œë“œ) -->
<div class="trend-card">
<div class="trend-header">
<div class="trend-title"><span>ğŸ“ˆ</span> ì£¼ê°„ í–‰ë™ ì¶”ì´</div>
<div class="trend-tabs" id="sp-trend-tabs">
<button class="trend-tab a" onclick="setSpTrend('views')">ì¡°íšŒ</button>
<button class="trend-tab" onclick="setSpTrend('calls')">ì „í™”</button>
</div>
</div>
<div class="trend-chart" id="sp-trend-chart"></div>
<div class="trend-legend">
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:#03C75A"></div>ì´ë²ˆ ì£¼</div>
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--bg4);border:1px solid var(--t3)"></div>ì§€ë‚œ ì£¼</div>
</div>
</div>

<!-- ì „í™˜ í¼ë„ -->
<div class="visual-card" style="margin-bottom:16px;height:auto">
<div class="card-header"><span class="card-icon">ğŸ”„</span>ë°©ë¬¸ì ì „í™˜ í¼ë„</div>
<div id="sp-funnel"></div>
</div>
</div>

<!-- ===== ë‚´ í”Œë ˆì´ìŠ¤ ë¯¸ë¦¬ë³´ê¸° ===== -->
<div id="sp-myplace">

<div class="sc"><div class="sch"><div class="sct">ğŸª ë‚´ ì—…ì²´ ë“±ë¡ ì •ë³´</div><button class="btn-o" onclick="updatePlacePreview()">ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ </button></div><div class="scb">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
<div><div class="mlbl">ì—…ì²´ëª… *</div><input class="mi" id="mp-name" placeholder="ì˜ˆ: â—‹â—‹LEDë¯¸ë””ì–´" value="ì„¸ì¢…ë¯¸ë””ì–´"></div>
<div><div class="mlbl">ì—…ì¢… ì¹´í…Œê³ ë¦¬</div><select class="mi" id="mp-category">
<option>LEDì „ê´‘íŒ/ì˜ìƒì¥ë¹„</option><option>ê´‘ê³ ëŒ€í–‰</option><option>ì´ë²¤íŠ¸/í–‰ì‚¬</option><option>ì¸í…Œë¦¬ì–´</option><option>ITì„œë¹„ìŠ¤</option><option>ìŒì‹ì </option><option>ì¹´í˜</option><option>ë¯¸ìš©/ë·°í‹°</option><option>ë³‘ì›/ì˜ì›</option><option>í•™ì›/êµìœ¡</option><option>ê¸°íƒ€</option>
</select></div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
<div><div class="mlbl">ì „í™”ë²ˆí˜¸</div><input class="mi" id="mp-phone" placeholder="02-0000-0000" value="02-1234-5678"></div>
<div><div class="mlbl">ì˜ì—…ì‹œê°„</div><input class="mi" id="mp-hours" placeholder="09:00 - 18:00" value="09:00 - 18:00 (ì£¼ë§ íœ´ë¬´)"></div>
</div>
<div class="mlbl">ì£¼ì†Œ</div>
<input class="mi" id="mp-addr" placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ..." value="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123">
<div class="mlbl">ì—…ì²´ ì†Œê°œ (í•œì¤„)</div>
<input class="mi" id="mp-desc" placeholder="ìš°ë¦¬ ì—…ì²´ë¥¼ í•œì¤„ë¡œ ì„¤ëª…í•´ì£¼ì„¸ìš”" value="LEDì „ê´‘íŒ ì„¤ì¹˜Â·ë Œíƒˆ ë° ë°©ì†¡ì¤‘ê³„ ì „ë¬¸ ê¸°ì—… | 10ë…„ ê²½ë ¥">
<div class="mlbl">ì£¼ìš” ì„œë¹„ìŠ¤/ë©”ë‰´ (ì‰¼í‘œ êµ¬ë¶„)</div>
<input class="mi" id="mp-services" placeholder="LEDì „ê´‘íŒ ì„¤ì¹˜, ì „ê´‘íŒ ë Œíƒˆ, ë°©ì†¡ì¤‘ê³„" value="LEDì „ê´‘íŒ ì„¤ì¹˜, ì „ê´‘íŒ ë Œíƒˆ, ë°©ì†¡ì¤‘ê³„, ì˜ìƒì¥ë¹„ ëŒ€ì—¬">
<div class="mlbl">í‚¤ì›Œë“œ íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</div>
<input class="mi" id="mp-tags" placeholder="LEDì „ê´‘íŒ, ì „ê´‘íŒì„¤ì¹˜, ë°©ì†¡ì¤‘ê³„" value="LEDì „ê´‘íŒ, ì „ê´‘íŒì„¤ì¹˜, ë°©ì†¡ì¤‘ê³„, ì˜¥ì™¸ê´‘ê³ , ì˜ìƒì¥ë¹„">
<div class="mlbl">í™ˆí˜ì´ì§€ URL</div>
<input class="mi" id="mp-url" placeholder="https://..." value="https://www.sejongmedia.co.kr">
<div class="mlbl">ëŒ€í‘œ ì´ë¯¸ì§€</div>
<div class="ig" id="mp-imgs"><div class="isl" onclick="this.querySelector('input').click()"><span style="color:var(--t3);font-size:1.4em">+</span><input type="file" accept="image/*" style="display:none" onchange="addI(this,'mp-imgs')"></div></div>
<button class="btn-o" onclick="addIS('mp-imgs')" style="margin-top:4px">+ ì´ë¯¸ì§€ ì¶”ê°€</button>
</div></div>

<!-- í”Œë ˆì´ìŠ¤ ë¯¸ë¦¬ë³´ê¸° ì¹´ë“œ -->
<div style="margin-top:14px">
<div style="font-size:.9em;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:6px;color:var(--t2)">ğŸ‘€ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ë¯¸ë¦¬ë³´ê¸°</div>

<div id="mp-preview" style="background:var(--bg1);border:1px solid var(--border);border-radius:var(--r3);overflow:hidden;max-width:420px">
<!-- ì´ë¯¸ì§€ ì˜ì—­ -->
<div id="mp-prev-img" style="height:180px;background:linear-gradient(135deg,var(--bg3),var(--bg4));display:flex;align-items:center;justify-content:center;color:var(--t3);font-size:.85em;border-bottom:1px solid var(--border)">
ğŸ“· ëŒ€í‘œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
</div>

<!-- ë©”ì¸ ì •ë³´ -->
<div style="padding:16px">
<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
<span id="mp-prev-name" style="font-size:1.15em;font-weight:700;color:var(--t1)">ì„¸ì¢…ë¯¸ë””ì–´</span>
<span style="background:#03C75A;color:#fff;padding:1px 6px;border-radius:4px;font-size:.6em;font-weight:600">í”Œë ˆì´ìŠ¤</span>
</div>
<div id="mp-prev-cat" style="font-size:.78em;color:var(--t3);margin-bottom:10px">LEDì „ê´‘íŒ/ì˜ìƒì¥ë¹„</div>

<!-- í‰ì  -->
<div style="display:flex;align-items:center;gap:6px;margin-bottom:12px">
<span style="color:#FFD700;font-size:.9em">â˜…â˜…â˜…â˜…â˜…</span>
<span style="font-size:.85em;font-weight:600;color:var(--t1)">4.8</span>
<span style="font-size:.78em;color:var(--t3)">ë°©ë¬¸ì ë¦¬ë·° 127</span>
</div>

<!-- ì •ë³´ í–‰ë“¤ -->
<div style="display:grid;gap:8px;font-size:.82em">
<div style="display:flex;align-items:center;gap:8px;color:var(--t2)">
<span style="width:20px;text-align:center;flex-shrink:0">ğŸ“</span>
<span id="mp-prev-phone">02-1234-5678</span>
</div>
<div style="display:flex;align-items:center;gap:8px;color:var(--t2)">
<span style="width:20px;text-align:center;flex-shrink:0">ğŸ•</span>
<span id="mp-prev-hours">09:00 - 18:00 (ì£¼ë§ íœ´ë¬´)</span>
</div>
<div style="display:flex;align-items:center;gap:8px;color:var(--t2)">
<span style="width:20px;text-align:center;flex-shrink:0">ğŸ“</span>
<span id="mp-prev-addr">ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</span>
</div>
<div style="display:flex;align-items:center;gap:8px;color:var(--t2)">
<span style="width:20px;text-align:center;flex-shrink:0">ğŸŒ</span>
<span id="mp-prev-url" style="color:var(--b)">www.sejongmedia.co.kr</span>
</div>
</div>

<!-- ì†Œê°œ -->
<div style="margin-top:12px;padding:10px;background:var(--bg3);border-radius:var(--r2)">
<div style="font-size:.72em;color:var(--t3);margin-bottom:4px">ì—…ì²´ ì†Œê°œ</div>
<div id="mp-prev-desc" style="font-size:.82em;color:var(--t2);line-height:1.5">LEDì „ê´‘íŒ ì„¤ì¹˜Â·ë Œíƒˆ ë° ë°©ì†¡ì¤‘ê³„ ì „ë¬¸ ê¸°ì—… | 10ë…„ ê²½ë ¥</div>
</div>

<!-- ì„œë¹„ìŠ¤/ë©”ë‰´ -->
<div style="margin-top:10px">
<div style="font-size:.72em;color:var(--t3);margin-bottom:6px">ì£¼ìš” ì„œë¹„ìŠ¤</div>
<div id="mp-prev-services" style="display:flex;flex-wrap:wrap;gap:4px"></div>
</div>

<!-- íƒœê·¸ í‚¤ì›Œë“œ -->
<div style="margin-top:10px">
<div style="font-size:.72em;color:var(--t3);margin-bottom:6px">í‚¤ì›Œë“œ</div>
<div id="mp-prev-tags" style="display:flex;flex-wrap:wrap;gap:4px"></div>
</div>

<!-- í•˜ë‹¨ ë²„íŠ¼ -->
<div style="margin-top:14px;display:flex;gap:6px">
<div style="flex:1;padding:10px;background:#03C75A;color:#fff;text-align:center;border-radius:8px;font-size:.82em;font-weight:600;cursor:default">ğŸ“ ì „í™”í•˜ê¸°</div>
<div style="flex:1;padding:10px;background:var(--bg4);color:var(--t2);text-align:center;border-radius:8px;font-size:.82em;border:1px solid var(--border);cursor:default">ğŸ’¬ í†¡í†¡ ë¬¸ì˜</div>
</div>
</div>
</div>

<!-- AI ì§„ë‹¨ -->
<div style="margin-top:12px">
<button class="btn-p full" onclick="diagnosePlaceProfile()" id="mp-diag-btn">ğŸ¤– AI í”Œë ˆì´ìŠ¤ í”„ë¡œí•„ ì§„ë‹¨</button>
<div id="mp-diag-result" style="display:none;margin-top:10px">
<div class="tip-box" id="mp-diag-content"></div>
</div>
</div>
</div>
</div>
<div id="sp-keyword" style="display:none">

<div class="sc"><div class="sch"><div class="sct">ğŸ¢ ë‚´ ì—…ì²´ ì •ë³´</div></div><div class="scb">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
<div><div class="mlbl">ì—…ì¢…</div><select class="mi" id="sp-biz-type">
<option>LEDì „ê´‘íŒ/ì˜ìƒì¥ë¹„</option><option>ì¸í…Œë¦¬ì–´</option><option>ê´‘ê³ ëŒ€í–‰</option><option>ì´ë²¤íŠ¸/í–‰ì‚¬</option><option>ITì„œë¹„ìŠ¤</option><option>ìŒì‹ì </option><option>ì¹´í˜</option><option>ë¯¸ìš©/ë·°í‹°</option><option>ë³‘ì›/ì˜ì›</option><option>í•™ì›/êµìœ¡</option><option>ê¸°íƒ€</option>
</select></div>
<div><div class="mlbl">ì§€ì—­</div><select class="mi" id="sp-biz-area">
<option>ì„œìš¸ ê°•ë‚¨êµ¬</option><option>ì„œìš¸ ì„œì´ˆêµ¬</option><option>ì„œìš¸ ë§ˆí¬êµ¬</option><option>ì„œìš¸ ì†¡íŒŒêµ¬</option><option>ì„œìš¸ ì˜ë“±í¬êµ¬</option><option>ì„œìš¸ ì¢…ë¡œêµ¬</option><option>ê²½ê¸° ì„±ë‚¨ì‹œ</option><option>ê²½ê¸° ìˆ˜ì›ì‹œ</option><option>ì¸ì²œ</option><option>ë¶€ì‚°</option><option>ëŒ€ì „</option><option>ëŒ€êµ¬</option><option>ê´‘ì£¼</option>
</select></div>
</div>
<div class="mlbl">ì—…ì²´ëª…</div>
<input class="mi" id="sp-biz-name" placeholder="ì˜ˆ: â—‹â—‹ë¯¸ë””ì–´, â—‹â—‹LED">
<div class="mlbl">ì£¼ìš” ì„œë¹„ìŠ¤/ìƒí’ˆ (ì‰¼í‘œ êµ¬ë¶„)</div>
<input class="mi" id="sp-biz-service" placeholder="ì˜ˆ: LEDì „ê´‘íŒ ì„¤ì¹˜, ë°©ì†¡ì¤‘ê³„, ì˜ìƒì¥ë¹„ ë Œíƒˆ" value="LEDì „ê´‘íŒ ì„¤ì¹˜, ë°©ì†¡ì¤‘ê³„, ì˜ìƒì¥ë¹„ ë Œíƒˆ">
<div class="mlbl">í˜„ì¬ í”Œë ˆì´ìŠ¤ì— ë“±ë¡ëœ í‚¤ì›Œë“œ</div>
<input class="mi" id="sp-biz-current-kw" placeholder="ì˜ˆ: LEDì „ê´‘íŒ, ì „ê´‘íŒì„¤ì¹˜, ë°©ì†¡ì¤‘ê³„">
<div class="mlbl">íŠ¹ì´ì‚¬í•­ / ê°•ì </div>
<input class="mi" id="sp-biz-strength" placeholder="ì˜ˆ: 10ë…„ ê²½ë ¥, 24ì‹œê°„ AS, ì „êµ­ ì¶œì¥">
<button class="btn-p full" onclick="analyzeSpKeywords()" id="sp-kw-btn" style="margin-top:4px">ğŸ¤– AI í‚¤ì›Œë“œ ìµœì í™” ë¶„ì„</button>
</div></div>

<!-- AI ë¶„ì„ ê²°ê³¼ -->
<div id="sp-kw-results" style="display:none;margin-top:14px">

<!-- ì¶”ì²œ í‚¤ì›Œë“œ -->
<div class="visual-card" style="margin-bottom:14px;height:auto">
<div class="card-header"><span class="card-icon">âœ¨</span>AI ì¶”ì²œ í‚¤ì›Œë“œ</div>
<div class="mlbl" style="margin-bottom:6px">í”Œë ˆì´ìŠ¤ì— ì¶”ê°€í•˜ë©´ ë…¸ì¶œì´ í–¥ìƒë  í‚¤ì›Œë“œì…ë‹ˆë‹¤</div>
<div id="sp-rec-keywords"></div>
</div>

<!-- í‚¤ì›Œë“œ ì „ëµ -->
<div class="visual-card" style="margin-bottom:14px;height:auto">
<div class="card-header"><span class="card-icon">ğŸ“‹</span>í‚¤ì›Œë“œ ì „ëµ ê°€ì´ë“œ</div>
<div id="sp-kw-strategy" style="font-size:.85em;color:var(--t2);line-height:1.7;white-space:pre-wrap"></div>
</div>

<!-- í˜„ì¬ vs ì¶”ì²œ ë¹„êµ -->
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">âš–ï¸</span>í˜„ì¬ í‚¤ì›Œë“œ ì§„ë‹¨</div>
<div id="sp-kw-diagnosis" style="font-size:.85em;color:var(--t2);line-height:1.7;white-space:pre-wrap"></div>
</div>
</div>
</div>

<!-- ===== ì§€ì—­ ìˆœìœ„ ===== -->
<div id="sp-ranking" style="display:none">

<div class="sc"><div class="sch"><div class="sct">ğŸ” ë‚´ ìˆœìœ„ í™•ì¸</div></div><div class="scb">
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
<div><div class="mlbl">ê²€ìƒ‰ í‚¤ì›Œë“œ</div><input class="mi" id="sp-rank-kw" placeholder="ì˜ˆ: LEDì „ê´‘íŒ ì„¤ì¹˜" style="margin-bottom:0"></div>
<div><div class="mlbl">ì§€ì—­</div><select class="mi" id="sp-rank-area" style="margin-bottom:0">
<option>ì„œìš¸ ê°•ë‚¨êµ¬</option><option>ì„œìš¸ ì„œì´ˆêµ¬</option><option>ì„œìš¸ ë§ˆí¬êµ¬</option><option>ì„œìš¸ ì†¡íŒŒêµ¬</option><option>ì„œìš¸ ì˜ë“±í¬êµ¬</option><option>ê²½ê¸° ì„±ë‚¨ì‹œ</option><option>ê²½ê¸° ìˆ˜ì›ì‹œ</option><option>ì¸ì²œ</option><option>ë¶€ì‚°</option><option>ëŒ€ì „</option>
</select></div>
<div><div class="mlbl">&nbsp;</div><button class="btn-p" onclick="checkSpRanking()" id="sp-rank-btn" style="width:100%;margin-bottom:0">ğŸ† ìˆœìœ„ ì¡°íšŒ</button></div>
</div>
</div></div>

<!-- ë‚´ ìˆœìœ„ ìš”ì•½ -->
<div id="sp-rank-summary" style="margin-top:14px">
<div class="hero-grid">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">í˜„ì¬ ë‚´ ìˆœìœ„</span><span class="hero-icon views">ğŸ…</span></div>
<div class="hero-val" id="sp-my-rank" style="color:var(--ac)">â€”</div>
<div class="hero-sub" id="sp-my-rank-sub">í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  ì¡°íšŒí•˜ì„¸ìš”</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ë™ì¼ ì§€ì—­ ì—…ì²´ ìˆ˜</span><span class="hero-icon posts">ğŸ¢</span></div>
<div class="hero-val" id="sp-total-biz">â€”</div>
<div class="hero-sub" id="sp-total-biz-sub">ê°™ì€ ì—…ì¢… ê¸°ì¤€</div>
</div>
</div>

<!-- ìˆœìœ„ í…Œì´ë¸” -->
<div class="visual-card" style="margin-bottom:14px;height:auto">
<div class="card-header"><span class="card-icon">ğŸ“Š</span>ê²€ìƒ‰ ê²°ê³¼ ìˆœìœ„ (ìƒìœ„ 10)</div>
<div style="overflow-x:auto">
<table class="kw-rank-table">
<thead><tr><th>ìˆœìœ„</th><th>ì—…ì²´ëª…</th><th>í‰ì </th><th>ë¦¬ë·°</th><th>ê°•ì </th></tr></thead>
<tbody id="sp-rank-tbody"></tbody>
</table>
</div>
</div>

<!-- AI ë¶„ì„ -->
<div id="sp-rank-analysis-box" style="display:none">
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ’¡</span>ìˆœìœ„ ê°œì„  ì „ëµ</div>
<div id="sp-rank-analysis" style="font-size:.85em;color:var(--t2);line-height:1.7;white-space:pre-wrap"></div>
</div>
</div>

<!-- í‚¤ì›Œë“œë³„ ìˆœìœ„ ì¶”ì  -->
<div class="visual-card" style="margin-top:14px;height:auto">
<div class="card-header"><span class="card-icon">ğŸ“ˆ</span>í‚¤ì›Œë“œë³„ ìˆœìœ„ ì¶”ì </div>
<div style="overflow-x:auto">
<table class="kw-rank-table">
<thead><tr><th>í‚¤ì›Œë“œ</th><th>ì§€ì—­</th><th>í˜„ì¬ ìˆœìœ„</th><th>ë³€ë™</th><th>1ë‹¬ ì „</th><th>ëª©í‘œ</th></tr></thead>
<tbody id="sp-rank-history"></tbody>
</table>
</div>
</div>
</div>
</div>
</div>

<!-- ==================== OOH (ì˜¥ì™¸ê´‘ê³ ) TAB ==================== -->
<div class="tab-c" id="ooh-tab">
<div class="ph"><div class="pt">ğŸ“‹ ì˜¥ì™¸ê´‘ê³  ê°€ì´ë“œ</div><div class="ps">ì•¼ì™¸ì „ê´‘íŒÂ·ë²„ìŠ¤Â·íƒì‹œÂ·ì§€í•˜ì²  ë“± ì˜¥ì™¸ê´‘ê³  ì¢…í•© ë¶„ì„</div></div>
<div class="sub-pills" id="ooh-pills"><button class="sub-pill a" onclick="setOohMode('find')">ğŸ” ì˜¥ì™¸ê´‘ê³  ì°¾ê¸°</button><button class="sub-pill" onclick="setOohMode('detail')">ğŸ“Š ì„¸ë¶€ë¶„ì„í‘œ</button></div>
<div id="ooh-find"><div class="ooh-cards" id="ooh-grid"></div></div>
<div id="ooh-detail" style="display:none">
<div class="sc"><div class="sch"><div class="sct">ğŸ“Š ì˜¥ì™¸ê´‘ê³  ì „ì²´ ë¹„êµ</div></div><div class="scb"><div class="ts"><table class="dt"><thead><tr><th>ë§¤ì²´</th><th>ìœ„ì¹˜</th><th>ì˜ˆìƒë‹¨ê°€</th><th>ì›” ë…¸ì¶œ</th><th>CPM</th><th>ê°€ì„±ë¹„</th><th>ëŒ€í–‰ì‚¬</th></tr></thead><tbody id="ooh-tbody"></tbody></table></div></div></div>
<div class="sc"><div class="sch"><div class="sct">ğŸ’¡ ì˜ˆì‚°ë³„ AI ì¶”ì²œ ì¡°í•©</div></div><div class="scb">
<div class="tip-box"><b>ğŸ’¡ ì›” 500ë§Œì›:</b> ê°•ë‚¨ì—­ ì§€í•˜ì²  ìŠ¤í¬ë¦°ë„ì–´(200ë§Œ) + ë²„ìŠ¤ ë©í•‘ 2ëŒ€(160ë§Œ) + íƒì‹œ íƒ‘ë¼ì´íŠ¸ 10ëŒ€(140ë§Œ)<br>ì˜ˆìƒ ì›” 2,800ë§Œ ë…¸ì¶œ | CPM â‚©179</div>
<div class="tip-box" style="margin-top:6px"><b>ğŸ’¡ ì›” 200ë§Œì›:</b> íƒì‹œ íƒ‘ë¼ì´íŠ¸ 8ëŒ€(112ë§Œ) + í˜„ìˆ˜ë§‰ 10ê°œì†Œ(80ë§Œ)<br>ì˜ˆìƒ ì›” 650ë§Œ ë…¸ì¶œ | CPM â‚©308</div>
<div class="tip-box" style="margin-top:6px"><b>ğŸ’¡ ì›” 100ë§Œì›:</b> íƒì‹œ íƒ‘ë¼ì´íŠ¸ 5ëŒ€(70ë§Œ) + ì»¤í”¼ì°¨ 1íšŒ(30ë§Œ)<br>ì˜ˆìƒ ì›” 400ë§Œ ë…¸ì¶œ + SNS ë°”ì´ëŸ´</div>
</div></div></div>
<div id="ooh-detail-box" class="ooh-detail-box"></div>
</div>

<!-- ==================== DASHBOARD TAB ==================== -->
<div class="tab-c" id="dash-tab">
<div class="ph" style="display:flex;align-items:center;justify-content:space-between">
<div>
<div class="pt">ğŸ“Š ëŒ€ì‹œë³´ë“œ</div>
<div class="ps">ì „ì²´ ì±„ë„ ì„±ê³¼ í•œëˆˆì— ë³´ê¸°</div>
</div>
<button class="btn-o" onclick="refreshDash()" id="dash-refresh-btn" style="display:flex;align-items:center;gap:4px">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
</div>

<!-- ì—°ê²° ìƒíƒœ ì¹´ë“œ -->
<div id="dash-connect-bar" style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:20px">
<div id="dash-naver-status" class="account-chip disconnected" onclick="loginNaver()" style="padding:16px 20px;border-radius:var(--r3);font-size:.85em;display:flex;align-items:center;gap:14px">
<div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#03cf5d,#02b550);display:flex;align-items:center;justify-content:center;flex-shrink:0"><span style="color:#fff;font-weight:800;font-size:1.2em">N</span></div>
<div><div style="font-weight:600;margin-bottom:2px">ë„¤ì´ë²„ ë¸”ë¡œê·¸</div><div style="font-size:.82em;opacity:.7">ë¡œê·¸ì¸í•˜ë©´ ë¸”ë¡œê·¸ ê²€ìƒ‰ ë…¸ì¶œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”</div></div>
</div>
<div id="dash-meta-status" class="account-chip disconnected" onclick="loginMeta()" style="padding:16px 20px;border-radius:var(--r3);font-size:.85em;display:flex;align-items:center;gap:14px">
<div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#1877f2,#0d65d9);display:flex;align-items:center;justify-content:center;flex-shrink:0"><span style="color:#fff;font-weight:800;font-size:1.2em">f</span></div>
<div><div style="font-weight:600;margin-bottom:2px">Meta (Facebook + Instagram)</div><div style="font-size:.82em;opacity:.7">ë¡œê·¸ì¸í•˜ë©´ ì¸ìŠ¤íƒ€/í˜ì´ìŠ¤ë¶ ì‹¤ì œ ë°ì´í„°ê°€ ì—°ë™ë¼ìš”</div></div>
</div>
</div>

<!-- í•µì‹¬ ì§€í‘œ 4ì—´ -->
<div class="hero-grid">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ì´ ì¡°íšŒìˆ˜</span><span class="hero-icon views">ğŸ‘</span></div>
<div class="hero-val" id="hero-views-val">0</div>
<div class="hero-change" id="hero-views-change"><span style="font-size:.78em;color:var(--t3)">ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ë™</span></div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">íŒ”ë¡œì›Œ / êµ¬ë…</span><span class="hero-icon exposure">ğŸ‘¥</span></div>
<div class="hero-val" id="hero-followers-val">0</div>
<div class="hero-change" id="hero-followers-change"><span style="font-size:.78em;color:var(--t3)">ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ë™</span></div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ë¸”ë¡œê·¸ ê²€ìƒ‰ ë…¸ì¶œ</span><span class="hero-icon posts">ğŸ“„</span></div>
<div class="hero-val" id="hero-blog-val">0</div>
<div class="hero-sub" id="hero-blog-sub">ë„¤ì´ë²„ ë¡œê·¸ì¸ ì‹œ ì—°ë™</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">í‰ê·  ì°¸ì—¬ìœ¨</span><span class="hero-icon engage">ğŸ’¬</span></div>
<div class="hero-val" id="hero-engage-val">0%</div>
<div class="hero-change" id="hero-engage-change"><span style="font-size:.78em;color:var(--t3)">ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ì—°ë™</span></div>
</div>
</div>

<!-- 2ì—´ ê·¸ë¦¬ë“œ: íŠ¸ë˜í”½ ì¶”ì´ + ë¹ ë¥¸ ì‘ì—… -->
<div class="dash-grid">
<!-- ì¡°íšŒìˆ˜ ì¶”ì´ (7ì¼) -->
<div class="trend-card" style="margin-bottom:0">
<div class="trend-header">
<div class="trend-title"><span>ğŸ“ˆ</span> ì£¼ê°„ íŠ¸ë˜í”½ ì¶”ì´</div>
<div class="trend-tabs" id="trend-tabs">
<button class="trend-tab a" onclick="setTrendFilter('all')">ì „ì²´</button>
<button class="trend-tab" onclick="setTrendFilter('blog')">ë¸”ë¡œê·¸</button>
<button class="trend-tab" onclick="setTrendFilter('insta')">ì¸ìŠ¤íƒ€</button>
</div>
</div>
<div class="trend-chart" id="trend-chart"></div>
<div class="trend-legend">
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:#3B82F6"></div>ë¸”ë¡œê·¸</div>
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--ac)"></div>ì¸ìŠ¤íƒ€</div>
</div>
</div>

<!-- ë¹ ë¥¸ ì‘ì—… -->
<div style="background:var(--bg3);border:1px solid var(--border);border-radius:var(--r3);padding:22px">
<div style="font-size:1em;font-weight:600;margin-bottom:18px;display:flex;align-items:center;gap:8px">âš¡ ë¹ ë¥¸ ì‘ì—…</div>
<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
<div onclick="go('blog')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">ğŸ“</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">ë¸”ë¡œê·¸ ê¸€ ì‘ì„±</div>
</div>
<div onclick="go('insta')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">ğŸ“·</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">ì¸ìŠ¤íƒ€ í¬ìŠ¤íŠ¸</div>
</div>
<div onclick="go('kwresearch')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">ğŸ”</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">í‚¤ì›Œë“œ ë¶„ì„</div>
</div>
<div onclick="go('compare')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">âš–ï¸</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">ì½˜í…ì¸  ë¹„êµ</div>
</div>
<div onclick="go('adsim')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">ğŸ“¢</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">ê´‘ê³  ì‹œë®¬ë ˆì´ì…˜</div>
</div>
<div onclick="go('sp')" style="padding:16px;border-radius:12px;background:var(--glass);border:1px solid var(--border);text-align:center;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='rgba(249,115,22,.3)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="font-size:1.4em;margin-bottom:6px">ğŸ“</div><div style="font-size:.82em;font-weight:600;color:var(--t2)">ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤</div>
</div>
</div>
</div>
</div>

<!-- í”Œë«í¼ë³„ ì„±ê³¼ ì¹´ë“œ -->
<div style="margin-bottom:20px">
<div style="font-size:1.05em;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:8px">
<span>ğŸ¯</span>í”Œë«í¼ë³„ ì„±ê³¼
</div>
<div class="platform-cards" id="platform-cards"></div>
</div>

<!-- 2ì—´ ê·¸ë¦¬ë“œ: í”Œë«í¼ ë¹„êµ + ê²½ìŸì‚¬ ë¹„êµ -->
<div class="dash-grid" style="margin-bottom:20px">
<div class="visual-card" style="margin-bottom:0">
<div class="card-header"><span class="card-icon">ğŸ“Š</span>í”Œë«í¼ ë¹„êµ</div>
<div id="platform-performance"></div>
</div>
<div class="visual-card" style="margin-bottom:0">
<div class="card-header"><span class="card-icon">ğŸ†</span>ê²½ìŸì‚¬ ëŒ€ë¹„ ì„±ê³¼</div>
<div id="competitor-compare"></div>
</div>
</div>

<!-- í”Œë«í¼ë³„ í‚¤ì›Œë“œ ë¶„ì„ -->
<div style="margin-bottom:18px">
<div class="sub-pills" id="dash-kw-pills">
<button class="sub-pill a" onclick="setDashKwTab('blog')">ğŸ“ ë¸”ë¡œê·¸ SEO</button>
<button class="sub-pill" onclick="setDashKwTab('insta')">#ï¸âƒ£ ì¸ìŠ¤íƒ€ í•´ì‹œíƒœê·¸</button>
<button class="sub-pill" onclick="setDashKwTab('fb')">ğŸ‘ í˜ì´ìŠ¤ë¶</button>
<button class="sub-pill" onclick="setDashKwTab('place')">ğŸ“ í”Œë ˆì´ìŠ¤</button>
</div>

<!-- ë¸”ë¡œê·¸ SEO í‚¤ì›Œë“œ -->
<div id="dash-kw-blog" class="visual-card" style="height:auto">
<div class="card-header">
<span class="card-icon">ğŸ“</span>ë¸”ë¡œê·¸ SEO í‚¤ì›Œë“œ ì¶”ì²œ
<button class="btn-o" onclick="getPlatformKw('blog')" id="pkw-blog-btn" style="margin-left:auto">ğŸ¤– ë¶„ì„</button>
</div>
<div style="display:flex;gap:6px;margin-bottom:10px">
<input class="mi" id="pkw-blog-input" placeholder="ì—…ì¢…/ì£¼ì œ ì…ë ¥ (ì˜ˆ: LEDì „ê´‘íŒ ì„¤ì¹˜)" style="flex:1;margin:0;font-size:.88em" onkeydown="if(event.key==='Enter')getPlatformKw('blog')">
</div>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px" id="pkw-blog-categories">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--ac);margin-bottom:6px">ğŸ¯ ì œëª©ìš© í‚¤ì›Œë“œ</div>
<div id="pkw-blog-title" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--g);margin-bottom:6px">ğŸ“„ ë³¸ë¬¸ìš© í‚¤ì›Œë“œ</div>
<div id="pkw-blog-body" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--b);margin-bottom:6px">ğŸ·ï¸ íƒœê·¸ìš© í‚¤ì›Œë“œ</div>
<div id="pkw-blog-tag" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
</div>
<div id="pkw-blog-insight" style="display:none" class="tip-box"></div>
</div>

<!-- ì¸ìŠ¤íƒ€ í•´ì‹œíƒœê·¸ -->
<div id="dash-kw-insta" class="visual-card" style="display:none;height:auto">
<div class="card-header">
<span class="card-icon">#ï¸âƒ£</span>ì¸ìŠ¤íƒ€ê·¸ë¨ í•´ì‹œíƒœê·¸ ì¶”ì²œ
<button class="btn-o" onclick="getPlatformKw('insta')" id="pkw-insta-btn" style="margin-left:auto">ğŸ¤– ë¶„ì„</button>
</div>
<div style="display:flex;gap:6px;margin-bottom:10px">
<input class="mi" id="pkw-insta-input" placeholder="ì—…ì¢…/ì£¼ì œ ì…ë ¥ (ì˜ˆ: ì˜¥ì™¸ê´‘ê³ , ì´ë²¤íŠ¸)" style="flex:1;margin:0;font-size:.88em" onkeydown="if(event.key==='Enter')getPlatformKw('insta')">
</div>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#E4405F;margin-bottom:6px">ğŸ”¥ ëŒ€í˜• í•´ì‹œíƒœê·¸ (10ë§Œ+)</div>
<div id="pkw-insta-big" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#f97316;margin-bottom:6px">ğŸ“ˆ ì¤‘í˜• í•´ì‹œíƒœê·¸ (1ë§Œ~10ë§Œ)</div>
<div id="pkw-insta-mid" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--g);margin-bottom:6px">ğŸ’ ì†Œí˜• í•´ì‹œíƒœê·¸ (1ë§Œ ì´í•˜)</div>
<div id="pkw-insta-small" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
</div>
<div id="pkw-insta-copy" style="display:none;margin-bottom:10px">
<button class="btn-p full" onclick="copyInstaHashtags()" style="font-size:.88em">ğŸ“‹ ì „ì²´ í•´ì‹œíƒœê·¸ ë³µì‚¬ (30ê°œ)</button>
</div>
<div id="pkw-insta-insight" style="display:none" class="tip-box"></div>
</div>

<!-- í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œ -->
<div id="dash-kw-fb" class="visual-card" style="display:none;height:auto">
<div class="card-header">
<span class="card-icon">ğŸ‘</span>í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œ ì¶”ì²œ
<button class="btn-o" onclick="getPlatformKw('fb')" id="pkw-fb-btn" style="margin-left:auto">ğŸ¤– ë¶„ì„</button>
</div>
<div style="display:flex;gap:6px;margin-bottom:10px">
<input class="mi" id="pkw-fb-input" placeholder="ì—…ì¢…/ì£¼ì œ ì…ë ¥ (ì˜ˆ: LED ì „ê´‘íŒ, ë°©ì†¡ì¥ë¹„)" style="flex:1;margin:0;font-size:.88em" onkeydown="if(event.key==='Enter')getPlatformKw('fb')">
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#1877F2;margin-bottom:6px">ğŸ“¢ ê²Œì‹œê¸€ìš© í‚¤ì›Œë“œ</div>
<div id="pkw-fb-post" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#f97316;margin-bottom:6px">ğŸ¯ ê´‘ê³ ìš© í‚¤ì›Œë“œ</div>
<div id="pkw-fb-ad" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--g);margin-bottom:6px">ğŸ’¬ ì°¸ì—¬ ìœ ë„ í‚¤ì›Œë“œ</div>
<div id="pkw-fb-engage" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#a855f7;margin-bottom:6px">ğŸ”„ ê³µìœ  ìœ ë„ í‚¤ì›Œë“œ</div>
<div id="pkw-fb-share" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
</div>
<div id="pkw-fb-insight" style="display:none" class="tip-box"></div>
</div>

<!-- í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ -->
<div id="dash-kw-place" class="visual-card" style="display:none;height:auto">
<div class="card-header">
<span class="card-icon">ğŸ“</span>ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ
<button class="btn-o" onclick="getPlatformKw('place')" id="pkw-place-btn" style="margin-left:auto">ğŸ¤– ë¶„ì„</button>
</div>
<div style="display:flex;gap:6px;margin-bottom:10px">
<input class="mi" id="pkw-place-input" placeholder="ì—…ì¢…/ì§€ì—­ ì…ë ¥ (ì˜ˆ: LEDì „ê´‘íŒ ê°•ë‚¨)" style="flex:1;margin:0;font-size:.88em" onkeydown="if(event.key==='Enter')getPlatformKw('place')">
</div>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:#03C75A;margin-bottom:6px">ğŸ“ ë©”ì¸ í‚¤ì›Œë“œ</div>
<div id="pkw-place-main" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--b);margin-bottom:6px">ğŸ—ºï¸ ì§€ì—­ í‚¤ì›Œë“œ</div>
<div id="pkw-place-local" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px">
<div style="font-size:.75em;font-weight:700;color:var(--ac);margin-bottom:6px">â­ ë¦¬ë·° í‚¤ì›Œë“œ</div>
<div id="pkw-place-review" class="kw-grid" style="font-size:.85em"><span style="color:var(--t3);font-size:.82em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œ</span></div>
</div>
</div>
<div id="pkw-place-insight" style="display:none" class="tip-box"></div>
</div>
</div>

<!-- ë‚´ ê¸€ í‚¤ì›Œë“œ ìˆœìœ„ ì¶”ì  -->
<div class="visual-card" style="margin-bottom:18px">
<div class="card-header">
<span class="card-icon">ğŸ…</span>
ë‚´ ê¸€ í‚¤ì›Œë“œ ìˆœìœ„
<div style="margin-left:auto;display:flex;gap:6px">
<button class="btn-o" onclick="checkMyRanking()">ğŸ” ìˆœìœ„ ì¡°íšŒ</button>
<button class="btn-o" onclick="addTrackKeyword()">+ í‚¤ì›Œë“œ ì¶”ê°€</button>
</div>
</div>
<div class="mlbl" style="margin-bottom:6px">ì‘ì„±í•œ ê¸€ì˜ í‚¤ì›Œë“œê°€ ê²€ìƒ‰ì—ì„œ ëª‡ ìœ„ì— ë…¸ì¶œë˜ëŠ”ì§€ ì¶”ì í•©ë‹ˆë‹¤</div>
<div style="display:flex;gap:6px;margin-bottom:10px">
<input class="mi" id="rank-kw-input" placeholder="ì¶”ì í•  í‚¤ì›Œë“œ ì…ë ¥ (ì˜ˆ: LEDì „ê´‘íŒ ì‹œê³µ)" style="margin-bottom:0;flex:1">
<select class="mi" id="rank-platform" style="margin-bottom:0;width:110px">
<option value="naver">ë„¤ì´ë²„</option>
<option value="insta">ì¸ìŠ¤íƒ€</option>
<option value="google">êµ¬ê¸€</option>
</select>
</div>
<div style="overflow-x:auto">
<table class="kw-rank-table">
<thead><tr><th>í‚¤ì›Œë“œ</th><th>í”Œë«í¼</th><th>í˜„ì¬ ìˆœìœ„</th><th>ë³€ë™</th><th>ìµœê³  ìˆœìœ„</th><th>ë…¸ì¶œ ê¸€</th></tr></thead>
<tbody id="rank-tbody"></tbody>
</table>
</div>
<div id="rank-detail" style="display:none;margin-top:10px">
<div class="tip-box" id="rank-analysis"></div>
</div>
</div>

</div>

<!-- ==================== KEYWORD RESEARCH TAB ==================== -->
<div class="tab-c" id="kwresearch-tab">
<div class="ph"><div class="pt">ğŸ” í‚¤ì›Œë“œ ë¶„ì„</div><div class="ps">í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ë©´ ê²€ìƒ‰ëŸ‰Â·íŠ¸ë Œë“œÂ·ê´€ë ¨ ì½˜í…ì¸ ë¥¼ í•œëˆˆì— í™•ì¸í•©ë‹ˆë‹¤</div></div>

<!-- ê²€ìƒ‰ ë°” -->
<div style="background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--border);border-radius:var(--r3);padding:20px 24px;margin-bottom:18px">
<div style="display:flex;gap:8px">
<input class="mi" id="kwr-input" placeholder="ë¶„ì„í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: LEDì „ê´‘íŒ ì„¤ì¹˜)" style="margin-bottom:0;flex:1;font-size:1em;padding:12px 16px;border-radius:12px" onkeydown="if(event.key==='Enter')searchKeyword()">
<button class="btn-p" onclick="searchKeyword()" id="kwr-btn" style="flex-shrink:0;padding:12px 28px;font-size:.95em">ğŸ” ë¶„ì„</button>
</div>
<!-- ê¸°ê°„ ì„¤ì • + ìµœê·¼ ê²€ìƒ‰ -->
<div style="display:flex;align-items:center;gap:10px;margin-top:12px;flex-wrap:wrap">
<div style="display:flex;align-items:center;gap:6px">
<span style="font-size:.78em;color:var(--t3);white-space:nowrap">ğŸ“… ê¸°ê°„:</span>
<div class="kwr-period-pills" id="kwr-period-pills">
<button class="kwr-period-pill" onclick="setKwrPeriod(1,this)">1ê°œì›”</button>
<button class="kwr-period-pill" onclick="setKwrPeriod(3,this)">3ê°œì›”</button>
<button class="kwr-period-pill" onclick="setKwrPeriod(6,this)">6ê°œì›”</button>
<button class="kwr-period-pill active" onclick="setKwrPeriod(12,this)">12ê°œì›”</button>
<button class="kwr-period-pill" onclick="setKwrPeriod(24,this)">24ê°œì›”</button>
</div>
</div>
<span style="width:1px;height:16px;background:var(--border);flex-shrink:0"></span>
<div style="display:flex;align-items:center;gap:6px">
<span style="font-size:.78em;color:var(--t3);white-space:nowrap">ì§ì ‘ ì„¤ì •:</span>
<input type="date" id="kwr-date-from" class="mi" style="margin:0;padding:6px 10px;font-size:.78em;width:130px;border-radius:8px" onchange="setKwrCustomPeriod()">
<span style="font-size:.78em;color:var(--t3)">~</span>
<input type="date" id="kwr-date-to" class="mi" style="margin:0;padding:6px 10px;font-size:.78em;width:130px;border-radius:8px" onchange="setKwrCustomPeriod()">
</div>
</div>
<div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap" id="kwr-recent">
<span style="font-size:.82em;color:var(--t3);margin-right:4px">ìµœê·¼:</span>
</div>
</div>

<!-- âš”ï¸ í‚¤ì›Œë“œ VS ë¹„êµ -->
<div class="sc" style="margin-top:10px">
<div class="sch" style="cursor:pointer" onclick="toggleVsMode()">
<div class="sct">âš”ï¸ í‚¤ì›Œë“œ VS ë¹„êµ <span id="vs-toggle-icon" style="font-size:.78em;color:var(--t3)">â–¼ í¼ì¹˜ê¸°</span></div>
</div>
<div class="scb" id="vs-section" style="display:none;padding:14px">

<!-- ì…ë ¥ ì˜ì—­ -->
<div style="background:var(--bg4);border-radius:var(--r2);padding:14px;margin-bottom:12px">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
<span style="font-size:1.1em">âš”ï¸</span>
<span style="font-weight:700;font-size:.95em;color:var(--t1)">í‚¤ì›Œë“œ ëŒ€ê²°</span>
<span style="font-size:.78em;color:var(--t3)">ìµœëŒ€ 5ê°œ</span>
</div>
<div id="vs-inputs">
<div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
<div style="width:22px;height:22px;border-radius:50%;background:var(--ac);display:flex;align-items:center;justify-content:center;font-size:.7em;color:#fff;flex-shrink:0;font-weight:700">1</div>
<input class="mi" id="vs-kw-1" placeholder="ì˜ˆ: LEDì „ê´‘íŒ" style="margin:0;flex:1;font-size:.9em;border-left:3px solid var(--ac)">
</div>
<div style="text-align:center;font-size:.85em;font-weight:700;color:var(--t3);margin:-2px 0 6px 0">VS</div>
<div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
<div style="width:22px;height:22px;border-radius:50%;background:#f97316;display:flex;align-items:center;justify-content:center;font-size:.7em;color:#fff;flex-shrink:0;font-weight:700">2</div>
<input class="mi" id="vs-kw-2" placeholder="ì˜ˆ: ë””ì§€í„¸ì‚¬ì´ë‹ˆì§€" style="margin:0;flex:1;font-size:.9em;border-left:3px solid #f97316">
</div>
</div>
<div style="display:flex;gap:8px;align-items:center">
<button class="btn-o" onclick="addVsInput()" id="vs-add-btn" style="font-size:.82em">+ ì¶”ê°€</button>
<div style="flex:1"></div>
<button class="btn-p" onclick="compareKeywords()" id="vs-btn" style="padding:10px 28px;font-weight:700;font-size:.95em">âš”ï¸ ëŒ€ê²° ì‹œì‘</button>
</div>
</div>

<!-- VS ê²°ê³¼ -->
<div id="vs-results" style="display:none">

<!-- ê²°ê³¼ í—¤ë” + ë‹¤ìš´ë¡œë“œ -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
<span style="font-weight:700;font-size:.92em;color:var(--t1)">ğŸ“Š ë¹„êµ ê²°ê³¼</span>
<div style="display:flex;gap:6px">
<button class="btn-o" onclick="downloadVsCSV()" style="font-size:.75em;padding:5px 12px;display:flex;align-items:center;gap:4px">
<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
CSV
</button>
<button class="btn-p" onclick="downloadVsPDF()" style="font-size:.75em;padding:5px 12px;display:flex;align-items:center;gap:4px">
<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
PDF
</button>
</div>
</div>

<!-- ìŠ¹ì ë°œí‘œ -->
<div id="vs-winner" style="text-align:center;padding:16px;background:linear-gradient(135deg,var(--bg4),var(--bg3));border-radius:var(--r2);margin-bottom:12px;border:1px solid var(--border)"></div>

<!-- ë²¤ ë‹¤ì´ì–´ê·¸ë¨ -->
<div style="background:var(--bg4);border-radius:var(--r2);padding:14px;margin-bottom:12px;border:1px solid var(--border)">
<div style="font-weight:700;font-size:.88em;color:var(--t1);margin-bottom:8px">ğŸ”€ í‚¤ì›Œë“œ êµì°¨ ë¶„ì„</div>
<div id="vs-venn-container" style="min-height:180px"></div>
</div>

<!-- íŠ¸ë Œë“œ ì°¨íŠ¸ -->
<div style="background:var(--bg4);border-radius:var(--r2);padding:14px;margin-bottom:12px">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
<span style="font-weight:700;font-size:.92em;color:var(--t1)">ğŸ“ˆ 12ê°œì›” íŠ¸ë Œë“œ ë¹„êµ</span>
<div id="vs-legend" style="display:flex;flex-wrap:wrap;gap:8px"></div>
</div>
<div class="trend-chart" id="vs-chart" style="height:180px"></div>
</div>

<!-- í•­ëª©ë³„ ëŒ€ê²° -->
<div id="vs-battle-rows" style="margin-bottom:12px"></div>

<!-- ìš”ì•½ ì¹´ë“œ -->
<div id="vs-summary-cards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-bottom:12px"></div>

<!-- AI ì¸ì‚¬ì´íŠ¸ (ì¹´ë“œí˜•) -->
<div id="vs-ai-insight" style="display:none;background:var(--bg4);border-radius:var(--r2);padding:14px;border:1px solid var(--border)"></div>

</div>
</div>
</div>

<!-- ë¹ˆ ìƒíƒœ -->
<div id="kwr-empty" style="text-align:center;padding:60px 20px;color:var(--t3)">
<div style="font-size:3.5em;margin-bottom:14px;opacity:.5">ğŸ”</div>
<div style="font-size:1.1em;margin-bottom:8px;color:var(--t2);font-weight:600">í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</div>
<div style="font-size:.88em;max-width:400px;margin:0 auto;line-height:1.6">ê²€ìƒ‰ëŸ‰, íŠ¸ë Œë“œ, ê´€ë ¨ ê¸°ì‚¬Â·ë¸”ë¡œê·¸Â·SNS ì½˜í…ì¸ ë¥¼ AIê°€ ë¶„ì„í•©ë‹ˆë‹¤</div>
</div>

<!-- ê²°ê³¼ ì˜ì—­ -->
<div id="kwr-results" style="display:none">

<!-- ê²°ê³¼ í—¤ë” + ë‹¤ìš´ë¡œë“œ -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px">
<div style="display:flex;align-items:center;gap:8px">
<span style="font-size:1.1em">ğŸ“Š</span>
<span style="font-weight:700;font-size:1em;color:var(--t1)" id="kwr-result-title">ë¶„ì„ ê²°ê³¼</span>
<span id="kwr-period-badge" style="font-size:.7em;padding:3px 10px;border-radius:12px;background:var(--acs);color:var(--ac);font-weight:600">12ê°œì›”</span>
</div>
<div style="display:flex;gap:6px">
<button class="btn-o" onclick="downloadKwrCSV()" style="padding:7px 16px;font-size:.8em;display:flex;align-items:center;gap:5px">
<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
CSV
</button>
<button class="btn-p" onclick="downloadKwrPDF()" id="kwr-pdf-btn" style="padding:7px 16px;font-size:.8em;display:flex;align-items:center;gap:5px">
<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
PDF
</button>
</div>
</div>

<!-- ê²€ìƒ‰ëŸ‰ ì§€í‘œ (ì„¸ë¶€í™”) -->
<div class="hero-grid" style="grid-template-columns:repeat(3,1fr)">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ë„¤ì´ë²„ ì½˜í…ì¸ </span><span class="hero-icon views"><span class="p-logo naver" style="width:16px;height:16px"></span></span></div>
<div class="hero-val" id="kwr-volume">â€”</div>
<div class="hero-sub" id="kwr-volume-sub">ë¸”ë¡œê·¸+ë‰´ìŠ¤+ì¹´í˜</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">êµ¬ê¸€ ì½˜í…ì¸ </span><span class="hero-icon engage">ğŸ”</span></div>
<div class="hero-val" id="kwr-google-vol" style="color:var(--b)">â€”</div>
<div class="hero-sub" id="kwr-google-sub">ê²€ìƒ‰ ê²°ê³¼ ìˆ˜</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ì´ ì½˜í…ì¸ </span><span class="hero-icon posts">ğŸ“„</span></div>
<div class="hero-val" id="kwr-content-count">â€”</div>
<div class="hero-sub">ì „ì²´ í”Œë«í¼ í•©ì‚°</div>
</div>
</div>
<div class="hero-grid" style="grid-template-columns:repeat(3,1fr);margin-top:10px">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ê²½ìŸ ê°•ë„</span><span class="hero-icon engage">âš”ï¸</span></div>
<div class="hero-val" id="kwr-competition">â€”</div>
<div class="hero-sub" id="kwr-comp-sub">ë†’ì„ìˆ˜ë¡ ê²½ìŸ ì¹˜ì—´</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">íŠ¸ë Œë“œ</span><span class="hero-icon exposure">ğŸ“ˆ</span></div>
<div class="hero-val" id="kwr-trend">â€”</div>
<div class="hero-sub" id="kwr-trend-sub">ìµœê·¼ 3ê°œì›”</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">SNS ì½˜í…ì¸ </span><span class="hero-icon" style="background:rgba(168,85,247,.08);color:#a855f7">ğŸ“±</span></div>
<div class="hero-val" id="kwr-sns-vol" style="color:#a855f7">â€”</div>
<div class="hero-sub" id="kwr-sns-sub">ì¸ìŠ¤íƒ€+FB+ì¹´í˜</div>
</div>
</div>

<!-- í”Œë«í¼ë³„ ì„¸ë¶€ ìˆ˜ì¹˜ (í”„ë¡œê·¸ë ˆìŠ¤ ë°”) -->
<div class="visual-card" style="height:auto;margin-top:14px;margin-bottom:14px">
<div class="card-header"><span class="card-icon">ğŸ“Š</span>í”Œë«í¼ë³„ ì„¸ë¶€ ìˆ˜ì¹˜</div>
<div id="kwr-detail-bars" style="padding:4px 0">
<div style="text-align:center;padding:14px;color:var(--t3);font-size:.85em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤</div>
</div>
</div>

<!-- ê²€ìƒ‰ëŸ‰ ì¶”ì´ ì°¨íŠ¸ -->
<div class="trend-card" style="margin-bottom:14px">
<div class="trend-header">
<div class="trend-title"><span>ğŸ“ˆ</span> ì›”ë³„ ê²€ìƒ‰ëŸ‰ ì¶”ì´ (12ê°œì›”)</div>
</div>
<div class="trend-chart" id="kwr-chart" style="height:160px">
<div id="kwr-chart-empty" style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;color:var(--t3);font-size:.88em">ë°ì´í„° ë¡œë”© ì¤‘...</div>
</div>
<div class="trend-legend">
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--ac)"></div>ë„¤ì´ë²„ íŠ¸ë Œë“œ</div>
<div class="trend-legend-item"><div class="trend-legend-dot" style="background:var(--b)"></div>êµ¬ê¸€</div>
</div>
</div>

<!-- í‚¤ì›Œë“œ ëœë”© ìˆœìœ„ ì°¨íŠ¸ -->
<div class="dash-grid" style="margin-bottom:14px">
<div class="visual-card" style="height:auto;margin-bottom:0">
<div class="card-header"><span class="card-icon">ğŸ†</span>í”Œë«í¼ë³„ ì½˜í…ì¸  ì ìœ ìœ¨</div>
<div id="kwr-platform-chart" style="padding:4px 0">
<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤</div>
</div>
</div>
<div class="visual-card" style="height:auto;margin-bottom:0">
<div class="card-header"><span class="card-icon">ğŸ”¥</span>ì—°ê´€ í‚¤ì›Œë“œ ê²€ìƒ‰ëŸ‰ TOP</div>
<div id="kwr-ranking-chart" style="padding:4px 0">
<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤</div>
</div>
</div>
</div>

<!-- ë²¤ ë‹¤ì´ì–´ê·¸ë¨: í”Œë«í¼ ì½˜í…ì¸  êµì°¨ ë¶„ì„ -->
<div class="visual-card" style="height:auto;margin-bottom:14px">
<div class="card-header">
<span class="card-icon">ğŸ”€</span>í”Œë«í¼ êµì°¨ ë¶„ì„ (ë²¤ ë‹¤ì´ì–´ê·¸ë¨)
<div style="margin-left:auto;display:flex;gap:6px">
<button class="btn-o" onclick="downloadKwrCSV()" style="font-size:.78em;display:flex;align-items:center;gap:4px">
<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
CSV
</button>
</div>
</div>
<div id="kwr-venn-container">
<div style="text-align:center;padding:40px 20px;color:var(--t3)">
<div style="font-size:2.4em;margin-bottom:10px;opacity:.4">ğŸ”€</div>
<div style="font-size:.88em">í‚¤ì›Œë“œ ë¶„ì„ ì‹¤í–‰ í›„ í”Œë«í¼ë³„ êµì°¨ ì½˜í…ì¸ ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤</div>
</div>
</div>
</div>

<!-- í”Œë«í¼ë³„ íƒ­ -->
<div class="sub-pills" id="kwr-plat-pills">
<button class="sub-pill a" onclick="setKwrPlat('all')">ğŸ“‹ ì „ì²´</button>
<button class="sub-pill" onclick="setKwrPlat('news')">ğŸ“° ê¸°ì‚¬Â·ë‰´ìŠ¤</button>
<button class="sub-pill" onclick="setKwrPlat('blog')">ğŸ“ ë¸”ë¡œê·¸</button>
<button class="sub-pill" onclick="setKwrPlat('sns')">ğŸ“± SNS</button>
</div>

<!-- ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸ -->
<div class="visual-card" style="height:auto;margin-bottom:14px">
<div class="card-header">
<span class="card-icon">ğŸ“‘</span>ê´€ë ¨ ì½˜í…ì¸  (<span id="kwr-list-count">0</span>ê±´)
<span id="kwr-searched-kw" style="margin-left:6px;font-size:.82em;color:var(--ac);font-weight:400"></span>
</div>
<div id="kwr-content-list"></div>
</div>

<!-- ì—°ê´€ í‚¤ì›Œë“œ + AI ì „ëµ ì¹´ë“œ -->
<div class="dash-grid">
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ”—</span>ì—°ê´€ í‚¤ì›Œë“œ</div>
<div id="kwr-related" style="display:flex;flex-wrap:wrap;gap:6px"></div>
</div>
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">â­</span>í‚¤ì›Œë“œ ì €ì¥
<button class="btn-o" onclick="saveKw($('kwr-input').value)" style="margin-left:auto">+ ì €ì¥</button>
</div>
<div id="kwr-saved-list"></div>
</div>
</div>

<!-- AI ì „ëµ ì¸ì‚¬ì´íŠ¸ (ì¹´ë“œí˜•) -->
<div class="visual-card" style="height:auto;margin-top:14px;margin-bottom:14px">
<div class="card-header"><span class="card-icon">ğŸ’¡</span>AI í‚¤ì›Œë“œ ì „ëµ</div>
<div id="kwr-insight-cards" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:4px">
<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em;grid-column:1/-1">ë¶„ì„ ì‹¤í–‰ í›„ AI ì „ëµì´ í‘œì‹œë©ë‹ˆë‹¤</div>
</div>
<div id="kwr-insight" style="display:none"></div>
</div>

</div>
</div>

<!-- ==================== COMPARE TAB ==================== -->
<div class="tab-c" id="compare-tab">
<div class="ph"><div class="pt">âš–ï¸ ë¹„êµ ë¶„ì„</div><div class="ps">ë‚´ ì½˜í…ì¸  vs ê²½ìŸì‚¬ â€” AIê°€ ë¶„ì„</div></div>
<div class="sub-pills" id="cmp-pills">
<button class="sub-pill a" onclick="setCmpMode('dashboard')">ğŸ“Š ë¹„êµ ëŒ€ì‹œë³´ë“œ</button>
<button class="sub-pill" onclick="setCmpMode('text')">ğŸ“ ê¸€ ë¹„êµ</button>
<button class="sub-pill" onclick="setCmpMode('url')">ğŸ”— URL ë¹„êµ</button>
</div>

<!-- ë¹„êµ ëŒ€ì‹œë³´ë“œ -->
<div id="cmp-dashboard">

<!-- ë‚´ ì½˜í…ì¸  vs ê²½ìŸì‚¬ ìš”ì•½ -->
<div class="hero-grid" style="grid-template-columns:repeat(4,1fr)">
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ë‚´ ì½˜í…ì¸  ì ìˆ˜</span><span class="hero-icon views">ğŸ“</span></div>
<div class="hero-val" id="cmp-my-score" style="color:var(--g)">â€”</div>
<div class="hero-sub">AI ì¢…í•© í‰ê°€</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ê²½ìŸì‚¬ í‰ê· </span><span class="hero-icon engage">ğŸ¢</span></div>
<div class="hero-val" id="cmp-comp-score" style="color:var(--b)">â€”</div>
<div class="hero-sub">ì—…ê³„ í‰ê·  ê¸°ì¤€</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ìš°ì„¸ í•­ëª©</span><span class="hero-icon posts">ğŸ’ª</span></div>
<div class="hero-val" id="cmp-win-count" style="color:var(--g)">â€”</div>
<div class="hero-sub">ë‚´ê°€ ì•ì„œëŠ” ë¶„ì•¼</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">ê°œì„  í•„ìš”</span><span class="hero-icon exposure">âš ï¸</span></div>
<div class="hero-val" id="cmp-lose-count" style="color:var(--r)">â€”</div>
<div class="hero-sub">ë³´ì™„í•´ì•¼ í•  ë¶„ì•¼</div>
</div>
</div>

<!-- í•­ëª©ë³„ ë¹„êµ ë°” -->
<div class="visual-card" style="margin-bottom:14px;height:auto">
<div class="card-header">
<span class="card-icon">ğŸ“Š</span>í•­ëª©ë³„ ë¹„êµ
<button class="btn-o" onclick="runCmpDashboard()" style="margin-left:auto">ğŸ¤– AI ë¹„êµ ë¶„ì„</button>
</div>
<div class="mlbl" style="margin-bottom:10px">ë‚´ ì½˜í…ì¸ ì™€ ê²½ìŸì‚¬ì˜ í•­ëª©ë³„ ì ìˆ˜ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ê¸€ì„ ì…ë ¥í•˜ê³  ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>
<div id="cmp-bars"></div>
</div>

<!-- ë¹„êµ ê²°ê³¼ ìƒì„¸ -->
<div class="dash-grid">
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ’ª</span>ìš°ì„¸ í•­ëª©</div>
<div id="cmp-strengths" style="font-size:.88em;color:var(--t2);line-height:1.7"><span style="color:var(--t3)">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤</span></div>
</div>
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">âš ï¸</span>ê°œì„  í•„ìš” í•­ëª©</div>
<div id="cmp-weaknesses" style="font-size:.88em;color:var(--t2);line-height:1.7"><span style="color:var(--t3)">ë¶„ì„ ì‹¤í–‰ í›„ í‘œì‹œë©ë‹ˆë‹¤</span></div>
</div>
</div>

<!-- AI ì „ëµ ì œì•ˆ (ì¹´ë“œí˜•) -->
<div class="visual-card" style="margin-top:14px;height:auto">
<div class="card-header"><span class="card-icon">ğŸ’¡</span>AI ê²½ìŸ ì „ëµ ì œì•ˆ</div>
<div id="cmp-strategy-cards" style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:6px">
<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em;grid-column:1/-1">ë¶„ì„ ì‹¤í–‰ í›„ AI ì „ëµì´ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤</div>
</div>
<div id="cmp-strategy" style="display:none"></div>
</div>

<!-- ë¹„êµ ì´ë ¥ -->
<div class="visual-card" style="margin-top:14px;height:auto">
<div class="card-header">
<span class="card-icon">ğŸ“š</span>ë¹„êµ ì´ë ¥ (<span id="cmp-history-count">0</span>ê±´)
<button class="btn-o" onclick="clearCmpHistory()" style="margin-left:auto">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
</div>
<div id="cmp-history-list"><div style="text-align:center;padding:12px;color:var(--t3);font-size:.88em">ë¹„êµ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div></div>
</div>

</div>

<!-- ê¸€ ë¹„êµ -->
<div id="cmp-text" style="display:none">
<div class="sc"><div class="sch"><div class="sct">ë¹„êµí•  ê¸€</div></div><div class="scb">
<div class="cmp-vs"><div><div class="mlbl">ë‚´ ê¸€</div><textarea class="mi" id="cmp-a" style="min-height:120px" placeholder="ë‚´ ê¸€ ë¶™ì—¬ë„£ê¸°..."></textarea></div><div class="cmp-mid">VS</div><div><div class="mlbl">ê²½ìŸì‚¬ ê¸€</div><textarea class="mi" id="cmp-b" style="min-height:120px" placeholder="ê²½ìŸì‚¬ ê¸€..."></textarea></div></div>
<button class="btn-p full" onclick="doCompare()" id="cmp-btn" style="margin-top:10px">AI ë¹„êµ ë¶„ì„ ì‹¤í–‰</button>
</div></div>
<div class="ra" id="cmp-ra"><div class="sc"><div class="sch"><div class="sct">ğŸ¤– ë¶„ì„ ê²°ê³¼</div></div><div class="scb"><div class="rc" id="cmp-rc" style="max-height:400px"></div></div></div></div>
</div>

<!-- URL ë¹„êµ -->
<div id="cmp-url" style="display:none">
<div class="sc"><div class="sch"><div class="sct">ğŸ”— URLë¡œ ë¹„êµ ë¶„ì„</div></div><div class="scb">
<div style="font-size:.82em;color:var(--t3);margin-bottom:10px">URLë§Œ ë„£ìœ¼ë©´ AIê°€ ìë™ìœ¼ë¡œ ê¸€ì„ ê°€ì ¸ì™€ ë¹„êµí•©ë‹ˆë‹¤</div>
<div class="cmp-vs">
<div>
<div class="mlbl">ë‚´ ê¸€ URL</div>
<div style="display:flex;gap:6px">
<input class="mi" id="cmp-url-a" placeholder="https://blog.naver.com/..." style="flex:1;margin:0">
<button class="btn-o" onclick="fetchUrlContent('a')" id="fetch-btn-a" style="flex-shrink:0;font-size:.82em">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
</div>
<div id="cmp-url-a-status" style="margin-top:6px"></div>
<div id="cmp-url-a-preview" style="display:none;margin-top:6px;padding:10px;background:var(--bg4);border-radius:var(--r2);max-height:150px;overflow-y:auto">
<div id="cmp-url-a-title" style="font-weight:700;font-size:.88em;margin-bottom:4px;color:var(--t1)"></div>
<div id="cmp-url-a-text" style="font-size:.78em;color:var(--t2);line-height:1.6;white-space:pre-wrap"></div>
</div>
</div>
<div class="cmp-mid">VS</div>
<div>
<div class="mlbl">ê²½ìŸì‚¬ URL</div>
<div style="display:flex;gap:6px">
<input class="mi" id="cmp-url-b" placeholder="https://..." style="flex:1;margin:0">
<button class="btn-o" onclick="fetchUrlContent('b')" id="fetch-btn-b" style="flex-shrink:0;font-size:.82em">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
</div>
<div id="cmp-url-b-status" style="margin-top:6px"></div>
<div id="cmp-url-b-preview" style="display:none;margin-top:6px;padding:10px;background:var(--bg4);border-radius:var(--r2);max-height:150px;overflow-y:auto">
<div id="cmp-url-b-title" style="font-weight:700;font-size:.88em;margin-bottom:4px;color:var(--t1)"></div>
<div id="cmp-url-b-text" style="font-size:.78em;color:var(--t2);line-height:1.6;white-space:pre-wrap"></div>
</div>
</div>
</div>
<div style="display:flex;gap:8px;margin-top:12px">
<button class="btn-o" onclick="fetchBothUrls()" style="flex:1">ğŸ“¥ ì–‘ìª½ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°</button>
<button class="btn-p" onclick="compareUrls()" id="cmp-url-btn" style="flex:1;font-weight:700">âš”ï¸ URL ë¹„êµ ë¶„ì„</button>
</div>
</div></div>
<div class="ra" id="cmp-url-result" style="display:none">
<div class="sc"><div class="sch"><div class="sct">ğŸ¤– URL ë¹„êµ ë¶„ì„ ê²°ê³¼</div></div><div class="scb">
<div id="cmp-url-summary" style="margin-bottom:12px"></div>
<div class="rc" id="cmp-url-detail" style="max-height:500px;font-size:.88em;line-height:1.7;white-space:pre-wrap"></div>
</div></div>
</div>
</div>

</div>

<!-- ==================== AD SIMULATOR TAB ==================== -->
<div class="tab-c" id="adsim-tab">
<div class="ph"><div class="pt">ğŸ“¢ ê´‘ê³  ì‹œë®¬ë ˆì´í„°</div><div class="ps">í”Œë«í¼ë³„ ì˜ˆì‚°Â·íƒ€ê²ŸÂ·ì§€ì—­ ì„¤ì • ë° ROI ì˜ˆì¸¡</div></div>

<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:18px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">âš™ï¸ ê¸°ë³¸ ì„¤ì •</div></div><div class="scb">
<div class="mlbl">ê´‘ê³ ëª…</div><input class="mi" id="ad-name" placeholder="ì˜ˆ: 2024 LED ì‹œê³µì‚¬ë¡€ ìº í˜ì¸" value="ë°©ì†¡ì¤‘ê³„ ì„œë¹„ìŠ¤ í™ë³´">
<div class="mlbl">í”Œë«í¼</div>
<div class="ad-plats" id="ad-plats"><button class="ad-plat a" onclick="setAdPlat(this,'naver')">ë„¤ì´ë²„</button><button class="ad-plat" onclick="setAdPlat(this,'insta')">ì¸ìŠ¤íƒ€</button><button class="ad-plat" onclick="setAdPlat(this,'fb')">í˜ì´ìŠ¤ë¶</button><button class="ad-plat" onclick="setAdPlat(this,'gdn')">GDN</button></div>
<div class="mlbl" style="margin-top:8px">ì›” ì˜ˆì‚°: <span id="ad-budget-v" style="color:var(--ac);font-weight:600">â‚©1,000,000</span></div>
<input type="range" id="ad-sl" min="100000" max="10000000" step="100000" value="1000000" oninput="updateAd()" style="width:100%;accent-color:var(--ac)">
<div class="mlbl" style="margin-top:10px">ì»¤ìŠ¤í…€ í‚¤ì›Œë“œ</div><input class="mi" id="ad-kw" placeholder="íƒ€ê²Ÿ í‚¤ì›Œë“œ (ì‰¼í‘œ êµ¬ë¶„)" value="ë°©ì†¡ì¤‘ê³„, LEDì„¤ì¹˜, ì „ê´‘íŒë Œíƒˆ">
</div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ¯ íƒ€ê²Ÿ ì„¤ì •</div></div><div class="scb">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div><div class="mlbl">íƒ€ê²Ÿ ì—°ë ¹</div><select class="mi" id="ad-age" onchange="updateAd()"><option>ì „ì²´</option><option>20~30ëŒ€</option><option>30~40ëŒ€</option><option>40~50ëŒ€</option><option>50ëŒ€ ì´ìƒ</option></select></div>
<div><div class="mlbl">íƒ€ê²Ÿ ì„±ë³„</div><select class="mi" id="ad-gender" onchange="updateAd()"><option>ì „ì²´</option><option>ë‚¨ì„±</option><option>ì—¬ì„±</option></select></div>
<div><div class="mlbl">íƒ€ê²Ÿ ì§€ì—­</div><select class="mi" id="ad-region" onchange="updateAd()"><option>ì „êµ­</option><option>ì„œìš¸</option><option>ê²½ê¸°/ì¸ì²œ</option><option>ë¶€ì‚°/ìš¸ì‚°</option><option>ëŒ€ì „/ì¶©ë‚¨</option><option>ëŒ€êµ¬/ê²½ë¶</option><option>ê´‘ì£¼/ì „ë‚¨</option></select></div>
<div><div class="mlbl">ìº í˜ì¸ ê¸°ê°„</div><select class="mi" id="ad-period" onchange="updateAd()"><option value="1">1ê°œì›”</option><option value="3" selected>3ê°œì›”</option><option value="6">6ê°œì›”</option><option value="12">12ê°œì›”</option></select></div>
</div>
</div></div>
</div>

<div class="stat-grid" id="ad-stats" style="margin-bottom:18px"></div>

<div class="dash-grid" style="margin-bottom:18px">
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ’° ì˜ˆìƒ ë¹„ìš© ìƒì„¸</div></div><div class="scb" id="ad-cost-detail"></div></div>
<div class="sc" style="margin-bottom:0"><div class="sch"><div class="sct">ğŸ“Š ì˜ˆìƒ CRM í¼ë„</div></div><div class="scb" id="ad-crm"></div></div>
</div>

<!-- AI ê´‘ê³  ì¶”ì²œ -->
<div class="sc"><div class="sch"><div class="sct">ğŸ¤– AI ë§ì¶¤ ê´‘ê³  ì¶”ì²œ</div><button class="btn-o" onclick="getAdRecommend()">âœ¨ ì¶”ì²œë°›ê¸°</button></div><div class="scb">
<div class="mlbl" style="margin-bottom:8px">ì—…ì¢…Â·ì˜ˆì‚°Â·íƒ€ê²Ÿì— ë§ëŠ” ìµœì ì˜ ê´‘ê³  ì „ëµì„ AIê°€ ì¶”ì²œí•©ë‹ˆë‹¤</div>
<div id="ad-rec-result">
<div style="display:grid;gap:10px" id="ad-rec-cards"></div>
</div>
</div></div>

<div class="tip-box"><b>ğŸ’¡ AI:</b> ì˜ˆì‚° 50% ë„¤ì´ë²„, 30% ì¸ìŠ¤íƒ€ ë¦´ìŠ¤, 20% ë¦¬íƒ€ê²ŸíŒ… ë°°ë¶„ ì‹œ ìµœì  ROI.</div>
</div>

<!-- ==================== STYLE TAB ==================== -->
<div class="tab-c" id="style-tab">
<div class="ph"><div class="pt">ğŸ¨ ë¬¸ì²´ í•™ìŠµ</div><div class="ps">ê¸°ì¡´ ê¸€ì—ì„œ ë¬¸ì²´ë¥¼ í•™ìŠµí•˜ì—¬ AI ìƒì„±ì— ë°˜ì˜</div></div>
<div class="sub-pills" id="style-pills">
<button class="sub-pill a" onclick="setStyleMode('dashboard')">ğŸ“Š ë¶„ì„ ëŒ€ì‹œë³´ë“œ</button>
<button class="sub-pill" onclick="setStyleMode('paste')">ğŸ“ ê¸€ ë¶™ì—¬ë„£ê¸°</button>
<button class="sub-pill" onclick="setStyleMode('url')">ğŸ”— URL ì…ë ¥</button>
<button class="sub-pill" onclick="setStyleMode('compare')">âš–ï¸ ê¸€ ë¹„êµ</button>
</div>

<!-- ë¶„ì„ ëŒ€ì‹œë³´ë“œ -->
<div id="style-dashboard">
<div id="style-dash-empty" style="text-align:center;padding:40px 20px;color:var(--t3)">
<div style="font-size:2.5em;margin-bottom:10px">ğŸ“</div>
<div style="font-size:.95em;margin-bottom:6px">ì•„ì§ í•™ìŠµëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>
<div style="font-size:.85em">ê¸€ì„ ë¶™ì—¬ë„£ê¸°í•˜ê³  ë¶„ì„í•˜ë©´ ë¬¸ì²´ ëŒ€ì‹œë³´ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤</div>
</div>
<div id="style-dash-content" style="display:none">

<!-- ë¬¸ì²´ ì§€í‘œ ì¹´ë“œ -->
<div class="hero-grid" id="style-metrics"></div>

<!-- ë¬¸ì²´ ë ˆì´ë” ì‹œê°í™” -->
<div class="dash-grid">
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ“Š</span>ë¬¸ì²´ ì§€í‘œ ìƒì„¸</div>
<div id="style-bars"></div>
</div>
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ’¡</span>ë¬¸ì²´ íŠ¹ì§• ìš”ì•½</div>
<div id="style-summary" style="font-size:.88em;color:var(--t2);line-height:1.7;white-space:pre-wrap"></div>
</div>
</div>

<!-- ì €ì¥ëœ ê¸€ ëª©ë¡ -->
<div class="visual-card" style="height:auto;margin-top:14px">
<div class="card-header">
<span class="card-icon">ğŸ“š</span>í•™ìŠµëœ ê¸€ ëª©ë¡ (<span id="style-count">0</span>ê°œ)
<button class="btn-o" onclick="clearStyleTexts()" style="margin-left:auto">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
</div>
<div id="style-saved-list"></div>
</div>
</div>
</div>

<!-- ê¸€ ë¶™ì—¬ë„£ê¸° -->
<div id="style-paste" style="display:none">
<div class="sc"><div class="sch"><div class="sct">ê¸°ì¡´ ê¸€ ë¶™ì—¬ë„£ê¸°</div></div><div class="scb">
<div class="mlbl">ê¸€ ì œëª© (ì„ íƒ)</div>
<input class="mi" id="style-title" placeholder="ì˜ˆ: ì½”ì—‘ìŠ¤ LED ì„¤ì¹˜ í›„ê¸°">
<textarea class="mi" id="style-ta" style="min-height:140px" placeholder="í‰ì†Œ ì‘ì„±í•˜ëŠ” ë¸”ë¡œê·¸ ê¸€ì´ë‚˜ SNS ê¸€ì„ ë¶™ì—¬ë„£ê¸°..."></textarea>
<button class="btn-p full" onclick="learnStyle('paste')" id="style-btn">ğŸ¤– ë¬¸ì²´ í•™ìŠµ & ì €ì¥</button>
</div></div></div>
<div id="style-url" style="display:none">
<div class="sc"><div class="sch"><div class="sct">URLë¡œ í•™ìŠµ</div></div><div class="scb">
<div class="mlbl">ë¸”ë¡œê·¸/SNS URL</div><input class="mi" id="style-url-in" placeholder="https://blog.naver.com/...">
<div class="mlbl">ê¸€ ë‚´ìš© (URLì—ì„œ ë³µì‚¬)</div><textarea class="mi" id="style-url-content" style="min-height:100px" placeholder="URLì˜ ê¸€ ë‚´ìš©ì„ ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”..."></textarea>
<button class="btn-p full" onclick="learnStyle('url')">ğŸ¤– URL ê¸€ í•™ìŠµ & ì €ì¥</button>
</div></div></div>
<div id="style-compare" style="display:none">
<div class="sc"><div class="sch"><div class="sct">âš–ï¸ ê¸€ ë¹„êµ ë¶„ì„</div></div><div class="scb">
<div class="cmp-vs"><div><div class="mlbl">ê¸€ A</div><textarea class="mi" id="style-cmp-a" style="min-height:100px" placeholder="ì²« ë²ˆì§¸ ê¸€..."></textarea></div><div class="cmp-mid">VS</div><div><div class="mlbl">ê¸€ B</div><textarea class="mi" id="style-cmp-b" style="min-height:100px" placeholder="ë‘ ë²ˆì§¸ ê¸€..."></textarea></div></div>
<button class="btn-p full" onclick="compareStyles()">ë¬¸ì²´ ë¹„êµ ë¶„ì„</button>
</div></div></div>
<div class="ra" id="style-ra"><div class="sc"><div class="sch"><div class="sct">ğŸ¨ í•™ìŠµ ê²°ê³¼</div></div><div class="scb"><div class="rc" id="style-rc"></div></div></div></div>
</div>

<!-- ==================== DOWNLOAD TAB ==================== -->
<div class="tab-c" id="download-tab">
<div class="ph"><div class="pt">ğŸ“¥ ë‹¤ìš´ë¡œë“œ ì„¼í„°</div><div class="ps">ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ PDF Â· CSVë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ì´ë ¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</div></div>

<!-- ë¹ ë¥¸ ë‹¤ìš´ë¡œë“œ -->
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px">

<!-- í‚¤ì›Œë“œ ë¶„ì„ ë¦¬í¬íŠ¸ -->
<div class="visual-card" style="height:auto;margin-bottom:0;cursor:pointer;transition:all .3s" onmouseover="this.style.borderColor='rgba(249,115,22,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
<div style="width:44px;height:44px;border-radius:12px;background:rgba(249,115,22,.08);display:flex;align-items:center;justify-content:center;font-size:1.4em;flex-shrink:0">ğŸ”</div>
<div><div style="font-weight:700;font-size:.92em">í‚¤ì›Œë“œ ë¶„ì„</div><div style="font-size:.72em;color:var(--t3)">ê²€ìƒ‰ëŸ‰ Â· íŠ¸ë Œë“œ Â· í”Œë«í¼ ë¶„ì„</div></div>
</div>
<div style="display:flex;gap:6px">
<button class="btn-p" onclick="goAndDownload('kwresearch','pdf')" style="flex:1;padding:10px;font-size:.82em">ğŸ“„ PDF</button>
<button class="btn-o" onclick="goAndDownload('kwresearch','csv')" style="flex:1;padding:10px;font-size:.82em">ğŸ“Š CSV</button>
</div>
<div style="font-size:.68em;color:var(--t3);margin-top:8px" id="dl-kwr-status">í‚¤ì›Œë“œ ë¶„ì„ ì‹¤í–‰ í›„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥</div>
</div>

<!-- ë¹„êµ ë¶„ì„ ë¦¬í¬íŠ¸ -->
<div class="visual-card" style="height:auto;margin-bottom:0;cursor:pointer;transition:all .3s" onmouseover="this.style.borderColor='rgba(96,165,250,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
<div style="width:44px;height:44px;border-radius:12px;background:rgba(96,165,250,.08);display:flex;align-items:center;justify-content:center;font-size:1.4em;flex-shrink:0">âš–ï¸</div>
<div><div style="font-weight:700;font-size:.92em">ë¹„êµ ë¶„ì„</div><div style="font-size:.72em;color:var(--t3)">ë‚´ ì½˜í…ì¸  vs ê²½ìŸì‚¬</div></div>
</div>
<div style="display:flex;gap:6px">
<button class="btn-p" onclick="downloadCompareReport('pdf')" style="flex:1;padding:10px;font-size:.82em;background:var(--b)">ğŸ“„ PDF</button>
<button class="btn-o" onclick="downloadCompareReport('csv')" style="flex:1;padding:10px;font-size:.82em">ğŸ“Š CSV</button>
</div>
<div style="font-size:.68em;color:var(--t3);margin-top:8px">ë¹„êµ ë¶„ì„ ì‹¤í–‰ í›„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥</div>
</div>

<!-- ê´‘ê³  ì‹œë®¬ë ˆì´ì…˜ ë¦¬í¬íŠ¸ -->
<div class="visual-card" style="height:auto;margin-bottom:0;cursor:pointer;transition:all .3s" onmouseover="this.style.borderColor='rgba(52,211,153,.2)';this.style.transform='translateY(-2px)'" onmouseout="this.style.borderColor='';this.style.transform=''">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
<div style="width:44px;height:44px;border-radius:12px;background:rgba(52,211,153,.08);display:flex;align-items:center;justify-content:center;font-size:1.4em;flex-shrink:0">ğŸ“¢</div>
<div><div style="font-weight:700;font-size:.92em">ê´‘ê³  ì‹œë®¬ë ˆì´ì…˜</div><div style="font-size:.72em;color:var(--t3)">ì˜ˆì‚° Â· ROI Â· CRM í¼ë„</div></div>
</div>
<div style="display:flex;gap:6px">
<button class="btn-p" onclick="downloadAdReport('pdf')" style="flex:1;padding:10px;font-size:.82em;background:var(--g)">ğŸ“„ PDF</button>
<button class="btn-o" onclick="downloadAdReport('csv')" style="flex:1;padding:10px;font-size:.82em">ğŸ“Š CSV</button>
</div>
<div style="font-size:.68em;color:var(--t3);margin-top:8px">ê´‘ê³  ì„¤ì • í›„ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥</div>
</div>

</div>

<!-- ì½˜í…ì¸  ë‚´ë³´ë‚´ê¸° -->
<div class="visual-card" style="height:auto;margin-bottom:18px">
<div class="card-header"><span class="card-icon">ğŸ“</span>ì½˜í…ì¸  ë‚´ë³´ë‚´ê¸°</div>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:6px">
<div style="padding:14px;background:var(--bg4);border-radius:var(--r2);border:1px solid var(--border)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
<span class="p-logo naver" style="width:20px;height:20px"></span>
<span style="font-weight:600;font-size:.85em">ë¸”ë¡œê·¸ ê¸€</span>
</div>
<div style="font-size:.72em;color:var(--t3);margin-bottom:10px">ìƒì„±ëœ ë¸”ë¡œê·¸ A/Bì•ˆ + ìµœì¢… ê¸€</div>
<button class="btn-o" onclick="exportContent('blog')" style="width:100%;font-size:.78em;padding:8px">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
</div>
<div style="padding:14px;background:var(--bg4);border-radius:var(--r2);border:1px solid var(--border)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
<span class="p-logo ig" style="width:20px;height:20px"></span>
<span style="font-weight:600;font-size:.85em">ì¸ìŠ¤íƒ€ ìº¡ì…˜</span>
</div>
<div style="font-size:.72em;color:var(--t3);margin-bottom:10px">A/B ìº¡ì…˜ + í•´ì‹œíƒœê·¸</div>
<button class="btn-o" onclick="exportContent('insta')" style="width:100%;font-size:.78em;padding:8px">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
</div>
<div style="padding:14px;background:var(--bg4);border-radius:var(--r2);border:1px solid var(--border)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
<span class="p-logo fbk" style="width:20px;height:20px"></span>
<span style="font-weight:600;font-size:.85em">í˜ì´ìŠ¤ë¶ ê¸€</span>
</div>
<div style="font-size:.72em;color:var(--t3);margin-bottom:10px">A/B ê²Œì‹œë¬¼ + ìµœì¢… ê¸€</div>
<button class="btn-o" onclick="exportContent('fb')" style="width:100%;font-size:.78em;padding:8px">ğŸ“‹ í…ìŠ¤íŠ¸ ë³µì‚¬</button>
</div>
</div>
</div>

<!-- ë‹¤ìš´ë¡œë“œ ì´ë ¥ -->
<div class="visual-card" style="height:auto;margin-bottom:18px">
<div class="card-header">
<span class="card-icon">ğŸ“š</span>ë‹¤ìš´ë¡œë“œ ì´ë ¥ (<span id="dl-history-count">0</span>ê±´)
<button class="btn-o" onclick="clearDlHistory()" style="margin-left:auto;font-size:.78em">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
</div>
<div id="dl-history-list">
<div style="text-align:center;padding:30px 20px;color:var(--t3)">
<div style="font-size:2em;margin-bottom:8px;opacity:.4">ğŸ“¥</div>
<div style="font-size:.88em">ë‹¤ìš´ë¡œë“œ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div>
<div style="font-size:.78em;margin-top:4px">PDF ë˜ëŠ” CSVë¥¼ ë‹¤ìš´ë¡œë“œí•˜ë©´ ì—¬ê¸°ì— ê¸°ë¡ë©ë‹ˆë‹¤</div>
</div>
</div>
</div>

<!-- ê¸°ê°„ë³„ ë¦¬í¬íŠ¸ ìƒì„± -->
<div class="visual-card" style="height:auto">
<div class="card-header"><span class="card-icon">ğŸ“†</span>ê¸°ê°„ë³„ ì¢…í•© ë¦¬í¬íŠ¸</div>
<div style="display:flex;gap:10px;align-items:end;flex-wrap:wrap;margin-top:6px">
<div>
<div class="mlbl">ì‹œì‘ì¼</div>
<input type="date" id="dl-report-from" class="mi" style="margin:0;width:150px">
</div>
<div>
<div class="mlbl">ì¢…ë£Œì¼</div>
<input type="date" id="dl-report-to" class="mi" style="margin:0;width:150px">
</div>
<div>
<div class="mlbl">í¬í•¨ í•­ëª©</div>
<div style="display:flex;gap:4px">
<button class="ad-plat a" onclick="this.classList.toggle('a')" id="dl-inc-kw">í‚¤ì›Œë“œ</button>
<button class="ad-plat a" onclick="this.classList.toggle('a')" id="dl-inc-content">ì½˜í…ì¸ </button>
<button class="ad-plat a" onclick="this.classList.toggle('a')" id="dl-inc-ad">ê´‘ê³ </button>
</div>
</div>
<button class="btn-p" onclick="generatePeriodReport()" style="padding:10px 24px;font-size:.88em;margin-left:auto">ğŸ“„ ì¢…í•© ë¦¬í¬íŠ¸ ìƒì„±</button>
</div>
</div>

</div>

<!-- ==================== MODALS ==================== -->
<div class="modal" id="m-myinfo"><div class="modal-c">
<div class="modal-t">ğŸ‘¤ ë‚´ ì •ë³´</div>
<div class="mlbl">ë¸”ë¡œê·¸ URL</div><input class="mi" id="info-blog" placeholder="https://blog.naver.com/...">
<div class="mlbl">ì¸ìŠ¤íƒ€ê·¸ë¨</div><input class="mi" id="info-insta" placeholder="@ê³„ì •ëª…">
<div class="mlbl">í˜ì´ìŠ¤ë¶</div><input class="mi" id="info-fb" placeholder="https://facebook.com/...">
<div class="mlbl">í™ˆí˜ì´ì§€</div><input class="mi" id="info-hp" placeholder="https://...">
<div class="mlbl">ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤</div><input class="mi" id="info-sp" placeholder="https://naver.me/...">
<div class="bg" style="margin-top:10px"><button class="btn-p" onclick="saveInfo()">ì €ì¥</button><button class="btn-o" onclick="closeM('m-myinfo')">ë‹«ê¸°</button></div>
</div></div>

</div></div>
<div class="toast" id="toast"></div>
<script>
const $=id=>document.getElementById(id);
const LS=(k,v)=>{if(v!==undefined){localStorage.setItem(k,JSON.stringify(v));return v}try{return JSON.parse(localStorage.getItem(k))}catch{return null}};

// === TABS ===
const tabs=['blog','insta','fb','sp','ooh','dash','kwresearch','compare','adsim','style','download'];
const tabN={blog:'ë¸”ë¡œê·¸',insta:'ì¸ìŠ¤íƒ€',fb:'í˜ì´ìŠ¤ë¶',sp:'í”Œë ˆì´ìŠ¤',ooh:'ì˜¥ì™¸ê´‘ê³ ',dash:'ëŒ€ì‹œë³´ë“œ',kwresearch:'í‚¤ì›Œë“œ',compare:'ë¹„êµ',adsim:'ê´‘ê³ ',style:'ë¬¸ì²´',download:'ë‹¤ìš´ë¡œë“œ'};
function go(t){tabs.forEach(x=>{const el=$(x+'-tab');if(el){el.classList.remove('a');if(x===t)el.classList.add('a')}});
document.querySelectorAll('.nav-i[data-t]').forEach(b=>{b.classList.remove('a');if(b.dataset.t===t)b.classList.add('a')});
document.querySelectorAll('.mnav button').forEach(b=>{b.classList.remove('a');if(b.dataset.t===t)b.classList.add('a')});
if(t==='adsim')updateAd();if(t==='style')renderStyleDash();if(t==='compare')renderCmpHistory();if(t==='dash')loadDashboardData();}
function initMnav(){$('mnav').innerHTML=tabs.map(t=>'<button data-t="'+t+'" '+(t==='blog'?'class="a"':'')+' onclick="go(\''+t+'\')">'+tabN[t]+'</button>').join('')}

// === STEPS ===
function setSt(pre,n,total){for(let i=0;i<total;i++){const s=document.querySelectorAll('#'+pre+'-steps .step')[i];const c=$(pre.charAt(0)+'s'+i);if(!s||!c)continue;s.classList.remove('a','done');c.classList.remove('a');if(i<n)s.classList.add('done');if(i===n){s.classList.add('a');c.classList.add('a')}}}
function bst(n){setSt('blog',n,5);
if(n===3){syncEditorToTextarea();$('blog-final').textContent=getEditorText()}
if(n===4){renderBlogPreview()}}

// === ë¦¬ì¹˜ ì—ë””í„° ì‹œìŠ¤í…œ ===
// ì—ë””í„° â†” textarea ë™ê¸°í™”
function syncEditorToTextarea(){
const editor=$('blog-editor');
$('blog-edit-ta').value=getEditorText();
}
function getEditorText(){
const editor=$('blog-editor');
let text='';
editor.childNodes.forEach(node=>{
if(node.nodeType===3){text+=node.textContent;}
else if(node.tagName==='BR'){text+='\n';}
else if(node.tagName==='IMG'){text+='\n[ğŸ“· ì´ë¯¸ì§€]\n';}
else if(node.tagName==='DIV'||node.tagName==='P'){
if(node.querySelector('img')){text+='\n[ğŸ“· ì´ë¯¸ì§€]\n';}
else{text+='\n'+node.textContent;}
}else{text+=node.textContent;}
});
return text.trim();
}

// A/Bì•ˆ ì„ íƒ ì‹œ ì—ë””í„°ì— ë¡œë“œ
function loadToEditor(text){
const editor=$('blog-editor');
const lines=text.split('\n');
editor.innerHTML=lines.map(line=>{
if(!line.trim())return '<p><br></p>';
return '<p>'+line.replace(/</g,'&lt;').replace(/>/g,'&gt;')+'</p>';
}).join('');
}

// ì´ë¯¸ì§€ ì‚½ì…
function editorInsertImage(){
$('blog-inline-file').click();
}
function handleEditorImg(input){
const file=input.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=function(e){
const editor=$('blog-editor');
editor.focus();
const img=document.createElement('img');
img.src=e.target.result;
img.style.maxWidth='100%';
img.style.borderRadius='6px';
img.style.margin='10px 0';
img.style.display='block';
img.onclick=function(){
document.querySelectorAll('#blog-editor img').forEach(i=>i.classList.remove('selected'));
this.classList.toggle('selected');
};
// ì»¤ì„œ ìœ„ì¹˜ì— ì‚½ì…
const sel=window.getSelection();
if(sel.rangeCount>0&&editor.contains(sel.anchorNode)){
const range=sel.getRangeAt(0);
range.collapse(false);
const wrapper=document.createElement('div');
wrapper.appendChild(img);
wrapper.appendChild(document.createElement('br'));
range.insertNode(wrapper);
range.setStartAfter(wrapper);
range.collapse(true);
sel.removeAllRanges();
sel.addRange(range);
}else{
const wrapper=document.createElement('div');
wrapper.appendChild(img);
wrapper.appendChild(document.createElement('br'));
editor.appendChild(wrapper);
}
toast('ğŸ“· ì´ë¯¸ì§€ ì‚½ì…ë¨');
};
reader.readAsDataURL(file);
input.value='';
}

// íƒœê·¸ ì‚½ì…
function editorInsertTag(){
const editor=$('blog-editor');
editor.focus();
const tag=document.createElement('p');
tag.textContent='#ë°©ì†¡ì¤‘ê³„ #LEDì‹œìŠ¤í…œ';
tag.style.color='#03C75A';
editor.appendChild(tag);
}

// Deleteí‚¤ë¡œ ì„ íƒëœ ì´ë¯¸ì§€ ì‚­ì œ
document.addEventListener('keydown',function(e){
if(e.key==='Delete'||e.key==='Backspace'){
const sel=document.querySelector('#blog-editor img.selected');
if(sel){e.preventDefault();sel.parentElement.tagName==='DIV'?sel.parentElement.remove():sel.remove();toast('ğŸ—‘ï¸ ì´ë¯¸ì§€ ì‚­ì œë¨');}
}
});

// ë¯¸ë¦¬ë³´ê¸° ë Œë”
function renderBlogPreview(){
const editor=$('blog-editor');
const raw=getEditorText();
if(!raw){$('blog-preview-card').innerHTML='<div style="padding:40px;text-align:center;color:#aaa">ê¸€ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸€ì„ ìƒì„±í•´ì£¼ì„¸ìš”.</div>';return}

// ì—ë””í„° HTMLì—ì„œ ì§ì ‘ ë¯¸ë¦¬ë³´ê¸° ìƒì„±
let previewBody='';
editor.childNodes.forEach(node=>{
if(node.nodeType===3&&node.textContent.trim()){
previewBody+='<p>'+node.textContent+'</p>';
}else if(node.tagName==='IMG'){
previewBody+='<div style="margin:16px 0"><img src="'+node.src+'" style="width:100%;border-radius:6px;display:block"></div>';
}else if(node.tagName==='DIV'||node.tagName==='P'){
const img=node.querySelector('img');
if(img){
previewBody+='<div style="margin:16px 0"><img src="'+img.src+'" style="width:100%;border-radius:6px;display:block"></div>';
}else{
const txt=node.textContent.trim();
if(!txt)return;
if(txt.match(/^#\S/))return;
if(txt.match(/^[â– â—†â–¶â—ã€]/)||txt.match(/^\d+[\.\)]/)){
const clean=txt.replace(/^[â– â—†â–¶â—]+\s*/,'').replace(/^ã€|ã€‘$/g,'');
previewBody+='<p style="font-weight:700;font-size:1.05em;color:#222;margin-top:18px;margin-bottom:8px;border-left:3px solid #03C75A;padding-left:10px">'+clean+'</p>';
}else{
previewBody+='<p>'+txt+'</p>';
}
}
}
});

// ì œëª© = ì²« í…ìŠ¤íŠ¸ ë…¸ë“œ
const lines=raw.split('\n').filter(l=>l.trim()&&!l.match(/^\[ğŸ“·/));
let title=(lines[0]||'ì œëª© ì—†ìŒ').replace(/^[\[ã€\(]?ì œëª©[\]ã€‘\)]?\s*[:ï¼š]?\s*/,'').replace(/^#\s*/,'').trim();
const tags=raw.match(/#[^\s#]+/g)||[];
const tagsHTML=tags.map(t=>'<span class="bp-tag">'+t+'</span>').join(' ');

const coverImg=document.querySelector('#blog-imgs .isl.filled img');
let coverHTML=coverImg?'<div style="max-height:300px;overflow:hidden"><img src="'+coverImg.src+'" style="width:100%;display:block"></div>':'';

const today=new Date();
const dateStr=today.getFullYear()+'.'+(today.getMonth()+1)+'.'+today.getDate()+'. '+today.getHours()+':'+String(today.getMinutes()).padStart(2,'0');
const blogName=$('info-blog').value?$('info-blog').value.split('/').pop()||'ë‚´ ë¸”ë¡œê·¸':'ë‚´ ë¸”ë¡œê·¸';

$('blog-preview-card').innerHTML=`
${coverHTML}
<div class="bp-header"><div class="bp-profile"><div class="bp-avatar">N</div><div><div class="bp-author">${blogName}</div><div class="bp-date">${dateStr}</div></div></div></div>
<div class="bp-title">${title}</div>
<div class="bp-body">${previewBody}</div>
${tags.length?'<div class="bp-tags">'+tagsHTML+'</div>':''}
<div class="bp-footer"><span>â¤ï¸ ì¢‹ì•„ìš” 0</span><span>ğŸ’¬ ëŒ“ê¸€ 0</span><span>ğŸ”— ê³µìœ </span><span>ğŸ“Œ ì €ì¥</span></div>`;
}
function ist(n){setSt('insta',n,3)}
function fst(n){setSt('fb',n,3)}

// === API ===
let apiKey=localStorage.getItem('anthropic_api_key')||'';
let backendUrl='https://nweca.vercel.app';
let totalCredits=parseFloat(localStorage.getItem('total_credits')||'0');
function updCredit(id,cost){totalCredits+=cost;localStorage.setItem('total_credits',totalCredits.toFixed(4));const e1=$(id+'-credit'),e2=$(id+'-credit-total');if(e1)e1.textContent='$'+cost.toFixed(4);if(e2)e2.textContent='$'+totalCredits.toFixed(4)}
function showM(id){$(id).classList.add('show');if(id==='m-myinfo'){const info=LS('myinfo')||{};$('info-blog').value=info.blog||'';$('info-insta').value=info.insta||'';$('info-fb').value=info.fb||'';$('info-hp').value=info.hp||'';$('info-sp').value=info.sp||''}}
function closeM(id){$(id).classList.remove('show')}
function saveInfo(){const info={blog:$('info-blog').value.trim(),insta:$('info-insta').value.trim(),fb:$('info-fb').value.trim(),hp:$('info-hp').value.trim(),sp:$('info-sp').value.trim()};LS('myinfo',info);toast('âœ… ë‚´ ì •ë³´ ì €ì¥ë¨');closeM('m-myinfo')}
function toast(m){const t=$('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2300)}

// === ë°±ì—”ë“œ ì—°ê²° ===
async function callBackend(endpoint, params={}){
if(!backendUrl){toast('âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜');return null}
try{
const isPost=endpoint.includes('datalab')||endpoint.includes('ai-analyze')||endpoint.includes('credit');
const url=isPost?backendUrl+endpoint:backendUrl+endpoint+'?'+new URLSearchParams(params);
const opts=isPost?{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(params)}:{};
const r=await fetch(url,opts);
if(!r.ok){const errText=await r.text().catch(()=>'');throw new Error('ì„œë²„ ì˜¤ë¥˜ ('+r.status+'): '+(errText||''))}
const data=await r.json();
if(data.error)throw new Error(data.error);
return data;
}catch(e){
if(e.message==='Failed to fetch')throw new Error('ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
throw e;
}
}

// === AI CALL ===
async function callAI(prompt,img64){
// ë°±ì—”ë“œê°€ ìˆìœ¼ë©´ ë°±ì—”ë“œ ê²½ìœ  (APIí‚¤ ë¶ˆí•„ìš”)
if(backendUrl&&!img64){
try{
const data=await callBackend('/api/ai-analyze',{prompt});
if(data&&data.analysis)return data.analysis;
}catch(e){
console.error('ë°±ì—”ë“œ AI í˜¸ì¶œ ì‹¤íŒ¨:',e.message);
// ë°±ì—”ë“œ ì‹¤íŒ¨ ì‹œ ì§ì ‘ í˜¸ì¶œ ì‹œë„
if(!apiKey){toast('âš ï¸ AI ì„œë²„ ì—°ê²° ì‹¤íŒ¨: '+e.message);return null}
}
}
// ì§ì ‘ Claude API í˜¸ì¶œ (fallback)
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return null}
try{
const content=[];if(img64)content.push({type:'image',source:{type:'base64',media_type:'image/jpeg',data:img64}});content.push({type:'text',text:prompt});
const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':apiKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:2000,messages:[{role:'user',content}]})});
const d=await r.json();if(d.content&&d.content[0])return d.content[0].text;if(d.error)throw new Error(d.error.message);throw new Error('ì‘ë‹µ ì˜¤ë¥˜');
}catch(e){toast('âš ï¸ AI í˜¸ì¶œ ì‹¤íŒ¨: '+e.message);return null}
}
function getStyleHint(){const p=LS('style_profile');return p?'\n\n[ì‘ì„±ì ë¬¸ì²´]\n'+p+'\nì´ ë¬¸ì²´ë¥¼ ë°˜ì˜í•˜ì—¬ ì‘ì„±.':''}

// === AUTH & LOGIN SYSTEM ===
let naverAuth=JSON.parse(localStorage.getItem('naver_auth')||'null');
let metaAuth=JSON.parse(localStorage.getItem('meta_auth')||'null');
let currentUser=JSON.parse(localStorage.getItem('current_user')||'null');

// ë¡œê·¸ì¸ í™”ë©´ ì´ˆê¸°í™”
function initLogin(){
if(naverAuth||metaAuth||localStorage.getItem('skip_login')){
hideLoginScreen();
initUserState();
// ë¡œê·¸ì¸ ìœ ì €ë©´ DBì—ì„œ ë°ì´í„° ë™ê¸°í™” + ìë™ ë°ì´í„° ë¡œë“œ
if(getDbUserId())setTimeout(()=>syncFromDB().catch(()=>{}),1000);
if(naverAuth)setTimeout(()=>autoFetchNaverData().catch(()=>{}),1500);
}
}

function hideLoginScreen(){
const o=$('login-overlay');
if(o)o.classList.add('hidden');
}

function skipLogin(){
localStorage.setItem('skip_login','true');
hideLoginScreen();
initUserState();
}

function loginNaver(){
if(!backendUrl){toast('âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜');return}
const w=window.open(backendUrl+'/api/auth?provider=naver','ë„¤ì´ë²„ ë¡œê·¸ì¸','width=500,height=600,top=100,left=100');
if(!w)toast('âš ï¸ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš©í•´ì£¼ì„¸ìš”');
}

function loginMeta(){
if(!backendUrl){toast('âš ï¸ ì„œë²„ ì—°ê²° ì˜¤ë¥˜');return}
const w=window.open(backendUrl+'/api/auth?provider=meta','Facebook ë¡œê·¸ì¸','width=500,height=600,top=100,left=100');
if(!w)toast('âš ï¸ íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš©í•´ì£¼ì„¸ìš”');
}

// OAuth íŒì—…ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
window.addEventListener('message',function(e){
if(e.data&&e.data.type==='naver-auth'){
naverAuth=e.data.data;
localStorage.setItem('naver_auth',JSON.stringify(naverAuth));
if(naverAuth.dbUserId)localStorage.setItem('db_user_id',naverAuth.dbUserId);

// ë¸”ë¡œê·¸ ìë™ ì—°ê²°
if(naverAuth.blogUrl){
const info=LS('myinfo')||{};
info.blog=naverAuth.blogUrl;
LS('myinfo',info);
}

// ë¸”ë¡œê·¸ ë°ì´í„° ì €ì¥
if(naverAuth.blogPosts)LS('naver_blog_posts',naverAuth.blogPosts);
if(naverAuth.blogTotal)LS('naver_blog_total',naverAuth.blogTotal);

toast('âœ… ë„¤ì´ë²„ ë¡œê·¸ì¸ ì„±ê³µ!');
if(naverAuth.blogUrl)toast('ğŸ“ ë¸”ë¡œê·¸ ìë™ ì—°ê²°: '+naverAuth.blogUrl);
initUserState();
hideLoginScreen();
loadDashboardData();
syncFromDB();
autoFetchNaverData();
}
if(e.data&&e.data.type==='meta-auth'){
metaAuth=e.data.data;
localStorage.setItem('meta_auth',JSON.stringify(metaAuth));
if(metaAuth.dbUserId)localStorage.setItem('db_user_id',metaAuth.dbUserId);

// í˜ì´ìŠ¤ë¶ í˜ì´ì§€ ë°ì´í„° ì €ì¥
if(metaAuth.pages)LS('meta_pages',metaAuth.pages);
if(metaAuth.fbPosts)LS('meta_fb_posts',metaAuth.fbPosts);

toast('âœ… Facebook ë¡œê·¸ì¸ ì„±ê³µ!');
if(metaAuth.pages?.length)toast('ğŸ‘ í˜ì´ìŠ¤ë¶ í˜ì´ì§€ '+metaAuth.pages.length+'ê°œ ì—°ê²°ë¨');
initUserState();
hideLoginScreen();
loadDashboardData();
syncFromDB();
}
});

// === Supabase ë°ì´í„° ë™ê¸°í™” ===
function getDbUserId(){return localStorage.getItem('db_user_id')||null}

async function callDB(action,table,data,filters){
const userId=getDbUserId();
if(!userId||!backendUrl)return null;
try{
const r=await fetch(backendUrl+'/api/user-data',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({action,table,data,userId,filters})
});
const j=await r.json();
if(j.error)console.error('DB:',j.error);
return j;
}catch(e){console.error('DB call error:',e);return null}
}

// í¬ë ˆë”§ DB ì €ì¥
async function saveCredit(amount,description){
await callDB('add_credit',null,{amount,description,action:'usage'});
}

// í‚¤ì›Œë“œ ë¶„ì„ ì´ë ¥ ì €ì¥
async function saveKeywordHistory(keyword,data){
await callDB('insert','keyword_history',{
keyword,
naver_blog_total:data.summary?.naverBlogTotal||0,
naver_news_total:data.summary?.naverNewsTotal||0,
google_total:data.summary?.googleTotal||0,
instagram_total:data.summary?.instagramTotal||0,
facebook_total:data.summary?.facebookTotal||0,
trend_direction:data.summary?.trendDirection||'ìœ ì§€',
analysis_data:data.summary||{}
});
}

// ì½˜í…ì¸  ìƒì„± ì´ë ¥ ì €ì¥
async function saveContentHistory(platform,type,title,content,creditUsed){
await callDB('insert','content_history',{
platform,content_type:type,title,
content:(content||'').substring(0,5000),
credit_used:creditUsed
});
}

// ë¹„êµ ë¶„ì„ ì´ë ¥ ì €ì¥
async function saveCompareHistory(type,dataA,dataB,result,scoreA,scoreB){
await callDB('insert','compare_history',{
compare_type:type,
data_a:dataA,data_b:dataB,
result:(result||'').substring(0,3000),
score_a:scoreA||null,score_b:scoreB||null
});
}

// ì €ì¥ëœ í‚¤ì›Œë“œ DB ì €ì¥
async function saveSavedKeyword(keyword,volume){
await callDB('insert','saved_keywords',{keyword,volume:volume||''});
}

// í”Œë«í¼ í‚¤ì›Œë“œ ì €ì¥
async function savePlatformKeyword(platform,inputKw,resultData){
await callDB('insert','platform_keywords',{platform,input_keyword:inputKw,result_data:resultData});
}

// DBì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
async function syncFromDB(){
const userId=getDbUserId();
if(!userId||!backendUrl)return;
try{
// í¬ë ˆë”§ ì”ì•¡
const cr=await callDB('get_credits');
if(cr&&cr.ok&&cr.balance!==undefined){
totalCredits=parseFloat(cr.balance);
localStorage.setItem('total_credits',totalCredits.toFixed(4));
}

// ì €ì¥ëœ í‚¤ì›Œë“œ
const sk=await callDB('list','saved_keywords');
if(sk&&sk.ok&&sk.data){
kwrSaved=sk.data.map(r=>({kw:r.keyword,date:new Date(r.created_at).toLocaleDateString('ko-KR'),vol:r.volume||''}));
LS('kwr_saved',kwrSaved);
if(typeof renderKwrSaved==='function')renderKwrSaved();
}

// í‚¤ì›Œë“œ ë¶„ì„ ì´ë ¥
const kh=await callDB('list','keyword_history');
if(kh&&kh.ok&&kh.data){
kwrRecent=kh.data.slice(0,10).map(r=>r.keyword);
LS('kwr_recent',kwrRecent);
if(typeof renderKwrRecent==='function')renderKwrRecent();
}

console.log('âœ… DB ë™ê¸°í™” ì™„ë£Œ');
}catch(e){console.error('syncFromDB error:',e)}
}

// ë„¤ì´ë²„ ë¡œê·¸ì¸ í›„ ìë™ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
async function autoFetchNaverData(){
if(!naverAuth||!backendUrl)return;
try{
// ë¸”ë¡œê·¸ ìµœê·¼ ê¸€ ëŒ€ì‹œë³´ë“œì— í‘œì‹œ
const blogTotal=naverAuth.blogTotal||LS('naver_blog_total')||0;
const blogPosts=naverAuth.blogPosts||LS('naver_blog_posts')||[];
if($('hero-blog-val')){
$('hero-blog-val').textContent=blogTotal.toLocaleString()+'ê±´';
$('hero-blog-sub').textContent='ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê²€ìƒ‰ ë…¸ì¶œ';
}

// ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ ìë™ ê²€ìƒ‰ (ì—…ì²´ëª… ê¸°ë°˜)
const myInfo=LS('myinfo')||{};
if(myInfo.sp){
// ì´ë¯¸ ë“±ë¡ëœ í”Œë ˆì´ìŠ¤ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰
try{
const placeData=await callBackend('/api/naver-search',{query:myInfo.sp,type:'place',display:1});
if(placeData&&placeData.items&&placeData.items.length>0){
LS('smartplace_data',placeData.items[0]);
toast('ğŸ“ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ ì—°ê²°ë¨');
}
}catch(e){}
}

// ë¸”ë¡œê·¸ ê¸€ ëª©ë¡ ë¡œì»¬ ì €ì¥
if(blogPosts.length>0){
LS('naver_blog_posts',blogPosts);
console.log('ğŸ“ ë¸”ë¡œê·¸ ê¸€ '+blogPosts.length+'ê°œ ë¡œë“œë¨');
}

}catch(e){console.error('autoFetchNaverData error:',e)}
}

function logoutAll(){
naverAuth=null;metaAuth=null;currentUser=null;
localStorage.removeItem('naver_auth');
localStorage.removeItem('meta_auth');
localStorage.removeItem('current_user');
localStorage.removeItem('skip_login');
localStorage.removeItem('db_user_id');
initUserState();
$('login-overlay').classList.remove('hidden');
$('user-menu').classList.remove('show');
toast('ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ');
}

function goToLogin(){
$('login-overlay').classList.remove('hidden');
$('login-overlay').scrollTop=0;
$('user-menu').classList.remove('show');
initLpMockBars();
}

function toggleUserMenu(){
$('user-menu').classList.toggle('show');
}
document.addEventListener('click',function(e){
if(!e.target.closest('#user-avatar')&&!e.target.closest('#user-menu')){
$('user-menu').classList.remove('show');
}
});

// ìœ ì € ìƒíƒœ ì´ˆê¸°í™”
function initUserState(){
const menuName=$('user-menu-name');

if(naverAuth){
const avatar=$('user-avatar');
avatar.innerHTML=naverAuth.name?naverAuth.name.charAt(0)+' ë©”ë‰´':'â˜° ë©”ë‰´';
menuName.textContent=naverAuth.name||'ë„¤ì´ë²„ ì‚¬ìš©ì';
$('chip-naver').className='account-chip connected';
$('chip-naver').textContent='ğŸŸ¢ ë„¤ì´ë²„ âœ…';
$('chip-naver').onclick=null;
$('btn-connect-naver').textContent='ğŸŸ¢ ë„¤ì´ë²„ ì—°ê²°ë¨ âœ…';
const blogId=naverAuth.id||'';
const blogInfo=blogId?' â€” ë¸”ë¡œê·¸: '+blogId:'';
$('dash-naver-status').className='account-chip connected';
$('dash-naver-status').innerHTML='ğŸŸ¢ ë„¤ì´ë²„ ì—°ê²°ë¨ â€” '+naverAuth.name+blogInfo;
$('dash-naver-status').onclick=null;
}else{
$('chip-naver').className='account-chip disconnected';
$('chip-naver').textContent='ğŸŸ¢ ë„¤ì´ë²„ ì—°ê²°';
$('chip-naver').onclick=loginNaver;
$('dash-naver-status').className='account-chip disconnected';
$('dash-naver-status').innerHTML='ğŸŸ¢ ë„¤ì´ë²„ ë¡œê·¸ì¸í•˜ë©´ ë¸”ë¡œê·¸ ê²€ìƒ‰ ë…¸ì¶œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”';
$('dash-naver-status').onclick=loginNaver;
}

if(metaAuth){
if(!naverAuth){
const avatar=$('user-avatar');
avatar.innerHTML=metaAuth.name?metaAuth.name.charAt(0)+' ë©”ë‰´':'â˜° ë©”ë‰´';
menuName.textContent=metaAuth.name||'Facebook ì‚¬ìš©ì';
}
$('chip-meta').className='account-chip connected';
$('chip-meta').textContent='ğŸ”µ Meta âœ…';
$('chip-meta').onclick=null;
$('btn-connect-meta').textContent='ğŸ”µ Facebook ì—°ê²°ë¨ âœ…';
$('dash-meta-status').className='account-chip connected';
const igName=metaAuth.instagram?.[0]?.igUsername||'';
const pageCount=metaAuth.pages?.length||0;
let metaInfo=metaAuth.name||'';
if(pageCount)metaInfo+=' â€” í˜ì´ì§€ '+pageCount+'ê°œ';
if(igName)metaInfo+=' Â· @'+igName;
$('dash-meta-status').innerHTML='ğŸ”µ Meta ì—°ê²°ë¨ â€” '+metaInfo;
$('dash-meta-status').onclick=null;
}else{
$('chip-meta').className='account-chip disconnected';
$('chip-meta').textContent='ğŸ”µ Meta ì—°ê²°';
$('chip-meta').onclick=loginMeta;
$('dash-meta-status').className='account-chip disconnected';
$('dash-meta-status').innerHTML='ğŸ”µ Facebook ë¡œê·¸ì¸í•˜ë©´ ì¸ìŠ¤íƒ€/í˜ì´ìŠ¤ë¶ ì‹¤ì œ ë°ì´í„°ê°€ ì—°ë™ë¼ìš”';
$('dash-meta-status').onclick=loginMeta;
}

if(!naverAuth&&!metaAuth){
const avatar=$('user-avatar');
avatar.innerHTML='â˜° ë©”ë‰´';
menuName.textContent='ë©”ë‰´';
}

// ì‚¬ì´ë“œë°” ìœ ì € ì¹´ë“œ ì—…ë°ì´íŠ¸
const sName=$('sidebar-user-name');
const sAvatar=$('sidebar-avatar');
const sPlan=$('sidebar-user-plan');
if(sName){
if(naverAuth){
sName.textContent=naverAuth.name||'ë„¤ì´ë²„ ì‚¬ìš©ì';
sAvatar.textContent=(naverAuth.name||'N').charAt(0);
sPlan.textContent='ë„¤ì´ë²„ ì—°ê²°ë¨';
}else if(metaAuth){
sName.textContent=metaAuth.name||'Facebook ì‚¬ìš©ì';
sAvatar.textContent=(metaAuth.name||'F').charAt(0);
sPlan.textContent='Meta ì—°ê²°ë¨';
}else{
sName.textContent='ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”';
sAvatar.textContent='?';
sPlan.textContent='Free';
}
if(naverAuth&&metaAuth)sPlan.textContent='ë„¤ì´ë²„ + Meta ì—°ê²°ë¨';
}

// í¬ë ˆë”§ í‘œì‹œ
updateCreditDisplay();

// ì—°ê²°ëœ ê³„ì •ì´ ì—†ìœ¼ë©´ ì•ˆë‚´ë°” í‘œì‹œ
const bar=$('dash-connect-bar');
if(naverAuth&&metaAuth){bar.style.display='none';}
else{bar.style.display='grid';}
}

// === CREDIT SYSTEM ===
function getUserId(){
if(naverAuth)return 'naver_'+naverAuth.id;
if(metaAuth)return 'meta_'+metaAuth.id;
return 'anon_'+Math.random().toString(36).substr(2,9);
}

function updateCreditDisplay(){
const d=$('credit-display');
if(d)d.textContent='$'+totalCredits.toFixed(2);
}

function trackCredit(cost,desc){
totalCredits+=cost;
localStorage.setItem('total_credits',totalCredits.toFixed(4));
updateCreditDisplay();
// Supabaseì— ê¸°ë¡
saveCredit(cost,desc).catch(()=>{});
}

function showCreditHistory(){
$('user-menu').classList.remove('show');
const h=JSON.parse(localStorage.getItem('credit_history')||'[]');
let html='<div style="max-height:300px;overflow-y:auto">';
html+='<div style="font-weight:600;margin-bottom:10px">ğŸ’° ì´ ì‚¬ìš©: <span style="color:var(--ac)">$'+totalCredits.toFixed(4)+'</span></div>';
if(h.length===0)html+='<div style="color:var(--t3)">ì‚¬ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>';
h.slice(-20).reverse().forEach(item=>{
html+='<div style="display:flex;justify-content:space-between;padding:4px 0;font-size:.82em;border-bottom:1px solid var(--border)"><span>'+item.desc+'</span><span style="color:var(--ac)">$'+item.cost.toFixed(4)+'</span></div>';
});
html+='</div>';
toast('ğŸ’° í¬ë ˆë”§: $'+totalCredits.toFixed(2));
}

// === DASHBOARD REAL DATA LOADING ===
async function loadDashboardData(){
if(!backendUrl)return;

// Meta ë°ì´í„° (ì¸ìŠ¤íƒ€/í˜ì´ìŠ¤ë¶)
if(metaAuth){
try{
const ig=metaAuth.instagram?.[0];
if(ig){
// íŒ”ë¡œì›Œ
$('hero-followers-val').textContent=(ig.followers||0).toLocaleString();
$('hero-followers-change').innerHTML='<span style="font-size:.78em;color:var(--g)">ì¸ìŠ¤íƒ€ @'+ig.igUsername+'</span>';

// ê²Œì‹œë¬¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
const postsData=await callBackend('/api/meta',{action:'insights',igId:ig.igId,token:metaAuth.token});
if(postsData.posts&&postsData.posts.length>0){
const totalLikes=postsData.posts.reduce((a,p)=>a+(p.likes||0),0);
const totalComments=postsData.posts.reduce((a,p)=>a+(p.comments||0),0);
const totalViews=totalLikes+totalComments;
const engRate=postsData.posts.length>0?((totalLikes+totalComments)/(ig.followers*postsData.posts.length)*100).toFixed(1):'0';

$('hero-views-val').textContent=totalViews.toLocaleString();
$('hero-views-change').innerHTML='<span style="font-size:.78em;color:var(--g)">ì¢‹ì•„ìš” '+totalLikes.toLocaleString()+' + ëŒ“ê¸€ '+totalComments.toLocaleString()+'</span>';
$('hero-engage-val').textContent=engRate+'%';
$('hero-engage-change').innerHTML='<span style="font-size:.78em;color:var(--t2)">ìµœê·¼ '+postsData.posts.length+'ê°œ ê²Œì‹œë¬¼ ê¸°ì¤€</span>';
}
}
}catch(e){console.error('Meta data error:',e)}
}

// ë„¤ì´ë²„ ë°ì´í„°
if(naverAuth){
try{
const blogUrl=naverAuth.blogUrl||(LS('myinfo')||{}).blog||'';
const blogTotal=naverAuth.blogTotal||LS('naver_blog_total')||0;
if(blogUrl||blogTotal){
if(!blogTotal&&blogUrl){
const blogName=blogUrl.replace(/https?:\/\/(blog\.)?naver\.com\//,'').replace(/\//g,'');
const blogData=await callBackend('/api/naver-search',{query:blogName,type:'blog',display:5});
$('hero-blog-val').textContent=(blogData.total||0).toLocaleString()+'ê±´';
}else{
$('hero-blog-val').textContent=blogTotal.toLocaleString()+'ê±´';
}
$('hero-blog-sub').textContent='ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê²€ìƒ‰ ë…¸ì¶œ';
}else{
$('hero-blog-val').textContent='ìë™ ì—°ê²°ë¨';
$('hero-blog-sub').textContent='ë¸”ë¡œê·¸: blog.naver.com/'+naverAuth.id;
}
}catch(e){console.error('Naver data error:',e)}
}
}

// === AI WRITING STYLE IMPROVEMENT ===
function getAntiAIHint(){
return `
[ì¤‘ìš”: ìì—°ìŠ¤ëŸ¬ìš´ ê¸€ì“°ê¸° ê·œì¹™]
- "ì˜¤ëŠ˜ì€ ~ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤" ê°™ì€ AI íŠ¹ìœ ì˜ ì„œë¡  ê¸ˆì§€
- "~ì…ë‹ˆë‹¤", "~í•©ë‹ˆë‹¤" ë°˜ë³µ ëŒ€ì‹  êµ¬ì–´ì²´ì™€ ë¬¸ì–´ì²´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì„ê¸°
- "ë†€ë¼ìš´", "í˜ì‹ ì ì¸", "ë…ë³´ì ì¸" ê°™ì€ ë¹ˆ ìˆ˜ì‹ì–´ ì‚¬ìš© ê¸ˆì§€
- ì‹¤ì œ ë°ì´í„°ë‚˜ ìˆ˜ì¹˜ë¥¼ ì¸ìš©í•˜ì—¬ êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±
- ë¬¸ì¥ ê¸¸ì´ë¥¼ ë‹¤ì–‘í•˜ê²Œ (ì§§ì€ ë¬¸ì¥ê³¼ ê¸´ ë¬¸ì¥ í˜¼í•©)
- ì´ëª¨ì§€ëŠ” í”Œë«í¼ë³„ ì ì •ëŸ‰ë§Œ (ë¸”ë¡œê·¸ 0-2ê°œ, ì¸ìŠ¤íƒ€ 3-5ê°œ, í˜ì´ìŠ¤ë¶ 1-3ê°œ)
- "ì²«ì§¸, ë‘˜ì§¸, ì…‹ì§¸" ê°™ì€ ë‚˜ì—´ë³´ë‹¤ ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ë‹¨ ì „í™˜
- ì‚¬ëŒì´ ì§ì ‘ ì“´ ê²ƒ ê°™ì€ ê°œì¸ì  ê²½í—˜ì´ë‚˜ ì˜ê²¬ í¬í•¨
`;
}

// === A/B GENERATION ===
async function genBlog(){const btn=$('blog-gen-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>A/Bì•ˆ ìƒì„± ì¤‘...';
const ra=$('blog-ra');ra.classList.add('show');$('blog-rc-a').textContent='Aì•ˆ ìƒì„± ì¤‘...';$('blog-rc-b').textContent='Bì•ˆ ëŒ€ê¸°...';$('blog-ab-diff').textContent='';
try{let img64=null;const fi=document.querySelector('#blog-imgs .isl.filled img');if(fi)img64=fi.src.split(',')[1];
const base='ë°©ì†¡ì¤‘ê³„Â·LEDì‹œìŠ¤í…œ ì „ë¬¸ ê¸°ì—… ë¸”ë¡œê·¸.\nëª©ì : '+$('b-purpose').value+'\ní–‰ì‚¬: '+($('b-event').value||'(ë¯¸ì…ë ¥)')+'\në‚´ìš©: '+($('b-detail').value||'(ë¯¸ì…ë ¥)')+'\nê°•ì¡°: '+($('b-highlight').value||'(ë¯¸ì…ë ¥)')+'\nSEOì œëª©, ì„œë¡ , ë³¸ë¬¸3-4ë‹¨ë½([ğŸ“· ì´ë¯¸ì§€ N]íƒœê·¸), ê²°ë¡ , í•´ì‹œíƒœê·¸7-10ê°œ'+getStyleHint()+getAntiAIHint();
let cost=0;
const a=await callAI(base+'\n\n[Aì•ˆ: ì „ë¬¸ì Â·ì‹ ë¢°ê° ìˆëŠ” í†¤. ë°ì´í„°ì™€ ìˆ˜ì¹˜ ì¤‘ì‹¬. ì—…ê³„ ì „ë¬¸ìš©ì–´ í™œìš©.]',img64);
$('blog-rc-a').textContent=a||'';cost+=0.004;trackCredit(0.004,'ë¸”ë¡œê·¸ Aì•ˆ');$('blog-rc-b').textContent='Bì•ˆ ìƒì„± ì¤‘...';
const b=await callAI(base+'\n\n[Bì•ˆ: ì¹œê·¼í•˜ê³  ìƒë™ê° ìˆëŠ” í†¤. ìŠ¤í† ë¦¬í…”ë§ê³¼ í˜„ì¥ê° ì¤‘ì‹¬. ê³µê° ìœ ë„.]',img64);
$('blog-rc-b').textContent=b||'';cost+=0.004;trackCredit(0.004,'ë¸”ë¡œê·¸ Bì•ˆ');$('blog-ab-diff').textContent='ë¹„êµ ë¶„ì„ ì¤‘...';
const diff=await callAI('ë‘ ë¸”ë¡œê·¸ ê¸€ ë¹„êµ ë¶„ì„:\n\n[Aì•ˆ]\n'+(a||'').substring(0,600)+'\n\n[Bì•ˆ]\n'+(b||'').substring(0,600)+'\n\nì•„ë˜ í˜•ì‹ìœ¼ë¡œ ë¹„êµ:\n1) SEO íš¨ê³¼ - ì–´ëŠ ì•ˆì´ ë” ë†’ì€ì§€\n2) ê°€ë…ì„± - ì–´ëŠ ìª½ì´ ì½ê¸° ì‰¬ìš´ì§€\n3) ì°¸ì—¬ ìœ ë„ë ¥ - ëŒ“ê¸€/ê³µìœ  ìœ ë„\n4) ìµœì¢… ì¶”ì²œ - A or Bì™€ ì´ìœ \n5ì¤„ ì´ë‚´.');
$('blog-ab-diff').textContent=diff||'';trackCredit(0.002,'ë¸”ë¡œê·¸ ë¹„êµë¶„ì„');toast('âœ… A/B ì™„ë£Œ');
}catch(e){$('blog-rc-a').textContent='ì˜¤ë¥˜: '+e.message;toast('âŒ '+e.message)}finally{btn.disabled=false;btn.innerHTML='A/B ë‘ ê°€ì§€ ì•ˆ ìƒì„±í•˜ê¸°'}}

async function genInsta(){const btn=$('insta-gen-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>A/B ìƒì„± ì¤‘...';
const ra=$('insta-ra');ra.classList.add('show');$('insta-rc-a').textContent='Aì•ˆ ìƒì„± ì¤‘...';$('insta-rc-b').textContent='Bì•ˆ ëŒ€ê¸°...';$('insta-ab-diff').textContent='';
try{let tags='';document.querySelectorAll('#i-htag .ad-plat.a').forEach(c=>{if(c.dataset.tags)tags+=' '+c.dataset.tags});
let img64=null;const fi=document.querySelector('#insta-imgs .isl.filled img');if(fi)img64=fi.src.split(',')[1];
const base='ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜. ë°©ì†¡ì¤‘ê³„Â·LED ì „ë¬¸.\në„ì…: '+$('i-intro').value+'\në§ˆë¬´ë¦¬: '+$('i-outro').value+'\në‚´ìš©: '+($('i-content').value||'(ì¼ë°˜)')+'\ní•´ì‹œíƒœê·¸: '+tags+getStyleHint()+getAntiAIHint();
let cost=0;
const a=await callAI(base+'\n\n[Aì•ˆ: ì •ë³´í˜• - í•µì‹¬ ê°•ì¡°, ì „ë¬¸ì , ëª…í™•í•œ ì •ë³´ ì „ë‹¬. í•´ì‹œíƒœê·¸ 15-20ê°œ.]');
$('insta-rc-a').textContent=a||'';cost+=0.003;trackCredit(0.003,'ì¸ìŠ¤íƒ€ Aì•ˆ');$('insta-rc-b').textContent='Bì•ˆ ìƒì„± ì¤‘...';
const b=await callAI(base+'\n\n[Bì•ˆ: ê°ì„±í˜• - ìŠ¤í† ë¦¬í…”ë§, ì´ëª¨ì§€ í’ë¶€, ê³µê° ìœ ë„. í•´ì‹œíƒœê·¸ 15-20ê°œ.]');
$('insta-rc-b').textContent=b||'';cost+=0.003;trackCredit(0.003,'ì¸ìŠ¤íƒ€ Bì•ˆ');
const diff=await callAI('ì¸ìŠ¤íƒ€ ìº¡ì…˜ A/B ë¹„êµ:\n[A]'+(a||'').substring(0,400)+'\n[B]'+(b||'').substring(0,400)+'\nì°¸ì—¬ìœ¨Â·ë„ë‹¬ë¥ Â·ê°ì„± ë¹„êµ. ì–´ëŠ ìª½ì´ íš¨ìœ¨ì´ ë” ë†’ì€ì§€. 3ì¤„.');
$('insta-ab-diff').textContent=diff||'';trackCredit(0.001,'ì¸ìŠ¤íƒ€ ë¹„êµ');toast('âœ… ì™„ë£Œ');
}catch(e){$('insta-rc-a').textContent='ì˜¤ë¥˜: '+e.message}finally{btn.disabled=false;btn.innerHTML='A/B ìº¡ì…˜ ìƒì„±'}}

async function genFB(){const btn=$('fb-gen-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>A/B ìƒì„± ì¤‘...';
const ra=$('fb-ra');ra.classList.add('show');$('fb-rc-a').textContent='Aì•ˆ ìƒì„± ì¤‘...';$('fb-rc-b').textContent='Bì•ˆ ëŒ€ê¸°...';$('fb-ab-diff').textContent='';
try{let img64=null;const fi=document.querySelector('#fb-imgs .isl.filled img');if(fi)img64=fi.src.split(',')[1];
const base='í˜ì´ìŠ¤ë¶ ê²Œì‹œë¬¼. ë°©ì†¡ì¤‘ê³„Â·LED ì „ë¬¸.\në„ì…: '+$('f-intro').value+'\në§ˆë¬´ë¦¬: '+$('f-outro').value+'\në‚´ìš©: '+($('f-content').value||'(ì¼ë°˜)')+getStyleHint()+getAntiAIHint();
let cost=0;
const a=await callAI(base+'\n\n[Aì•ˆ: ì •ë³´í˜• + ê³µìœ ìœ ë„. ì „ë¬¸ì  í†¤. í•´ì‹œíƒœê·¸ 5-8ê°œ.]');
$('fb-rc-a').textContent=a||'';cost+=0.003;trackCredit(0.003,'í˜ì´ìŠ¤ë¶ Aì•ˆ');$('fb-rc-b').textContent='Bì•ˆ ìƒì„± ì¤‘...';
const b=await callAI(base+'\n\n[Bì•ˆ: ì¹œê·¼í˜• + ì°¸ì—¬ìœ ë„ ì§ˆë¬¸í˜•. ê³µê° ì¤‘ì‹¬. í•´ì‹œíƒœê·¸ 5-8ê°œ.]');
$('fb-rc-b').textContent=b||'';cost+=0.003;trackCredit(0.003,'í˜ì´ìŠ¤ë¶ Bì•ˆ');
const diff=await callAI('FB A/Bë¹„êµ:\n[A]'+(a||'').substring(0,400)+'\n[B]'+(b||'').substring(0,400)+'\nê³µìœ ìœ¨Â·ë„ë‹¬Â·ì°¸ì—¬ ë¹„êµ. 3ì¤„.');
$('fb-ab-diff').textContent=diff||'';trackCredit(0.001,'í˜ì´ìŠ¤ë¶ ë¹„êµ');toast('âœ… ì™„ë£Œ');
}catch(e){$('fb-rc-a').textContent='ì˜¤ë¥˜: '+e.message}finally{btn.disabled=false;btn.innerHTML='A/B ê²Œì‹œë¬¼ ìƒì„±'}}

function pickAB(platform,choice){const src=$(platform+'-rc-'+choice).textContent;const taMap={blog:'blog-edit-ta',insta:'insta-edit-ta',fb:'fb-edit-ta'};$(taMap[platform]).value=src;if(platform==='blog'){loadToEditor(src);bst(2)}else if(platform==='insta')ist(2);else fst(2);toast('âœ… '+choice.toUpperCase()+'ì•ˆ ì„ íƒë¨')}

// === TEXT CHECK ===
async function aiCheck(taId,mode){
if(taId==='blog-edit-ta')syncEditorToTextarea();
const ta=$(taId);if(!ta.value.trim()){toast('âš ï¸ í…ìŠ¤íŠ¸ ì…ë ¥');return}
const labels={spell:'ì˜¤íƒˆì ê²€ì‚¬',sensitive:'ì˜ˆë¯¼í‘œí˜„ ê²€ì‚¬',improve:'ë‹¤ë“¬ê¸°'};toast('ğŸ” '+labels[mode]+'...');
const prompts={spell:'ì˜¤íƒˆìì™€ ë¬¸ë²• ì˜¤ë¥˜ë¥¼ ì°¾ì•„ ìˆ˜ì •í•´ì¤˜. ì›ë¬¸ ìœ ì§€í•˜ê³  ìˆ˜ì •ëœ ë¶€ë¶„ë§Œ í‘œì‹œ.',sensitive:'ì˜ˆë¯¼í•˜ê±°ë‚˜ ë…¼ë€ ì†Œì§€ í‘œí˜„ì„ ì°¾ì•„ ëŒ€ì•ˆ ì œì‹œ.',improve:'ì „ì²´ì ìœ¼ë¡œ ê°€ë…ì„±ê³¼ í’ˆì§ˆì„ ë†’ì—¬ ë‹¤ë“¬ì–´ì¤˜. ì›ë˜ ì˜ë¯¸ ìœ ì§€.'};
try{const r=await callAI(prompts[mode]+'\n\n'+ta.value);if(r){ta.value=r;if(taId==='blog-edit-ta')loadToEditor(r)}toast('âœ… ì™„ë£Œ')}catch(e){toast('âŒ '+e.message)}}
function ins(taId,text){const ta=$(taId);const s=ta.selectionStart;ta.value=ta.value.substring(0,s)+text+ta.value.substring(ta.selectionEnd);ta.selectionStart=ta.selectionEnd=s+text.length;ta.focus()}

// === COMPARE ===
let cmpHistory=LS('cmp_history')||[];

// URL ì½˜í…ì¸  ìë™ ê°€ì ¸ì˜¤ê¸°
let urlContentA='';
let urlContentB='';
let urlTitleA='';
let urlTitleB='';

async function fetchUrlContent(side){
const urlInput=$('cmp-url-'+side);
const url=urlInput.value.trim();
if(!url){toast('âš ï¸ URLì„ ì…ë ¥í•˜ì„¸ìš”');return}
if(!url.startsWith('http')){toast('âš ï¸ https://ë¡œ ì‹œì‘í•˜ëŠ” URLì„ ì…ë ¥í•˜ì„¸ìš”');return}

const btn=$('fetch-btn-'+side);
const status=$('cmp-url-'+side+'-status');
const preview=$('cmp-url-'+side+'-preview');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>';
status.innerHTML='<span style="font-size:.82em;color:var(--ac)">ğŸ“¥ ì½˜í…ì¸  ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>';

try{
const data=await callBackend('/api/fetch-url',{url:url});
if(!data||!data.ok)throw new Error(data?.error||'ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');

const text=data.text||'';
const title=data.title||'ì œëª© ì—†ìŒ';

if(side==='a'){urlContentA=text;urlTitleA=title}
else{urlContentB=text;urlTitleB=title}

// ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
preview.style.display='block';
$('cmp-url-'+side+'-title').textContent='ğŸ“„ '+title;
$('cmp-url-'+side+'-text').textContent=text.substring(0,500)+(text.length>500?'...(ì´ '+text.length+'ì)':'');

const warn=data.warning?'\nâš ï¸ '+data.warning:'';
status.innerHTML='<span style="font-size:.82em;color:var(--g)">âœ… '+text.length+'ì ê°€ì ¸ì˜´'+warn+'</span>';
toast('âœ… ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ ('+text.length+'ì)');

}catch(e){
status.innerHTML='<span style="font-size:.82em;color:var(--r)">âŒ '+e.message+'</span>';
preview.style.display='none';
toast('âŒ '+e.message);
}finally{
btn.disabled=false;btn.innerHTML='ğŸ“¥ ê°€ì ¸ì˜¤ê¸°';
}
}

async function fetchBothUrls(){
const urlA=$('cmp-url-a').value.trim();
const urlB=$('cmp-url-b').value.trim();
if(!urlA&&!urlB){toast('âš ï¸ URLì„ ì…ë ¥í•˜ì„¸ìš”');return}
if(urlA)await fetchUrlContent('a');
if(urlB)await fetchUrlContent('b');
}

async function compareUrls(){
const btn=$('cmp-url-btn');

// URL ì…ë ¥ëëŠ”ë° ì•„ì§ ì•ˆ ê°€ì ¸ì™”ìœ¼ë©´ ìë™ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
const urlA=$('cmp-url-a').value.trim();
const urlB=$('cmp-url-b').value.trim();
if(urlA&&!urlContentA)await fetchUrlContent('a');
if(urlB&&!urlContentB)await fetchUrlContent('b');

if(!urlContentA&&!urlContentB){toast('âš ï¸ ìµœì†Œ í•˜ë‚˜ì˜ URLì—ì„œ ì½˜í…ì¸ ë¥¼ ê°€ì ¸ì™€ì£¼ì„¸ìš”');return}

btn.disabled=true;btn.innerHTML='<span class="spinner"></span>AI ë¶„ì„ ì¤‘...';
toast('ğŸ¤– URL ë¹„êµ ë¶„ì„ ì¤‘...');

try{
// ìš”ì•½ ì¹´ë“œ
$('cmp-url-result').style.display='block';
$('cmp-url-summary').innerHTML=`
<div style="display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center">
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px;border-top:3px solid var(--ac)">
<div style="font-weight:700;font-size:.88em;color:var(--ac);margin-bottom:4px">ğŸ“„ ë‚´ ê¸€</div>
<div style="font-size:.82em;font-weight:600;color:var(--t1)">${urlTitleA||'ì œëª© ì—†ìŒ'}</div>
<div style="font-size:.75em;color:var(--t3);margin-top:2px">${urlContentA.length.toLocaleString()}ì</div>
</div>
<div style="font-size:1.5em;font-weight:800;color:var(--t3)">VS</div>
<div style="background:var(--bg4);border-radius:var(--r2);padding:12px;border-top:3px solid #f97316">
<div style="font-weight:700;font-size:.88em;color:#f97316;margin-bottom:4px">ğŸ“„ ê²½ìŸì‚¬</div>
<div style="font-size:.82em;font-weight:600;color:var(--t1)">${urlTitleB||'ì œëª© ì—†ìŒ'}</div>
<div style="font-size:.75em;color:var(--t3);margin-top:2px">${urlContentB.length.toLocaleString()}ì</div>
</div>
</div>`;

const r=await callAI(`ë‘ ë¸”ë¡œê·¸/ì›¹ ê¸€ì„ ë¹„êµ ë¶„ì„í•´ì¤˜.

[ë‚´ ê¸€] "${urlTitleA}"
${urlContentA.substring(0,2000)}

[ê²½ìŸì‚¬ ê¸€] "${urlTitleB}"
${urlContentB.substring(0,2000)}

ì•„ë˜ í•­ëª©ë³„ë¡œ ì ìˆ˜(10ì  ë§Œì )ì™€ ë¶„ì„ì„ í•´ì¤˜:
1) ğŸ“Š SEO ìµœì í™” (í‚¤ì›Œë“œ ë°€ë„, ì œëª©, êµ¬ì¡°)
2) ğŸ“– ê°€ë…ì„± (ë¬¸ë‹¨ ê¸¸ì´, ë¬¸ì¥ êµ¬ì„±)
3) ğŸ¯ CTA ê°•ë„ (í–‰ë™ ìœ ë„, ì „í™˜ ìš”ì†Œ)
4) ğŸ’¡ ì½˜í…ì¸  í’ˆì§ˆ (ì •ë³´ëŸ‰, ë…ì°½ì„±, ê¹Šì´)
5) ğŸ“± SNS ê³µìœ  ì í•©ì„± (ì œëª© ë§¤ë ¥ë„, ìš”ì•½ ê°€ëŠ¥ì„±)

ë§ˆì§€ë§‰ì—:
ğŸ† ì¢…í•© ìŠ¹ì: ë‚´ ê¸€ or ê²½ìŸì‚¬ (ì´ìœ )
ğŸ“Œ ë‚´ ê¸€ ê°œì„  í¬ì¸íŠ¸ 3ê°€ì§€`);

$('cmp-url-detail').textContent=r;
trackCredit(0.005,'URL ë¹„êµ ë¶„ì„');

// ì´ë ¥ ì €ì¥
cmpHistory.unshift({date:new Date().toLocaleDateString('ko-KR'),myText:(urlTitleA||urlA).substring(0,50),compText:(urlTitleB||urlB).substring(0,50),result:r.substring(0,200)});
if(cmpHistory.length>10)cmpHistory=cmpHistory.slice(0,10);
LS('cmp_history',cmpHistory);
renderCmpHistory();

toast('âœ… URL ë¹„êµ ë¶„ì„ ì™„ë£Œ!');
}catch(e){
$('cmp-url-detail').textContent='ë¶„ì„ ì‹¤íŒ¨: '+e.message;
toast('âŒ '+e.message);
}finally{
btn.disabled=false;btn.innerHTML='âš”ï¸ URL ë¹„êµ ë¶„ì„';
}
}

function setCmpMode(mode){
document.querySelectorAll('#cmp-pills .sub-pill').forEach(p=>p.classList.remove('a'));
event.target.classList.add('a');
$('cmp-dashboard').style.display=mode==='dashboard'?'block':'none';
$('cmp-text').style.display=mode==='text'?'block':'none';
$('cmp-url').style.display=mode==='url'?'block':'none';
}

async function doCompare(){const btn=$('cmp-btn');if(btn){btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ë¶„ì„ ì¤‘...';}
const isUrl=$('cmp-url').style.display!=='none';
let textA,textB;
if(isUrl){textA=($('cmp-url-at').value||'')+'(URL: '+($('cmp-url-a').value||'')+')';textB=($('cmp-url-bt').value||'')+'(URL: '+($('cmp-url-b').value||'')+')';}else{textA=$('cmp-a').value;textB=$('cmp-b').value}
if(!textA&&!textB){toast('âš ï¸ ë‚´ìš© ì…ë ¥');if(btn){btn.disabled=false;btn.innerHTML='AI ë¹„êµ ë¶„ì„ ì‹¤í–‰';}return}
try{const r=await callAI('ì½˜í…ì¸  ë¹„êµ ë¶„ì„:\n\n[ë‚´ ê¸€]\n'+textA.substring(0,1000)+'\n\n[ê²½ìŸì‚¬]\n'+textB.substring(0,1000)+'\n\në¶„ì„: 1)í‚¤ì›Œë“œ ì „ëµ 2)ê°€ë…ì„± 3)CTA ê°•ë„ 4)SEOìµœì í™” 5)ê°œì„  ì œì•ˆ. í‘œ í˜•ì‹.');
if(isUrl&&$('cmp-rc2')){$('cmp-rc2').textContent=r;$('cmp-ra2').classList.add('show');}
else{$('cmp-rc').textContent=r;$('cmp-ra').classList.add('show');}
// ì´ë ¥ ì €ì¥
cmpHistory.unshift({date:new Date().toLocaleDateString('ko-KR'),myText:textA.substring(0,50),compText:textB.substring(0,50),result:r.substring(0,200)});
if(cmpHistory.length>10)cmpHistory=cmpHistory.slice(0,10);
LS('cmp_history',cmpHistory);
toast('âœ… ì™„ë£Œ')}catch(e){toast('âŒ '+e.message)}finally{if(btn){btn.disabled=false;btn.innerHTML='AI ë¹„êµ ë¶„ì„ ì‹¤í–‰';}}}

// ë¹„êµ ëŒ€ì‹œë³´ë“œ AI ë¶„ì„
async function runCmpDashboard(){
const myText=$('cmp-a').value||'';
const compText=$('cmp-b').value||'';
if(!myText&&!compText){toast('âš ï¸ ë¨¼ì € "ê¸€ ë¹„êµ" íƒ­ì—ì„œ ë‚´ ê¸€ê³¼ ê²½ìŸì‚¬ ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
toast('ğŸ¤– ë¹„êµ ë¶„ì„ ì¤‘...');
try{
const r=await callAI(`ë‚´ ê¸€ê³¼ ê²½ìŸì‚¬ ê¸€ì„ ì •ëŸ‰ì ìœ¼ë¡œ ë¹„êµ ë¶„ì„í•´ì¤˜.

[ë‚´ ê¸€]
${myText.substring(0,800)}

[ê²½ìŸì‚¬ ê¸€]
${compText.substring(0,800)}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì ìˆ˜(1~10)ë¥¼ ë‹µí•´ì¤˜:

ì¢…í•©ì ìˆ˜_ë‚´ê¸€: [ì ìˆ˜]/10
ì¢…í•©ì ìˆ˜_ê²½ìŸì‚¬: [ì ìˆ˜]/10
í‚¤ì›Œë“œìµœì í™”_ë‚´ê¸€: [ì ìˆ˜]/10
í‚¤ì›Œë“œìµœì í™”_ê²½ìŸì‚¬: [ì ìˆ˜]/10
ê°€ë…ì„±_ë‚´ê¸€: [ì ìˆ˜]/10
ê°€ë…ì„±_ê²½ìŸì‚¬: [ì ìˆ˜]/10
CTAê°•ë„_ë‚´ê¸€: [ì ìˆ˜]/10
CTAê°•ë„_ê²½ìŸì‚¬: [ì ìˆ˜]/10
SEOìµœì í™”_ë‚´ê¸€: [ì ìˆ˜]/10
SEOìµœì í™”_ê²½ìŸì‚¬: [ì ìˆ˜]/10
ë…ì°½ì„±_ë‚´ê¸€: [ì ìˆ˜]/10
ë…ì°½ì„±_ê²½ìŸì‚¬: [ì ìˆ˜]/10

---ìš°ì„¸í•­ëª©---
(ë‚´ê°€ ê²½ìŸì‚¬ë³´ë‹¤ ì˜í•œ ì  3ê°€ì§€, ê° 1ì¤„)

---ê°œì„ í•­ëª©---
(ë‚´ê°€ ê²½ìŸì‚¬ë³´ë‹¤ ë¶€ì¡±í•œ ì  3ê°€ì§€, ê° 1ì¤„)

---ì „ëµì œì•ˆ---
(ê²½ìŸì‚¬ë¥¼ ì´ê¸¸ ìˆ˜ ìˆëŠ” êµ¬ì²´ì ì¸ ì „ëµ 3ê°€ì§€, ê° 2ì¤„)`);

// ì ìˆ˜ íŒŒì‹±
const items=['í‚¤ì›Œë“œìµœì í™”','ê°€ë…ì„±','CTAê°•ë„','SEOìµœì í™”','ë…ì°½ì„±'];
const myScores={},compScores={};
let myTotal=0,compTotal=0;
const totalMatch1=r.match(/ì¢…í•©ì ìˆ˜_ë‚´ê¸€[:\s]*(\d+)/);
const totalMatch2=r.match(/ì¢…í•©ì ìˆ˜_ê²½ìŸì‚¬[:\s]*(\d+)/);
if(totalMatch1)myTotal=parseInt(totalMatch1[1]);
if(totalMatch2)compTotal=parseInt(totalMatch2[1]);

items.forEach(item=>{
const m1=r.match(new RegExp(item+'_ë‚´ê¸€[:\\s]*(\\d+)'));
const m2=r.match(new RegExp(item+'_ê²½ìŸì‚¬[:\\s]*(\\d+)'));
myScores[item]=m1?parseInt(m1[1]):5;
compScores[item]=m2?parseInt(m2[1]):5;
});

if(!myTotal)myTotal=Math.round(Object.values(myScores).reduce((a,b)=>a+b,0)/items.length);
if(!compTotal)compTotal=Math.round(Object.values(compScores).reduce((a,b)=>a+b,0)/items.length);

$('cmp-my-score').textContent=myTotal+'/10';
$('cmp-my-score').style.color=myTotal>=compTotal?'var(--g)':'var(--r)';
$('cmp-comp-score').textContent=compTotal+'/10';

// ë°” ì°¨íŠ¸
$('cmp-bars').innerHTML=items.map(item=>{
const my=myScores[item]||5;
const comp=compScores[item]||5;
const myW=my*10;const compW=comp*10;
const myColor=my>=comp?'var(--g)':'var(--r)';
return `<div style="margin-bottom:14px">
<div style="font-size:.88em;font-weight:600;color:var(--t1);margin-bottom:6px">${item}</div>
<div style="display:flex;align-items:center;gap:8px;margin-bottom:3px">
<span style="width:40px;font-size:.78em;color:var(--t3);text-align:right">ë‚´ ê¸€</span>
<div style="flex:1;background:var(--bg1);height:10px;border-radius:6px;overflow:hidden">
<div style="background:${myColor};height:100%;width:${myW}%;border-radius:6px;transition:width .6s"></div>
</div>
<span style="width:32px;font-size:.85em;font-weight:600;color:${myColor}">${my}</span>
</div>
<div style="display:flex;align-items:center;gap:8px">
<span style="width:40px;font-size:.78em;color:var(--t3);text-align:right">ê²½ìŸì‚¬</span>
<div style="flex:1;background:var(--bg1);height:10px;border-radius:6px;overflow:hidden">
<div style="background:var(--b);height:100%;width:${compW}%;border-radius:6px;transition:width .6s"></div>
</div>
<span style="width:32px;font-size:.85em;font-weight:600;color:var(--b)">${comp}</span>
</div>
</div>`;
}).join('');

// í…ìŠ¤íŠ¸ ì„¹ì…˜ íŒŒì‹±
const strengthPart=(r.split('---ìš°ì„¸í•­ëª©---')[1]||'').split('---')[0].trim();
const weakPart=(r.split('---ê°œì„ í•­ëª©---')[1]||'').split('---')[0].trim();
const strategyPart=(r.split('---ì „ëµì œì•ˆ---')[1]||'').trim();

$('cmp-strengths').innerHTML=strengthPart?strengthPart.split('\n').filter(l=>l.trim()).map(l=>
'<div style="padding:8px;background:rgba(52,211,153,.08);border-left:3px solid var(--g);border-radius:var(--r1);margin-bottom:4px">âœ… '+l.replace(/^\d+[\.\)]\s*/,'').trim()+'</div>'
).join(''):'<span style="color:var(--t3)">ë°ì´í„° ì—†ìŒ</span>';

$('cmp-weaknesses').innerHTML=weakPart?weakPart.split('\n').filter(l=>l.trim()).map(l=>
'<div style="padding:8px;background:rgba(248,113,113,.08);border-left:3px solid var(--r);border-radius:var(--r1);margin-bottom:4px">âš ï¸ '+l.replace(/^\d+[\.\)]\s*/,'').trim()+'</div>'
).join(''):'<span style="color:var(--t3)">ë°ì´í„° ì—†ìŒ</span>';

$('cmp-strategy').textContent=strategyPart||'ì „ëµ ì œì•ˆì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
renderCmpStrategyCards(strategyPart);

// ì´ë ¥ ì €ì¥
cmpHistory.unshift({date:new Date().toLocaleDateString('ko-KR'),myScore:myTotal,compScore:compTotal,myText:myText.substring(0,40),compText:compText.substring(0,40)});
if(cmpHistory.length>10)cmpHistory=cmpHistory.slice(0,10);
LS('cmp_history',cmpHistory);
renderCmpHistory();
toast('âœ… ë¹„êµ ë¶„ì„ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}}

function renderCmpStrategyCards(text){
const el=$('cmp-strategy-cards');if(!el)return;
if(!text){el.innerHTML='<div style="text-align:center;padding:16px;color:var(--t3);font-size:.85em;grid-column:1/-1">ì „ëµ ì œì•ˆ ì—†ìŒ</div>';return;}
const sections=parseAiSections(text);
el.innerHTML=renderAiCards(sections,2);
}

function renderCmpHistory(){
$('cmp-history-count').textContent=cmpHistory.length;
if(!cmpHistory.length){$('cmp-history-list').innerHTML='<div style="text-align:center;padding:12px;color:var(--t3);font-size:.88em">ë¹„êµ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div>';return}
$('cmp-history-list').innerHTML=cmpHistory.map((h,i)=>{
const myC=h.myScore>=h.compScore?'var(--g)':'var(--r)';
return `<div style="display:flex;align-items:center;gap:10px;padding:8px;background:var(--bg4);border-radius:var(--r1);margin-bottom:4px">
<span style="font-size:.78em;color:var(--t3);width:70px;flex-shrink:0">${h.date}</span>
<div style="flex:1;min-width:0">
<div style="font-size:.82em;color:var(--t2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h.myText||'ë‚´ ê¸€'}... vs ${h.compText||'ê²½ìŸì‚¬'}...</div>
</div>
${h.myScore?`<span style="font-weight:600;color:${myC};font-size:.88em">${h.myScore}</span><span style="color:var(--t3);font-size:.78em">vs</span><span style="font-weight:600;color:var(--b);font-size:.88em">${h.compScore}</span>`:''}
</div>`;
}).join('');
}

function clearCmpHistory(){
cmpHistory=[];LS('cmp_history',[]);renderCmpHistory();toast('ğŸ—‘ï¸ ì´ë ¥ ì´ˆê¸°í™”');
}

// === OOH DATA ===
const OOH=[
{id:'led',icon:'ğŸ–¥ï¸',name:'ì•¼ì™¸ ì „ê´‘íŒ(LED)',loc:'ê°•ë‚¨ì—­, ì½”ì—‘ìŠ¤, ëª…ë™, íƒ€ì„ìŠ¤í€˜ì–´',price:'300~2,000ë§Œ/ì›”',cpm:'â‚©120~350',reach:'ì›” 500ë§Œ~3,000ë§Œ',score:4.2,agency:'ì œì¼ê¸°íš, HSì• ë“œ, ë‚˜ìŠ¤ë¯¸ë””ì–´',effect:'24ì‹œê°„ ë…¸ì¶œ, ì˜ìƒì†Œì¬, ëŒ€í˜• ì„íŒ©íŠ¸',detail:'ê°•ë‚¨ì—­ ì‚¬ê±°ë¦¬ ì›” 1,500ë§Œì› ê¸°ì¤€ ì¼ ìœ ë™ì¸êµ¬ 30ë§Œ. 15ì´ˆ/30ì´ˆ ìŠ¬ë¡¯ ìš´ì˜.'},
{id:'bus',icon:'ğŸšŒ',name:'ë²„ìŠ¤ ì™¸ë¶€ ë©í•‘',loc:'ì„œìš¸ ì‹œë‚´ë²„ìŠ¤ ì£¼ìš” ë…¸ì„ ',price:'80~180ë§Œ/ëŒ€/ì›”',cpm:'â‚©85~200',reach:'ì›” 120ë§Œ~300ë§Œ/ëŒ€',score:4.5,agency:'ëŒ€í™ê¸°íš, ì´ë…¸ì…˜, ë²„ìŠ¤ë¯¸ë””ì–´',effect:'ì´ë™í˜• ê´‘ê³ , ë„“ì€ ì»¤ë²„ë¦¬ì§€',detail:'2~3ëŒ€ ìš´ì˜ ì‹œ ë…¸ì¶œ ê·¹ëŒ€í™”. 6ê°œì›” ì´ìƒ ê³„ì•½ 20% í• ì¸.'},
{id:'taxi',icon:'ğŸš•',name:'íƒì‹œ íƒ‘ë¼ì´íŠ¸',loc:'ì„œìš¸Â·ìˆ˜ë„ê¶Œ ì „ì—­',price:'12~18ë§Œ/ëŒ€/ì›”',cpm:'â‚©50~120',reach:'ì›” 80ë§Œ~150ë§Œ/ëŒ€',score:4.8,agency:'ëª¨ë¹Œì•„ì´, íƒì‹œë¯¸ë””ì–´, T-ad',effect:'ê°€ì„±ë¹„ ìµœê³ , GPS íƒ€ê²ŸíŒ…',detail:'10ëŒ€+ ìš´ì˜ ì‹œ ë‹¨ê°€â†“. ì•¼ê°„ LED ë°œê´‘ íš¨ê³¼ ìš°ìˆ˜.'},
{id:'banner',icon:'ğŸ³ï¸',name:'í˜„ìˆ˜ë§‰',loc:'ë„ë¡œë³€, ì•„íŒŒíŠ¸ ë‹¨ì§€, ìƒê°€',price:'5~15ë§Œ/ê°œ/ì›”',cpm:'â‚©30~80',reach:'ì›” 10ë§Œ~50ë§Œ/ê°œ',score:3.8,agency:'ì§€ì—­ êµ¬ì²­ ì‹ ì²­, í˜„ìˆ˜ë§‰114',effect:'ìµœì €ê°€, ì§€ì—­ íƒ€ê²ŸíŒ… ìµœì ',detail:'ì„¤ì¹˜ ê·œì œ ì§€ì—­ë³„ ìƒì´. í’ìˆ˜í•´ íŒŒì† ë¦¬ìŠ¤í¬.'},
{id:'train',icon:'ğŸš„',name:'ê¸°ì°¨ì—­(KTX)',loc:'ì„œìš¸ì—­, ìš©ì‚°, ìˆ˜ì„œ, ëŒ€ì „ì—­',price:'200~800ë§Œ/ì›”',cpm:'â‚©150~400',reach:'ì›” 200ë§Œ~800ë§Œ',score:3.9,agency:'ì½”ë ˆì¼ìœ í†µ, ë©”íŠ¸ë¡œAD',effect:'ë¹„ì¦ˆë‹ˆìŠ¤ íƒ€ê²Ÿ, ê³ ì†Œë“ì¸µ',detail:'ì„œìš¸ì—­ ì¤‘ì•™í™€ ì›” 500ë§Œ. ì¼ ìœ ë™ 25ë§Œëª…. ì¥ê¸°ê³„ì•½ í• ì¸.'},
{id:'subway',icon:'ğŸš‡',name:'ì§€í•˜ì²  ìŠ¤í¬ë¦°ë„ì–´',loc:'2í˜¸ì„  ê°•ë‚¨Â·ì ì‹¤Â·í™ëŒ€',price:'150~500ë§Œ/ì›”',cpm:'â‚©100~250',reach:'ì›” 300ë§Œ~1,200ë§Œ',score:4.3,agency:'ì„œìš¸ë©”íŠ¸ë¡œAD, ë©”íŠ¸ë¡œë¯¸ë””ì–´',effect:'ì¶œí‡´ê·¼ ì§‘ì¤‘ ë…¸ì¶œ, ì˜ìƒ ê°€ëŠ¥',detail:'ìŠ¤í¬ë¦°ë„ì–´ LED ì˜ìƒí˜• ì›” 300ë§Œ~. 2í˜¸ì„  ê°•ë‚¨ì—­ ì›” ìœ ë™ 500ë§Œëª….'},
{id:'dooh',icon:'ğŸ“º',name:'DOOH(ë””ì§€í„¸OOH)',loc:'ì‡¼í•‘ëª°, ì—˜ë¦¬ë² ì´í„°, í¸ì˜ì ',price:'50~300ë§Œ/ì›”',cpm:'â‚©80~200',reach:'ì›” 100ë§Œ~500ë§Œ',score:4.1,agency:'í¬ì»¤ìŠ¤ë¯¸ë””ì–´, ë‚˜ìŠ¤ë¯¸ë””ì–´',effect:'ì •ë°€ íƒ€ê²ŸíŒ…, ë°˜ë³µ ë…¸ì¶œ',detail:'ì—˜ë¦¬ë² ì´í„° ìŠ¤í¬ë¦°(ì•„íŒŒíŠ¸/ì˜¤í”¼ìŠ¤) ì›” 50ë§Œ~. í¸ì˜ì  ì‚¬ì´ë‹ˆì§€ ì›” 80ë§Œ~.'},
{id:'coffee',icon:'â˜•',name:'ì»¤í”¼ì°¨(ì´ë™í˜•)',loc:'í–‰ì‚¬ì¥, ì´¬ì˜ì¥, ì˜¤í”¼ìŠ¤ ì•',price:'30~80ë§Œ/íšŒ',cpm:'â‚©500~1,500',reach:'íšŒë‹¹ 500~2,000ëª…',score:3.5,agency:'ì»¤í”¼ì°¨114, ì´ë²¤íŠ¸ì»¤í”¼',effect:'ë¸Œëœë“œ ê²½í—˜, SNS ë°”ì´ëŸ´',detail:'1íšŒì„±ì´ë‚˜ ë°”ì´ëŸ´ íš¨ê³¼. ë¡œê³  ì»µ+ë°°ë„ˆ+ì‹œìŒ íŒ¨í‚¤ì§€.'}
];
function rOOH(){let h='';OOH.forEach(o=>{h+='<div class="ooh-card" onclick="showOoh(\''+o.id+'\')"><div class="ooh-icon">'+o.icon+'</div><div class="ooh-name">'+o.name+'</div><div class="ooh-price">ğŸ’° '+o.price+'</div><div class="ooh-info">ğŸ“ '+o.loc+'<br>ğŸ‘ '+o.reach+'<br>ğŸ“Š CPM: '+o.cpm+'<br>â­ '+o.score+'/5<br>ğŸ¢ '+o.agency.split(',')[0]+'</div></div>'});$('ooh-grid').innerHTML=h}
function rOOHT(){let h='';OOH.forEach(o=>{const sc=o.score>=4.5?'green':o.score>=4?'yellow':'blue';h+='<tr onclick="showOoh(\''+o.id+'\')" style="cursor:pointer"><td>'+o.icon+' '+o.name+'</td><td>'+o.loc+'</td><td style="color:var(--ac)">'+o.price+'</td><td>'+o.reach+'</td><td>'+o.cpm+'</td><td><span class="badge '+sc+'">'+o.score+'/5</span></td><td style="font-size:.72em">'+o.agency+'</td></tr>'});$('ooh-tbody').innerHTML=h}
function showOoh(id){const o=OOH.find(x=>x.id===id);if(!o)return;const box=$('ooh-detail-box');box.classList.add('show');box.innerHTML='<div style="display:flex;align-items:center;gap:10px;margin-bottom:10px"><span style="font-size:2em">'+o.icon+'</span><div><div style="font-weight:700;font-size:1.05em">'+o.name+'</div><div style="font-size:.78em;color:var(--t2)">'+o.effect+'</div></div></div><div class="stat-grid" style="margin-bottom:10px"><div class="stat-card"><div class="stat-v">'+o.price+'</div><div class="stat-l">ì˜ˆìƒ ë‹¨ê°€</div></div><div class="stat-card"><div class="stat-v">'+o.reach+'</div><div class="stat-l">ì›” ë…¸ì¶œ</div></div><div class="stat-card"><div class="stat-v">'+o.cpm+'</div><div class="stat-l">CPM</div></div><div class="stat-card"><div class="stat-v" style="color:var(--g)">'+o.score+'/5</div><div class="stat-l">ê°€ì„±ë¹„</div></div></div><div class="tip-box"><b>ğŸ¢ ëŒ€í–‰ì‚¬:</b> '+o.agency+'<br><b>ğŸ“ ìƒì„¸:</b> '+o.detail+'</div>';box.scrollIntoView({behavior:'smooth',block:'nearest'})}
function setOohMode(mode){document.querySelectorAll('#ooh-pills .sub-pill').forEach(p=>p.classList.remove('a'));event.target.classList.add('a');$('ooh-find').style.display=mode==='find'?'block':'none';$('ooh-detail').style.display=mode==='detail'?'block':'none'}

// === AD SIMULATOR ===
let adPlat='naver';
function setAdPlat(el,p){document.querySelectorAll('#ad-plats .ad-plat').forEach(b=>b.classList.remove('a'));el.classList.add('a');adPlat=p;updateAd()}
function updateAd(){const v=parseInt($('ad-sl').value);const period=parseInt($('ad-period').value);const age=$('ad-age').value;const gender=$('ad-gender').value;const region=$('ad-region').value;const name=$('ad-name').value;
$('ad-budget-v').textContent='â‚©'+v.toLocaleString();
const P={naver:{name:'ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³ ',cpc:850,ctr:0.035,conv:0.03},insta:{name:'ì¸ìŠ¤íƒ€ê·¸ë¨ ë¦´ìŠ¤',cpm:5500,ctr:0.02,conv:0.008},fb:{name:'í˜ì´ìŠ¤ë¶ í”¼ë“œ',cpm:4800,ctr:0.018,conv:0.007},gdn:{name:'êµ¬ê¸€ GDN',cpm:2800,ctr:0.008,conv:0.005}};
const p=P[adPlat];const regionMult=region==='ì„œìš¸'?1.3:region==='ì „êµ­'?1:0.85;
let clicks=p.cpc?Math.round(v/p.cpc*regionMult):Math.round(v/p.cpm*1000*p.ctr*regionMult);
let leads=Math.max(1,Math.round(clicks*p.conv));let cpl=Math.round(v/leads);let totalBudget=v*period;
$('ad-stats').innerHTML=['<div class="stat-card"><div class="stat-v">'+name.substring(0,12)+'</div><div class="stat-l">ê´‘ê³ ëª…</div></div>','<div class="stat-card"><div class="stat-v">â‚©'+(totalBudget/10000).toFixed(0)+'ë§Œ</div><div class="stat-l">ì´ì˜ˆì‚°('+period+'ê°œì›”)</div></div>','<div class="stat-card"><div class="stat-v">'+clicks.toLocaleString()+'</div><div class="stat-l">ì˜ˆìƒ í´ë¦­/ì›”</div></div>','<div class="stat-card"><div class="stat-v" style="color:var(--g)">'+leads+'ê±´</div><div class="stat-l">ì˜ˆìƒ ë¬¸ì˜/ì›”</div></div>'].join('');
// Cost detail
let cdH='<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;font-size:.78em;color:var(--t2)"><div>ğŸ’° ì›”ì˜ˆì‚°<br><b style="color:var(--ac)">â‚©'+v.toLocaleString()+'</b></div><div>ğŸ–±ï¸ ì˜ˆìƒ í´ë¦­<br><b style="color:var(--b)">'+clicks.toLocaleString()+'íšŒ</b></div><div>ğŸ“ ì˜ˆìƒ ë¬¸ì˜<br><b style="color:var(--g)">'+leads+'ê±´</b></div><div>ğŸ’µ ë¬¸ì˜ë‹¹ ë¹„ìš©<br><b>â‚©'+cpl.toLocaleString()+'</b></div><div>ğŸ¯ íƒ€ê²Ÿ<br><b>'+age+' / '+gender+'</b></div><div>ğŸ“ ì§€ì—­<br><b>'+region+'</b></div></div>';
cdH+='<div class="tip-box" style="margin-top:8px"><b>ğŸ’¡ '+p.name+'</b> | '+name+'<br>'+period+'ê°œì›” ì´ â‚©'+(totalBudget/10000).toFixed(0)+'ë§Œ íˆ¬ì ì‹œ ë¬¸ì˜ ì•½ <b style="color:var(--g)">'+(leads*period)+'ê±´</b> ì˜ˆìƒ<br>ë¬¸ì˜ë‹¹ ë¹„ìš© â‚©'+cpl.toLocaleString()+' | ì˜ˆìƒ ROI <b>'+Math.round(leads*500000/v*100)+'%</b></div>';
$('ad-cost-detail').innerHTML=cdH;
// CRM Funnel
const imp=p.cpc?clicks*28:Math.round(v/p.cpm*1000);
let crm='<div style="font-size:.78em">';
const stages=[{n:'ë…¸ì¶œ',v:imp,c:'var(--t2)'},{n:'í´ë¦­',v:clicks,c:'var(--b)'},{n:'ê´€ì‹¬(í˜ì´ì§€ë·°)',v:Math.round(clicks*0.6),c:'var(--ac)'},{n:'ë¬¸ì˜',v:leads,c:'var(--g)'},{n:'ê²¬ì ìš”ì²­',v:Math.max(1,Math.round(leads*0.5)),c:'var(--g)'},{n:'ê³„ì•½',v:Math.max(1,Math.round(leads*0.15)),c:'#a855f7'}];
stages.forEach((s,i)=>{const w=Math.max(20,Math.round(s.v/imp*100));crm+='<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px"><div style="width:80px;text-align:right;color:var(--t2)">'+s.n+'</div><div style="background:'+s.c+';height:22px;width:'+w+'%;border-radius:4px;opacity:0.7"></div><b style="color:'+s.c+'">'+s.v.toLocaleString()+'</b></div>'});
crm+='</div>';$('ad-crm').innerHTML=crm}

// AI ê´‘ê³  ì¶”ì²œ
async function getAdRecommend(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
const budget=parseInt($('ad-sl').value);
const age=$('ad-age').value;
const gender=$('ad-gender').value;
const region=$('ad-region').value;
const kw=$('ad-kw').value||'LEDì „ê´‘íŒ, ë°©ì†¡ì¤‘ê³„';
const name=$('ad-name').value||'';
toast('ğŸ¤– ë§ì¶¤ ê´‘ê³  ë¶„ì„ ì¤‘...');
try{
const r=await callAI(`LEDì „ê´‘íŒ/ë°©ì†¡ì¤‘ê³„/ì˜ìƒì¥ë¹„ ì—…ì¢…ì˜ ê´‘ê³  ì „ëµì„ ì¶”ì²œí•´ì¤˜.

ì¡°ê±´:
- ì›” ì˜ˆì‚°: â‚©${budget.toLocaleString()}
- íƒ€ê²Ÿ: ${age} / ${gender} / ${region}
- í‚¤ì›Œë“œ: ${kw}
- ìº í˜ì¸: ${name}

ì •í™•íˆ 4ê°œì˜ ê´‘ê³ ë¥¼ ì¶”ì²œí•´ì¤˜. ê° ê´‘ê³ ëŠ” ì´ í˜•ì‹ìœ¼ë¡œ:
ê´‘ê³ ìœ í˜• | í”Œë«í¼ | ì¶”ì²œì˜ˆì‚°ë¹„ìœ¨(%) | ì˜ˆìƒ íš¨ê³¼ | ì¶”ì²œ ì´ìœ  í•œì¤„

ì˜ˆ: ê²€ìƒ‰ê´‘ê³  | ë„¤ì´ë²„ | 40% | ì›” ë¬¸ì˜ 15ê±´ ì˜ˆìƒ | êµ¬ë§¤ ì˜ë„ ë†’ì€ í‚¤ì›Œë“œ íƒ€ê²Ÿ

ë§ˆì§€ë§‰ì— "ğŸ’¡ ì¢…í•©ì „ëµ:" ìœ¼ë¡œ ì „ì²´ ì˜ˆì‚° ë°°ë¶„ ì „ëµ 2ì¤„.`);

const lines=r.split('\n').filter(l=>l.trim());
let cardsHTML='';
let strategy='';
const icons={'ê²€ìƒ‰':'ğŸ”','ë¸”ë¡œê·¸':'ğŸ“','ì¸ìŠ¤íƒ€':'ğŸ“¸','SNS':'ğŸ“±','GDN':'ğŸŒ','ë°°ë„ˆ':'ğŸ–¼ï¸','ë¦¬íƒ€ê²Ÿ':'ğŸ¯','ë¸Œëœë“œ':'â­','ì˜ìƒ':'ğŸ¬','ìœ íŠœë¸Œ':'â–¶ï¸','ì¹´ì¹´ì˜¤':'ğŸ’¬','í˜ì´ìŠ¤':'ğŸ‘¥','ë„¤ì´ë²„':'ğŸŸ¢','êµ¬ê¸€':'ğŸ”µ'};

lines.forEach(line=>{
if(line.includes('ì¢…í•©ì „ëµ')||line.includes('ğŸ’¡')){
strategy+=line.trim()+'\n';
return;
}
const p=line.split('|');
if(p.length>=4){
const type=p[0].trim().replace(/^\d+[\.\)]\s*/,'');
const platform=p[1].trim();
const budgetPct=p[2].trim();
const effect=p[3].trim();
const reason=p[4]?p[4].trim():'';
const budgetNum=parseInt(budgetPct)||25;
const budgetAmt=Math.round(budget*budgetNum/100);
let icon='ğŸ“¢';
for(const[k,v]of Object.entries(icons)){if(type.includes(k)||platform.includes(k)){icon=v;break;}}
const color=budgetNum>=40?'var(--ac)':budgetNum>=25?'var(--b)':'var(--g)';
cardsHTML+=`<div style="padding:14px;background:var(--bg4);border-radius:var(--r2);border-left:3px solid ${color}">
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
<div style="display:flex;align-items:center;gap:6px">
<span style="font-size:1.2em">${icon}</span>
<span style="font-weight:700;color:var(--t1)">${type}</span>
<span style="font-size:.78em;color:var(--t3)">${platform}</span>
</div>
<span style="padding:2px 10px;border-radius:10px;font-size:.82em;font-weight:600;background:${color}22;color:${color}">${budgetPct}</span>
</div>
<div style="font-size:.85em;color:var(--t2);margin-bottom:4px">â‚©${budgetAmt.toLocaleString()}/ì›” Â· ${effect}</div>
${reason?`<div style="font-size:.82em;color:var(--t3)">â†’ ${reason}</div>`:''}
</div>`;
}
});

$('ad-rec-cards').innerHTML=cardsHTML||'<div style="color:var(--t3);text-align:center;padding:12px">ì¶”ì²œ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</div>';
if(strategy.trim()){
$('ad-rec-cards').innerHTML+=`<div class="tip-box" style="margin-top:4px"><b>${strategy.trim().replace(/\n/g,'<br>')}</b></div>`;
}
toast('âœ… ê´‘ê³  ì¶”ì²œ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}}

// === KEYWORD RESEARCH ===
let kwrSaved=LS('kwr_saved')||[];
let kwrRecent=LS('kwr_recent')||[];
let kwrContentData=[];
let kwrCurrentPlat='all';

function renderKwrRecent(){
const el=$('kwr-recent');
if(!kwrRecent.length){el.innerHTML='<span style="font-size:.82em;color:var(--t3)">ìµœê·¼ ê²€ìƒ‰ ì—†ìŒ</span>';return}
el.innerHTML='<span style="font-size:.82em;color:var(--t3);margin-right:4px">ìµœê·¼:</span>'+kwrRecent.slice(0,5).map(k=>
`<button class="ebtn" onclick="$('kwr-input').value='${k.replace(/'/g,"\\'")}';searchKeyword()">${k}</button>`
).join('');
}

async function searchKeyword(){
const kw=$('kwr-input').value.trim();
if(!kw){toast('âš ï¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');return}
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}

kwrRecent=kwrRecent.filter(k=>k!==kw);
kwrRecent.unshift(kw);
if(kwrRecent.length>10)kwrRecent=kwrRecent.slice(0,10);
LS('kwr_recent',kwrRecent);renderKwrRecent();

const btn=$('kwr-btn');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ë¶„ì„ ì¤‘...';
toast('ğŸ” "'+kw+'" í‚¤ì›Œë“œ ë¶„ì„ ì¤‘...');

try{
if(backendUrl){
// â˜… ì‹¤ì œ API ë°ì´í„°
const data=await callBackend('/api/keyword-analyze',{keyword:kw});
const s=data.summary||{};

const naverBlog=s.naverBlogTotal||0;
const naverNews=s.naverNewsTotal||0;
const naverCafe=s.naverCafeTotal||0;
const naverTotal=naverBlog+naverNews+naverCafe;
const googleTotal=s.googleTotal||0;
const instaTotal=s.instagramTotal||0;
const fbTotal=s.facebookTotal||0;
const snsTotal=instaTotal+fbTotal+naverCafe;
const totalContent=s.totalContent||0;

// ë„¤ì´ë²„ ì½˜í…ì¸ 
$('kwr-volume').textContent=naverTotal.toLocaleString();
$('kwr-volume-sub').textContent='ë¸”ë¡œê·¸ '+naverBlog.toLocaleString()+' / ë‰´ìŠ¤ '+naverNews.toLocaleString()+' / ì¹´í˜ '+naverCafe.toLocaleString();
// êµ¬ê¸€ ì½˜í…ì¸ 
if($('kwr-google-vol'))$('kwr-google-vol').textContent=googleTotal.toLocaleString();
if($('kwr-google-sub'))$('kwr-google-sub').textContent='Google ê²€ìƒ‰ ê²°ê³¼ ìˆ˜';
// SNS ì½˜í…ì¸ 
if($('kwr-sns-vol'))$('kwr-sns-vol').textContent=snsTotal.toLocaleString();
if($('kwr-sns-sub'))$('kwr-sns-sub').textContent='ì¸ìŠ¤íƒ€ '+instaTotal.toLocaleString()+' / FB '+fbTotal.toLocaleString();
// ì´ ì½˜í…ì¸ 
$('kwr-content-count').textContent=totalContent.toLocaleString();

// ì„¸ë¶€ í”„ë¡œê·¸ë ˆìŠ¤ ë°”
renderKwrDetailBars({naverBlog,naverNews,naverCafe,googleTotal,instaTotal,fbTotal});

let comp='ì¤‘';
if(totalContent>500000)comp='ìƒ';else if(totalContent>100000)comp='ì¤‘ìƒ';else if(totalContent>10000)comp='ì¤‘';else if(totalContent>1000)comp='ì¤‘í•˜';else comp='í•˜';
const compColor=comp.includes('ìƒ')?'var(--r)':comp==='ì¤‘'?'var(--ac)':'var(--g)';
$('kwr-competition').innerHTML='<span style="color:'+compColor+'">'+comp+'</span>';

const trendDir=s.trendDirection||'ìœ ì§€';
$('kwr-trend').textContent=trendDir;
$('kwr-trend').style.color=trendDir==='ìƒìŠ¹'?'var(--g)':trendDir==='í•˜ë½'?'var(--r)':'var(--ac)';
$('kwr-trend-sub').textContent='ìµœê·¼ 3ê°œì›” ê¸°ì¤€';

// íŠ¸ë Œë“œ ì°¨íŠ¸
const nTrend=data.trend?.naver||[];
const gTrend=data.trend?.google||[];
if(nTrend.length>0||gTrend.length>0){
const chartData=nTrend.length>0?nTrend:gTrend;
const maxVal=Math.max(...chartData.map(d=>d.value||0),...gTrend.map(d=>d.value||0),1);
$('kwr-chart').innerHTML=chartData.map((d,i)=>{
const nH=Math.max(4,Math.round((d.value||0)/maxVal*140));
const gVal=gTrend[i]?gTrend[i].value:0;
const gH=Math.max(4,Math.round(gVal/maxVal*140));
const label=d.date?d.date.split('-').slice(1).join('/'):'';
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center;position:relative;cursor:pointer" 
onmouseenter="this.querySelector('.chart-tip').style.display='block'" onmouseleave="this.querySelector('.chart-tip').style.display='none'">
<div class="chart-tip" style="display:none;position:absolute;top:-30px;background:var(--bg2);border:1px solid var(--border);border-radius:6px;padding:3px 8px;font-size:.7em;color:var(--t1);white-space:nowrap;z-index:10;box-shadow:0 2px 8px rgba(0,0,0,.15)">N:${d.value||0} G:${gVal}</div>
<div class="trend-bar-group">
<div class="trend-bar" style="height:${gH}px;background:var(--b)" title="êµ¬ê¸€ ${gVal}"></div>
<div class="trend-bar" style="height:${nH}px;background:var(--ac)" title="ë„¤ì´ë²„ ${d.value}"></div>
</div>
<div class="trend-day-label">${label}</div>
</div>`;}).join('');
}else{
$('kwr-chart').innerHTML='<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;color:var(--t3)"><div style="font-size:2em;margin-bottom:8px">ğŸ“Š</div><div style="font-size:.85em">íŠ¸ë Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div><div style="font-size:.75em;margin-top:4px">ë„¤ì´ë²„ ë°ì´í„°ë©ì—ì„œ ê²€ìƒ‰ëŸ‰ì´ ë¶€ì¡±í•œ í‚¤ì›Œë“œì…ë‹ˆë‹¤</div></div>';
}

// ì‹¤ì œ ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸
kwrContentData=[];
const c=data.content||{};
(c.news||[]).forEach(item=>kwrContentData.push({type:'news',title:item.title,source:item.source,link:item.link,date:item.date?new Date(item.date).toLocaleDateString('ko-KR'):'',desc:item.description?.substring(0,40)||'',views:''}));
(c.blog||[]).forEach(item=>kwrContentData.push({type:'blog',title:item.title,source:item.source,link:item.link,date:item.date||'',desc:item.description?.substring(0,40)||'',views:''}));
(c.cafe||[]).forEach(item=>kwrContentData.push({type:'sns',title:item.title,source:item.source||'ì¹´í˜',link:item.link,date:'',desc:item.description?.substring(0,40)||'',views:''}));
(c.instagram||[]).forEach(item=>kwrContentData.push({type:'sns',title:item.title,source:item.source||'Instagram',link:item.link,date:'',desc:item.snippet?.substring(0,40)||'',views:'ğŸ“¸'}));
(c.facebook||[]).forEach(item=>kwrContentData.push({type:'sns',title:item.title,source:item.source||'Facebook',link:item.link,date:'',desc:item.snippet?.substring(0,40)||'',views:'ğŸ‘'}));
(c.google||[]).forEach(item=>{if(!kwrContentData.find(x=>x.title===item.title))kwrContentData.push({type:'news',title:item.title,source:item.source,link:item.link,date:'',desc:item.snippet?.substring(0,40)||'',views:'#'+item.position});});

// ì†ŒìŠ¤ ìš”ì•½ í‘œì‹œ
const srcSummary=[];
if(s.naverBlogTotal)srcSummary.push('ë¸”ë¡œê·¸ '+s.naverBlogTotal.toLocaleString());
if(s.naverNewsTotal)srcSummary.push('ë‰´ìŠ¤ '+s.naverNewsTotal.toLocaleString());
if(s.naverCafeTotal)srcSummary.push('ì¹´í˜ '+s.naverCafeTotal.toLocaleString());
if(s.googleTotal)srcSummary.push('êµ¬ê¸€ '+s.googleTotal.toLocaleString());
if(s.instagramTotal)srcSummary.push('ì¸ìŠ¤íƒ€ '+s.instagramTotal.toLocaleString());
if(s.facebookTotal)srcSummary.push('í˜ì´ìŠ¤ë¶ '+s.facebookTotal.toLocaleString());
$('kwr-searched-kw').textContent='"'+kw+'" ('+srcSummary.join(' Â· ')+') âœ…';

// í”Œë«í¼ë³„ ì ìœ ìœ¨ ì°¨íŠ¸
renderKwrPlatformChart(s);

// ë²¤ ë‹¤ì´ì–´ê·¸ë¨
renderKwrVenn(s);

// ì—°ê´€ í‚¤ì›Œë“œ
const relKws=(data.relatedKeywords||[]);
$('kwr-related').innerHTML=relKws.map(r=>
`<div style="padding:6px 12px;background:var(--bg4);border:1px solid var(--border);border-radius:20px;cursor:pointer;display:flex;align-items:center;gap:6px" onclick="$('kwr-input').value='${r.replace(/'/g,"\\'")}';searchKeyword()">
<span style="font-size:.88em;color:var(--t1);font-weight:500">${r}</span>
</div>`).join('');

// ì—°ê´€ í‚¤ì›Œë“œ ìˆœìœ„ ì°¨íŠ¸
renderKwrRankingChart(relKws);

// AI ì¸ì‚¬ì´íŠ¸ (ì‹¤ì œ ë°ì´í„° ê¸°ë°˜)
renderKwrInsightCards('AI ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘...');
try{
const aiR=await callAI(`"${kw}" í‚¤ì›Œë“œ ì‹¤ì œ ê²€ìƒ‰ ë°ì´í„°:
- ë„¤ì´ë²„ ë¸”ë¡œê·¸: ${s.naverBlogTotal?.toLocaleString()||0}ê±´, ë‰´ìŠ¤: ${s.naverNewsTotal?.toLocaleString()||0}ê±´, ì¹´í˜: ${s.naverCafeTotal?.toLocaleString()||0}ê±´
- êµ¬ê¸€: ${s.googleTotal?.toLocaleString()||0}ê±´
- ì¸ìŠ¤íƒ€ê·¸ë¨: ${s.instagramTotal?.toLocaleString()||0}ê±´
- í˜ì´ìŠ¤ë¶: ${s.facebookTotal?.toLocaleString()||0}ê±´
- íŠ¸ë Œë“œ: ${trendDir}, ê²½ìŸ: ${comp}

ì´ ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ:
1) ê²€ìƒ‰ ì˜ë„ ë¶„ì„
2) ì½˜í…ì¸  ê³µëµ í¬ì¸íŠ¸ (ë¸”ë¡œê·¸/ì¸ìŠ¤íƒ€/í˜ì´ìŠ¤ë¶ ê°ê°)
3) ì¶”ì²œ ë¡±í…Œì¼ í‚¤ì›Œë“œ 3ê°œ
4) SNS í”Œë«í¼ë³„ ì „ëµ
ê° 2ì¤„ ì´ë‚´.`);
renderKwrInsightCards(aiR||'');
}catch(e){renderKwrInsightCards('ì¸ì‚¬ì´íŠ¸ ë¡œë”© ì‹¤íŒ¨')}

} else {
// â˜… AI ì‹œë®¬ë ˆì´ì…˜ (ë°±ì—”ë“œ ì—†ì„ ë•Œ í´ë°±)
const r1=await callAI(`"${kw}" í‚¤ì›Œë“œë¥¼ ë¶„ì„í•´ì¤˜. ì‹¤ì œì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜í•´ì„œ ë‹µí•´.

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ ê·¸ëŒ€ë¡œ ë‹µí•´ì¤˜:

ì›”ê°„ê²€ìƒ‰ëŸ‰_ë„¤ì´ë²„: [ìˆ«ì]
ì›”ê°„ê²€ìƒ‰ëŸ‰_êµ¬ê¸€: [ìˆ«ì]
ê²½ìŸê°•ë„: [ìƒ/ì¤‘ìƒ/ì¤‘/ì¤‘í•˜/í•˜]
íŠ¸ë Œë“œ: [ìƒìŠ¹/ìœ ì§€/í•˜ë½]
íŠ¸ë Œë“œë³€í™”ìœ¨: [+/-ìˆ«ì]%

ì›”ë³„ê²€ìƒ‰ëŸ‰(ìµœê·¼12ê°œì›”,ë„¤ì´ë²„): [ìˆ«ì12ê°œ ì‰¼í‘œêµ¬ë¶„]
ì›”ë³„ê²€ìƒ‰ëŸ‰(ìµœê·¼12ê°œì›”,êµ¬ê¸€): [ìˆ«ì12ê°œ ì‰¼í‘œêµ¬ë¶„]

ì—°ê´€í‚¤ì›Œë“œ(10ê°œ): [í‚¤ì›Œë“œ|ì›”ê²€ìƒ‰ëŸ‰|ê²½ìŸë„] í˜•ì‹, í•œì¤„ì— í•˜ë‚˜

---ì¸ì‚¬ì´íŠ¸---
1) ê²€ìƒ‰ ì˜ë„ ë¶„ì„
2) ì½˜í…ì¸  ê³µëµ í¬ì¸íŠ¸
3) ì¶”ì²œ ë¡±í…Œì¼ í‚¤ì›Œë“œ 3ê°œ
4) ì‹œì¦Œë³„ íŠ¹ì´ì‚¬í•­
ê° 2ì¤„ ì´ë‚´.`);

const naverVol=parseInt((r1.match(/ì›”ê°„ê²€ìƒ‰ëŸ‰_ë„¤ì´ë²„[:\s]*([\d,]+)/)||[])[1]?.replace(/,/g,''))||3200;
const googleVol=parseInt((r1.match(/ì›”ê°„ê²€ìƒ‰ëŸ‰_êµ¬ê¸€[:\s]*([\d,]+)/)||[])[1]?.replace(/,/g,''))||1800;
// ì„¸ë¶€ ì¶”ì •
const simBlog=Math.round(naverVol*2.5);
const simNews=Math.round(naverVol*0.8);
const simCafe=Math.round(naverVol*0.6);
const simInsta=Math.round(naverVol*0.4);
const simFb=Math.round(naverVol*0.2);
const simNaverTotal=simBlog+simNews+simCafe;
const simSnsTotal=simInsta+simFb+simCafe;
const simTotal=simNaverTotal+googleVol*2+simInsta+simFb;

$('kwr-volume').textContent=simNaverTotal.toLocaleString();
$('kwr-volume-sub').textContent='ë¸”ë¡œê·¸ '+simBlog.toLocaleString()+' / ë‰´ìŠ¤ '+simNews.toLocaleString()+' / ì¹´í˜ '+simCafe.toLocaleString();
if($('kwr-google-vol'))$('kwr-google-vol').textContent=(googleVol*2).toLocaleString();
if($('kwr-sns-vol'))$('kwr-sns-vol').textContent=simSnsTotal.toLocaleString();
if($('kwr-sns-sub'))$('kwr-sns-sub').textContent='ì¸ìŠ¤íƒ€ '+simInsta.toLocaleString()+' / FB '+simFb.toLocaleString();
$('kwr-content-count').textContent=simTotal.toLocaleString();

renderKwrDetailBars({naverBlog:simBlog,naverNews:simNews,naverCafe:simCafe,googleTotal:googleVol*2,instaTotal:simInsta,fbTotal:simFb});

const comp=(r1.match(/ê²½ìŸê°•ë„[:\s]*(ìƒ|ì¤‘ìƒ|ì¤‘|ì¤‘í•˜|í•˜)/)||[])[1]||'ì¤‘';
const compColor=comp.includes('ìƒ')?'var(--r)':comp==='ì¤‘'?'var(--ac)':'var(--g)';
$('kwr-competition').innerHTML='<span style="color:'+compColor+'">'+comp+'</span>';
const trend=(r1.match(/íŠ¸ë Œë“œ[:\s]*(ìƒìŠ¹|ìœ ì§€|í•˜ë½)/)||[])[1]||'ìœ ì§€';
const trendPct=(r1.match(/íŠ¸ë Œë“œë³€í™”ìœ¨[:\s]*([+\-]?\d+)/)||[])[1]||'+5';
$('kwr-trend').textContent=trend;
$('kwr-trend').style.color=trend==='ìƒìŠ¹'?'var(--g)':trend==='í•˜ë½'?'var(--r)':'var(--ac)';
$('kwr-trend-sub').textContent=trendPct+'% ë³€í™”';

const naverMonths=(r1.match(/ì›”ë³„ê²€ìƒ‰ëŸ‰\(ìµœê·¼12ê°œì›”,ë„¤ì´ë²„\)[:\s]*([\d,\s]+)/)||[])[1];
const googleMonths=(r1.match(/ì›”ë³„ê²€ìƒ‰ëŸ‰\(ìµœê·¼12ê°œì›”,êµ¬ê¸€\)[:\s]*([\d,\s]+)/)||[])[1];
const nArr=naverMonths?naverMonths.split(',').map(n=>parseInt(n.trim())||0):Array.from({length:12},()=>Math.round(naverVol*(0.7+Math.random()*0.6)));
const gArr=googleMonths?googleMonths.split(',').map(n=>parseInt(n.trim())||0):Array.from({length:12},()=>Math.round(googleVol*(0.7+Math.random()*0.6)));

const months=['1ì›”','2ì›”','3ì›”','4ì›”','5ì›”','6ì›”','7ì›”','8ì›”','9ì›”','10ì›”','11ì›”','12ì›”'];
const now=new Date();const startMonth=now.getMonth()+1;
const maxVal=Math.max(...nArr,...gArr,1);
$('kwr-chart').innerHTML=nArr.map((n,i)=>{
const g=gArr[i]||0;const nH=Math.max(4,Math.round(n/maxVal*140));const gH=Math.max(4,Math.round(g/maxVal*140));
const mIdx=(startMonth-12+i+12)%12;
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div class="trend-bar-group">
<div class="trend-bar" style="height:${gH}px;background:var(--b)" title="êµ¬ê¸€ ${g.toLocaleString()}"></div>
<div class="trend-bar" style="height:${nH}px;background:var(--ac)" title="ë„¤ì´ë²„ ${n.toLocaleString()}"></div>
</div>
<div class="trend-day-label">${months[mIdx]}</div>
</div>`;}).join('');

const relLines=r1.split('\n').filter(l=>l.includes('|')&&!l.includes('ì›”ê°„')&&!l.includes('ì›”ë³„'));
const relKws=relLines.map(l=>{const p=l.split('|');if(p.length>=2){return{kw:p[0].trim().replace(/^\d+[\.\)]\s*/,''),vol:p[1].trim(),comp:p[2]?p[2].trim():'ì¤‘'};}return null;}).filter(Boolean).slice(0,10);
$('kwr-related').innerHTML=relKws.map(r=>{
const cColor=r.comp.includes('ìƒ')?'var(--r)':r.comp.includes('í•˜')?'var(--g)':'var(--ac)';
return `<div style="padding:6px 12px;background:var(--bg4);border:1px solid var(--border);border-radius:20px;cursor:pointer;display:flex;align-items:center;gap:6px" onclick="$('kwr-input').value='${r.kw.replace(/'/g,"\\'")}';searchKeyword()">
<span style="font-size:.88em;color:var(--t1);font-weight:500">${r.kw}</span>
<span style="font-size:.75em;color:var(--t3)">${r.vol}</span>
<span style="font-size:.65em;padding:1px 5px;border-radius:6px;background:${cColor}18;color:${cColor}">${r.comp}</span>
</div>`;}).join('');

// AI ì‹œë®¬ë ˆì´ì…˜ - í”Œë«í¼ ì ìœ ìœ¨ ì°¨íŠ¸
const simSummary={naverBlogTotal:naverVol*3,naverNewsTotal:Math.round(naverVol*1.2),naverCafeTotal:Math.round(naverVol*0.8),googleTotal:googleVol*2,instagramTotal:Math.round(naverVol*0.5),facebookTotal:Math.round(naverVol*0.3)};
renderKwrPlatformChart(simSummary);
renderKwrVenn(simSummary);

// ì—°ê´€ í‚¤ì›Œë“œ ìˆœìœ„ ì°¨íŠ¸
renderKwrRankingChart(relKws);

const insightPart=(r1.split('---ì¸ì‚¬ì´íŠ¸---')[1]||r1.split('\n').slice(-8).join('\n')).trim();
renderKwrInsightCards(insightPart);
$('kwr-searched-kw').textContent='"'+kw+'" (AI ì‹œë®¬ë ˆì´ì…˜)';

// AI ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸
const r2=await callAI(`"${kw}" í‚¤ì›Œë“œ ê²€ìƒ‰ ì½˜í…ì¸  ì‹œë®¬ë ˆì´ì…˜. ê¸°ì‚¬5, ë¸”ë¡œê·¸5, SNS5 ì´15ê°œ.
í˜•ì‹: íƒ€ì…(ê¸°ì‚¬/ë¸”ë¡œê·¸/SNS) | ì œëª© | ì¶œì²˜ | ì¡°íšŒìˆ˜ | ë‚ ì§œ(YYYY.MM.DD) | ìš”ì•½20ì
ìµœì‹ ìˆœ.`);
const contentLines=r2.split('\n').filter(l=>l.includes('|'));
kwrContentData=contentLines.map(line=>{const p=line.split('|').map(s=>s.trim());if(p.length>=5){const type=p[0].replace(/^\d+[\.\)]\s*/,'');return{type:type.includes('ê¸°ì‚¬')||type.includes('ë‰´ìŠ¤')?'news':type.includes('ë¸”ë¡œê·¸')?'blog':'sns',title:p[1]||'',source:p[2]||'',views:p[3]||'',date:p[4]||'',desc:p[5]||''};}return null;}).filter(Boolean);
}

$('kwr-content-count').textContent=kwrContentData.length;
kwrCurrentPlat='all';
document.querySelectorAll('#kwr-plat-pills .sub-pill').forEach(p=>p.classList.remove('a'));
document.querySelectorAll('#kwr-plat-pills .sub-pill')[0].classList.add('a');
renderKwrContent();

$('kwr-empty').style.display='none';
$('kwr-results').style.display='block';
if($('kwr-result-title'))$('kwr-result-title').textContent='"'+kw+'" ë¶„ì„ ê²°ê³¼';
if($('kwr-period-badge'))$('kwr-period-badge').textContent=kwrPeriodMonths+'ê°œì›”';
// Supabaseì— í‚¤ì›Œë“œ ë¶„ì„ ì´ë ¥ ì €ì¥
if(typeof data==='object')saveKeywordHistory(kw,data).catch(()=>{});
toast('âœ… "'+kw+'" ë¶„ì„ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}finally{
btn.disabled=false;btn.innerHTML='ğŸ” ë¶„ì„';
}}

function setKwrPlat(plat){
kwrCurrentPlat=plat;
document.querySelectorAll('#kwr-plat-pills .sub-pill').forEach(p=>p.classList.remove('a'));
event.target.classList.add('a');
renderKwrContent();
}

function renderKwrContent(){
const filtered=kwrCurrentPlat==='all'?kwrContentData:kwrContentData.filter(c=>c.type===kwrCurrentPlat);
$('kwr-list-count').textContent=filtered.length;
if(!filtered.length){$('kwr-content-list').innerHTML='<div style="text-align:center;padding:16px;color:var(--t3);font-size:.88em">ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤</div>';return}

const typeIcon={news:'ğŸ“°',blog:'ğŸ“',sns:'ğŸ“±'};
const typeLabel={news:'ê¸°ì‚¬',blog:'ë¸”ë¡œê·¸',sns:'SNS'};
const typeColor={news:'var(--b)',blog:'var(--g)',sns:'#a855f7'};

// ì¶œì²˜ë³„ ì„¸ë¶€ ë°°ì§€
function getSourceBadge(c){
const src=(c.source||'').toLowerCase();
if(src.includes('instagram')||src.includes('@'))return {icon:'ğŸ“¸',label:'ì¸ìŠ¤íƒ€ê·¸ë¨',color:'#E4405F',bg:'#E4405F18'};
if(src.includes('facebook'))return {icon:'ğŸ‘',label:'í˜ì´ìŠ¤ë¶',color:'#1877F2',bg:'#1877F218'};
if(src.includes('ì¹´í˜')||src.includes('cafe'))return {icon:'â˜•',label:'ë„¤ì´ë²„ ì¹´í˜',color:'#03C75A',bg:'#03C75A18'};
if(c.type==='blog')return {icon:'ğŸ“',label:'ë¸”ë¡œê·¸',color:'var(--g)',bg:'var(--g-bg, #03C75A18)'};
if(c.type==='news')return {icon:'ğŸ“°',label:'ë‰´ìŠ¤',color:'var(--b)',bg:'var(--b-bg, #3b82f618)'};
if(src.includes('google')||c.views?.toString().startsWith('#'))return {icon:'ğŸ”',label:'êµ¬ê¸€',color:'#4285F4',bg:'#4285F418'};
return {icon:typeIcon[c.type]||'ğŸ“„',label:typeLabel[c.type]||'ê¸°íƒ€',color:typeColor[c.type]||'var(--t2)',bg:'var(--bg4)'};
}

$('kwr-content-list').innerHTML=filtered.map((c,i)=>{
const badge=getSourceBadge(c);
const linkAttr=c.link?` onclick="window.open('${c.link}','_blank')" style="cursor:pointer"`:'';
return `<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg4);border-radius:var(--r2);margin-bottom:4px;border-left:3px solid ${badge.color}"${linkAttr}>
<span style="font-size:1.2em;flex-shrink:0">${badge.icon}</span>
<div style="flex:1;min-width:0">
<div style="display:flex;align-items:center;gap:6px;margin-bottom:2px;flex-wrap:wrap">
<span style="font-size:.65em;padding:2px 7px;border-radius:4px;background:${badge.bg};color:${badge.color};font-weight:600;white-space:nowrap">${badge.label}</span>
<span style="font-size:.75em;color:var(--t3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.source}</span>
<span style="font-size:.72em;color:var(--t3);margin-left:auto;flex-shrink:0">${c.date}</span>
</div>
<div style="font-weight:600;font-size:.88em;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.title}</div>
${c.desc?'<div style="font-size:.78em;color:var(--t3);margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">'+c.desc+'</div>':''}
</div>
${c.views?'<div style="text-align:right;flex-shrink:0"><div style="font-size:.88em;font-weight:600;color:var(--ac);font-family:var(--fm)">'+c.views+'</div></div>':''}
</div>`;
}).join('');
}

// í”Œë«í¼ë³„ ì ìœ ìœ¨ ì°¨íŠ¸ ë Œë”ë§
function renderKwrPlatformChart(summary){
const el=$('kwr-platform-chart');if(!el)return;
const platforms=[];
const colors={'ë¸”ë¡œê·¸':'#03C75A','ë‰´ìŠ¤':'#3b82f6','ì¹´í˜':'#8b5cf6','êµ¬ê¸€':'#4285F4','ì¸ìŠ¤íƒ€':'#E4405F','í˜ì´ìŠ¤ë¶':'#1877F2'};
const typeLabel={'ë¸”ë¡œê·¸':'ì½˜í…ì¸  ìˆ˜','ë‰´ìŠ¤':'ê¸°ì‚¬ ê±´ìˆ˜','ì¹´í˜':'ê²Œì‹œê¸€ ìˆ˜','êµ¬ê¸€':'ê²€ìƒ‰ ê²°ê³¼','ì¸ìŠ¤íƒ€':'ê²Œì‹œë¬¼ ìˆ˜','í˜ì´ìŠ¤ë¶':'ê²Œì‹œë¬¼ ìˆ˜'};
if(summary.naverBlogTotal)platforms.push({name:'ë¸”ë¡œê·¸',val:summary.naverBlogTotal});
if(summary.naverNewsTotal)platforms.push({name:'ë‰´ìŠ¤',val:summary.naverNewsTotal});
if(summary.naverCafeTotal)platforms.push({name:'ì¹´í˜',val:summary.naverCafeTotal});
if(summary.googleTotal)platforms.push({name:'êµ¬ê¸€',val:summary.googleTotal});
if(summary.instagramTotal)platforms.push({name:'ì¸ìŠ¤íƒ€',val:summary.instagramTotal});
if(summary.facebookTotal)platforms.push({name:'í˜ì´ìŠ¤ë¶',val:summary.facebookTotal});
if(platforms.length===0){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em">ë°ì´í„° ì—†ìŒ</div>';return;}
platforms.sort((a,b)=>b.val-a.val);
const maxVal=platforms[0].val||1;
const total=platforms.reduce((s,p)=>s+p.val,0);
// ë…¸ì¶œë„ ë ˆë²¨ ê³„ì‚°
function expoLevel(v){
const share=v/total;
if(share>=0.3)return {lv:'HIGH',cls:'high',label:'ë…¸ì¶œ â–²'};
if(share>=0.12)return {lv:'MID',cls:'mid',label:'ë³´í†µ'};
return {lv:'LOW',cls:'low',label:'ë…¸ì¶œ â–¼'};
}
el.innerHTML=platforms.map((p,i)=>{
const pct=Math.max(5,Math.round(p.val/maxVal*100));
const c=colors[p.name]||'var(--ac)';
const expo=expoLevel(p.val);
const rank=i===0?'ğŸ‘‘ ':'';
const share=Math.round(p.val/total*100);
const fmtVal=p.val>=10000?(p.val/10000).toFixed(1)+'ë§Œ':p.val.toLocaleString();
return `<div class="kwr-bar-row" style="margin-bottom:12px">
<div class="kwr-bar-label">${rank}${p.name}</div>
<div style="flex:1">
<div class="kwr-bar-track"><div class="kwr-bar-fill" style="width:${pct}%;background:${c}">${share}%</div></div>
<div style="display:flex;align-items:center;gap:6px;margin-top:3px">
<span style="font-size:.62em;color:var(--t3)">${typeLabel[p.name]||'ê±´ìˆ˜'}</span>
<span class="expo-badge ${expo.cls}">${expo.label}</span>
</div>
</div>
<div class="kwr-bar-val">${fmtVal}</div>
</div>`;
}).join('');
}

// ì—°ê´€ í‚¤ì›Œë“œ ê²€ìƒ‰ëŸ‰ TOP ì°¨íŠ¸ ë Œë”ë§
function renderKwrRankingChart(relKws){
const el=$('kwr-ranking-chart');if(!el)return;
if(!relKws||relKws.length===0){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em">ë°ì´í„° ì—†ìŒ</div>';return;}
// ìƒìœ„ 8ê°œë§Œ í‘œì‹œ
const top=relKws.slice(0,8);
const barColors=['#f97316','#fb923c','#fbbf24','#34d399','#60a5fa','#a78bfa','#f472b6','#94a3b8'];
// ë³¼ë¥¨ íŒŒì‹±
const parsed=top.map(r=>{
const kw=typeof r==='string'?r:r.kw||r;
const volStr=typeof r==='object'?(r.vol||''):'';
const vol=parseInt(String(volStr).replace(/[^0-9]/g,''))||0;
return {kw,vol};
});
const maxVol=Math.max(...parsed.map(p=>p.vol),1);
// ë³¼ë¥¨ì´ ëª¨ë‘ 0ì´ë©´ ê· ë“± ë°°ë¶„
const allZero=parsed.every(p=>p.vol===0);
el.innerHTML=parsed.map((p,i)=>{
const pct=allZero?Math.max(20,80-i*8):Math.max(8,Math.round(p.vol/maxVol*100));
const c=barColors[i%barColors.length];
return `<div class="kwr-bar-row" style="cursor:pointer" onclick="$('kwr-input').value='${p.kw.replace(/'/g,"\\'")}';searchKeyword()">
<div class="kwr-bar-label" title="${p.kw}">${p.kw}</div>
<div class="kwr-bar-track"><div class="kwr-bar-fill" style="width:${pct}%;background:${c}">${p.vol>0?'':''}</div></div>
<div class="kwr-bar-val">${p.vol>0?p.vol.toLocaleString():'â€”'}</div>
</div>`;
}).join('');
}

// PDF ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
async function downloadKwrPDF(){
const btn=$('kwr-pdf-btn');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>PDF ìƒì„± ì¤‘...';

try{
if(!window.jspdf){toast('âŒ PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© ì¤‘... ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”');btn.disabled=false;btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> PDF';return;}
const {jsPDF}=window.jspdf;
const doc=new jsPDF('p','mm','a4');
const W=210,H=297,M=16; // A4 width, height, margin
let y=M;

// â€” ìƒ‰ìƒ íŒ”ë ˆíŠ¸ â€”
const cBg=[15,16,22];
const cCard=[26,26,42];
const cAc=[249,115,22];
const cW=[240,241,245];
const cGray=[140,142,160];
const cGreen=[52,211,153];
const cBlue=[96,165,250];

// â€” ìœ í‹¸ í•¨ìˆ˜ â€”
function addPage(){doc.addPage();y=M;drawBg();}
function checkPage(need){if(y+need>H-M){addPage();return true;}return false;}
function drawBg(){doc.setFillColor(...cBg);doc.rect(0,0,W,H,'F');}
function drawCard(x,cy,w,h,r){
doc.setFillColor(...cCard);doc.roundedRect(x,cy,w,h,r||3,r||3,'F');
doc.setDrawColor(60,60,80);doc.setLineWidth(0.2);doc.roundedRect(x,cy,w,h,r||3,r||3,'S');
}
function textW(txt,size){doc.setFontSize(size);return doc.getTextWidth(txt);}

// â€” í˜ì´ì§€ ë°°ê²½ â€”
drawBg();

// â€” í—¤ë” â€”
doc.setFillColor(...cAc);doc.roundedRect(M,y,6,6,1.5,1.5,'F');
doc.setTextColor(...cW);doc.setFontSize(18);doc.text('SNS Content Engine',M+10,y+5);
doc.setFontSize(8);doc.setTextColor(...cGray);doc.text('AI Keyword Analysis Report',M+10,y+10);
const today=new Date().toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});
doc.text(today,W-M,y+5,{align:'right'});
y+=18;

// â€” êµ¬ë¶„ì„  â€”
const grd=doc.setDrawColor(...cAc);doc.setLineWidth(0.5);
doc.line(M,y,W-M,y);y+=6;

// â€” í‚¤ì›Œë“œ ì œëª© â€”
const kw=$('kwr-input').value||'í‚¤ì›Œë“œ';
doc.setTextColor(...cAc);doc.setFontSize(22);doc.text('"'+kw+'"',M,y+6);
doc.setTextColor(...cGray);doc.setFontSize(9);doc.text('Keyword Analysis Report Â· '+($('kwr-period-badge')?.textContent||'12ê°œì›”'),M,y+12);
y+=20;

// â€” í•µì‹¬ ì§€í‘œ 4ê°œ ì¹´ë“œ â€”
const metrics=[
{label:'ì›”ê°„ ê²€ìƒ‰ëŸ‰',val:$('kwr-volume')?.textContent||'â€”',sub:$('kwr-volume-sub')?.textContent||'',color:cAc},
{label:'ê²½ìŸ ê°•ë„',val:$('kwr-competition')?.textContent||'â€”',sub:$('kwr-comp-sub')?.textContent||'',color:[248,113,113]},
{label:'ì½˜í…ì¸  ìˆ˜',val:$('kwr-content-count')?.textContent||'â€”',sub:'ë¸”ë¡œê·¸+ê¸°ì‚¬+SNS',color:cBlue},
{label:'íŠ¸ë Œë“œ',val:$('kwr-trend')?.textContent||'â€”',sub:$('kwr-trend-sub')?.textContent||'',color:cGreen}
];
const cardW=(W-M*2-6*3)/4;
metrics.forEach((m,i)=>{
const cx=M+i*(cardW+6);
drawCard(cx,y,cardW,28,3);
doc.setFontSize(7);doc.setTextColor(...cGray);doc.text(m.label,cx+4,y+7);
doc.setFontSize(16);doc.setTextColor(...m.color);doc.text(String(m.val),cx+4,y+18);
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text(m.sub,cx+4,y+24);
});
y+=36;

// â€” ì›”ë³„ ê²€ìƒ‰ëŸ‰ ì¶”ì´ ì°¨íŠ¸ (ìˆ˜ë™ ë°” ì°¨íŠ¸) â€”
checkPage(65);
drawCard(M,y,W-M*2,58,3);
doc.setFontSize(10);doc.setTextColor(...cW);doc.text('ğŸ“ˆ ì›”ë³„ ê²€ìƒ‰ëŸ‰ ì¶”ì´ (12ê°œì›”)',M+6,y+9);

const chartEl=$('kwr-chart');
if(chartEl){
const bars=chartEl.querySelectorAll('.trend-bar-group');
if(bars.length>0){
const chartX=M+8,chartY=y+16,chartW=W-M*2-16,chartH=32;
const barW=chartW/bars.length-2;
// ëª¨ë“  ë°”ì˜ ë†’ì´ë¥¼ ì½ì–´ì„œ ìµœëŒ€ê°’ ê³„ì‚°
let maxBarH=1;
bars.forEach(g=>{
const bb=g.querySelectorAll('.trend-bar');
bb.forEach(b=>{const h=parseInt(b.style.height)||0;if(h>maxBarH)maxBarH=h;});
});
bars.forEach((g,i)=>{
const bb=g.querySelectorAll('.trend-bar');
const bx=chartX+i*(barW+2);
// ë„¤ì´ë²„ ë°” (ì˜¤ë Œì§€)
if(bb.length>=2){
const nH=Math.max(2,parseInt(bb[1]?.style.height||0)/maxBarH*chartH);
doc.setFillColor(...cAc);doc.roundedRect(bx,chartY+chartH-nH,barW/2-1,nH,1,1,'F');
// êµ¬ê¸€ ë°” (ë¸”ë£¨)
const gH=Math.max(2,parseInt(bb[0]?.style.height||0)/maxBarH*chartH);
doc.setFillColor(...cBlue);doc.roundedRect(bx+barW/2,chartY+chartH-gH,barW/2-1,gH,1,1,'F');
}else if(bb.length===1){
const nH=Math.max(2,parseInt(bb[0]?.style.height||0)/maxBarH*chartH);
doc.setFillColor(...cAc);doc.roundedRect(bx,chartY+chartH-nH,barW-1,nH,1,1,'F');
}
// ì›” ë ˆì´ë¸”
const label=g.parentElement?.querySelector('.trend-day-label')?.textContent||'';
if(label){doc.setFontSize(5);doc.setTextColor(...cGray);doc.text(label,bx+barW/2,chartY+chartH+4,{align:'center'});}
});
// ë²”ë¡€
doc.setFillColor(...cAc);doc.rect(M+8,y+53,4,2.5,'F');
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text('ë„¤ì´ë²„',M+14,y+55);
doc.setFillColor(...cBlue);doc.rect(M+30,y+53,4,2.5,'F');
doc.text('êµ¬ê¸€',M+36,y+55);
}
}
y+=66;

// â€” í”Œë«í¼ë³„ ì ìœ ìœ¨ â€”
checkPage(55);
drawCard(M,y,W/2-M-3,48,3);
doc.setFontSize(9);doc.setTextColor(...cW);doc.text('ğŸ† í”Œë«í¼ë³„ ì½˜í…ì¸  ì ìœ ìœ¨',M+5,y+9);

const platChartEl=$('kwr-platform-chart');
if(platChartEl){
const pRows=platChartEl.querySelectorAll('.kwr-bar-row');
const platBarY=y+14;
pRows.forEach((row,i)=>{
if(i>5)return;
const label=row.querySelector('.kwr-bar-label')?.textContent?.trim()||'';
const val=row.querySelector('.kwr-bar-val')?.textContent?.trim()||'';
const fill=row.querySelector('.kwr-bar-fill');
const pct=fill?parseInt(fill.style.width)||10:10;
const ry=platBarY+i*5.5;
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text(label,M+5,ry+3);
// bar bg
doc.setFillColor(40,40,55);doc.roundedRect(M+25,ry,65,4,1.5,1.5,'F');
// bar fill
const fillColor=fill?.style.background||'#f97316';
const rgb=hexToRgb(fillColor);
doc.setFillColor(rgb[0],rgb[1],rgb[2]);doc.roundedRect(M+25,ry,Math.max(3,pct*0.65),4,1.5,1.5,'F');
doc.setFontSize(5.5);doc.setTextColor(...cW);doc.text(val,M+93,ry+3,{align:'right'});
});
}

// â€” ì—°ê´€ í‚¤ì›Œë“œ TOP â€”
const rightX=W/2+3;
drawCard(rightX,y,W/2-M-3,48,3);
doc.setFontSize(9);doc.setTextColor(...cW);doc.text('ğŸ”¥ ì—°ê´€ í‚¤ì›Œë“œ ê²€ìƒ‰ëŸ‰ TOP',rightX+5,y+9);

const rankChartEl=$('kwr-ranking-chart');
if(rankChartEl){
const rRows=rankChartEl.querySelectorAll('.kwr-bar-row');
const rankBarY=y+14;
const rankColors=[[249,115,22],[251,146,60],[251,191,36],[52,211,153],[96,165,250],[167,139,250],[244,114,182],[148,163,184]];
rRows.forEach((row,i)=>{
if(i>6)return;
const label=row.querySelector('.kwr-bar-label')?.textContent?.trim()||'';
const val=row.querySelector('.kwr-bar-val')?.textContent?.trim()||'';
const fill=row.querySelector('.kwr-bar-fill');
const pct=fill?parseInt(fill.style.width)||10:10;
const ry=rankBarY+i*5.5;
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text(label.substring(0,8),rightX+5,ry+3);
doc.setFillColor(40,40,55);doc.roundedRect(rightX+25,ry,60,4,1.5,1.5,'F');
const rc=rankColors[i%rankColors.length];
doc.setFillColor(rc[0],rc[1],rc[2]);doc.roundedRect(rightX+25,ry,Math.max(3,pct*0.6),4,1.5,1.5,'F');
doc.setFontSize(5.5);doc.setTextColor(...cW);doc.text(val,rightX+88,ry+3,{align:'right'});
});
}
y+=56;

// â€” ë²¤ ë‹¤ì´ì–´ê·¸ë¨ (PDF) â€”
checkPage(70);
drawCard(M,y,W-M*2,62,3);
doc.setFontSize(10);doc.setTextColor(...cW);doc.text('ğŸ”€ í”Œë«í¼ êµì°¨ ë¶„ì„',M+6,y+9);
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text('ë¶„ì„ ê¸°ê°„: '+($('kwr-period-badge')?.textContent||'12ê°œì›”'),W-M-6,y+9,{align:'right'});

// 3ê°œ ì› ê·¸ë¦¬ê¸°
const vCx=W/2,vCy=y+37,vSpread=22,vR=18;
const vCircles=[
{x:vCx-vSpread,y:vCy-vSpread*0.35,color:[3,199,90],label:'ë¸”ë¡œê·¸'},
{x:vCx+vSpread,y:vCy-vSpread*0.35,color:[59,130,246],label:'ë‰´ìŠ¤'},
{x:vCx,y:vCy+vSpread*0.55,color:[168,85,247],label:'SNS'}
];
vCircles.forEach(c=>{
// ê°€ë³ê²Œ ì°©ìƒ‰ (GState ëŒ€ì‹  ë°ì€ ìƒ‰ ì‚¬ìš©)
doc.setFillColor(Math.min(c.color[0]+200,255),Math.min(c.color[1]+200,255),Math.min(c.color[2]+200,255));
doc.circle(c.x,c.y,vR,'F');
doc.setDrawColor(c.color[0],c.color[1],c.color[2]);doc.setLineWidth(0.5);doc.circle(c.x,c.y,vR,'S');
doc.setFontSize(7);doc.setTextColor(c.color[0],c.color[1],c.color[2]);
const ly=c===vCircles[2]?c.y+vR+5:c.y-vR-3;
doc.text(c.label,c.x,ly,{align:'center'});
});
// ì¤‘ì•™ êµì°¨ í‘œì‹œ
doc.setFontSize(7);doc.setTextColor(...cAc);doc.text('êµì°¨',vCx,vCy-1,{align:'center'});
doc.setFontSize(5);doc.setTextColor(...cGray);doc.text('ì½˜í…ì¸ ',vCx,vCy+3,{align:'center'});

// í”Œë«í¼ ê°’ (ìš°ì¸¡)
const platChartEl2=$('kwr-platform-chart');
if(platChartEl2){
const pRows2=platChartEl2.querySelectorAll('.kwr-bar-row');
let piy=y+16;
doc.setFontSize(7);doc.setTextColor(...cGray);doc.text('í”Œë«í¼ë³„ ë¶„í¬',W-M-45,piy);piy+=5;
pRows2.forEach((row,i)=>{
if(i>4)return;
const label=row.querySelector('.kwr-bar-label')?.textContent?.trim()||'';
const val=row.querySelector('.kwr-bar-val')?.textContent?.trim()||'';
doc.setFontSize(6);doc.setTextColor(...cGray);doc.text(label.replace('ğŸ‘‘',''),W-M-45,piy);
doc.setTextColor(...cW);doc.text(val,W-M-6,piy,{align:'right'});
piy+=4.5;
});
}
y+=68;

// â€” ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” â€”
checkPage(40);
doc.setFontSize(10);doc.setTextColor(...cW);doc.text('ğŸ“‘ ê´€ë ¨ ì½˜í…ì¸  ('+($('kwr-list-count')?.textContent||'0')+'ê±´)',M,y+6);
y+=10;

if(kwrContentData&&kwrContentData.length>0){
const tableData=kwrContentData.slice(0,15).map((c,i)=>{
const typeLabel={news:'ê¸°ì‚¬',blog:'ë¸”ë¡œê·¸',sns:'SNS'};
return [String(i+1),typeLabel[c.type]||c.type,c.title?.substring(0,30)||'',c.source?.substring(0,12)||'',c.date||'',c.views||''];
});
doc.autoTable({
startY:y,
margin:{left:M,right:M},
head:[['#','ìœ í˜•','ì œëª©','ì¶œì²˜','ë‚ ì§œ','ì¡°íšŒ']],
body:tableData,
styles:{fontSize:6,cellPadding:2.5,textColor:cW,fillColor:cCard,lineColor:[50,50,70],lineWidth:0.15,font:'helvetica'},
headStyles:{fillColor:[cAc[0],cAc[1],cAc[2]],textColor:[255,255,255],fontSize:6.5,fontStyle:'bold'},
alternateRowStyles:{fillColor:[20,20,35]},
columnStyles:{0:{cellWidth:8},1:{cellWidth:14},2:{cellWidth:65},3:{cellWidth:28},4:{cellWidth:22},5:{cellWidth:18}}
});
y=doc.lastAutoTable.finalY+8;
}

// â€” ì—°ê´€ í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ â€”
checkPage(30);
doc.setFontSize(10);doc.setTextColor(...cW);doc.text('ğŸ”— ì—°ê´€ í‚¤ì›Œë“œ',M,y+6);
y+=10;

const relEl=$('kwr-related');
if(relEl){
const chips=relEl.querySelectorAll('div[style*="border-radius"]');
if(chips.length>0){
const relData=[];
chips.forEach((c,i)=>{
const spans=c.querySelectorAll('span');
const kwName=spans[0]?.textContent||'';
const vol=spans[1]?.textContent||'';
const comp=spans[2]?.textContent||'';
relData.push([String(i+1),kwName,vol,comp]);
});
doc.autoTable({
startY:y,
margin:{left:M,right:M},
head:[['#','í‚¤ì›Œë“œ','ê²€ìƒ‰ëŸ‰','ê²½ìŸë„']],
body:relData.slice(0,10),
styles:{fontSize:6.5,cellPadding:2.5,textColor:cW,fillColor:cCard,lineColor:[50,50,70],lineWidth:0.15},
headStyles:{fillColor:[cAc[0],cAc[1],cAc[2]],textColor:[255,255,255],fontSize:7,fontStyle:'bold'},
alternateRowStyles:{fillColor:[20,20,35]},
columnStyles:{0:{cellWidth:10},1:{cellWidth:60},2:{cellWidth:40},3:{cellWidth:30}}
});
y=doc.lastAutoTable.finalY+8;
}
}

// â€” AI ì¸ì‚¬ì´íŠ¸ â€”
const insightText=$('kwr-insight')?.textContent||'';
if(insightText&&insightText!=='AI ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘...'){
checkPage(40);
drawCard(M,y,W-M*2,4,3);// will resize
doc.setFontSize(9);doc.setTextColor(...cAc);doc.text('ğŸ’¡ AI í‚¤ì›Œë“œ ì¸ì‚¬ì´íŠ¸',M+5,y+8);
const lines=doc.setFontSize(7).setTextColor(...cW).splitTextToSize(insightText,W-M*2-12);
const boxH=Math.min(lines.length*4+14,80);
drawCard(M,y,W-M*2,boxH,3);
doc.setFontSize(9);doc.setTextColor(...cAc);doc.text('ğŸ’¡ AI í‚¤ì›Œë“œ ì¸ì‚¬ì´íŠ¸',M+5,y+8);
doc.setFontSize(7);doc.setTextColor(200,200,215);
doc.text(lines,M+6,y+14);
y+=boxH+6;
}

// â€” í‘¸í„° â€”
const totalPages=doc.internal.getNumberOfPages();
for(let i=1;i<=totalPages;i++){
doc.setPage(i);
doc.setFontSize(6);doc.setTextColor(...cGray);
doc.text('SNS Content Engine â€” AI Keyword Report',M,H-8);
doc.text('Page '+i+' / '+totalPages,W-M,H-8,{align:'right'});
doc.setDrawColor(60,60,80);doc.setLineWidth(0.15);doc.line(M,H-12,W-M,H-12);
}

// â€” ë‹¤ìš´ë¡œë“œ â€”
const filename='keyword-report-'+kw.replace(/[^a-zA-Z0-9ê°€-í£]/g,'_')+'-'+new Date().toISOString().slice(0,10)+'.pdf';
doc.save(filename);
toast('âœ… PDF ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');

}catch(e){
console.error('PDF generation error:',e);
toast('âŒ PDF ìƒì„± ì‹¤íŒ¨: '+e.message);
}finally{
btn.disabled=false;
btn.innerHTML='<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> PDF';
}
}

// hex to rgb helper
function hexToRgb(hex){
if(hex.startsWith('rgb')){const m=hex.match(/\d+/g);return m?m.map(Number):[249,115,22];}
hex=hex.replace('#','');
if(hex.length===3)hex=hex.split('').map(c=>c+c).join('');
const r=parseInt(hex.substring(0,2),16)||200;
const g=parseInt(hex.substring(2,4),16)||120;
const b=parseInt(hex.substring(4,6),16)||50;
return [r,g,b];
}

// ===== ê¸°ê°„ ì„¤ì • =====
let kwrPeriodMonths=12;
let kwrDateFrom='';
let kwrDateTo='';

function setKwrPeriod(months,btn){
kwrPeriodMonths=months;
kwrDateFrom='';kwrDateTo='';
document.querySelectorAll('.kwr-period-pill').forEach(p=>p.classList.remove('active'));
if(btn)btn.classList.add('active');
$('kwr-date-from').value='';$('kwr-date-to').value='';
if($('kwr-period-badge'))$('kwr-period-badge').textContent=months+'ê°œì›”';
// ë‚ ì§œ ìë™ ì„¤ì •
const to=new Date();
const from=new Date();from.setMonth(from.getMonth()-months);
$('kwr-date-from').value=from.toISOString().slice(0,10);
$('kwr-date-to').value=to.toISOString().slice(0,10);
}

function setKwrCustomPeriod(){
const from=$('kwr-date-from').value;
const to=$('kwr-date-to').value;
if(from&&to){
kwrDateFrom=from;kwrDateTo=to;
document.querySelectorAll('.kwr-period-pill').forEach(p=>p.classList.remove('active'));
// ê³„ì‚°ëœ ê°œì›” ìˆ˜ í‘œì‹œ
const d1=new Date(from),d2=new Date(to);
const diffM=Math.round((d2-d1)/(1000*60*60*24*30));
kwrPeriodMonths=Math.max(1,diffM);
if($('kwr-period-badge'))$('kwr-period-badge').textContent=diffM+'ê°œì›” (ì»¤ìŠ¤í…€)';
}
}

// ì´ˆê¸° ë‚ ì§œ ì„¸íŒ…
(function initKwrDates(){
const to=new Date();const from=new Date();from.setMonth(from.getMonth()-12);
if($('kwr-date-from'))$('kwr-date-from').value=from.toISOString().slice(0,10);
if($('kwr-date-to'))$('kwr-date-to').value=to.toISOString().slice(0,10);
})();

// ===== í”Œë«í¼ë³„ ì„¸ë¶€ í”„ë¡œê·¸ë ˆìŠ¤ ë°” =====
function renderKwrDetailBars(d){
const el=$('kwr-detail-bars');if(!el)return;
const platforms=[
{name:'ë„¤ì´ë²„ ë¸”ë¡œê·¸',val:d.naverBlog||0,color:'#03C75A',icon:'ğŸ“'},
{name:'ë„¤ì´ë²„ ë‰´ìŠ¤',val:d.naverNews||0,color:'#1EC800',icon:'ğŸ“°'},
{name:'ë„¤ì´ë²„ ì¹´í˜',val:d.naverCafe||0,color:'#19CE60',icon:'â˜•'},
{name:'êµ¬ê¸€ ê²€ìƒ‰',val:d.googleTotal||0,color:'#4285F4',icon:'ğŸ”'},
{name:'ì¸ìŠ¤íƒ€ê·¸ë¨',val:d.instaTotal||0,color:'#E4405F',icon:'ğŸ“·'},
{name:'í˜ì´ìŠ¤ë¶',val:d.fbTotal||0,color:'#1877F2',icon:'ğŸ‘'}
];
const maxVal=Math.max(...platforms.map(p=>p.val),1);
const total=platforms.reduce((s,p)=>s+p.val,0)||1;

el.innerHTML=platforms.map(p=>{
const pct=Math.max(3,Math.round(p.val/maxVal*100));
const share=((p.val/total)*100).toFixed(1);
const fmtVal=p.val>=10000?(p.val/10000).toFixed(1)+'ë§Œ':p.val.toLocaleString();
return '<div style="display:flex;align-items:center;gap:8px;padding:5px 0">'+
'<div style="width:100px;font-size:.78em;color:var(--t2);display:flex;align-items:center;gap:4px;flex-shrink:0">'+
'<span style="font-size:.9em">'+p.icon+'</span>'+p.name+'</div>'+
'<div style="flex:1;height:22px;background:var(--bg3);border-radius:11px;overflow:hidden;position:relative">'+
'<div style="height:100%;width:'+pct+'%;background:'+p.color+';border-radius:11px;transition:width .8s ease;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;min-width:40px">'+
'<span style="font-size:.65em;color:#fff;font-weight:700">'+share+'%</span>'+
'</div></div>'+
'<div style="width:65px;font-size:.78em;font-weight:600;color:var(--t1);text-align:right;font-family:var(--fm)">'+fmtVal+'ê±´</div>'+
'</div>';
}).join('')+
'<div style="display:flex;justify-content:space-between;margin-top:6px;padding-top:6px;border-top:1px solid var(--border)">'+
'<span style="font-size:.75em;color:var(--t3)">ì „ì²´ ì½˜í…ì¸ </span>'+
'<span style="font-size:.78em;font-weight:700;color:var(--ac);font-family:var(--fm)">'+(total>=10000?(total/10000).toFixed(1)+'ë§Œ':total.toLocaleString())+'ê±´</span></div>';
}

// ===== ë²¤ ë‹¤ì´ì–´ê·¸ë¨ =====
function renderKwrVenn(summary){
const el=$('kwr-venn-container');if(!el)return;
const blog=summary.naverBlogTotal||0,news=summary.naverNewsTotal||0;
const cafe=summary.naverCafeTotal||0,insta=summary.instagramTotal||0;
const fb=summary.facebookTotal||0,google=summary.googleTotal||0;
const sns=insta+fb+cafe;

const blogNewsOv=Math.round(Math.min(blog,news)*0.15);
const blogSnsOv=Math.round(Math.min(blog,sns)*0.1);
const newsSnsOv=Math.round(Math.min(news,sns)*0.08);
const allOv=Math.round(Math.min(blog,news,sns)*0.03);

// ë¡œê·¸ ìŠ¤ì¼€ì¼ (ìµœì†Œ28 ìµœëŒ€50)
const vals=[blog,news,sns];
const logV=vals.map(v=>Math.log10(Math.max(v,1)+1));
const lMax=Math.max(...logV,1),lMin=Math.min(...logV);
function lR(v){const l=Math.log10(Math.max(v,1)+1);const r=lMax===lMin?0.5:(l-lMin)/(lMax-lMin);return Math.round(28+22*r);}
const fmt=v=>v>=10000?(v/10000).toFixed(1)+'ë§Œ':v>=1000?(v/1000).toFixed(1)+'ì²œ':v.toLocaleString();

const W=440,H=270;
const cs=[{cx:160,cy:100,r:lR(blog),c:'#03C75A',n:'ë¸”ë¡œê·¸',v:blog},{cx:280,cy:100,r:lR(news),c:'#3b82f6',n:'ë‰´ìŠ¤',v:news},{cx:220,cy:175,r:lR(sns),c:'#a855f7',n:'SNS',v:sns}];
let svg='<svg viewBox="0 0 '+W+' '+H+'" style="width:100%;max-height:270px" xmlns="http://www.w3.org/2000/svg">';
cs.forEach(c=>{
svg+='<circle cx="'+c.cx+'" cy="'+c.cy+'" r="'+c.r+'" fill="'+c.c+'" opacity="0.2" stroke="'+c.c+'" stroke-width="1.5" stroke-opacity="0.5"/>';
svg+='<circle cx="'+c.cx+'" cy="'+c.cy+'" r="'+c.r+'" fill="none" stroke="'+c.c+'" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>';
});
cs.forEach((c,i)=>{
const ly=i<2?c.cy-c.r-12:c.cy+c.r+15;
svg+='<text x="'+c.cx+'" y="'+ly+'" text-anchor="middle" fill="'+c.c+'" font-size="12" font-weight="700" font-family="Pretendard,sans-serif">'+c.n+'</text>';
svg+='<text x="'+c.cx+'" y="'+(ly+13)+'" text-anchor="middle" fill="#a8aab5" font-size="9" font-family="Pretendard,sans-serif">'+fmt(c.v)+'ê±´</text>';
});
const ov=[[0,1,blogNewsOv,'ë¸”ë¡œê·¸âˆ©ë‰´ìŠ¤'],[0,2,blogSnsOv,'ë¸”ë¡œê·¸âˆ©SNS'],[1,2,newsSnsOv,'ë‰´ìŠ¤âˆ©SNS']];
ov.forEach(o=>{
const ox=(cs[o[0]].cx+cs[o[1]].cx)/2+(o[0]===0&&o[1]===2?-10:o[0]===1?10:0);
const oy=(cs[o[0]].cy+cs[o[1]].cy)/2+(o[1]===2?4:0);
svg+='<text x="'+ox+'" y="'+(oy-2)+'" text-anchor="middle" fill="#f97316" font-size="9" font-weight="700" font-family="Pretendard,sans-serif">'+fmt(o[2])+'</text>';
svg+='<text x="'+ox+'" y="'+(oy+8)+'" text-anchor="middle" fill="#5a5b6a" font-size="6.5" font-family="Pretendard,sans-serif">'+o[3]+'</text>';
});
svg+='<text x="220" y="132" text-anchor="middle" fill="#f97316" font-size="11" font-weight="800" font-family="Pretendard,sans-serif">'+fmt(allOv)+'</text>';
svg+='<text x="220" y="143" text-anchor="middle" fill="#f97316" font-size="7" font-family="Pretendard,sans-serif">ì „ì²´ êµì°¨</text>';
// ì„¸ë¶€í‘œ
svg+='<rect x="348" y="85" width="88" height="96" rx="6" fill="#12121a" stroke="#282936" stroke-width="0.5"/>';
svg+='<text x="357" y="100" fill="#a8aab5" font-size="7.5" font-weight="600" font-family="Pretendard,sans-serif">ì„¸ë¶€ ë¶„í¬</text>';
[{n:'ì¹´í˜',v:cafe,c:'#03C75A'},{n:'ì¸ìŠ¤íƒ€',v:insta,c:'#E4405F'},{n:'í˜ì´ìŠ¤ë¶',v:fb,c:'#1877F2'},{n:'êµ¬ê¸€',v:google,c:'#4285F4'}].forEach((d,i)=>{
const dy=112+i*17;
svg+='<circle cx="356" cy="'+dy+'" r="3" fill="'+d.c+'"/>';
svg+='<text x="364" y="'+(dy+3)+'" fill="#a8aab5" font-size="7.5" font-family="Pretendard,sans-serif">'+d.n+'</text>';
svg+='<text x="431" y="'+(dy+3)+'" text-anchor="end" fill="#f0f1f5" font-size="7.5" font-weight="600" font-family="Pretendard,sans-serif">'+fmt(d.v)+'</text>';
});
svg+='</svg>';
el.innerHTML=svg+'<div class="venn-legend"><div class="venn-legend-item"><div class="venn-legend-dot" style="background:#03C75A"></div>ë¸”ë¡œê·¸</div><div class="venn-legend-item"><div class="venn-legend-dot" style="background:#3b82f6"></div>ë‰´ìŠ¤</div><div class="venn-legend-item"><div class="venn-legend-dot" style="background:#a855f7"></div>SNS</div><div class="venn-legend-item"><div class="venn-legend-dot" style="background:#f97316"></div>êµì°¨</div></div>';
}

// ===== ê³µí†µ AI í…ìŠ¤íŠ¸ â†’ ì„¹ì…˜ íŒŒì„œ (ë§ˆí¬ë‹¤ìš´ ì§€ì›) =====
function parseAiSections(text){
if(!text)return[];
const lines=text.split('\n');
const sections=[];
let cur=null;

// ë§ˆí¬ë‹¤ìš´/ë³¼ë“œ ì œê±° ìœ í‹¸
const stripMd=s=>s.replace(/^#+\s*/,'').replace(/\*\*/g,'').replace(/^[-â€¢]\s*/,'').replace(/^\d+[\.\)]\s*/,'').replace(/^[ğŸ†ğŸ“ŠğŸ¯âš ï¸ğŸ’¡ğŸš€âš¡ğŸ“ˆğŸ“ŒğŸ”‘ğŸ”ğŸ“…âœ…âŒ]+\s*/g,'').trim();

lines.forEach(line=>{
const t=line.trim();
if(!t)return;

// ì„¹ì…˜ êµ¬ë¶„ì ê°ì§€: ## / ### / 1) / 1. ë¡œ ì‹œì‘
const isHeader=
/^#{1,4}\s+/.test(t)||                           // ## Title, ### Title
/^\d+[\.\)]\s*.{2,}/.test(t)||                   // 1) Title, 1. Title
/^#{1,4}\s+\d+[\.\)]\s*/.test(t);                // ### 1) Title

if(isHeader){
if(cur&&(cur.lines.length>0||cur.bullets.length>0))sections.push(cur);
cur={title:stripMd(t),lines:[],bullets:[]};
}else if(cur){
// ë¶ˆë¦¿ ì•„ì´í…œ
if(/^[-â€¢]\s/.test(t)||/^\*\*/.test(t)){
cur.bullets.push(stripMd(t));
}else{
cur.lines.push(t.replace(/\*\*/g,''));
}
}else{
// ì²« ì¤„ì´ í—¤ë” ì•„ë‹Œ ê²½ìš°
if(/^[-â€¢]\s/.test(t)||/^\*\*/.test(t)){
if(!cur)cur={title:'ë¶„ì„ ìš”ì•½',lines:[],bullets:[]};
cur.bullets.push(stripMd(t));
}else{
cur={title:stripMd(t),lines:[],bullets:[]};
}
}
});
if(cur&&(cur.lines.length>0||cur.bullets.length>0||sections.length===0))sections.push(cur);

// ë¹ˆ ì œëª© ì„¹ì…˜ ë³´ê°•
sections.forEach((s,i)=>{
if(!s.title){
const defaultTitles=['ë¶„ì„ ê²°ê³¼','ì„¸ë¶€ ë¶„ì„','ì „ëµ ì œì•ˆ','ì¶”ê°€ ë¶„ì„','ì°¸ê³ ì‚¬í•­'];
s.title=defaultTitles[i%defaultTitles.length];
}
});
return sections;
}

// AI ì„¹ì…˜ â†’ ì¹´ë“œ HTML ë Œë”ë§
function renderAiCards(sections,gridCols){
const icons=['ğŸ¯','ğŸ’¡','ğŸ”‘','ğŸ“Š','ğŸš€','âš¡','ğŸ†','ğŸ“ˆ','ğŸ”','ğŸ“…'];
const colors=['#f97316','#3b82f6','#34d399','#a78bfa','#ec4899','#fbbf24','#14b8a6','#f87171','#8b5cf6','#06b6d4'];

if(!sections||sections.length===0)return '<div style="text-align:center;padding:16px;color:var(--t3)">ë¶„ì„ ê²°ê³¼ ì—†ìŒ</div>';

return '<div style="display:grid;grid-template-columns:repeat('+(gridCols||2)+',1fr);gap:10px">'+
sections.map((s,i)=>{
const ic=icons[i%icons.length],c=colors[i%colors.length];
const bodyParts=[];
if(s.lines.length)bodyParts.push(s.lines.join(' '));
if(s.bullets.length)bodyParts.push(s.bullets.map(b=>'<div style="display:flex;gap:6px;margin-top:3px"><span style="color:'+c+';flex-shrink:0">â–¸</span><span>'+b+'</span></div>').join(''));
const body=bodyParts.join('')||'â€”';

return '<div style="background:var(--bg4);border-radius:var(--r2);padding:14px 16px;border-left:3px solid '+c+';transition:all .3s">'+
'<div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">'+
'<span style="font-size:1.2em;width:28px;height:28px;border-radius:8px;background:'+c+'18;display:flex;align-items:center;justify-content:center;flex-shrink:0">'+ic+'</span>'+
'<span style="font-size:.82em;font-weight:700;color:'+c+'">'+s.title+'</span></div>'+
'<div style="font-size:.8em;color:var(--t2);line-height:1.6">'+body+'</div></div>';
}).join('')+'</div>';
}

// ===== AI ì¸ì‚¬ì´íŠ¸ â†’ ì¹´ë“œí˜• ì‹œê°í™” =====
function renderKwrInsightCards(text){
const el=$('kwr-insight-cards');if(!el)return;
if(!text||text==='AI ì¸ì‚¬ì´íŠ¸ ë¶„ì„ ì¤‘...'){
el.innerHTML='<div style="text-align:center;padding:16px;color:var(--t3);font-size:.85em;grid-column:1/-1"><span class="spinner"></span> AI ì „ëµ ë¶„ì„ ì¤‘...</div>';
return;
}
if($('kwr-insight'))$('kwr-insight').textContent=text;
const sections=parseAiSections(text);
el.innerHTML=renderAiCards(sections,2);
}

// ===== VS ë¹„êµ ë²¤ ë‹¤ì´ì–´ê·¸ë¨ =====
function renderVsVenn(kwData){
const el=$('vs-venn-container');if(!el)return;
if(!kwData||kwData.length<2){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--t3);font-size:.85em">2ê°œ ì´ìƒ í‚¤ì›Œë“œ í•„ìš”</div>';return;}
const vsColors=['#f97316','#3b82f6','#a855f7','#ec4899','#14b8a6'];
const W=400,H=220;
const cx=W/2,cy=H/2;

// ë¡œê·¸ ìŠ¤ì¼€ì¼ ë°˜ì§€ë¦„ (ìµœì†Œ30 ìµœëŒ€52)
const vals=kwData.map(d=>Math.max(d.vol||1,1));
const logVals=vals.map(v=>Math.log10(v+1));
const logMax=Math.max(...logVals,1);
const logMin=Math.min(...logVals);
function logR(v){
const lv=Math.log10(Math.max(v,1)+1);
const ratio=logMax===logMin?0.5:(lv-logMin)/(logMax-logMin);
return Math.round(30+22*ratio);
}
const fmt=v=>v>=10000?(v/10000).toFixed(1)+'ë§Œ':v>=1000?(v/1000).toFixed(1)+'ì²œ':String(v||0);

let svg='<svg viewBox="0 0 '+W+' '+H+'" style="width:100%;max-height:220px" xmlns="http://www.w3.org/2000/svg">';

if(kwData.length===2){
const r1=logR(kwData[0].vol),r2=logR(kwData[1].vol);
const overlap=Math.round(Math.min(vals[0],vals[1])*0.12);
const gap=Math.max(r1,r2)*0.7;
const lx=cx-gap,rx=cx+gap;
svg+='<circle cx="'+lx+'" cy="'+cy+'" r="'+r1+'" fill="'+vsColors[0]+'" opacity="0.2" stroke="'+vsColors[0]+'" stroke-width="1.5" stroke-opacity="0.5"/>';
svg+='<circle cx="'+lx+'" cy="'+cy+'" r="'+r1+'" fill="none" stroke="'+vsColors[0]+'" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>';
svg+='<circle cx="'+rx+'" cy="'+cy+'" r="'+r2+'" fill="'+vsColors[1]+'" opacity="0.2" stroke="'+vsColors[1]+'" stroke-width="1.5" stroke-opacity="0.5"/>';
svg+='<circle cx="'+rx+'" cy="'+cy+'" r="'+r2+'" fill="none" stroke="'+vsColors[1]+'" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>';
svg+='<text x="'+lx+'" y="'+(cy-r1-12)+'" text-anchor="middle" fill="'+vsColors[0]+'" font-size="11" font-weight="700" font-family="Pretendard,sans-serif">'+kwData[0].kw+'</text>';
svg+='<text x="'+lx+'" y="'+(cy-r1+1)+'" text-anchor="middle" fill="#a8aab5" font-size="9" font-family="Pretendard,sans-serif">'+fmt(kwData[0].vol)+'ê±´</text>';
svg+='<text x="'+rx+'" y="'+(cy-r2-12)+'" text-anchor="middle" fill="'+vsColors[1]+'" font-size="11" font-weight="700" font-family="Pretendard,sans-serif">'+kwData[1].kw+'</text>';
svg+='<text x="'+rx+'" y="'+(cy-r2+1)+'" text-anchor="middle" fill="#a8aab5" font-size="9" font-family="Pretendard,sans-serif">'+fmt(kwData[1].vol)+'ê±´</text>';
svg+='<text x="'+cx+'" y="'+(cy-3)+'" text-anchor="middle" fill="#f97316" font-size="10" font-weight="800" font-family="Pretendard,sans-serif">'+fmt(overlap)+'</text>';
svg+='<text x="'+cx+'" y="'+(cy+10)+'" text-anchor="middle" fill="#5a5b6a" font-size="7" font-family="Pretendard,sans-serif">ê³µí†µ êµì°¨</text>';
}else{
// 3ê°œ ì‚¼ê°ë°°ì¹˜ (ì¤‘ì•™ ì •ë ¬)
const pos=[{x:cx-45,y:cy-25},{x:cx+45,y:cy-25},{x:cx,y:cy+35}];
const radii=kwData.slice(0,3).map(d=>logR(d.vol));
kwData.slice(0,3).forEach((d,i)=>{
const p=pos[i],r=radii[i],c=vsColors[i];
svg+='<circle cx="'+p.x+'" cy="'+p.y+'" r="'+r+'" fill="'+c+'" opacity="0.18" stroke="'+c+'" stroke-width="1.5" stroke-opacity="0.5"/>';
svg+='<circle cx="'+p.x+'" cy="'+p.y+'" r="'+r+'" fill="none" stroke="'+c+'" stroke-width="1" stroke-dasharray="4,3" stroke-opacity="0.4"/>';
const ly=i<2?p.y-r-12:p.y+r+14;
svg+='<text x="'+p.x+'" y="'+ly+'" text-anchor="middle" fill="'+c+'" font-size="10" font-weight="700" font-family="Pretendard,sans-serif">'+d.kw+'</text>';
svg+='<text x="'+p.x+'" y="'+(ly+13)+'" text-anchor="middle" fill="#a8aab5" font-size="8" font-family="Pretendard,sans-serif">'+fmt(d.vol)+'ê±´</text>';
});
// êµì°¨ê°’
const ov=Math.round(Math.min(...vals.slice(0,3))*0.08);
svg+='<text x="'+cx+'" y="'+(cy+2)+'" text-anchor="middle" fill="#f97316" font-size="10" font-weight="800" font-family="Pretendard,sans-serif">'+fmt(ov)+'</text>';
svg+='<text x="'+cx+'" y="'+(cy+13)+'" text-anchor="middle" fill="#5a5b6a" font-size="7" font-family="Pretendard,sans-serif">êµì°¨ ì˜ì—­</text>';
}

// ìš°ì¸¡ ìˆ˜ì¹˜í‘œ
const tableX=W-5;
kwData.slice(0,5).forEach((d,i)=>{
const ty=15+i*20;
svg+='<rect x="'+(tableX-95)+'" y="'+ty+'" width="92" height="16" rx="4" fill="#12121a" stroke="#282936" stroke-width="0.5"/>';
svg+='<circle cx="'+(tableX-82)+'" cy="'+(ty+8)+'" r="3" fill="'+vsColors[i]+'"/>';
svg+='<text x="'+(tableX-75)+'" y="'+(ty+11)+'" fill="#a8aab5" font-size="7.5" font-family="Pretendard,sans-serif">'+d.kw+'</text>';
svg+='<text x="'+(tableX-6)+'" y="'+(ty+11)+'" text-anchor="end" fill="#f0f1f5" font-size="7.5" font-weight="600" font-family="Pretendard,sans-serif">'+fmt(d.vol)+'</text>';
});

svg+='</svg>';
el.innerHTML=svg;
}

// VS AI ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ë Œë”ë§
function renderVsAiCards(text){
const el=$('vs-ai-insight');if(!el)return;
let html='<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px"><span style="font-size:1.2em">ğŸ¤–</span><span style="font-weight:700;font-size:.95em;color:var(--t1)">AI ì „ëµ ë¶„ì„</span></div>';
const sections=parseAiSections(text);
html+=renderAiCards(sections,2);
el.innerHTML=html;
}

// ===== VS ë¹„êµ ë‹¤ìš´ë¡œë“œ =====
let vsResultData=null;

function downloadVsCSV(){
if(!vsResultData){toast('âš ï¸ ë¹„êµ ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”');return;}
let csv='\uFEFFí‚¤ì›Œë“œ VS ë¹„êµ ë¦¬í¬íŠ¸\nìƒì„±ì¼: '+new Date().toLocaleDateString('ko-KR')+'\n\n';
csv+='í‚¤ì›Œë“œ,ê²€ìƒ‰ëŸ‰,ê²½ìŸë„,íŠ¸ë Œë“œ\n';
vsResultData.forEach(d=>{
csv+=d.kw+','+d.vol+','+d.comp+','+d.trend+'\n';
});
csv+='\nìŠ¹ì: '+($('vs-winner')?.textContent||'')+'\n';
const insight=$('vs-ai-insight')?.textContent||'';
if(insight)csv+='\nAI ì¸ì‚¬ì´íŠ¸\n'+insight.replace(/,/g,' ')+'\n';
const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='keyword-vs-'+new Date().toISOString().slice(0,10)+'.csv';a.click();
toast('âœ… VS ë¹„êµ CSV ë‹¤ìš´ë¡œë“œ');
if(typeof addDlHistory==='function')addDlHistory('keyword','csv','í‚¤ì›Œë“œ VS ë¹„êµ');
}

function downloadVsPDF(){
if(!vsResultData){toast('âš ï¸ ë¹„êµ ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”');return;}
try{
const {jsPDF}=window.jspdf;
const doc=new jsPDF('p','mm','a4');
const W=210,M=16;let y=M;
doc.setFillColor(15,16,22);doc.rect(0,0,210,297,'F');
doc.setFillColor(249,115,22);doc.roundedRect(M,y,6,6,1.5,1.5,'F');
doc.setTextColor(240,241,245);doc.setFontSize(16);doc.text('Keyword VS Comparison',M+10,y+5);
const today=new Date().toLocaleDateString('ko-KR');
doc.setFontSize(8);doc.setTextColor(140,142,160);doc.text(today,W-M,y+5,{align:'right'});
y+=16;
doc.setDrawColor(249,115,22);doc.setLineWidth(0.4);doc.line(M,y,W-M,y);y+=10;
// ìŠ¹ì
doc.setFontSize(12);doc.setTextColor(249,115,22);doc.text($('vs-winner')?.textContent?.substring(0,60)||'',M,y);y+=10;
// í…Œì´ë¸”
const tableData=vsResultData.map(d=>[d.kw,d.vol?.toLocaleString()||'',d.comp||'',d.trend||'']);
doc.autoTable({
startY:y,margin:{left:M,right:M},
head:[['í‚¤ì›Œë“œ','ê²€ìƒ‰ëŸ‰','ê²½ìŸë„','íŠ¸ë Œë“œ']],
body:tableData,
styles:{fontSize:8,cellPadding:3,textColor:[240,241,245],fillColor:[26,26,42],lineColor:[50,50,70],lineWidth:0.15},
headStyles:{fillColor:[249,115,22],textColor:[255,255,255],fontStyle:'bold'}
});
y=doc.lastAutoTable.finalY+10;
// AI
const insight=$('vs-ai-insight')?.textContent||'';
if(insight){
doc.setFontSize(9);doc.setTextColor(249,115,22);doc.text('AI Insight',M,y);y+=5;
const lines=doc.setFontSize(7).setTextColor(200,200,215).splitTextToSize(insight,W-M*2);
doc.text(lines,M,y);
}
doc.save('keyword-vs-'+new Date().toISOString().slice(0,10)+'.pdf');
toast('âœ… VS ë¹„êµ PDF ë‹¤ìš´ë¡œë“œ');
if(typeof addDlHistory==='function')addDlHistory('keyword','pdf','í‚¤ì›Œë“œ VS ë¹„êµ');
}catch(e){toast('âŒ PDF ìƒì„± ì‹¤íŒ¨: '+e.message);}
}

// ===== CSV ë‹¤ìš´ë¡œë“œ =====
function downloadKwrCSV(){
const kw=$('kwr-input')?.value||'keyword';
let csv='\\uFEFF'; // BOM for Excel Korean
csv+='í‚¤ì›Œë“œ ë¶„ì„ ë¦¬í¬íŠ¸: '+kw+'\\n';
csv+='ë¶„ì„ ê¸°ê°„: '+($('kwr-period-badge')?.textContent||'12ê°œì›”')+'\\n';
csv+='ìƒì„±ì¼: '+new Date().toLocaleDateString('ko-KR')+'\\n\\n';

// í•µì‹¬ ì§€í‘œ
csv+='===== í•µì‹¬ ì§€í‘œ =====\\n';
csv+='í•­ëª©,ê°’\\n';
csv+='ì›”ê°„ ê²€ìƒ‰ëŸ‰,'+($('kwr-volume')?.textContent||'')+'\\n';
csv+='ê²½ìŸ ê°•ë„,'+($('kwr-competition')?.textContent||'')+'\\n';
csv+='ì½˜í…ì¸  ìˆ˜,'+($('kwr-content-count')?.textContent||'')+'\\n';
csv+='íŠ¸ë Œë“œ,'+($('kwr-trend')?.textContent||'')+'\\n\\n';

// í”Œë«í¼ë³„ ì ìœ ìœ¨
csv+='===== í”Œë«í¼ë³„ ì½˜í…ì¸  =====\\n';
csv+='í”Œë«í¼,ê±´ìˆ˜\\n';
const platEl=$('kwr-platform-chart');
if(platEl){
platEl.querySelectorAll('.kwr-bar-row').forEach(row=>{
const label=row.querySelector('.kwr-bar-label')?.textContent?.trim()||'';
const val=row.querySelector('.kwr-bar-val')?.textContent?.trim()||'';
csv+=label+','+val+'\\n';
});
}
csv+='\\n';

// ì—°ê´€ í‚¤ì›Œë“œ
csv+='===== ì—°ê´€ í‚¤ì›Œë“œ =====\\n';
csv+='í‚¤ì›Œë“œ,ê²€ìƒ‰ëŸ‰,ê²½ìŸë„\\n';
const relEl=$('kwr-related');
if(relEl){
relEl.querySelectorAll('div[style*="border-radius"]').forEach(chip=>{
const spans=chip.querySelectorAll('span');
const kwName=(spans[0]?.textContent||'').replace(/,/g,' ');
const vol=spans[1]?.textContent||'';
const comp=spans[2]?.textContent||'';
csv+=kwName+','+vol+','+comp+'\\n';
});
}
csv+='\\n';

// ì½˜í…ì¸  ë¦¬ìŠ¤íŠ¸
csv+='===== ê´€ë ¨ ì½˜í…ì¸  =====\\n';
csv+='ìœ í˜•,ì œëª©,ì¶œì²˜,ì¡°íšŒìˆ˜,ë‚ ì§œ\\n';
if(kwrContentData){
kwrContentData.forEach(c=>{
const tl={news:'ê¸°ì‚¬',blog:'ë¸”ë¡œê·¸',sns:'SNS'};
csv+=(tl[c.type]||c.type)+','+(c.title||'').replace(/,/g,' ')+','+(c.source||'').replace(/,/g,' ')+','+(c.views||'')+','+(c.date||'')+'\\n';
});
}
csv+='\\n';

// AI ì¸ì‚¬ì´íŠ¸
const insight=$('kwr-insight')?.textContent||'';
if(insight){
csv+='===== AI ì¸ì‚¬ì´íŠ¸ =====\\n';
csv+=insight.replace(/,/g,' ')+'\\n';
}

// ë‹¤ìš´ë¡œë“œ
const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download='keyword-report-'+kw.replace(/[^a-zA-Z0-9ê°€-í£]/g,'_')+'-'+new Date().toISOString().slice(0,10)+'.csv';
a.click();
URL.revokeObjectURL(url);
toast('âœ… CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}

// âš”ï¸ í‚¤ì›Œë“œ VS ë¹„êµ ê¸°ëŠ¥
let vsInputCount=2;
const vsColors=['var(--ac)','#f97316','#a855f7','#ec4899','#14b8a6'];

function toggleVsMode(){
const sec=$('vs-section');
const icon=$('vs-toggle-icon');
if(sec.style.display==='none'){sec.style.display='block';icon.textContent='â–² ì ‘ê¸°'}
else{sec.style.display='none';icon.textContent='â–¼ í¼ì¹˜ê¸°'}
}

function addVsInput(){
if(vsInputCount>=5){toast('âš ï¸ ìµœëŒ€ 5ê°œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤');return}
vsInputCount++;
const div=document.createElement('div');
div.style.cssText='display:flex;gap:8px;margin-bottom:8px;align-items:center';
div.id='vs-row-'+vsInputCount;
div.innerHTML=`<div style="width:22px;height:22px;border-radius:50%;background:${vsColors[vsInputCount-1]};display:flex;align-items:center;justify-content:center;font-size:.7em;color:#fff;flex-shrink:0;font-weight:700">${vsInputCount}</div>
<input class="mi" id="vs-kw-${vsInputCount}" placeholder="í‚¤ì›Œë“œ ${vsInputCount}" style="margin:0;flex:1;font-size:.9em;border-left:3px solid ${vsColors[vsInputCount-1]}">
<button onclick="removeVsInput(${vsInputCount})" style="background:none;border:none;cursor:pointer;font-size:1.1em;color:var(--t3);padding:4px;line-height:1">âœ•</button>`;
$('vs-inputs').appendChild(div);
if(vsInputCount>=5)$('vs-add-btn').style.display='none';
}

function removeVsInput(n){
const row=$('vs-row-'+n);if(row)row.remove();
vsInputCount--;
$('vs-add-btn').style.display='';
}

async function compareKeywords(){
const keywords=[];
for(let i=1;i<=5;i++){
const el=$('vs-kw-'+i);
if(el&&el.value.trim())keywords.push(el.value.trim());
}
if(keywords.length<2){toast('âš ï¸ ìµœì†Œ 2ê°œ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');return}

const btn=$('vs-btn');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ë¹„êµ ì¤‘...';
toast('âš”ï¸ '+keywords.join(' vs ')+' ë¹„êµ ë¶„ì„ ì¤‘...');

try{
// ë„¤ì´ë²„ ë°ì´í„°ë©ìœ¼ë¡œ íŠ¸ë Œë“œ ë¹„êµ
let trendResults=[];
if(backendUrl){
try{
const endDate=new Date().toISOString().split('T')[0];
const startDate=new Date(Date.now()-365*24*60*60*1000).toISOString().split('T')[0];
const body={startDate,endDate,timeUnit:'month',keywordGroups:keywords.map(kw=>({groupName:kw,keywords:[kw]}))};
const datalabData=await callBackend('/api/naver-datalab',body);
if(datalabData&&datalabData.results){
trendResults=datalabData.results.map(r=>({name:r.title||r.groupName||'',data:(r.data||[]).map(d=>({date:d.period,value:Math.round(d.ratio)}))}));
}
}catch(e){console.error('DataLab compare error:',e)}
}

// ê° í‚¤ì›Œë“œë³„ ê²€ìƒ‰ëŸ‰ ê°€ì ¸ì˜¤ê¸°
const kwSummaries=[];
for(const kw of keywords){
try{
const data=await callBackend('/api/keyword-analyze',{keyword:kw});
kwSummaries.push({kw,blog:data.summary?.naverBlogTotal||0,news:data.summary?.naverNewsTotal||0,google:data.summary?.googleTotal||0,total:data.summary?.totalContent||0,trend:data.summary?.trendDirection||'ìœ ì§€'});
}catch(e){kwSummaries.push({kw,blog:0,news:0,google:0,total:0,trend:'ìœ ì§€'})}
}

// íŠ¸ë Œë“œ ì°¨íŠ¸ ë Œë”ë§
$('vs-results').style.display='block';
if(trendResults.length>0){
const allVals=trendResults.flatMap(r=>r.data.map(d=>d.value));
const maxVal=Math.max(...allVals,1);
const months=trendResults[0].data.length;
$('vs-chart').innerHTML=Array.from({length:months},(_,i)=>{
const bars=trendResults.map((r,ri)=>{
const val=r.data[i]?.value||0;
const h=Math.max(4,Math.round(val/maxVal*160));
return `<div class="trend-bar" style="height:${h}px;background:${vsColors[ri]};min-width:6px;opacity:.85" title="${r.name}: ${val}"></div>`;
}).join('');
const label=trendResults[0].data[i]?.date?.split('-').slice(1).join('/')||'';
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div class="trend-bar-group">${bars}</div>
<div class="trend-day-label">${label}</div>
</div>`;
}).join('');
$('vs-legend').innerHTML=trendResults.map((r,i)=>
`<div style="display:flex;align-items:center;gap:4px"><div style="width:10px;height:10px;border-radius:2px;background:${vsColors[i]}"></div><span style="font-size:.75em;color:var(--t2);font-weight:500">${r.name}</span></div>`
).join('');
}else{
$('vs-chart').innerHTML='<div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;color:var(--t3);font-size:.85em">ğŸ“Š íŠ¸ë Œë“œ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</div>';
$('vs-legend').innerHTML='';
}

// ğŸ† ìŠ¹ì ë°œí‘œ
const winner=kwSummaries.reduce((a,b)=>a.total>b.total?a:b);
const winIdx=kwSummaries.indexOf(winner);
$('vs-winner').innerHTML=`
<div style="font-size:2em;margin-bottom:4px">ğŸ†</div>
<div style="font-size:1.1em;font-weight:800;color:${vsColors[winIdx]};margin-bottom:4px">"${winner.kw}"</div>
<div style="font-size:.85em;color:var(--t2)">ì´ ì½˜í…ì¸  <b style="color:var(--ac)">${winner.total.toLocaleString()}ê±´</b>ìœ¼ë¡œ 1ìœ„!</div>
<div style="display:flex;justify-content:center;gap:12px;margin-top:8px;font-size:.78em;color:var(--t3)">
${kwSummaries.map((s,i)=>`<span style="color:${vsColors[i]}">${i+1}ìœ„ ${s.kw}: ${s.total.toLocaleString()}ê±´</span>`).join(' Â· ')}
</div>`;

// âš”ï¸ í•­ëª©ë³„ ëŒ€ê²° (ê°€ë¡œ ë°” ëŒ€ê²°)
const battleItems=[
{label:'ğŸ“ ë¸”ë¡œê·¸',key:'blog'},
{label:'ğŸ“° ë‰´ìŠ¤',key:'news'},
{label:'ğŸ” êµ¬ê¸€',key:'google'}
];
$('vs-battle-rows').innerHTML=battleItems.map(item=>{
const vals=kwSummaries.map(s=>s[item.key]||0);
const maxV=Math.max(...vals,1);
const topIdx=vals.indexOf(Math.max(...vals));
return `<div style="background:var(--bg4);border-radius:var(--r2);padding:12px;margin-bottom:8px">
<div style="font-weight:600;font-size:.85em;color:var(--t2);margin-bottom:8px">${item.label}</div>
${kwSummaries.map((s,i)=>{
const val=s[item.key]||0;
const pct=Math.max(8,Math.round(val/maxV*100));
const isTop=i===topIdx&&val>0;
return `<div style="display:flex;align-items:center;gap:8px;margin-bottom:5px">
<span style="width:80px;font-size:.78em;color:${vsColors[i]};font-weight:600;flex-shrink:0;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${s.kw}</span>
<div style="flex:1;height:20px;background:var(--bg3);border-radius:10px;overflow:hidden;position:relative">
<div style="height:100%;width:${pct}%;background:${vsColors[i]};border-radius:10px;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;transition:width .5s">
<span style="font-size:.7em;color:#fff;font-weight:700">${val.toLocaleString()}</span>
</div>
</div>
${isTop?'<span style="font-size:.75em;flex-shrink:0">ğŸ‘‘</span>':'<span style="width:16px;flex-shrink:0"></span>'}
</div>`;}).join('')}
</div>`;}).join('');

// ìš”ì•½ ì¹´ë“œ
$('vs-summary-cards').innerHTML=kwSummaries.map((s,i)=>{
const rank=kwSummaries.slice().sort((a,b)=>b.total-a.total).findIndex(x=>x.kw===s.kw)+1;
const medal=rank===1?'ğŸ¥‡':rank===2?'ğŸ¥ˆ':rank===3?'ğŸ¥‰':rank+'ìœ„';
return `<div style="background:var(--bg4);border-radius:var(--r2);padding:14px;border-top:3px solid ${vsColors[i]};position:relative">
<div style="position:absolute;top:8px;right:10px;font-size:1.2em">${medal}</div>
<div style="font-weight:700;font-size:.95em;color:${vsColors[i]};margin-bottom:8px">${s.kw}</div>
<div style="font-size:.78em;color:var(--t2);line-height:2">
<div style="display:flex;justify-content:space-between">ì´ ì½˜í…ì¸ <b style="color:var(--ac)">${s.total.toLocaleString()}</b></div>
<div style="display:flex;justify-content:space-between">ë¸”ë¡œê·¸<span>${s.blog.toLocaleString()}</span></div>
<div style="display:flex;justify-content:space-between">ë‰´ìŠ¤<span>${s.news.toLocaleString()}</span></div>
<div style="display:flex;justify-content:space-between">êµ¬ê¸€<span>${s.google.toLocaleString()}</span></div>
<div style="display:flex;justify-content:space-between">íŠ¸ë Œë“œ<span style="color:${s.trend==='ìƒìŠ¹'?'var(--g)':s.trend==='í•˜ë½'?'var(--r)':'var(--ac)'}"><b>${s.trend}</b></span></div>
</div>
</div>`}).join('');

// VS ë²¤ ë‹¤ì´ì–´ê·¸ë¨
renderVsVenn(kwSummaries.map(s=>({kw:s.kw,vol:s.total})));

// vsResultData ì €ì¥ (ë‹¤ìš´ë¡œë“œìš©)
vsResultData=kwSummaries.map(s=>({kw:s.kw,vol:s.total,comp:s.blog>s.news?'ë¸”ë¡œê·¸ ê°•ì„¸':'ë‰´ìŠ¤ ê°•ì„¸',trend:s.trend}));

// AI ë¹„êµ ì¸ì‚¬ì´íŠ¸
$('vs-ai-insight').style.display='block';
$('vs-ai-insight').innerHTML='<div style="display:flex;align-items:center;gap:8px;margin-bottom:10px"><span style="font-size:1.2em">ğŸ¤–</span><span style="font-weight:700;font-size:.95em;color:var(--t1)">AI ì „ëµ ë¶„ì„</span></div><div style="text-align:center;padding:12px;color:var(--t3)"><span class="spinner"></span> ë¶„ì„ ì¤‘...</div>';
try{
const summaryText=kwSummaries.map(s=>`"${s.kw}": ë¸”ë¡œê·¸${s.blog}ê±´, ë‰´ìŠ¤${s.news}ê±´, êµ¬ê¸€${s.google}ê±´, íŠ¸ë Œë“œ:${s.trend}`).join('\n');
const aiR=await callAI(`ë‹¤ìŒ í‚¤ì›Œë“œë“¤ì„ ë¹„êµ ë¶„ì„í•´ì¤˜:\n${summaryText}\n\n1) ì¢…í•© ìŠ¹ìì™€ ì´ìœ \n2) ê° í‚¤ì›Œë“œ í•œì¤„ í‰ê°€\n3) ì¶”ì²œ ì „ëµ: ì–´ë–¤ í‚¤ì›Œë“œë¥¼ ì–´ë–¤ í”Œë«í¼ì— ì“¸ì§€\n4) ì£¼ì˜ì‚¬í•­\nê° 2ì¤„ ì´ë‚´.`);
renderVsAiCards(aiR||'ë¶„ì„ ê²°ê³¼ ì—†ìŒ');
trackCredit(0.004,'í‚¤ì›Œë“œ ë¹„êµ ë¶„ì„');
}catch(e){$('vs-ai-insight').innerHTML='<div style="display:flex;align-items:center;gap:8px"><span style="font-size:1.2em">ğŸ¤–</span><span style="font-weight:700;color:var(--t1)">AI ë¶„ì„</span></div><div style="color:var(--t3);margin-top:6px">ë¶„ì„ ì‹¤íŒ¨</div>'}

toast('âœ… ë¹„êµ ë¶„ì„ ì™„ë£Œ!');
}catch(e){toast('âŒ '+e.message)}
finally{btn.disabled=false;btn.innerHTML='âš”ï¸ ë¹„êµ ë¶„ì„'}
}

// í‚¤ì›Œë“œ ì €ì¥
function saveKw(kw){
if(kwrSaved.find(k=>k.kw===kw))return toast('ì´ë¯¸ ì €ì¥ë¨');
const vol=$('kwr-volume').textContent;
kwrSaved.push({kw,date:new Date().toLocaleDateString('ko-KR'),vol});
LS('kwr_saved',kwrSaved);
renderKwrSaved();
saveSavedKeyword(kw,vol).catch(()=>{});
toast('â­ ì €ì¥ë¨');
}

function renderKwrSaved(){
if($('kwr-saved-count'))$('kwr-saved-count').textContent=kwrSaved.length;
if(!$('kwr-saved-list'))return;
if(!kwrSaved.length){$('kwr-saved-list').innerHTML='<div style="text-align:center;padding:12px;color:var(--t3);font-size:.88em">ì €ì¥ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤</div>';return}
$('kwr-saved-list').innerHTML=kwrSaved.map(k=>
`<div style="display:flex;align-items:center;gap:8px;padding:8px;background:var(--bg4);border-radius:var(--r1);margin-bottom:4px">
<span style="font-size:.88em;font-weight:600;color:var(--t1);flex:1;cursor:pointer" onclick="$('kwr-input').value='${k.kw.replace(/'/g,"\\'")}';searchKeyword()">${k.kw}</span>
<span style="font-size:.78em;color:var(--t3)">${k.vol||''}</span>
<span style="font-size:.78em;color:var(--t3)">${k.date}</span>
<button class="ebtn" onclick="kwrSaved=kwrSaved.filter(x=>x.kw!=='${k.kw.replace(/'/g,"\\'")}');LS('kwr_saved',kwrSaved);renderKwrSaved()" style="color:var(--r)">ì‚­ì œ</button>
</div>`
).join('');
}

function clearSavedKw(){
kwrSaved=[];LS('kwr_saved',[]);renderKwrSaved();toast('ğŸ—‘ï¸ ì´ˆê¸°í™”');
}

// === STYLE LEARNING ===
function setStyleMode(mode){
document.querySelectorAll('#style-pills .sub-pill').forEach(p=>p.classList.remove('a'));
event.target.classList.add('a');
$('style-dashboard').style.display=mode==='dashboard'?'block':'none';
$('style-paste').style.display=mode==='paste'?'block':'none';
$('style-url').style.display=mode==='url'?'block':'none';
$('style-compare').style.display=mode==='compare'?'block':'none';
if(mode==='dashboard')renderStyleDash();
}

// ì €ì¥ëœ ê¸€ & ë¶„ì„ ë°ì´í„°
let styleTexts=LS('style_texts')||[];
let styleAnalysis=LS('style_analysis')||null;

function saveStyleText(title,text,source){
const item={
id:Date.now(),
title:title||('ê¸€ '+(styleTexts.length+1)),
text:text.substring(0,2000),
source:source,
date:new Date().toLocaleDateString('ko-KR'),
charCount:text.length,
sentCount:(text.match(/[.!?ã€‚]\s/g)||[]).length+1,
wordCount:text.split(/\s+/).filter(w=>w).length
};
styleTexts.push(item);
LS('style_texts',styleTexts);
}

async function learnStyle(mode){
let text='',title='';
if(mode==='paste'){text=$('style-ta').value;title=$('style-title').value;}
else{text=$('style-url-content').value;title=$('style-url-in').value;}
if(!text.trim()){toast('âš ï¸ í…ìŠ¤íŠ¸ ì…ë ¥');return}
toast('ğŸ¨ í•™ìŠµ ì¤‘...');
try{
const r=await callAI(`ì´ ê¸€ì˜ ë¬¸ì²´ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ë¶„ì„í•´ì¤˜:

${text.substring(0,1500)}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì ìˆ˜(1~10)ë¥¼ ë¨¼ì € ë‹µí•˜ê³ , ê·¸ ì•„ë˜ì— ë¶„ì„ ì„¤ëª…:

í†¤(ê²©ì‹ë„): [ì ìˆ˜]/10
ë¬¸ì¥ê¸¸ì´: [ì ìˆ˜]/10
ì´ëª¨ì§€ì‚¬ìš©: [ì ìˆ˜]/10
ì „ë¬¸ìš©ì–´: [ì ìˆ˜]/10
ì¹œê·¼ê°: [ì ìˆ˜]/10
ì„¤ë“ë ¥: [ì ìˆ˜]/10

---
1) í†¤: (ê²©ì‹/ë¹„ê²©ì‹ ì„¤ëª…)
2) ë¬¸ì¥ êµ¬ì¡° íŠ¹ì§•
3) ìì£¼ ì“°ëŠ” í‘œí˜„ íŒ¨í„´
4) ë…ì í˜¸ì¹­ ë°©ì‹
5) ì „ì²´ ë¬¸ì²´ í•œì¤„ ìš”ì•½`);

// ê¸€ ì €ì¥
saveStyleText(title,text,mode==='paste'?'ë¶™ì—¬ë„£ê¸°':'URL');

// ë¶„ì„ ê²°ê³¼ íŒŒì‹± & ì €ì¥
const scores={};
const scoreLines=r.split('\n').filter(l=>l.match(/[:\ï¼š]\s*\d/));
const labels=['í†¤(ê²©ì‹ë„)','ë¬¸ì¥ê¸¸ì´','ì´ëª¨ì§€ì‚¬ìš©','ì „ë¬¸ìš©ì–´','ì¹œê·¼ê°','ì„¤ë“ë ¥'];
const keys=['formality','sentLen','emoji','jargon','friendly','persuasion'];
scoreLines.forEach(line=>{
keys.forEach((k,i)=>{
if(line.includes(labels[i])||line.toLowerCase().includes(k)){
const m=line.match(/(\d+)\s*\/\s*10/);
if(m)scores[k]=parseInt(m[1]);
}
});
});
// ê¸°ë³¸ê°’ ì±„ìš°ê¸°
keys.forEach(k=>{if(!scores[k])scores[k]=5+Math.floor(Math.random()*3)});

const descPart=r.split('---')[1]||r.split('\n').slice(6).join('\n');
styleAnalysis={scores,desc:descPart.trim(),raw:r,date:new Date().toLocaleDateString('ko-KR'),textCount:styleTexts.length};
LS('style_analysis',styleAnalysis);
LS('style_profile',r);

$('style-rc').textContent=r||'';
$('style-ra').classList.add('show');
toast('âœ… ë¬¸ì²´ í•™ìŠµ ì™„ë£Œ & ì €ì¥ë¨');

// ì…ë ¥ ì´ˆê¸°í™”
if(mode==='paste'){$('style-ta').value='';$('style-title').value='';}
}catch(e){toast('âŒ '+e.message)}}

async function compareStyles(){const a=$('style-cmp-a').value,b=$('style-cmp-b').value;
if(!a||!b){toast('âš ï¸ ë‘ ê¸€ ëª¨ë‘ ì…ë ¥');return}toast('âš–ï¸ ë¹„êµ ì¤‘...');
try{const r=await callAI('ë‘ ê¸€ì˜ ë¬¸ì²´ë¥¼ ë¹„êµ ë¶„ì„:\n\n[ê¸€ A]\n'+a.substring(0,500)+'\n\n[ê¸€ B]\n'+b.substring(0,500)+'\n\në¹„êµ: 1)í†¤ ì°¨ì´ 2)ë¬¸ì¥ êµ¬ì¡° 3)ë‹¨ì–´ ì„ íƒ 4)ë…ì ì ‘ê·¼ì„± 5)ì–´ëŠ ìª½ì´ ë” íš¨ê³¼ì ì¸ì§€ì™€ ì´ìœ . í‘œ í˜•ì‹.');
$('style-rc').textContent=r||'';$('style-ra').classList.add('show');toast('âœ… ë¹„êµ ì™„ë£Œ')}catch(e){toast('âŒ '+e.message)}}

// ëŒ€ì‹œë³´ë“œ ë Œë”ë§
function renderStyleDash(){
if(!styleAnalysis||styleTexts.length===0){
$('style-dash-empty').style.display='block';
$('style-dash-content').style.display='none';
return;
}
$('style-dash-empty').style.display='none';
$('style-dash-content').style.display='block';

const s=styleAnalysis.scores;
const avgChars=styleTexts.length?Math.round(styleTexts.reduce((a,t)=>a+t.charCount,0)/styleTexts.length):0;
const avgWords=styleTexts.length?Math.round(styleTexts.reduce((a,t)=>a+t.wordCount,0)/styleTexts.length):0;
const avgSents=styleTexts.length?Math.round(styleTexts.reduce((a,t)=>a+t.sentCount,0)/styleTexts.length):0;

// ì§€í‘œ ì¹´ë“œ
$('style-metrics').innerHTML=`
<div class="hero-card">
<div class="hero-top"><span class="hero-label">í•™ìŠµëœ ê¸€</span><span class="hero-icon views">ğŸ“š</span></div>
<div class="hero-val">${styleTexts.length}í¸</div>
<div class="hero-sub">ë§ˆì§€ë§‰ í•™ìŠµ: ${styleAnalysis.date}</div>
</div>
<div class="hero-card">
<div class="hero-top"><span class="hero-label">í‰ê·  ê¸€ ê¸¸ì´</span><span class="hero-icon posts">ğŸ“</span></div>
<div class="hero-val">${avgChars.toLocaleString()}ì</div>
<div class="hero-sub">í‰ê·  ${avgSents}ë¬¸ì¥ Â· ${avgWords}ë‹¨ì–´</div>
</div>
`;

// ë°” ì°¨íŠ¸ ì§€í‘œ
const barData=[
{label:'ê²©ì‹ë„',key:'formality',color:'var(--b)',desc:'ë†’ì„ìˆ˜ë¡ ê²©ì‹ì²´'},
{label:'ë¬¸ì¥ ê¸¸ì´',key:'sentLen',color:'var(--ac)',desc:'ë†’ì„ìˆ˜ë¡ ê¸´ ë¬¸ì¥'},
{label:'ì´ëª¨ì§€ í™œìš©',key:'emoji',color:'#facc15',desc:'ë†’ì„ìˆ˜ë¡ ì´ëª¨ì§€ ë§ìŒ'},
{label:'ì „ë¬¸ ìš©ì–´',key:'jargon',color:'var(--r)',desc:'ë†’ì„ìˆ˜ë¡ ì „ë¬¸ì '},
{label:'ì¹œê·¼ê°',key:'friendly',color:'var(--g)',desc:'ë†’ì„ìˆ˜ë¡ ì¹œê·¼'},
{label:'ì„¤ë“ë ¥',key:'persuasion',color:'#a855f7',desc:'ë†’ì„ìˆ˜ë¡ ì„¤ë“ì '}
];
$('style-bars').innerHTML=barData.map(b=>{
const val=s[b.key]||5;
const pct=val*10;
return `<div style="margin-bottom:10px">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
<span style="font-size:.88em;font-weight:600;color:var(--t1)">${b.label}</span>
<span style="font-size:.82em;color:var(--t3)">${val}/10 Â· ${b.desc}</span>
</div>
<div style="background:var(--bg1);height:10px;border-radius:6px;overflow:hidden">
<div style="background:${b.color};height:100%;width:${pct}%;border-radius:6px;transition:width .6s"></div>
</div>
</div>`;
}).join('');

// ë¬¸ì²´ ìš”ì•½
$('style-summary').textContent=styleAnalysis.desc||'ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';

// ì €ì¥ëœ ê¸€ ëª©ë¡
$('style-count').textContent=styleTexts.length;
$('style-saved-list').innerHTML=styleTexts.length?styleTexts.slice().reverse().map(t=>`
<div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg4);border-radius:var(--r2);margin-bottom:6px;border-left:3px solid var(--ac)">
<div style="flex:1;min-width:0">
<div style="font-weight:600;font-size:.88em;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${t.title}</div>
<div style="font-size:.8em;color:var(--t3);margin-top:2px">${t.date} Â· ${t.source} Â· ${t.charCount.toLocaleString()}ì Â· ${t.sentCount}ë¬¸ì¥</div>
</div>
<button class="ebtn" onclick="viewStyleText(${t.id})">ë³´ê¸°</button>
<button class="ebtn" onclick="deleteStyleText(${t.id})" style="color:var(--r)">ì‚­ì œ</button>
</div>
`).join(''):'<div style="text-align:center;padding:16px;color:var(--t3);font-size:.88em">ì €ì¥ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤</div>';
}

function viewStyleText(id){
const t=styleTexts.find(x=>x.id===id);
if(!t)return;
$('style-ta').value=t.text;
$('style-title').value=t.title;
setStyleMode('paste');
document.querySelectorAll('#style-pills .sub-pill').forEach(p=>p.classList.remove('a'));
document.querySelectorAll('#style-pills .sub-pill')[1].classList.add('a');
toast('ğŸ“„ "'+t.title+'" ë¶ˆëŸ¬ì˜´');
}

function deleteStyleText(id){
styleTexts=styleTexts.filter(x=>x.id!==id);
LS('style_texts',styleTexts);
renderStyleDash();
toast('ğŸ—‘ï¸ ì‚­ì œë¨');
}

function clearStyleTexts(){
if(!confirm('ëª¨ë“  í•™ìŠµ ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
styleTexts=[];
styleAnalysis=null;
LS('style_texts',[]);
LS('style_analysis',null);
renderStyleDash();
toast('ğŸ—‘ï¸ ì „ì²´ ì‚­ì œë¨');
}

// === IMAGE ===
function addI(input,containerId){const file=input.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){const slot=input.closest('.isl');slot.innerHTML='<img src="'+e.target.result+'">'; slot.classList.add('filled')};reader.readAsDataURL(file)}
function addIS(containerId){const c=$(containerId);const slot=document.createElement('div');slot.className='isl';slot.onclick=function(){this.querySelector('input').click()};slot.innerHTML='<span style="color:var(--t3);font-size:1.4em">+</span><input type="file" accept="image/*" style="display:none" onchange="addI(this,\''+containerId+'\')">';c.appendChild(slot)}

// === COPY ===
function copyF(platform){let text='';if(platform==='blog')text=$('blog-final').textContent||getEditorText();else if(platform==='insta')text=$('insta-edit-ta').value;else text=$('fb-edit-ta').value;
if(text)navigator.clipboard.writeText(text).then(()=>toast('ğŸ“‹ ë³µì‚¬ë¨')).catch(()=>toast('âŒ ë³µì‚¬ ì‹¤íŒ¨'))}

// === HELPERS ===
function togFP(btn){btn.classList.toggle('a');const panel=btn.nextElementSibling;panel.classList.toggle('show')}

// === DASHBOARD ===
// 7ì¼ íŠ¸ë Œë“œ ë°ì´í„°
const trendData=[
{day:'ì›”',blog:0,insta:0},
{day:'í™”',blog:0,insta:0},
{day:'ìˆ˜',blog:0,insta:0},
{day:'ëª©',blog:0,insta:0},
{day:'ê¸ˆ',blog:0,insta:0},
{day:'í† ',blog:0,insta:0},
{day:'ì¼',blog:0,insta:0}
];
let trendFilter='all';

function setTrendFilter(mode){
trendFilter=mode;
document.querySelectorAll('#trend-tabs .trend-tab').forEach(t=>t.classList.remove('a'));
event.target.classList.add('a');
renderTrend();
}

function renderTrend(){
const maxVal=Math.max(...trendData.map(d=>trendFilter==='blog'?d.blog:trendFilter==='insta'?d.insta:(d.blog+d.insta)),1);
const chart=$('trend-chart');
chart.innerHTML=trendData.map(d=>{
const blogH=Math.max(8,Math.round(d.blog/maxVal*140));
const instaH=Math.max(8,Math.round(d.insta/maxVal*140));
if(trendFilter==='blog'){
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div style="flex:1;display:flex;align-items:flex-end;width:100%">
<div class="trend-bar naver" style="height:${blogH}px;width:100%;border-radius:4px 4px 0 0" title="ë¸”ë¡œê·¸ ${d.blog.toLocaleString()}"></div>
</div>
<div class="trend-day-label">${d.day}</div>
</div>`;
}else if(trendFilter==='insta'){
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div style="flex:1;display:flex;align-items:flex-end;width:100%">
<div class="trend-bar insta" style="height:${instaH}px;width:100%;border-radius:4px 4px 0 0" title="ì¸ìŠ¤íƒ€ ${d.insta.toLocaleString()}"></div>
</div>
<div class="trend-day-label">${d.day}</div>
</div>`;
}else{
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div class="trend-bar-group">
<div class="trend-bar naver" style="height:${blogH}px" title="ë¸”ë¡œê·¸ ${d.blog.toLocaleString()}"></div>
<div class="trend-bar insta" style="height:${instaH}px" title="ì¸ìŠ¤íƒ€ ${d.insta.toLocaleString()}"></div>
</div>
<div class="trend-day-label">${d.day}</div>
</div>`;
}
}).join('');
}

function rDash(){
// íŠ¸ë Œë“œ ì°¨íŠ¸ ë Œë”
renderTrend();

// í”Œë«í¼ë³„ ì„±ê³¼ ì¹´ë“œ - ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„°ë¡œ ëŒ€ì²´ë¨
const platformData=[
{id:'naver',name:'ë„¤ì´ë²„ ë¸”ë¡œê·¸',logo:'<span class="p-logo naver"></span>',views:0,reach:0,engage:0,ctr:0,credits:0,posts:0},
{id:'insta',name:'ì¸ìŠ¤íƒ€ê·¸ë¨',logo:'<span class="p-logo ig"></span>',views:0,reach:0,engage:0,ctr:0,credits:0,posts:0},
{id:'facebook',name:'í˜ì´ìŠ¤ë¶',logo:'<span class="p-logo fbk"></span>',views:0,reach:0,engage:0,ctr:0,credits:0,posts:0},
{id:'homepage',name:'í™ˆí˜ì´ì§€',logo:'ğŸ ',views:0,reach:0,engage:0,ctr:0,credits:0,posts:0}
];

let cardsHTML='';
platformData.forEach(p=>{
const costPerPost=p.posts>0?Math.round(p.credits*12/p.posts):0;
const costPerView=p.views>0?Math.round(p.credits*12/p.views*1000):0;
const roi=p.posts>0?Math.round(p.views/p.posts):0;
const grade=roi>=300?'S':roi>=200?'A':roi>=130?'B':roi>0?'C':'-';
const notConnected=p.views===0&&p.posts===0;
cardsHTML+=`<div class="platform-card ${p.id}">
<div class="pc-header">
<div class="pc-title"><div class="pc-logo">${p.logo}</div><span>${p.name}</span></div>
<span class="badge neutral" style="font-size:.65em">${notConnected?'ë¯¸ì—°ê²°':p.posts+'ê°œ'}</span>
</div>
${notConnected?`<div style="padding:16px 0;text-align:center;color:var(--t3);font-size:.82em">ë¡œê·¸ì¸í•˜ë©´ ì‹¤ì œ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>`:`
<div class="pc-row"><span class="pc-row-label">ì¡°íšŒìˆ˜</span><span class="pc-row-val accent">${p.views>=1000?(p.views/1000).toFixed(1)+'K':p.views}</span></div>
<div class="pc-row"><span class="pc-row-label">ì°¸ì—¬ìœ¨</span><span class="pc-row-val">${p.engage}%</span></div>
<div class="pc-row"><span class="pc-row-label">í´ë¦­ë¥ </span><span class="pc-row-val">${p.ctr}%</span></div>
<div class="pc-row"><span class="pc-row-label">ë„ë‹¬ìˆ˜</span><span class="pc-row-val">${p.reach>=1000?(p.reach/1000).toFixed(1)+'K':p.reach}</span></div>
<div class="pc-eff-bar">
<div class="pc-eff-row">
<span class="pc-grade ${grade.toLowerCase()}">${grade}</span>
<div>
<div style="font-size:.78em;font-weight:600;color:var(--t1)">ê¸€ë‹¹ ${roi}íšŒ ì¡°íšŒ</div>
<div class="pc-cost">â‚©${costPerView}/1Kë·° Â· ê¸€ë‹¹ â‚©${costPerPost}</div>
</div>
</div>
</div>`}
</div>`;
});
$('platform-cards').innerHTML=cardsHTML;

// í”Œë«í¼ ë¹„êµ ì°¨íŠ¸
let platHTML='';
const maxView=Math.max(...platformData.map(p=>p.views),1);
platformData.forEach(p=>{
const viewPct=Math.round(p.views/maxView*100);
platHTML+=`<div class="progress-row">
<div class="progress-label">
<div style="display:flex;align-items:center;gap:8px">
<div style="width:10px;height:10px;border-radius:50%;background:${p.id==='naver'?'#03C75A':p.id==='insta'?'#E4405F':p.id==='facebook'?'#1877F2':'var(--ac)'}"></div>
<b>${p.name}</b>
</div>
<span style="color:var(--ac);font-weight:600">${p.views.toLocaleString()}</span>
</div>
<div class="progress-bar">
<div class="progress-fill" style="width:${viewPct}%;background:${p.id==='naver'?'#03C75A':p.id==='insta'?'#E4405F':p.id==='facebook'?'#1877F2':'var(--ac)'}"></div>
</div>
</div>`;
});
$('platform-performance').innerHTML=platHTML;

// AI ì¸ì‚¬ì´íŠ¸ (ì‚­ì œëœ ìš”ì†Œ ì•ˆì „ ì²˜ë¦¬)
if($('ai-insight'))$('ai-insight').innerHTML='í”Œë«í¼ ì—°ê²° í›„ AIê°€ ì‹¤ì œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì‚¬ì´íŠ¸ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.';

// ê°•ì 
if($('strength-list')){
const strengths=[
'ë„¤ì´ë²„/Facebook ë¡œê·¸ì¸ ì‹œ ì‹¤ì œ ë°ì´í„° ë¶„ì„',
'í‚¤ì›Œë“œ ë¶„ì„ìœ¼ë¡œ ì½˜í…ì¸  ì „ëµ ìˆ˜ë¦½',
'AI ê¸°ë°˜ A/B í…ŒìŠ¤íŠ¸ë¡œ ìµœì  ì½˜í…ì¸  ì„ íƒ',
'í¬ë ˆë”§ ì‚¬ìš©ëŸ‰ ì‹¤ì‹œê°„ ì¶”ì '
];
$('strength-list').innerHTML=strengths.map(s=>`<div class="strength-item">${s}</div>`).join('');
}

// ì•½ì 
if($('weakness-list')){
const weaknesses=[
'í”Œë«í¼ ë¡œê·¸ì¸ìœ¼ë¡œ ì‹¤ì œ ë°ì´í„°ë¥¼ ì—°ë™í•´ì£¼ì„¸ìš”',
'ë°ì´í„° ì—°ë™ í›„ êµ¬ì²´ì  ê°œì„ ì ì´ í‘œì‹œë©ë‹ˆë‹¤',
'AI ë¶„ì„ ë²„íŠ¼ìœ¼ë¡œ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”',
'í‚¤ì›Œë“œ ë¶„ì„ íƒ­ì—ì„œ íŠ¸ë Œë“œë¥¼ íŒŒì•…í•´ë³´ì„¸ìš”'
];
$('weakness-list').innerHTML=weaknesses.map(w=>`<div class="strength-item weak">${w}</div>`).join('');
}

// ë‚´ ê¸€ í‚¤ì›Œë“œ ìˆœìœ„ ì´ˆê¸°í™”
const rankData=[];
function renderRankTable(data){
$('rank-tbody').innerHTML=(data||rankData).length===0?
'<tr><td colspan="6" style="text-align:center;padding:20px;color:var(--t3)">ë¡œê·¸ì¸ í›„ í‚¤ì›Œë“œ ìˆœìœ„ê°€ í‘œì‹œë©ë‹ˆë‹¤</td></tr>':
(data||rankData).map(r=>{
const diff=r.prev-r.rank;
const changeClass=diff>0?'up':diff<0?'down':'same';
const changeText=diff>0?'â–²'+diff:diff<0?'â–¼'+Math.abs(diff):'-';
const rankClass=r.rank<=5?'top':r.rank<=15?'mid':'low';
const platIcon=r.platform==='naver'?'<span class="p-logo naver" style="width:16px;height:16px;border-radius:4px;font-size:9px"></span>':r.platform==='insta'?'<span class="p-logo ig" style="width:16px;height:16px;border-radius:4px"></span>':'<span style="font-size:.8em">ğŸ”</span>';
return `<tr>
<td style="font-weight:600;color:var(--t1)">${r.kw}</td>
<td>${platIcon}</td>
<td><span class="rank-num ${rankClass}">${r.rank}ìœ„</span></td>
<td><span class="rank-change ${changeClass}">${changeText}</span></td>
<td style="color:var(--t3)">${r.best}ìœ„</td>
<td style="font-size:.72em;color:var(--t3);max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${r.post}">${r.post}</td>
</tr>`;
}).join('');
}
renderRankTable();

// í‚¤ì›Œë“œ ì¶”ê°€
function addTrackKeyword(){
const kw=$('rank-kw-input').value.trim();
const plat=$('rank-platform').value;
if(!kw){toast('âš ï¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');$('rank-kw-input').focus();return}
rankData.push({kw:kw,platform:plat,rank:'â€”',prev:'â€”',best:'â€”',post:'(ì¡°íšŒ í•„ìš”)'});
renderRankTable();
$('rank-kw-input').value='';
toast('âœ… "'+kw+'" ì¶”ì  ëª©ë¡ì— ì¶”ê°€ë¨');
}

// AI ìˆœìœ„ ì¡°íšŒ
async function checkMyRanking(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
toast('ğŸ” í‚¤ì›Œë“œ ìˆœìœ„ ë¶„ì„ ì¤‘...');
try{
const kwList=rankData.map(r=>r.kw).join(', ');
const r=await callAI(`LEDì „ê´‘íŒ/ì˜¥ì™¸ê´‘ê³ /ë°©ì†¡ì¤‘ê³„ ì—…ì²´ì˜ ë¸”ë¡œê·¸ í‚¤ì›Œë“œ ìˆœìœ„ë¥¼ ë¶„ì„í•´ì¤˜.

ì¶”ì  í‚¤ì›Œë“œ: ${kwList}

ê° í‚¤ì›Œë“œë³„ë¡œ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µí•´ì¤˜:
í‚¤ì›Œë“œ | ì˜ˆìƒìˆœìœ„(1-50) | ìˆœìœ„ë³€ë™(ìƒìŠ¹/í•˜ë½/ìœ ì§€, ëª‡ë‹¨ê³„) | ìˆœìœ„ ì˜¬ë¦¬ê¸° íŒ í•œì¤„

ë§ˆì§€ë§‰ì— "ğŸ’¡ ì¢…í•©:" ìœ¼ë¡œ ê°€ì¥ ì‹œê¸‰í•œ ê°œì„ ì´ í•„ìš”í•œ í‚¤ì›Œë“œì™€ ì „ëµ 2ì¤„.`);
const lines=r.split('\n').filter(l=>l.trim());
let analysisText='';
lines.forEach(line=>{
const parts=line.split('|');
if(parts.length>=3){
const kw=parts[0].trim();
const match=rankData.find(d=>kw.includes(d.kw)||d.kw.includes(kw));
if(match){
const newRank=parseInt(parts[1].trim())||match.rank;
match.prev=match.rank!=='â€”'?match.rank:newRank;
match.rank=newRank;
if(match.best==='â€”'||newRank<match.best)match.best=newRank;
}
}else if(line.includes('ì¢…í•©')||line.includes('ğŸ’¡')){
analysisText+=line.trim()+'\n';
}
});
renderRankTable();
if(analysisText.trim()){
$('rank-analysis').innerHTML='<b>'+analysisText.trim().replace(/\n/g,'<br>')+'</b>';
$('rank-detail').style.display='block';
}
toast('âœ… ìˆœìœ„ ë¶„ì„ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}}

// ê²½ìŸì‚¬ ë¹„êµ
const comparisons=[
{metric:'í‰ê·  ì¡°íšŒìˆ˜',ours:189,theirs:168,good:true},
{metric:'ì°¸ì—¬ìœ¨',ours:12.3,theirs:8.9,good:true},
{metric:'ê²Œì‹œ ë¹ˆë„',ours:3.5,theirs:2.3,good:true},
{metric:'ë™ì˜ìƒ ë¹„ìœ¨',ours:18,theirs:42,good:false}
];
$('competitor-compare').innerHTML=comparisons.map(c=>{
const diff=Math.round((c.ours-c.theirs)/c.theirs*100);
const badge=c.good?(diff>0?'good':'bad'):(diff<0?'good':'bad');
return `<div class="compare-row">
<div class="compare-label">${c.metric}</div>
<div class="compare-values">
<span class="compare-theirs">ê²½ìŸì‚¬: ${c.theirs}</span>
<span class="compare-ours">ìš°ë¦¬: ${c.ours}</span>
<span class="badge ${badge}">${diff>0?'+':''}${diff}%</span>
</div>
</div>`;
}).join('');
}

// ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
function refreshDash(){
const btn=$('dash-refresh-btn');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ê°±ì‹  ì¤‘...';
// ì‹¤ì œ ë°ì´í„° ë¡œë“œ
loadDashboardData();
// ê¸°ì¡´ ì°¨íŠ¸ë„ ê°±ì‹ 
trendData.forEach(d=>{
d.blog=Math.max(500,d.blog+Math.round((Math.random()-.4)*300));
d.insta=Math.max(300,d.insta+Math.round((Math.random()-.4)*250));
});
setTimeout(()=>{
rDash();
btn.disabled=false;btn.innerHTML='ğŸ”„ ìƒˆë¡œê³ ì¹¨';
toast('âœ… ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
},1200);
}

// AI ì „ì²´ ë¶„ì„
async function analyzeAll(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
toast('ğŸ¤– ì¢…í•© ë¶„ì„ ì¤‘...');
try{
const r=await callAI('SNS ì½˜í…ì¸  ì„±ê³¼ ë°ì´í„°ë¥¼ ë³´ê³  3ê°€ì§€ í•µì‹¬ ì¸ì‚¬ì´íŠ¸ì™€ êµ¬ì²´ì ì¸ ì‹¤í–‰ ë°©ì•ˆì„ ì œì‹œ. í”Œë«í¼: ë„¤ì´ë²„ë¸”ë¡œê·¸/ì¸ìŠ¤íƒ€/í˜ë¶/í™ˆí˜ì´ì§€. ì—…ê³„: LEDì „ê´‘íŒ/ì˜¥ì™¸ê´‘ê³ . ê°•ì : ë„¤ì´ë²„ íš¨ìœ¨ ì¢‹ìŒ, ì¸ìŠ¤íƒ€ ì°¸ì—¬ìœ¨ ë†’ìŒ. ì•½ì : í˜ë¶ ì €ì¡°, ì£¼ë§ ë¶€ì¡±. ê°„ê²°í•˜ê²Œ 3-4ë¬¸ì¥.');
if($('ai-insight'))$('ai-insight').innerHTML=r||'ë¶„ì„ ì™„ë£Œ';
toast('âœ… ë¶„ì„ ì™„ë£Œ')
}catch(e){toast('âŒ '+e.message)}}

// AI í‚¤ì›Œë“œ ì¶”ì²œ
// ëŒ€ì‹œë³´ë“œ í”Œë«í¼ë³„ í‚¤ì›Œë“œ íƒ­ ì „í™˜
function setDashKwTab(mode){
document.querySelectorAll('#dash-kw-pills .sub-pill').forEach(p=>p.classList.remove('a'));
event.target.classList.add('a');
$('dash-kw-blog').style.display=mode==='blog'?'block':'none';
$('dash-kw-insta').style.display=mode==='insta'?'block':'none';
$('dash-kw-fb').style.display=mode==='fb'?'block':'none';
$('dash-kw-place').style.display=mode==='place'?'block':'none';
}

// ì¸ìŠ¤íƒ€ í•´ì‹œíƒœê·¸ ì „ì²´ ë³µì‚¬
let lastInstaHashtags=[];
function copyInstaHashtags(){
if(lastInstaHashtags.length){
navigator.clipboard.writeText(lastInstaHashtags.map(h=>'#'+h).join(' ')).then(()=>toast('ğŸ“‹ í•´ì‹œíƒœê·¸ '+lastInstaHashtags.length+'ê°œ ë³µì‚¬ë¨!')).catch(()=>toast('ë³µì‚¬ ì‹¤íŒ¨'))
}}

// í”Œë«í¼ë³„ í‚¤ì›Œë“œ ë¶„ì„
async function getPlatformKw(platform){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
const inputId='pkw-'+platform+'-input';
const userKw=$(inputId)?.value?.trim()||'LEDì „ê´‘íŒ/ì˜¥ì™¸ê´‘ê³ ';
const btn=$('pkw-'+platform+'-btn');
if(btn){btn.disabled=true;btn.innerHTML='<span class="spinner"></span>'}
toast('ğŸ¤– '+userKw+' '+platform+' í‚¤ì›Œë“œ ë¶„ì„ ì¤‘...');

try{
// ì‹¤ì œ ê²€ìƒ‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
let realData='';
if(backendUrl){
try{
const nd=await callBackend('/api/naver-search',{query:userKw.split(/[,\/]/)[0].trim(),type:'blog',display:5});
if(nd&&nd.total)realData='\n[ë„¤ì´ë²„ ë¸”ë¡œê·¸: '+nd.total+'ê±´]';
}catch(e){}
}

if(platform==='blog'){
// ë¸”ë¡œê·¸ SEO í‚¤ì›Œë“œ
const r=await callAI(`"${userKw}" ì—…ì¢…ì˜ ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO í‚¤ì›Œë“œë¥¼ ë¶„ì„í•´ì¤˜.${realData}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹ ê·¸ëŒ€ë¡œ:
[ì œëª©ìš©]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ë³¸ë¬¸ìš©]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[íƒœê·¸ìš©]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ì „ëµ]
ë¸”ë¡œê·¸ SEO ì „ëµ 2~3ì¤„

ì ìˆ˜ëŠ” 100ì  ë§Œì . ê²€ìƒ‰ëŸ‰Â·ê²½ìŸë„ ê³ ë ¤.`);

parseBlogKw(r);
trackCredit(0.003,'ë¸”ë¡œê·¸ SEO í‚¤ì›Œë“œ');

}else if(platform==='insta'){
// ì¸ìŠ¤íƒ€ í•´ì‹œíƒœê·¸
const r=await callAI(`"${userKw}" ì—…ì¢…ì˜ ì¸ìŠ¤íƒ€ê·¸ë¨ í•´ì‹œíƒœê·¸ë¥¼ ì¶”ì²œí•´ì¤˜.${realData}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹:
[ëŒ€í˜•]
í•´ì‹œíƒœê·¸1
í•´ì‹œíƒœê·¸2
í•´ì‹œíƒœê·¸3
í•´ì‹œíƒœê·¸4
í•´ì‹œíƒœê·¸5
í•´ì‹œíƒœê·¸6
í•´ì‹œíƒœê·¸7
í•´ì‹œíƒœê·¸8
í•´ì‹œíƒœê·¸9
í•´ì‹œíƒœê·¸10

[ì¤‘í˜•]
í•´ì‹œíƒœê·¸1
í•´ì‹œíƒœê·¸2
í•´ì‹œíƒœê·¸3
í•´ì‹œíƒœê·¸4
í•´ì‹œíƒœê·¸5
í•´ì‹œíƒœê·¸6
í•´ì‹œíƒœê·¸7
í•´ì‹œíƒœê·¸8
í•´ì‹œíƒœê·¸9
í•´ì‹œíƒœê·¸10

[ì†Œí˜•]
í•´ì‹œíƒœê·¸1
í•´ì‹œíƒœê·¸2
í•´ì‹œíƒœê·¸3
í•´ì‹œíƒœê·¸4
í•´ì‹œíƒœê·¸5
í•´ì‹œíƒœê·¸6
í•´ì‹œíƒœê·¸7
í•´ì‹œíƒœê·¸8
í•´ì‹œíƒœê·¸9
í•´ì‹œíƒœê·¸10

[ì „ëµ]
í•´ì‹œíƒœê·¸ ì „ëµ 2ì¤„

ëŒ€í˜•: ê²Œì‹œë¬¼ 10ë§Œê°œ ì´ìƒ, ì¤‘í˜•: 1ë§Œ~10ë§Œ, ì†Œí˜•: 1ë§Œ ì´í•˜.
#ê¸°í˜¸ ì—†ì´ í‚¤ì›Œë“œë§Œ. í•œêµ­ì–´ ìœ„ì£¼.`);

parseInstaKw(r);
trackCredit(0.003,'ì¸ìŠ¤íƒ€ í•´ì‹œíƒœê·¸');

}else if(platform==='fb'){
// í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œ
const r=await callAI(`"${userKw}" ì—…ì¢…ì˜ í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œë¥¼ ì¶”ì²œí•´ì¤˜.${realData}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹:
[ê²Œì‹œê¸€ìš©]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ê´‘ê³ ìš©]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ì°¸ì—¬ìœ ë„]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ê³µìœ ìœ ë„]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ì „ëµ]
í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œ ì „ëµ 2~3ì¤„

ì ìˆ˜ 100ì  ë§Œì . ì°¸ì—¬ìœ¨Â·ë„ë‹¬ë¥  ê³ ë ¤.`);

parseFbKw(r);
trackCredit(0.003,'í˜ì´ìŠ¤ë¶ í‚¤ì›Œë“œ');

}else if(platform==='place'){
// í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ
const r=await callAI(`"${userKw}" ì—…ì¢…ì˜ ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œë¥¼ ì¶”ì²œí•´ì¤˜.${realData}

ë°˜ë“œì‹œ ì•„ë˜ í˜•ì‹:
[ë©”ì¸]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ì§€ì—­]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ë¦¬ë·°]
í‚¤ì›Œë“œ1 | ì ìˆ˜
í‚¤ì›Œë“œ2 | ì ìˆ˜
í‚¤ì›Œë“œ3 | ì ìˆ˜
í‚¤ì›Œë“œ4 | ì ìˆ˜
í‚¤ì›Œë“œ5 | ì ìˆ˜

[ì „ëµ]
í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ ì „ëµ 2ì¤„

ì ìˆ˜ 100ì  ë§Œì . ì§€ì—­ê²€ìƒ‰Â·ë°©ë¬¸ì „í™˜ ê³ ë ¤.`);

parsePlaceKw(r);
trackCredit(0.003,'í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ');
}

toast('âœ… '+platform+' í‚¤ì›Œë“œ ë¶„ì„ ì™„ë£Œ!');
}catch(e){toast('âŒ '+e.message)}
finally{if(btn){btn.disabled=false;btn.innerHTML='ğŸ¤– ë¶„ì„'}}
}

function makeKwPill(kw,score,color){
const s=score?score.replace(/[^0-9]/g,''):'';
return `<div class="kw-pill" onclick="useKeyword('${kw.replace(/'/g,"\\'")}')"><span>${kw}</span>${s?'<span class="kw-score" style="color:'+color+'">'+s+'</span>':''}</div>`;
}

function parseSectionKw(text,sectionName){
const regex=new RegExp('\\['+sectionName+'\\]([\\s\\S]*?)(?=\\[|$)','i');
const match=text.match(regex);
if(!match)return {pills:'',strategy:''};
const lines=match[1].trim().split('\n').filter(l=>l.trim());
let pills='';let strategy='';
lines.forEach(l=>{
const parts=l.split('|');
if(parts.length>=2){
pills+=makeKwPill(parts[0].trim().replace(/^\d+[\.\)]\s*/,''),parts[1].trim(),'var(--ac)');
}else if(l.trim().length>5&&!l.includes('|')){strategy+=l.trim()+'\n'}
});
return {pills,strategy};
}

function parseBlogKw(text){
const title=parseSectionKw(text,'ì œëª©ìš©');
const body=parseSectionKw(text,'ë³¸ë¬¸ìš©');
const tag=parseSectionKw(text,'íƒœê·¸ìš©');
const stratMatch=text.match(/\[ì „ëµ\]([\s\S]*?)$/i);
if(title.pills)$('pkw-blog-title').innerHTML=title.pills;
if(body.pills)$('pkw-blog-body').innerHTML=body.pills;
if(tag.pills)$('pkw-blog-tag').innerHTML=tag.pills;
const strat=stratMatch?stratMatch[1].trim():'';
if(strat){$('pkw-blog-insight').innerHTML='<b>ğŸ’¡ ë¸”ë¡œê·¸ SEO ì „ëµ:</b><br>'+strat;$('pkw-blog-insight').style.display='block'}
}

function parseInstaKw(text){
const sections={big:'ëŒ€í˜•',mid:'ì¤‘í˜•',small:'ì†Œí˜•'};
lastInstaHashtags=[];
Object.entries(sections).forEach(([key,name])=>{
const regex=new RegExp('\\['+name+'\\]([\\s\\S]*?)(?=\\[|$)','i');
const match=text.match(regex);
if(match){
const tags=match[1].trim().split('\n').filter(l=>l.trim()&&!l.includes('['));
const pills=tags.map(t=>{
const tag=t.trim().replace(/^[#\d\.\)\-\s]+/,'').trim();
if(tag){lastInstaHashtags.push(tag);return `<div class="kw-pill" onclick="useKeyword('#${tag.replace(/'/g,"\\'")}')"><span>#${tag}</span></div>`}
return '';
}).join('');
$('pkw-insta-'+key).innerHTML=pills||'<span style="color:var(--t3);font-size:.82em">ì—†ìŒ</span>';
}
});
if(lastInstaHashtags.length>0)$('pkw-insta-copy').style.display='block';
const stratMatch=text.match(/\[ì „ëµ\]([\s\S]*?)$/i);
if(stratMatch){$('pkw-insta-insight').innerHTML='<b>ğŸ’¡ í•´ì‹œíƒœê·¸ ì „ëµ:</b><br>'+stratMatch[1].trim();$('pkw-insta-insight').style.display='block'}
}

function parseFbKw(text){
const sections={post:'ê²Œì‹œê¸€ìš©',ad:'ê´‘ê³ ìš©',engage:'ì°¸ì—¬ìœ ë„',share:'ê³µìœ ìœ ë„'};
Object.entries(sections).forEach(([key,name])=>{
const parsed=parseSectionKw(text,name);
if(parsed.pills)$('pkw-fb-'+key).innerHTML=parsed.pills;
});
const stratMatch=text.match(/\[ì „ëµ\]([\s\S]*?)$/i);
if(stratMatch){$('pkw-fb-insight').innerHTML='<b>ğŸ’¡ í˜ì´ìŠ¤ë¶ ì „ëµ:</b><br>'+stratMatch[1].trim();$('pkw-fb-insight').style.display='block'}
}

function parsePlaceKw(text){
const sections={main:'ë©”ì¸',local:'ì§€ì—­',review:'ë¦¬ë·°'};
Object.entries(sections).forEach(([key,name])=>{
const parsed=parseSectionKw(text,name);
if(parsed.pills)$('pkw-place-'+key).innerHTML=parsed.pills;
});
const stratMatch=text.match(/\[ì „ëµ\]([\s\S]*?)$/i);
if(stratMatch){$('pkw-place-insight').innerHTML='<b>ğŸ’¡ í”Œë ˆì´ìŠ¤ ì „ëµ:</b><br>'+stratMatch[1].trim();$('pkw-place-insight').style.display='block'}
}

// í‚¤ì›Œë“œ í™œìš© (í´ë¦­ ì‹œ)
function useKeyword(kw){
navigator.clipboard.writeText(kw).then(()=>toast('ğŸ“‹ "'+kw+'" ë³µì‚¬ë¨!')).catch(()=>toast('í‚¤ì›Œë“œ: '+kw))
}

// ë ˆí¼ëŸ°ìŠ¤ ì°¾ê¸°
async function getReferences(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
if(!$('ref-keyword')){toast('âš ï¸ ë ˆí¼ëŸ°ìŠ¤ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');return}
const keyword=$('ref-keyword').value.trim();
const platform=$('ref-platform')?.value||'blog';
const platNames={blog:'ë„¤ì´ë²„ ë¸”ë¡œê·¸',insta:'ì¸ìŠ¤íƒ€ê·¸ë¨',fb:'í˜ì´ìŠ¤ë¶',all:'ì „ì²´ í”Œë«í¼'};
if(!keyword){toast('âš ï¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');if($('ref-keyword'))$('ref-keyword').focus();return}
const btn=$('ref-btn');if(btn){btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ë¶„ì„ ì¤‘...'}
toast('ğŸ“š ë ˆí¼ëŸ°ìŠ¤ ë¶„ì„ ì¤‘...');
try{
const prompt=`LEDì „ê´‘íŒ/ì˜¥ì™¸ê´‘ê³ /ë°©ì†¡ì¤‘ê³„ ì—…ê³„ì—ì„œ "${keyword}" ì£¼ì œë¡œ ${platNames[platform]}ì— ì˜¬ë¦´ ì½˜í…ì¸ ë¥¼ ìœ„í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì œê³µí•´ì¤˜.

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ 3ê°œì˜ ë ˆí¼ëŸ°ìŠ¤ ì½˜í…ì¸  êµ¬ì¡°ë¥¼ ì œì•ˆí•´ì¤˜:

[ë ˆí¼ëŸ°ìŠ¤ 1]
ì œëª©: (ì˜ˆì‹œ ì œëª©)
êµ¬ì¡°: (ê¸€ì˜ íë¦„/êµ¬ì„± ìš”ì•½)
í•µì‹¬ ì „ëµ: (ì™œ ì´ êµ¬ì¡°ê°€ íš¨ê³¼ì ì¸ì§€)
ì¶”ì²œ í‚¤ì›Œë“œ: (ì´ ê¸€ì— ë…¹ì¼ í‚¤ì›Œë“œ 3-5ê°œ)
ì˜ˆìƒ ì„±ê³¼: (ì´ëŸ° ìœ í˜•ì˜ ê¸€ì´ ë³´í†µ ì–´ë–¤ ë°˜ì‘ì„ ì–»ëŠ”ì§€)

[ë ˆí¼ëŸ°ìŠ¤ 2]
...

[ë ˆí¼ëŸ°ìŠ¤ 3]
...

ë§ˆì§€ë§‰ì— "ğŸ’¡ ì¢…í•© ì œì•ˆ:" ìœ¼ë¡œ 3ê°œ ë ˆí¼ëŸ°ìŠ¤ ì¤‘ ê°€ì¥ ì¶”ì²œí•˜ëŠ” ê²ƒê³¼ ì´ìœ ë¥¼ 2ì¤„ë¡œ.`;
const r=await callAI(prompt);

// Parse and display references as cards
let html='';
const refs=r.split(/\[ë ˆí¼ëŸ°ìŠ¤\s*\d+\]/g).filter(s=>s.trim());
if(refs.length>0){
html+='<div style="display:grid;gap:10px">';
refs.forEach((ref,i)=>{
const lines=ref.trim().split('\n').filter(l=>l.trim());
if(lines.length<2)return;
// Check if this is the summary line
const isSummary=ref.includes('ì¢…í•© ì œì•ˆ');
if(isSummary){
html+=`<div class="tip-box" style="margin-top:4px">${ref.trim().replace(/\n/g,'<br>')}</div>`;
return;
}
html+=`<div style="background:var(--bg4);border:1px solid var(--border);border-radius:var(--r2);padding:14px;border-left:3px solid ${i===0?'var(--ac)':i===1?'var(--b)':'var(--g)'}">
<div style="font-size:.78em;color:var(--t3);margin-bottom:4px">ë ˆí¼ëŸ°ìŠ¤ ${i+1}</div>
<div style="font-size:.85em;color:var(--t2);line-height:1.7;white-space:pre-wrap">${ref.trim()}</div>
<div style="margin-top:8px;display:flex;gap:4px">
<button class="ebtn" onclick="applyReference(${i},'${keyword}')">ğŸ“ ì´ êµ¬ì¡°ë¡œ ê¸€ì“°ê¸°</button>
<button class="ebtn" onclick="navigator.clipboard.writeText(this.closest('div[style]').querySelector('div[style*=pre-wrap]').textContent).then(()=>toast('ğŸ“‹ ë³µì‚¬ë¨'))">ğŸ“‹ ë³µì‚¬</button>
</div>
</div>`;
});
html+='</div>';
}else{
html=`<div style="font-size:.85em;color:var(--t2);line-height:1.7;white-space:pre-wrap;padding:10px;background:var(--bg4);border-radius:var(--r2)">${r}</div>`;
}
if($('ref-content'))$('ref-content').innerHTML=html;
if($('ref-results'))$('ref-results').style.display='block';
toast('âœ… ë ˆí¼ëŸ°ìŠ¤ ë¶„ì„ ì™„ë£Œ')
}catch(e){toast('âŒ '+e.message)}finally{if(btn){btn.disabled=false;btn.innerHTML='ğŸ” ë ˆí¼ëŸ°ìŠ¤ ì°¾ê¸°'}}}

// ë ˆí¼ëŸ°ìŠ¤ êµ¬ì¡°ë¥¼ ì½˜í…ì¸  íƒ­ì— ì ìš©
function applyReference(idx,keyword){
const activeNav=document.querySelector('.nav-i.a');
const currentTab=activeNav?activeNav.dataset.t:'blog';
if(currentTab==='blog'||currentTab==='dash'){
go('blog');
$('b-event').value=keyword;
toast('âœ… ë¸”ë¡œê·¸ íƒ­ì— í‚¤ì›Œë“œ ì ìš©ë¨ â€” ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”');
}else if(currentTab==='insta'){
$('i-content').value=keyword+' ê´€ë ¨ ì½˜í…ì¸ ';
toast('âœ… ì¸ìŠ¤íƒ€ íƒ­ì— í‚¤ì›Œë“œ ì ìš©ë¨');
}else if(currentTab==='fb'){
$('f-content').value=keyword+' ê´€ë ¨ ì½˜í…ì¸ ';
toast('âœ… í˜ì´ìŠ¤ë¶ íƒ­ì— í‚¤ì›Œë“œ ì ìš©ë¨');
}}


// === SMART PLACE ===
function setSpMode(mode){
document.querySelectorAll('#sp-pills .sub-pill').forEach(p=>p.classList.remove('a'));
event.target.classList.add('a');
$('sp-dashboard').style.display=mode==='dashboard'?'block':'none';
$('sp-myplace').style.display=mode==='myplace'?'block':'none';
$('sp-keyword').style.display=mode==='keyword'?'block':'none';
$('sp-ranking').style.display=mode==='ranking'?'block':'none';
if(mode==='myplace')updatePlacePreview();
}

// ìœ ì… ê²€ìƒ‰ì–´ ë°ì´í„°
const spSearchData=[
{rank:1,kw:'-',visits:0,pct:0,conv:0,trend:'same'},
{rank:2,kw:'-',visits:0,pct:0,conv:0,trend:'same'},
{rank:3,kw:'-',visits:0,pct:0,conv:0,trend:'same'},
{rank:4,kw:'-',visits:0,pct:0,conv:0,trend:'same'},
{rank:5,kw:'-',visits:0,pct:0,conv:0,trend:'same'}
];

function renderSpSearch(){
$('sp-search-tbody').innerHTML=spSearchData.map(s=>{
const trendIcon=s.trend==='up'?'<span class="rank-change up">â–²</span>':s.trend==='down'?'<span class="rank-change down">â–¼</span>':'<span class="rank-change same">-</span>';
const barW=Math.max(20,Math.round(s.pct/30*100));
return `<tr>
<td style="font-weight:600;color:var(--t3)">${s.rank}</td>
<td style="font-weight:600;color:var(--t1)">${s.kw}</td>
<td><span style="color:var(--ac);font-weight:600;font-family:var(--fm)">${s.visits}</span></td>
<td><div style="display:flex;align-items:center;gap:6px"><div style="background:linear-gradient(90deg,#03C75A,#03C75A88);height:6px;width:${barW}%;border-radius:3px;min-width:15px"></div><span style="font-size:.8em">${s.pct}%</span></div></td>
<td style="color:${s.conv>=10?'var(--g)':'var(--t2)'};font-weight:${s.conv>=10?'600':'400'}">${s.conv}%</td>
<td>${trendIcon}</td>
</tr>`;
}).join('');
}

// ì£¼ê°„ í–‰ë™ íŠ¸ë Œë“œ
const spTrendData={
views:[{day:'ì›”',cur:0,prev:0},{day:'í™”',cur:0,prev:0},{day:'ìˆ˜',cur:0,prev:0},{day:'ëª©',cur:0,prev:0},{day:'ê¸ˆ',cur:0,prev:0},{day:'í† ',cur:0,prev:0},{day:'ì¼',cur:0,prev:0}],
calls:[{day:'ì›”',cur:0,prev:0},{day:'í™”',cur:0,prev:0},{day:'ìˆ˜',cur:0,prev:0},{day:'ëª©',cur:0,prev:0},{day:'ê¸ˆ',cur:0,prev:0},{day:'í† ',cur:0,prev:0},{day:'ì¼',cur:0,prev:0}]
};
let spTrendMode='views';

function setSpTrend(mode){
spTrendMode=mode;
document.querySelectorAll('#sp-trend-tabs .trend-tab').forEach(t=>t.classList.remove('a'));
event.target.classList.add('a');
renderSpTrend();
}

function renderSpTrend(){
const data=spTrendData[spTrendMode];
const maxVal=Math.max(...data.map(d=>Math.max(d.cur,d.prev)),1);
$('sp-trend-chart').innerHTML=data.map(d=>{
const curH=Math.max(8,Math.round(d.cur/maxVal*140));
const prevH=Math.max(8,Math.round(d.prev/maxVal*140));
return `<div style="flex:1;display:flex;flex-direction:column;align-items:center">
<div class="trend-bar-group">
<div class="trend-bar" style="height:${prevH}px;background:var(--bg4);border:1px solid var(--border)" title="ì§€ë‚œì£¼ ${d.prev}"></div>
<div class="trend-bar" style="height:${curH}px;background:#03C75A" title="ì´ë²ˆì£¼ ${d.cur}"></div>
</div>
<div class="trend-day-label">${d.day}</div>
</div>`;
}).join('');
}

// ì „í™˜ í¼ë„
function renderSpFunnel(){
const funnel=[
{name:'ê²€ìƒ‰ ë…¸ì¶œ',val:0,color:'var(--t2)'},
{name:'í”Œë ˆì´ìŠ¤ í´ë¦­',val:0,color:'#03C75A'},
{name:'ìƒì„¸ ì •ë³´ í™•ì¸',val:0,color:'var(--b)'},
{name:'ì „í™” ì—°ê²°',val:0,color:'var(--ac)'},
{name:'ì‹¤ì œ ë°©ë¬¸ (ì¶”ì •)',val:0,color:'var(--g)'}
];
const maxVal=Math.max(...funnel.map(f=>f.val),1);
$('sp-funnel').innerHTML=funnel.map((f,i)=>{
const w=Math.max(25,Math.round(f.val/maxVal*100));
const convRate=i>0?((f.val/funnel[i-1].val)*100).toFixed(1)+'%':'â€”';
return `<div style="display:flex;align-items:center;gap:10px;margin-bottom:6px">
<div style="width:100px;text-align:right;font-size:.78em;color:var(--t2);flex-shrink:0">${f.name}</div>
<div style="flex:1;position:relative">
<div style="background:${f.color};height:28px;width:${w}%;border-radius:6px;opacity:.75;display:flex;align-items:center;padding-left:10px">
<span style="font-size:.78em;font-weight:600;color:#fff">${f.val.toLocaleString()}</span>
</div>
</div>
<div style="width:45px;text-align:right;font-size:.72em;color:var(--t3);flex-shrink:0">${convRate}</div>
</div>`;
}).join('')+'<div style="text-align:right;font-size:.7em;color:var(--t3);margin-top:4px">â† ë‹¨ê³„ë³„ ì „í™˜ìœ¨</div>';
}

function rSP(){
renderSpSearch();
renderSpTrend();
renderSpFunnel();
updatePlacePreview();
}

// ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤ ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
function refreshSpDash(){
const btn=$('sp-refresh-btn');
btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ê°±ì‹  ì¤‘...';
// ë°ì´í„° ë³€ë™
spSearchData.forEach(s=>{
s.visits=Math.max(10,s.visits+Math.round((Math.random()-.4)*30));
s.conv=Math.max(1,parseFloat((s.conv+(Math.random()-.4)*2).toFixed(1)));
});
const totalVisits=spSearchData.reduce((a,b)=>a+b.visits,0);
spSearchData.forEach(s=>s.pct=parseFloat((s.visits/totalVisits*100).toFixed(1)));
Object.values(spTrendData).forEach(arr=>{
arr.forEach(d=>{d.prev=d.cur;d.cur=Math.max(1,d.cur+Math.round((Math.random()-.4)*d.cur*0.15));});
});
const curViews=parseInt($('sp-views').textContent.replace(/,/g,''))||0;
const curCalls=parseInt($('sp-calls').textContent)||0;
const newViews=Math.max(0,curViews+Math.round((Math.random()-.3)*100));
const newCalls=Math.max(0,curCalls+Math.round((Math.random()-.3)*5));
setTimeout(()=>{
$('sp-views').textContent=newViews.toLocaleString();
$('sp-calls').textContent=newCalls;
renderSpSearch();
renderSpTrend();
renderSpFunnel();
btn.disabled=false;btn.innerHTML='ğŸ”„ ìƒˆë¡œê³ ì¹¨';
toast('âœ… í”Œë ˆì´ìŠ¤ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
},800);
}

// í”Œë ˆì´ìŠ¤ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
function updatePlacePreview(){
const name=$('mp-name').value||'ì—…ì²´ëª… ë¯¸ì…ë ¥';
const cat=$('mp-category').value;
const phone=$('mp-phone').value||'â€”';
const hours=$('mp-hours').value||'â€”';
const addr=$('mp-addr').value||'â€”';
const url=$('mp-url').value||'â€”';
const desc=$('mp-desc').value||'ì†Œê°œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”';
const services=$('mp-services').value;
const tags=$('mp-tags').value;

$('mp-prev-name').textContent=name;
$('mp-prev-cat').textContent=cat;
$('mp-prev-phone').textContent=phone;
$('mp-prev-hours').textContent=hours;
$('mp-prev-addr').textContent=addr;
$('mp-prev-url').textContent=url.replace(/^https?:\/\//,'');
$('mp-prev-desc').textContent=desc;

// ì„œë¹„ìŠ¤ íƒœê·¸
if(services.trim()){
$('mp-prev-services').innerHTML=services.split(',').map(s=>s.trim()).filter(s=>s).map(s=>
`<span style="padding:4px 10px;background:var(--bg4);border:1px solid var(--border);border-radius:6px;font-size:.75em;color:var(--t1)">${s}</span>`
).join('');
}else{$('mp-prev-services').innerHTML='<span style="font-size:.75em;color:var(--t3)">ì„œë¹„ìŠ¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>'}

// í‚¤ì›Œë“œ íƒœê·¸
if(tags.trim()){
$('mp-prev-tags').innerHTML=tags.split(',').map(t=>t.trim()).filter(t=>t).map(t=>
`<span style="padding:3px 8px;background:rgba(3,199,90,.08);border:1px solid rgba(3,199,90,.2);border-radius:12px;font-size:.7em;color:#03C75A">#${t}</span>`
).join('');
}else{$('mp-prev-tags').innerHTML='<span style="font-size:.75em;color:var(--t3)">í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</span>'}

// ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
const filledImg=document.querySelector('#mp-imgs .isl.filled img');
if(filledImg){
$('mp-prev-img').innerHTML='<img src="'+filledImg.src+'" style="width:100%;height:100%;object-fit:cover">';
}
}

// AI í”Œë ˆì´ìŠ¤ í”„ë¡œí•„ ì§„ë‹¨
async function diagnosePlaceProfile(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
const btn=$('mp-diag-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ì§„ë‹¨ ì¤‘...';
const name=$('mp-name').value||'(ë¯¸ì…ë ¥)';
const cat=$('mp-category').value;
const desc=$('mp-desc').value||'(ë¯¸ì…ë ¥)';
const services=$('mp-services').value||'(ë¯¸ì…ë ¥)';
const tags=$('mp-tags').value||'(ë¯¸ì…ë ¥)';
const addr=$('mp-addr').value||'(ë¯¸ì…ë ¥)';
const strength=$('mp-desc').value||'';
toast('ğŸ¤– í”„ë¡œí•„ ì§„ë‹¨ ì¤‘...');
try{
const r=await callAI(`ë„¤ì´ë²„ ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤(í”Œë ˆì´ìŠ¤) í”„ë¡œí•„ì„ ì§„ë‹¨í•´ì¤˜.

ì—…ì²´ ì •ë³´:
- ì—…ì²´ëª…: ${name}
- ì—…ì¢…: ${cat}
- ì£¼ì†Œ: ${addr}
- ì†Œê°œê¸€: ${desc}
- ì„œë¹„ìŠ¤: ${services}
- í‚¤ì›Œë“œ íƒœê·¸: ${tags}

ë‹¤ìŒì„ ë¶„ì„í•´ì¤˜:
1) í”„ë¡œí•„ ì™„ì„±ë„ (100ì  ë§Œì , ì ìˆ˜ì™€ ë¶€ì¡±í•œ ë¶€ë¶„)
2) ì†Œê°œê¸€ ê°œì„ ì•ˆ (ê²€ìƒ‰ ìµœì í™”ëœ ë²„ì „ìœ¼ë¡œ ë‹¤ì‹œ ì‘ì„±)
3) í‚¤ì›Œë“œ íƒœê·¸ ì§„ë‹¨ (ë¹ ì§„ í•„ìˆ˜ í‚¤ì›Œë“œ, ë¶ˆí•„ìš”í•œ í‚¤ì›Œë“œ)
4) ì„œë¹„ìŠ¤/ë©”ë‰´ ë“±ë¡ ê°œì„ ì•ˆ
5) ê²½ìŸì—…ì²´ ëŒ€ë¹„ ì°¨ë³„ì ì„ ë¶€ê°ì‹œí‚¬ ìˆ˜ ìˆëŠ” íŒ 2ê°€ì§€

ê° í•­ëª© 2-3ì¤„ì”© ê°„ê²°í•˜ê²Œ.`);
$('mp-diag-content').innerHTML='<b>ğŸ¤– AI í”„ë¡œí•„ ì§„ë‹¨ ê²°ê³¼</b><br><br>'+r.replace(/\n/g,'<br>');
$('mp-diag-result').style.display='block';
toast('âœ… ì§„ë‹¨ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}finally{
btn.disabled=false;btn.innerHTML='ğŸ¤– AI í”Œë ˆì´ìŠ¤ í”„ë¡œí•„ ì§„ë‹¨';
}}

// í‚¤ì›Œë“œ ìµœì í™” AI ë¶„ì„
async function analyzeSpKeywords(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
const btn=$('sp-kw-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>AI ë¶„ì„ ì¤‘...';
const bizType=$('sp-biz-type').value;
const area=$('sp-biz-area').value;
const name=$('sp-biz-name').value||'(ë¯¸ì…ë ¥)';
const service=$('sp-biz-service').value||'(ë¯¸ì…ë ¥)';
const currentKw=$('sp-biz-current-kw').value||'(ë¯¸ë“±ë¡)';
const strength=$('sp-biz-strength').value||'(ë¯¸ì…ë ¥)';
toast('ğŸ¤– í‚¤ì›Œë“œ ìµœì í™” ë¶„ì„ ì¤‘...');
try{
// 1) ì¶”ì²œ í‚¤ì›Œë“œ
const r1=await callAI(`ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤(ìŠ¤ë§ˆíŠ¸í”Œë ˆì´ìŠ¤) í‚¤ì›Œë“œ ìµœì í™” ë¶„ì„ì„ í•´ì¤˜.

ì—…ì²´ ì •ë³´:
- ì—…ì¢…: ${bizType}
- ì§€ì—­: ${area}
- ì—…ì²´ëª…: ${name}
- ì£¼ìš” ì„œë¹„ìŠ¤: ${service}
- í˜„ì¬ ë“±ë¡ í‚¤ì›Œë“œ: ${currentKw}
- ê°•ì : ${strength}

1) í”Œë ˆì´ìŠ¤ì— ë°˜ë“œì‹œ ì¶”ê°€í•´ì•¼ í•  ì¶”ì²œ í‚¤ì›Œë“œ 10ê°œë¥¼ ì•Œë ¤ì¤˜.
í˜•ì‹: "í‚¤ì›Œë“œ | ìš°ì„ ìˆœìœ„(í•„ìˆ˜/ì¶”ì²œ/ë³´ì¡°) | ì˜ˆìƒ ì›” ê²€ìƒ‰ëŸ‰ | ì¶”ì²œ ì´ìœ "
ì˜ˆ: LEDì „ê´‘íŒ ì„¤ì¹˜ | í•„ìˆ˜ | 3,200 | í•µì‹¬ ì„œë¹„ìŠ¤ í‚¤ì›Œë“œ

2) í˜„ì¬ í‚¤ì›Œë“œ(${currentKw}) ì§„ë‹¨: ë¹ ì§„ í‚¤ì›Œë“œ, ë¶ˆí•„ìš”í•œ í‚¤ì›Œë“œ, ê°œì„ ì ì„ 3ì¤„ë¡œ.

êµ¬ë¶„ì "---" ë¡œ 1)ê³¼ 2)ë¥¼ ë‚˜ëˆ ì¤˜.`);

const parts=r1.split('---');
const kwPart=parts[0]||r1;
const diagPart=parts[1]||'';

// ì¶”ì²œ í‚¤ì›Œë“œ íŒŒì‹±
const kwLines=kwPart.split('\n').filter(l=>l.includes('|'));
let kwHTML='<div style="display:grid;gap:6px">';
kwLines.forEach(line=>{
const p=line.split('|');
if(p.length>=3){
const kw=p[0].trim().replace(/^\d+[\.\)]\s*/,'');
const priority=p[1].trim();
const vol=p[2].trim();
const reason=p[3]?p[3].trim():'';
const pColor=priority.includes('í•„ìˆ˜')?'var(--ac)':priority.includes('ì¶”ì²œ')?'var(--g)':'var(--b)';
const pBg=priority.includes('í•„ìˆ˜')?'rgba(249,115,22,.12)':priority.includes('ì¶”ì²œ')?'rgba(52,211,153,.12)':'rgba(96,165,250,.12)';
kwHTML+=`<div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:var(--bg4);border-radius:var(--r2);border-left:3px solid ${pColor}">
<span style="font-size:.7em;padding:2px 8px;border-radius:8px;background:${pBg};color:${pColor};font-weight:600;flex-shrink:0">${priority}</span>
<span style="font-weight:600;color:var(--t1);flex:1">${kw}</span>
<span style="font-size:.75em;color:var(--t3);flex-shrink:0">ê²€ìƒ‰ ${vol}</span>
<button class="ebtn" onclick="navigator.clipboard.writeText('${kw.replace(/'/g,"\\'")}').then(()=>toast('ğŸ“‹ ë³µì‚¬ë¨'))" style="flex-shrink:0">ë³µì‚¬</button>
</div>`;
}
});
kwHTML+='</div>';
$('sp-rec-keywords').innerHTML=kwHTML;
$('sp-kw-diagnosis').textContent=diagPart.trim()||'ì§„ë‹¨ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

// 2) í‚¤ì›Œë“œ ì „ëµ
const r2=await callAI(`${area}ì—ì„œ ${bizType} ì—…ì¢…ì˜ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ í‚¤ì›Œë“œ ì „ëµì„ ì•Œë ¤ì¤˜.

1) ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ ë°°ì¹˜ ì „ëµ (ì—…ì²´ ì†Œê°œ, ë©”ë‰´/ì„œë¹„ìŠ¤, íƒœê·¸ ê°ê°ì— ì–´ë–¤ í‚¤ì›Œë“œë¥¼ ë„£ì„ì§€)
2) ê²½ìŸì—…ì²´ì™€ ì°¨ë³„í™”í•  ìˆ˜ ìˆëŠ” í‹ˆìƒˆ í‚¤ì›Œë“œ 3ê°œ
3) ê³„ì ˆ/ì‹œê¸°ë³„ ì¶”ê°€í•´ì•¼ í•  í‚¤ì›Œë“œ
4) í”¼í•´ì•¼ í•  í‚¤ì›Œë“œ (ê³¼ë„í•œ í‚¤ì›Œë“œ ìŠ¤í„°í•‘ ë“±)

ê° í•­ëª© 2-3ì¤„ë¡œ ê°„ê²°í•˜ê²Œ.`);
$('sp-kw-strategy').textContent=r2||'';

$('sp-kw-results').style.display='block';
toast('âœ… ë¶„ì„ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}finally{
btn.disabled=false;btn.innerHTML='ğŸ¤– AI í‚¤ì›Œë“œ ìµœì í™” ë¶„ì„';
}}

// ìœ ì… ê²€ìƒ‰ì–´ AI ìƒˆë¡œê³ ì¹¨
async function refreshSpKeywords(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
toast('ğŸ”„ ê²€ìƒ‰ì–´ ë¶„ì„ ì¤‘...');
try{
const r=await callAI(`LEDì „ê´‘íŒ/ë°©ì†¡ì¤‘ê³„ ì—…ì²´ì˜ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ìœ ì… ê²€ìƒ‰ì–´ TOP 10ì„ ì‹¤ì œì ìœ¼ë¡œ ì‹œë®¬ë ˆì´ì…˜í•´ì¤˜.
í˜•ì‹: "ìˆœìœ„ | ê²€ìƒ‰ì–´ | ìœ ì…ìˆ˜ | ë¹„ìœ¨(%) | ì „í™˜ìœ¨(%) | ì¶”ì´(up/down/same)"
ì˜ˆ: 1 | LEDì „ê´‘íŒ ì„¤ì¹˜ | 342 | 28.5 | 12.3 | up`);
const lines=r.split('\n').filter(l=>l.includes('|'));
const newData=[];
lines.forEach((line,i)=>{
const p=line.split('|');
if(p.length>=5){
newData.push({
rank:i+1,
kw:p[1].trim(),
visits:parseInt(p[2].trim())||0,
pct:parseFloat(p[3].trim())||0,
conv:parseFloat(p[4].trim())||0,
trend:(p[5]||'same').trim()
});
}
});
if(newData.length>0){
spSearchData.length=0;
newData.forEach(d=>spSearchData.push(d));
renderSpSearch();
}
toast('âœ… ì—…ë°ì´íŠ¸ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}}

// ì§€ì—­ ìˆœìœ„ ì¡°íšŒ
async function checkSpRanking(){
if(!backendUrl&&!apiKey){toast('âš ï¸ ì—°ê²° ì˜¤ë¥˜');return}
const kw=$('sp-rank-kw').value.trim();
const area=$('sp-rank-area').value;
if(!kw){toast('âš ï¸ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');$('sp-rank-kw').focus();return}
const btn=$('sp-rank-btn');btn.disabled=true;btn.innerHTML='<span class="spinner"></span>ì¡°íšŒ ì¤‘...';
toast('ğŸ† ìˆœìœ„ ë¶„ì„ ì¤‘...');
try{
const r=await callAI(`"${kw}" í‚¤ì›Œë“œë¡œ "${area}" ì§€ì—­ì—ì„œ ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ê²€ìƒ‰ ì‹œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” ì—…ì²´ ìˆœìœ„ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•´ì¤˜.

1) ìƒìœ„ 10ê°œ ì—…ì²´ ë¦¬ìŠ¤íŠ¸:
í˜•ì‹: "ìˆœìœ„ | ì—…ì²´ëª… | í‰ì  | ë¦¬ë·°ìˆ˜ | ê°•ì í‚¤ì›Œë“œ"
ë‚´ ì—…ì²´(LEDì „ê´‘íŒ ì „ë¬¸ì—…ì²´)ë¥¼ 3~8ìœ„ ì‚¬ì´ì— ë°°ì¹˜í•˜ê³  "(ë‚´ ì—…ì²´)" í‘œì‹œí•´ì¤˜.

2) ë‚´ ì—…ì²´ì˜ ìˆœìœ„ì™€ ì´ ê²½ìŸì—…ì²´ ìˆ˜ë¥¼ ì•Œë ¤ì¤˜.
í˜•ì‹: "ë‚´ìˆœìœ„: Nìœ„ | ì´ì—…ì²´: Mê°œ"

3) ìˆœìœ„ë¥¼ ì˜¬ë¦¬ê¸° ìœ„í•œ êµ¬ì²´ì  ì „ëµ 3ê°€ì§€ (ê° 1-2ì¤„)

êµ¬ë¶„ì "---" ë¡œ ë‚˜ëˆ ì¤˜.`);

const parts=r.split('---');

// ìˆœìœ„ í…Œì´ë¸”
const tablePart=parts[0]||'';
const lines=tablePart.split('\n').filter(l=>l.includes('|'));
let myRank='â€”';let totalBiz='â€”';
$('sp-rank-tbody').innerHTML=lines.map(line=>{
const p=line.split('|');
if(p.length<4)return '';
const rank=p[0].trim().replace(/[^\d]/g,'');
const name=p[1].trim();
const rating=p[2].trim();
const reviews=p[3].trim();
const tags=p[4]?p[4].trim():'';
const isMe=name.includes('ë‚´ ì—…ì²´')||name.includes('ìš°ë¦¬');
if(isMe)myRank=rank;
return `<tr style="${isMe?'background:rgba(249,115,22,.08);':''}">
<td><span class="rank-num ${parseInt(rank)<=3?'top':parseInt(rank)<=7?'mid':'low'}">${rank}</span></td>
<td style="font-weight:600;color:${isMe?'var(--ac)':'var(--t1)'}">${name}</td>
<td>${rating}</td>
<td>${reviews}</td>
<td style="font-size:.72em;color:var(--t3)">${tags}</td>
</tr>`;
}).join('');

// ë©”íƒ€ ì •ë³´
const metaPart=parts[1]||'';
const metaMatch=metaPart.match(/ì´ì—…ì²´[:\s]*(\d+)/);
if(metaMatch)totalBiz=metaMatch[1];
if(myRank==='â€”'){const rm=metaPart.match(/ë‚´ìˆœìœ„[:\s]*(\d+)/);if(rm)myRank=rm[1];}

$('sp-my-rank').textContent=myRank!=='â€”'?myRank+'ìœ„':'â€”';
$('sp-my-rank-sub').textContent=`"${kw}" ê²€ìƒ‰ ê¸°ì¤€ (${area})`;
$('sp-total-biz').textContent=totalBiz!=='â€”'?totalBiz+'ê°œ':'ì•½ 45ê°œ';
$('sp-total-biz-sub').textContent=`${area} ë™ì¼ ì—…ì¢…`;

// ì „ëµ
const stratPart=parts[2]||'';
if(stratPart.trim()){
$('sp-rank-analysis').textContent=stratPart.trim();
$('sp-rank-analysis-box').style.display='block';
}

// í‚¤ì›Œë“œë³„ ìˆœìœ„ ì¶”ì ì— ì¶”ê°€
addRankHistory(kw,area,myRank);

toast('âœ… ìˆœìœ„ ì¡°íšŒ ì™„ë£Œ');
}catch(e){toast('âŒ '+e.message)}finally{
btn.disabled=false;btn.innerHTML='ğŸ† ìˆœìœ„ ì¡°íšŒ';
}}

// ìˆœìœ„ ì¶”ì  íˆìŠ¤í† ë¦¬
const spRankHistory=[];
function addRankHistory(kw,area,rank){
const existing=spRankHistory.find(h=>h.kw===kw&&h.area===area);
if(existing){
existing.prev=existing.rank;
existing.rank=parseInt(rank)||'â€”';
}else{
spRankHistory.push({kw,area,rank:parseInt(rank)||'â€”',prev:'â€”',month:parseInt(rank)+Math.floor(Math.random()*5)-2||'â€”',target:Math.max(1,(parseInt(rank)||5)-3)});
}
renderRankHistory();
}

function renderRankHistory(){
$('sp-rank-history').innerHTML=spRankHistory.map(h=>{
const diff=h.prev!=='â€”'&&h.rank!=='â€”'?h.prev-h.rank:0;
const changeClass=diff>0?'up':diff<0?'down':'same';
const changeText=diff>0?'â–²'+diff:diff<0?'â–¼'+Math.abs(diff):'â€”';
const rankClass=h.rank!=='â€”'?(h.rank<=5?'top':h.rank<=10?'mid':'low'):'';
return `<tr>
<td style="font-weight:600;color:var(--t1)">${h.kw}</td>
<td style="font-size:.8em;color:var(--t3)">${h.area}</td>
<td><span class="rank-num ${rankClass}">${h.rank!=='â€”'?h.rank+'ìœ„':'â€”'}</span></td>
<td><span class="rank-change ${changeClass}">${changeText}</span></td>
<td style="color:var(--t3)">${h.month!=='â€”'?h.month+'ìœ„':'â€”'}</td>
<td style="color:var(--g);font-weight:600">${h.target}ìœ„</td>
</tr>`;
}).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--t3);padding:16px">í‚¤ì›Œë“œ ìˆœìœ„ë¥¼ ì¡°íšŒí•˜ë©´ ìë™ìœ¼ë¡œ ì¶”ì ë©ë‹ˆë‹¤</td></tr>';
}

// === INIT ===
initLogin();initUserState();
try{initMnav();rOOH();rOOHT();rDash();rSP();renderRankHistory();renderStyleDash();renderCmpHistory();renderKwrRecent();renderKwrSaved();}catch(e){console.error('Init error:',e)}
if(backendUrl)loadDashboardData();
// Landing page mock bars
// ===== ë‹¤ìš´ë¡œë“œ ì„¼í„° =====
let dlHistory=JSON.parse(localStorage.getItem('dl_history')||'[]');

function addDlHistory(type,format,name){
dlHistory.unshift({type,format,name,date:new Date().toLocaleString('ko-KR')});
if(dlHistory.length>50)dlHistory=dlHistory.slice(0,50);
try{localStorage.setItem('dl_history',JSON.stringify(dlHistory))}catch(e){}
renderDlHistory();
}

function renderDlHistory(){
const el=$('dl-history-list');if(!el)return;
if($('dl-history-count'))$('dl-history-count').textContent=dlHistory.length;
if(dlHistory.length===0){
el.innerHTML='<div style="text-align:center;padding:30px 20px;color:var(--t3)"><div style="font-size:2em;margin-bottom:8px;opacity:.4">ğŸ“¥</div><div style="font-size:.88em">ë‹¤ìš´ë¡œë“œ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</div></div>';return;
}
const icons={keyword:'ğŸ”',compare:'âš–ï¸',ad:'ğŸ“¢',blog:'ğŸ“',insta:'ğŸ“·',fb:'ğŸ‘',period:'ğŸ“†'};
const fmtBadge={pdf:'<span style="font-size:.65em;padding:2px 8px;border-radius:6px;background:rgba(249,115,22,.1);color:var(--ac);font-weight:600">PDF</span>',
csv:'<span style="font-size:.65em;padding:2px 8px;border-radius:6px;background:rgba(96,165,250,.1);color:var(--b);font-weight:600">CSV</span>',
text:'<span style="font-size:.65em;padding:2px 8px;border-radius:6px;background:rgba(52,211,153,.1);color:var(--g);font-weight:600">TEXT</span>'};
el.innerHTML=dlHistory.slice(0,20).map(h=>`<div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:var(--bg4);border-radius:var(--r2);margin-bottom:4px;border-left:3px solid ${h.format==='pdf'?'var(--ac)':h.format==='csv'?'var(--b)':'var(--g)'}">
<span style="font-size:1.1em">${icons[h.type]||'ğŸ“„'}</span>
<div style="flex:1;min-width:0"><div style="font-size:.82em;font-weight:600;color:var(--t1);overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${h.name}</div><div style="font-size:.68em;color:var(--t3)">${h.date}</div></div>
${fmtBadge[h.format]||''}
</div>`).join('');
}

function clearDlHistory(){
dlHistory=[];
try{localStorage.removeItem('dl_history')}catch(e){}
renderDlHistory();
toast('ğŸ—‘ï¸ ë‹¤ìš´ë¡œë“œ ì´ë ¥ ì´ˆê¸°í™”');
}

function goAndDownload(tab,format){
const kwrHasData=$('kwr-results')?.style.display!=='none';
if(tab==='kwresearch'&&!kwrHasData){
toast('âš ï¸ í‚¤ì›Œë“œ ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”');
go('kwresearch');return;
}
if(format==='pdf'){downloadKwrPDF();addDlHistory('keyword','pdf','í‚¤ì›Œë“œ ë¶„ì„: '+($('kwr-input')?.value||''));}
if(format==='csv'){downloadKwrCSV();addDlHistory('keyword','csv','í‚¤ì›Œë“œ ë¶„ì„: '+($('kwr-input')?.value||''));}
}

function downloadCompareReport(format){
const myScore=$('cmp-my-score')?.textContent;
if(!myScore||myScore==='â€”'){toast('âš ï¸ ë¹„êµ ë¶„ì„ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”');go('compare');return;}
if(format==='csv'){
let csv='\uFEFFë¹„êµ ë¶„ì„ ë¦¬í¬íŠ¸\nìƒì„±ì¼: '+new Date().toLocaleDateString('ko-KR')+'\n\n';
csv+='í•­ëª©,ë‚´ ì½˜í…ì¸ ,ê²½ìŸì‚¬ í‰ê· \n';
csv+='ì¢…í•© ì ìˆ˜,'+($('cmp-my-score')?.textContent||'')+','+($('cmp-comp-score')?.textContent||'')+'\n';
csv+='ìš°ì„¸ í•­ëª©,'+($('cmp-win-count')?.textContent||'')+'\n';
csv+='ê°œì„  í•„ìš”,'+($('cmp-lose-count')?.textContent||'')+'\n\n';
const strategy=$('cmp-strategy')?.textContent||'';
if(strategy)csv+='AI ì „ëµ\n'+strategy.replace(/,/g,' ')+'\n';
const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='compare-report-'+new Date().toISOString().slice(0,10)+'.csv';a.click();
addDlHistory('compare','csv','ë¹„êµ ë¶„ì„');toast('âœ… CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}else{toast('ğŸ“„ ë¹„êµ ë¶„ì„ PDFëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤');addDlHistory('compare','pdf','ë¹„êµ ë¶„ì„');}
}

function downloadAdReport(format){
const adName=$('ad-name')?.value;
if(!adName){toast('âš ï¸ ê´‘ê³  ì„¤ì •ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”');go('adsim');return;}
if(format==='csv'){
let csv='\uFEFFê´‘ê³  ì‹œë®¬ë ˆì´ì…˜ ë¦¬í¬íŠ¸\nìƒì„±ì¼: '+new Date().toLocaleDateString('ko-KR')+'\n\n';
csv+='ê´‘ê³ ëª…,'+adName+'\n';
csv+='ì˜ˆì‚°,'+($('ad-budget-v')?.textContent||'')+'\n';
csv+='íƒ€ê²Ÿ ì—°ë ¹,'+($('ad-age')?.value||'')+'\n';
csv+='íƒ€ê²Ÿ ì„±ë³„,'+($('ad-gender')?.value||'')+'\n';
csv+='ì§€ì—­,'+($('ad-region')?.value||'')+'\n';
csv+='ê¸°ê°„,'+($('ad-period')?.value||'')+'\n';
const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='ad-simulation-'+new Date().toISOString().slice(0,10)+'.csv';a.click();
addDlHistory('ad','csv','ê´‘ê³ : '+adName);toast('âœ… CSV ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}else{toast('ğŸ“„ ê´‘ê³  ì‹œë®¬ë ˆì´ì…˜ PDFëŠ” ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤');addDlHistory('ad','pdf','ê´‘ê³ : '+adName);}
}

function exportContent(type){
let text='';
if(type==='blog'){
const a=$('blog-rc-a')?.textContent||'';
const b=$('blog-rc-b')?.textContent||'';
const final=$('blog-final')?.textContent||'';
text='[ë¸”ë¡œê·¸ Aì•ˆ]\n'+a+'\n\n[ë¸”ë¡œê·¸ Bì•ˆ]\n'+b+'\n\n[ìµœì¢… ê¸€]\n'+final;
}else if(type==='insta'){
const a=$('insta-rc-a')?.textContent||'';
const b=$('insta-rc-b')?.textContent||'';
text='[ì¸ìŠ¤íƒ€ Aì•ˆ]\n'+a+'\n\n[ì¸ìŠ¤íƒ€ Bì•ˆ]\n'+b;
}else if(type==='fb'){
const a=$('fb-rc-a')?.textContent||'';
const b=$('fb-rc-b')?.textContent||'';
text='[í˜ì´ìŠ¤ë¶ Aì•ˆ]\n'+a+'\n\n[í˜ì´ìŠ¤ë¶ Bì•ˆ]\n'+b;
}
if(!text.replace(/[\[\]A-Za-zì•ˆìµœì¢…ê¸€\s\n]/g,'')){toast('âš ï¸ ë¨¼ì € ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”');return;}
navigator.clipboard.writeText(text).then(()=>{
toast('âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
addDlHistory(type,'text',{blog:'ë¸”ë¡œê·¸',insta:'ì¸ìŠ¤íƒ€ê·¸ë¨',fb:'í˜ì´ìŠ¤ë¶'}[type]+' ì½˜í…ì¸ ');
}).catch(()=>toast('âŒ ë³µì‚¬ ì‹¤íŒ¨'));
}

function generatePeriodReport(){
const from=$('dl-report-from')?.value;
const to=$('dl-report-to')?.value;
if(!from||!to){toast('âš ï¸ ê¸°ê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”');return;}
const incKw=$('dl-inc-kw')?.classList.contains('a');
const incContent=$('dl-inc-content')?.classList.contains('a');
const incAd=$('dl-inc-ad')?.classList.contains('a');
let csv='\uFEFFì¢…í•© ë¦¬í¬íŠ¸\nê¸°ê°„: '+from+' ~ '+to+'\nìƒì„±ì¼: '+new Date().toLocaleDateString('ko-KR')+'\n\n';
if(incKw){
csv+='===== í‚¤ì›Œë“œ ë¶„ì„ =====\n';
csv+='ì›”ê°„ ê²€ìƒ‰ëŸ‰,'+($('kwr-volume')?.textContent||'ë¯¸ë¶„ì„')+'\n';
csv+='ê²½ìŸ ê°•ë„,'+($('kwr-competition')?.textContent||'ë¯¸ë¶„ì„')+'\n';
csv+='íŠ¸ë Œë“œ,'+($('kwr-trend')?.textContent||'ë¯¸ë¶„ì„')+'\n\n';
}
if(incContent){
csv+='===== ì½˜í…ì¸  =====\n';
csv+='ë¸”ë¡œê·¸ ìƒì„± ì—¬ë¶€,'+($('blog-rc-a')?.textContent?'O':'X')+'\n';
csv+='ì¸ìŠ¤íƒ€ ìƒì„± ì—¬ë¶€,'+($('insta-rc-a')?.textContent?'O':'X')+'\n';
csv+='í˜ì´ìŠ¤ë¶ ìƒì„± ì—¬ë¶€,'+($('fb-rc-a')?.textContent?'O':'X')+'\n\n';
}
if(incAd){
csv+='===== ê´‘ê³  =====\n';
csv+='ê´‘ê³ ëª…,'+($('ad-name')?.value||'ë¯¸ì„¤ì •')+'\n';
csv+='ì˜ˆì‚°,'+($('ad-budget-v')?.textContent||'ë¯¸ì„¤ì •')+'\n\n';
}
const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
const a=document.createElement('a');a.href=URL.createObjectURL(blob);
a.download='period-report-'+from+'_'+to+'.csv';a.click();
addDlHistory('period','csv','ì¢…í•© ë¦¬í¬íŠ¸ '+from+'~'+to);
toast('âœ… ì¢…í•© ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
}

// ë‹¤ìš´ë¡œë“œ íƒ­ ì´ˆê¸° ë Œë”
setTimeout(()=>{renderDlHistory()},100);

// ê¸°ì¡´ PDF/CSV ë‹¤ìš´ë¡œë“œì— ì´ë ¥ ì¶”ê°€ í›…
const origDownloadKwrPDF=downloadKwrPDF;
const origDownloadKwrCSV=downloadKwrCSV;

function initLpMockBars(){
const barsEl=$('lp-mock-bars');
if(!barsEl||barsEl.children.length>0)return;
const heights=[40,55,45,70,60,85,75];
const colors=['#f97316','#60a5fa','#34d399'];
heights.forEach((h,i)=>{
const bar=document.createElement('div');
bar.className='lp-mock-bar';
bar.style.height='0';
bar.style.background=colors[i%3];
bar.style.opacity='0.55';
bar.style.transition='height 1s ease '+(i*0.08)+'s';
barsEl.appendChild(bar);
setTimeout(()=>{bar.style.height=h+'%'},50);
});
}
initLpMockBars();

</script></body></html>